<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>游戏推荐：Screeps</title>
      <link href="/posts/2d7ab288.html"/>
      <url>/posts/2d7ab288.html</url>
      
        <content type="html"><![CDATA[<h2 id="前言-17">前言</h2><p>借用<a href="https://screeps.com/">游戏官网</a>的介绍，Screeps 是一款为程序员制作的 MMO 沙盒游戏。“Screeps”意为用脚本（Script）编程控制你的爬虫（Creep）。游戏的核心是通过编写 JavaScript 来控制你的单位，完成资源采集、领地扩张、战斗防御等任务。</p><p>目前游戏有 <a href="https://store.steampowered.com/app/464350/Screeps_World/">Screeps: World</a> 和 <a href="https://store.steampowered.com/app/1137320/Screeps_Arena/">Screeps: Arena</a> 两个版本，前者是 MMO 版本，后者是 PVP 版本。Screeps: Arena 目前还在开发中，并不太稳定。本文介绍 Screeps: World，并简称为 Screeps。</p><h2 id="游戏介绍">游戏介绍</h2><p>不同于其他基于伪代码或图形化界面的编码游戏，Screeps 使用 JavaScript 作为编程语言，这使得玩家可以像编写一个真实的工程项目一样进行开发。然而也正是因为如此，Screeps 的门槛也比较高，需要玩家有一定的编程基础。</p><p>如果你觉得拿不定主意，不知道适不适合自己，那么游戏官网上提供了免费的<a href="https://screeps.com/a/#!/sim/">教程关卡</a>，可以先尝试一下。</p><h2 id="不会玩怎么办？">不会玩怎么办？</h2><p>对于像我一样的编程苦手，以前基本没有接触过 JavaScript，在游玩的时候会遇到很多问题，甚至有很多傻瓜问题。不过不要灰心，如果你能坚持下来，那么你的编程能力一定会有很大的提升（当然，如果体验过免费教程关卡后感觉非常吃力和痛苦的话，那还是应该先学习一些基础的知识，有时放弃并不是胆怯而是种智慧）。</p><ol><li><p>关于 JavaScript 和 TypeScript 的问题，请善用搜索引擎，因为这个过程正是提升编程能力的最佳途径。现在有了大语言模型，这类编程问题问它们效果不错哦。</p></li><li><p>如果你有一些疑问需要他人解答，你可以加入<a href="https://discord.gg/screeps">官方的 Discord 服务器</a>，在里面提问，或者在<a href="https://screeps.com/forum/">官方论坛</a>上提问。当然你也可以加入 qq 群组与 qq 频道，大佬们会为你的疑问提供解决思路（当然，请尊重他人的时间，不要问一些没有价值的问题）。qq 频道可以通过搜索 <code>screeps</code> 关键词找到。</p></li><li><p>Screeps 的<a href="https://docs.screeps.com/index.html">官方文档</a>非常的详细，也有相应的<a href="https://screeps-cn.gitee.io/index.html">汉化版本</a>，也可以解答你的很多疑问。</p></li><li><p>学习大佬的代码。我不少的代码与框架都是都是从 [HoPGoldy] 大佬那里<ruby>借鉴<rt>抄来</rt></ruby>的，真的大有裨益。</p></li><li><p>看教程。<a href="https://www.jianshu.com/p/5431cb7f42d3://www.bilibili.com/video/BV1Q7411B7ZU">这个系列的教程</a>非常详细，由浅入深介绍了游戏内容、环境配置、代码设计与进阶内容，很适合小白入门（比如我）。其中环境配置部分介绍了在 vscode 上编写代码的方法，非常推荐。</p></li></ol><h2 id="游戏体验">游戏体验</h2><p>两年前我曾经上手玩过一次，但因为能力过于欠缺中途放弃。这今天我又重新拾起这款游戏，目前的情况与之前相比已经有了很大的进步（之前甚至是直接在游戏内置的 IDE 里写代码的，非常僵硬）。</p><p>这是目前我的房间情况，还是处于前期发展中。不过我已经品尝到这类长同期、高反馈的编程游戏的甜头了，希望以后能更加精进代码，早日解锁全部建筑（雾）。</p><p><img src="https://cdn.zerolacqua.top/images/blogs/%E6%B8%B8%E6%88%8F%E6%8E%A8%E8%8D%90Screeps/1.png" alt="房间控制等级-LV5"></p><p>游戏游玩过程中，最大的阻碍还是时间。在前期需要很多时间学习文档，虽然教程关卡给出了一些基本的运行方法，但随着房间里的建筑越来越多，简单的逻辑可能就支持不了这些单位的运作了。我经常得花上一整天的时间去调整我的代码结构，以应对不断增大的房间规模。在没有完成自己的第一套代码的情况下（即到达8级的控制等级并有了稳定的代码），玩家是需要花费大量时间在代码上的（时间倒流术警告！），这是最让我觉得痛苦的地方。</p><p>然后就是 JavaScript 上的短板。因为我本身并没有深入学习 JS 和 TS 的语法，在编程过程只能现学现卖，很大程度上影响了我的游戏体验。不过，这样也算是强迫自己去学习 JS 与 TS 知识了。</p><p>最后就是，调试起来真的很麻烦，虽然有单元测试和 server-mockup 测试，但依然不方便调试（我也没去尝试）。调试全在<ruby>生产环境<rt>游戏环境</rt></ruby>进行（乐）。</p><h2 id="总结-2">总结</h2><p>总之，Screeps 是一款非常耐玩且硬核的游戏，有着详尽的文档与有力的社区支持。如果你有一定的编程基础，那么这款游戏能力帮助你更快地提升（JS 和 TS）的编程能力。同时作为一个工程项目，它也能让你的程序设计水平有相当大的提升。投入的时间越多，收获的成就感也就越大！</p>]]></content>
      
      
      <categories>
          
          <category> 游戏 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JavaScript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>QQ 机器人搭建体验</title>
      <link href="/posts/781b999a.html"/>
      <url>/posts/781b999a.html</url>
      
        <content type="html"><![CDATA[<div class="tip warning faa-horizontal animated-hover"><p>本文章还在施工中（多半弃坑了，因为 qq 被风控了）</p></div><h2 id="使用效果">使用效果</h2><p><img src="https://cdn.zerolacqua.top/images/blogs/QQ%E6%9C%BA%E5%99%A8%E4%BA%BA%E6%90%AD%E5%BB%BA%E4%BD%93%E9%AA%8C/1.png" alt="图1"></p><h2 id="参考链接">参考链接</h2><h3 id="零基础搭建搭建">零基础搭建搭建</h3><ul><li><a href="https://juejin.cn/post/7177022630204014653">基于Nonebot2搭建QQ机器人实战篇（一） - 掘金 (juejin.cn)</a></li><li><a href="http://blog.well404.top/categories/NoneBot2%E7%B3%BB%E5%88%97%E6%95%99%E7%A8%8B/">Well404的妙妙屋</a></li><li><a href="https://v2.nonebot.dev/">官方文档</a></li></ul><h2 id="使用插件">使用插件</h2><h3 id="商店插件">商店插件</h3><ul><li><p><a href="https://github.com/mengshouer/nonebot_plugin_analysis_bilibili">nonebot_plugin_analysis_bilibili</a></p></li><li><p><a href="https://github.com/kexue-z/nonebot-plugin-heweather">nonebot-plugin-heweather</a></p><p>报错解决：<a href="https://github.com/kexue-z/nonebot-plugin-htmlrender/issues/25">windows平台启动nonebot-plugin-htmlrender 报错 NotImplementedError · Issue #25 · kexue-z/nonebot-plugin-htmlrender (github.com)</a></p></li><li><p><a href="https://github.com/noneplugin/nonebot-plugin-petpet">nonebot-plugin-petpet</a></p></li><li><p><a href="https://github.com/tkgs0/nonebot-plugin-blacklist">nonebot-plugin-blacklist</a></p></li><li><p><a href="https://github.com/XZhouQD/nonebot-plugin-help">nonebot-plugin-help</a></p></li></ul><h3 id="自编插件">自编插件</h3><ul><li><p>test_derpy_plugin</p><p>获取小马图片。参考了<a href="https://v2.nonebot.dev/docs/tutorial/plugin/example">官方文档</a>和 <a href="https://github.com/tkgs0/nonebot-plugin-blacklist">nonebot-plugin-blacklist</a>，使用 requests 和呆站 API 获取图片数据。</p></li></ul><h2 id="一些问题">一些问题</h2><h3 id="常见问题">常见问题</h3><p>可在<a href="http://blog.well404.top/2022/02/02/nonebot/%E3%80%90NoneBot2%E3%80%91%E7%AC%AC%E4%B8%80%E7%AB%A0%EF%BC%9A%E5%AE%89%E8%A3%85%E5%B9%B6%E9%85%8D%E7%BD%AE%E4%BD%A0%E7%9A%84%E6%9C%BA%E5%99%A8%E4%BA%BA%E5%8F%8A%E5%B8%B8%E8%A7%81%E6%8A%A5%E9%94%99%E7%9A%84%E8%A7%A3%E5%86%B3%E6%96%B9%E6%B3%95/">Well404的妙妙屋</a>中找到大部分常见报错，以下是我的一些白痴问题。</p><h3 id="代码问题">代码问题</h3><ul><li><p>机器人搭好了怎么连接 qq？</p><p>还要用 <code>go-cqhttp</code> 作为 qq 客户端</p></li><li><p>怎么通过 <code>url</code> 发送图片消息？</p><ul><li><p>使用 <code>MessageSegment</code></p></li><li><p>注意要导入适配器的 <code>MessageSegment</code></p></li><li><p>参见：<a href="https://github.com/nonebot/discussions/discussions/">Discussions · nonebot/discussions (github.com)</a></p></li><li><p>例如：</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> nonebot.adapters.onebot.v11 <span class="keyword">import</span> Message, MessageSegment</span><br></pre></td></tr></table></figure></li></ul></li><li><p>实例化 <code>MessageSegment</code> 时无法使用图片（版本相关）</p><ul><li><p>参见：<a href="https://github.com/Mrs4s/go-cqhttp/issues/1660">[Bug]: 使用图文时 警告: 图片上传失败: image type error: application/octet-stream · Issue #1660 · Mrs4s/go-cqhttp (github.com)</a></p></li><li><p>代码应为</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">MessageSegment(<span class="built_in">type</span>=<span class="string">&#x27;image&#x27;</span>, data=&#123;<span class="string">&#x27;file&#x27;</span>:img_url&#125;)</span><br><span class="line"><span class="comment"># 本应该是下面这样的写法的</span></span><br><span class="line">MessageSegment(<span class="built_in">type</span>=<span class="string">&#x27;image&#x27;</span>, data=&#123;<span class="string">&#x27;img&#x27;</span>:img_url&#125;)</span><br></pre></td></tr></table></figure><p>还有其他的方法</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">MessageSegment.image(img_url)</span><br></pre></td></tr></table></figure></li></ul></li><li><p>怎么接收图片为参数？</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 获取包含图像的消息段列表</span></span><br><span class="line">get(<span class="string">&quot;image&quot;</span>)</span><br><span class="line"><span class="comment"># 获取图像 url </span></span><br><span class="line">messagesegment.data.get(<span class="string">&quot;url&quot;</span>, <span class="string">&quot;&quot;</span>)</span><br></pre></td></tr></table></figure></li><li><p>获取呆站图像 url （具体应用场景，与 bot 无关）</p><ul><li><p>呆站 API：<a href="https://trixiebooru.org/pages/api">API - Derpibooru (trixiebooru.org)API - Derpibooru (trixiebooru.org)</a></p></li><li><p>注意 <code>Get</code> 与 <code>Post</code></p></li></ul></li><li><p>权限问题示例</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> nonebot.adapters.onebot.v11 <span class="keyword">import</span> (</span><br><span class="line">  Bot,</span><br><span class="line">  Message,</span><br><span class="line">  Event,</span><br><span class="line">  GroupMessageEvent,</span><br><span class="line">  GROUP_ADMIN,</span><br><span class="line">  GROUP_OWNER</span><br><span class="line">)</span><br><span class="line"><span class="comment"># @xxx.handle()</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">perssion_test</span>(<span class="params">bot: Bot, event: GroupMessageEvent</span>):</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">await</span> SUPERUSER(bot, event):</span><br><span class="line">        <span class="keyword">await</span> xxx.send(<span class="string">&quot;识别到超级用户权限&quot;</span>)</span><br><span class="line">    <span class="keyword">elif</span> <span class="keyword">await</span> GROUP_ADMIN(bot, event):</span><br><span class="line">        <span class="keyword">await</span> xxx.send(<span class="string">&quot;识别到管理员权限&quot;</span>)</span><br><span class="line">    <span class="keyword">elif</span> <span class="keyword">await</span> GROUP_OWNER(bot, event):</span><br><span class="line">        <span class="keyword">await</span> xxx.send(<span class="string">&quot;识别到群主权限&quot;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="comment"># await xxx.finish(&quot;您没有权限（无慈悲）&quot;)</span></span><br><span class="line">        <span class="keyword">await</span> xxx.send(<span class="string">&quot;识别到普通权限&quot;</span>)</span><br></pre></td></tr></table></figure></li></ul><h3 id="服务器上部署（CentOS-7-6）">服务器上部署（CentOS 7.6）</h3><ul><li><p><code>go-cqhttp</code> 无法执行</p><p>在 <a href="https://github.com/Mrs4s/go-cqhttp/releases">Releases · Mrs4s/go-cqhttp (github.com)</a> 中选择合适的程序</p></li><li><p>playwright 失败的解决方法</p><p><a href="https://github.com/microsoft/playwright/issues/5780#issuecomment-968091413">[Question] Support for CentOS · Issue #5780 · microsoft/playwright (github.com)</a></p></li><li><p>下载 chrome 与 chromeDriver</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">yum install https://dl.google.com/linux/direct/google-chrome-stable_current_x86_64.rpm</span><br></pre></td></tr></table></figure><p><a href="https://chromedriver.chromium.org/home">ChromeDriver - WebDriver for Chrome (chromium.org)</a></p></li><li><p>Tmux 后台运行机器人</p><p><a href="https://www.ruanyifeng.com/blog/2019/10/tmux.html">Tmux 使用教程 - 阮一峰的网络日志 (ruanyifeng.com)</a></p></li><li><p>查看进程信息</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">ps -elf</span><br></pre></td></tr></table></figure></li><li><p>关闭进程</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">killall -u username</span><br><span class="line"><span class="comment"># 或者</span></span><br><span class="line">pgrep -u ttlsa | xargs <span class="built_in">kill</span> -9</span><br></pre></td></tr></table></figure></li><li><p>安装字体</p></li></ul>]]></content>
      
      
      <categories>
          
          <category> 编程学习 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 各种摸鱼 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>关于最近的一些事情</title>
      <link href="/posts/53e8e35.html"/>
      <url>/posts/53e8e35.html</url>
      
        <content type="html"><![CDATA[<p>不知不觉，建站快一年了。这一年来的收获太多太多，仿佛打开了一个全新的世界。以前我也喜欢搞陌生东西，但从来没有像这般的大手笔。在经历了这一年之后，我更有勇气去尝试些新东西了。以前的我畏畏缩缩，总是在徘徊犹豫。但是现在依然还有足够的试错时间，让我去品尝各种有趣的东西。希望这些个人爱好，能在未来以我意想不到的方式帮助到我。</p><p>这段时间正值毕业设计的重要关头，所以很遗憾没有写什么博客。之前有那么些时间也是一直美化网站，并没有写什么实质性的内容。本来是有打算写一写关于 QQ Bot 的内容的，但是时间已然不够，所以只得放到以后再写了。期间笔记内容的更新倒是频繁一些，不过也没多少就是了。</p><p>想着真的到了二月底的时候我肯定就是天天待在实验室赶工了，所以就提前写了这么个简单的回顾（其实元旦的时候也有在<code>日记</code>里写回顾，所以就不展开写了）。</p><p>总之，希望自己能够顺利毕业，之后的个人博客也能正常地建设下去！</p>]]></content>
      
      
      <categories>
          
          <category> 随笔 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 吐槽 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>计算思维</title>
      <link href="/posts/4263a541.html"/>
      <url>/posts/4263a541.html</url>
      
        <content type="html"><![CDATA[<h2 id="前言-18">前言</h2><p>第一次接触 <code>Julia</code> 是在学习《矩阵计算》的时候，当时看到这个名字我就被吸引了（比某 <code>Rust</code> 好听多了，雾）。后来稍微学习了一下 <code>Julia</code> 的语法，并接触了 <code>pluto</code> 这个交互式的笔记，感觉蛮有意思的。前几天看到 MIT 的这个<a href="https://computationalthinking.mit.edu/Fall22/"><b>计算思维</b></a>课程，发现它使用的是 <code>Julia</code> 的 <code>pluto</code> ，我直接来电，打算学学这个课程。</p><h2 id="准备">准备</h2><ul><li><p>如何使用 <em>vscode</em> 配置 <em>Julia</em> 环境<br><a href="https://zhuanlan.zhihu.com/p/163809924">VScode + Julia 1.5.0 配置使用超详细完全排坑指南(包括设置国内镜像源) - 知乎 (zhihu.com)</a></p><ul><li><p>下载</p></li><li><p>配置环境变量<br><a href="https://cn.julialang.org/JuliaZH.jl/latest/manual/environment-variables/index.html">环境变量 · Julia中文文档 (julialang.org)</a></p><p>如果以后不想把包安装在系统盘里的话，请设置<code>JULIA_DEPOT_PATH</code> 环境变量</p></li><li><p>安装插件</p></li><li><p>设置国内镜像</p></li></ul></li><li><p><em>vscode</em> 使用 <em>Julia</em><br><a href="https://www.julia-vscode.org/docs/stable/">Home · Julia in VS Code (julia-vscode.org)</a></p><ul><li><p>推荐网页</p><ul><li><a href="https://www.math.pku.edu.cn/teachers/lidf/docs/Julia/html/_book/index.html">Julia语言入门 (pku.edu.cn)</a></li></ul></li></ul></li></ul><h2 id="开始">开始</h2><p>所有课程都在 <code>Pluto</code> 上运行的，在开始前运行 <code>Pluto</code></p><figure class="highlight julia"><table><tr><td class="code"><pre><span class="line"><span class="keyword">using</span> Pluto</span><br><span class="line">Pluto.run()</span><br></pre></td></tr></table></figure><p>在课程页面中选择一节课程，点击 <em>Edit or run this notebook</em> 按提示方式运行笔记本（当然是要在自己的 <code>Pluto</code> 上跑了，在线版本真的很慢！），不然只能看静态的，然而动态即时交互才是 <code>Pluto</code> 的灵魂啊！</p><p>本来还想搞一点笔记的，但是用了 <code>Pluto</code> 我都只是在 <code>Pluto</code> 里做题，啥也没写……想想那就只写一点感受吧。</p><p>在学习了三四节课程加上做了两次作业以后，我发现这门课确实是个帮助学习 <code>Julia</code> 好方式。虽然写循环并不会对速度产生太大影响，但是向量化函数点语法和数组推导式真的能省很多事。尤其是第二次作业涉及到很多图像处理的内容，能省事为什么不省呢？</p><p>实时交互让图像变形变得更加直观易懂，虽然多数交互还只是滑动条什么的，但是已经很不错了。</p><p>关于作业的代码，请参考仓库分支：</p>  <a class="ghcard" rel="external nofollow noopener noreferrer" href="https://github.com/ZerolAcqua/ComputationalThinking"><img src="https://github-readme-stats.zerolacqua.top/api/pin/?username=ZerolAcqua&repo=ComputationalThinking&show_owner=true"/></a>]]></content>
      
      
      <categories>
          
          <category> 编程学习 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Julia </tag>
            
            <tag> 数值分析 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>记一次博客迁移历程</title>
      <link href="/posts/9a76c0ee.html"/>
      <url>/posts/9a76c0ee.html</url>
      
        <content type="html"><![CDATA[<h3 id="服务器与域名">服务器与域名</h3><p>域名是之前就已经准备好了的，是在阿里云上购买的。服务器是在腾讯云上购买的轻量级应用服务器，优惠的时候入的大概六十多一年吧，不过这个价格应该不会持久，以后恢复原价了大概就是一年六百了（心疼，一发 648）。</p><h3 id="博客由-Github-Page-迁移至腾讯云服务器">博客由 Github Page 迁移至腾讯云服务器</h3><p><strong>2022.10.25</strong></p><p>这篇教程不愧是保姆级教程，基本上解决了大部分的问题，步骤详细。我这种零基础小白基本上也就大半天功夫就搞好了。</p><p><a href="https://hjxlog.com/posts/20191130a1.html">将Hexo部署到阿里云轻量服务器（保姆级教程） | HJX’s Site (hjxlog.com)</a></p><p>下面我只把我遇到的问题，以及我觉得需要注意的地方列出。</p><ul><li><p>在创建 <code>repo</code> 仓库和 <code>hexo</code> 目录时，请更换一个目录，不要放在 <code>var</code> 中，在后续宝塔的操作中可以避免不少麻烦（宝塔不让用 <code>var</code> 作网站目录）。</p></li><li><p>如果你更换了 <code>repo</code> 仓库和 <code>hexo</code> 目录，请记得修改教程中的所有相关目录。尤其是创建钩子文件 <code>post-receive</code> 的时候</p>  <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">#!/bin/bash</span><br><span class="line">git --work-tree=[yourpath]/hexo --git-dir=[yourpath]/repo/hexo.git checkout -f</span><br></pre></td></tr></table></figure><p><code>--work-tree</code> 和 <code>--git-dir</code> 都要进行修改！</p></li><li><p>安装宝塔时，会提示是否在 <code>/www</code> 目录下安装（出于纯净性的考虑它没在 <code>var</code> 目录下安装），同意即可。</p></li><li><p>最好在 hexo 三连之前就给权限</p>  <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">chown -R git:git [yourpath]/repo/</span><br><span class="line">chown -R git:git [yourpath]/hexo/</span><br></pre></td></tr></table></figure><p>不然提交时可能会出现 <code>.user.ini</code> 无法处理的情况。如果已经出现 <code>.user.ini</code> 并且处理不了的话，使用</p>  <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">chattr -i .user.ini</span><br></pre></td></tr></table></figure><p>去除保护，并清空文件夹。给完权限，再 <code>hexo</code> 三连（前面 <code>clean</code> 和 <code>generate</code> 已经做了的话，直接 <code>deploy</code> 就好了？）。</p></li><li><p>在设置 <code>_config.yml</code> 文件时，<code>branch</code> 是 <code>master</code> 不是 <code>main</code> 。当然，这是最省事的方法，使用其他分支应该也有办法，不过这就请你自己去找方法了。可能是默认分支是 <code>master</code> 的原因，提交到 <code>main</code> 是打不开网站的（<code>hexo</code> 文件夹是没有部署东西的）。</p>  <figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">deploy:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">type:</span> <span class="string">git</span></span><br><span class="line">    <span class="attr">repository:</span> <span class="string">git@[your.ip.your.ip]:[yourpath]/repo/hexo.git</span>  <span class="comment">#你的仓库地址</span></span><br><span class="line">    <span class="attr">branch:</span> <span class="string">master</span></span><br></pre></td></tr></table></figure></li></ul><p>这样，在完成那个保姆教程后，你应该可以通过你填写的 IP （你域名肯定填的公网 IP 吧。至少我是暂时填的 IP）直接访问到了。其它问题的话，问度娘吧。</p><h3 id="域名-ICP-备案">域名 ICP 备案</h3><p>如果服务器与域名不是同一家的话，会有点麻烦（没错的就是我！）。按照阿里云的相关文档，域名是阿里云的，而服务器是腾讯云，应当通过腾讯云平台备案。</p><p><strong>2022.10.26</strong></p><p>上午提交，中午备案被腾讯云驳回。</p><ul><li>网站名不符合要求（大悲，丘卡的饮品店要换招牌了）。</li><li>采集视频中背景不是纯白（宿舍楼光线不好），人脸不是正脸（我的锅）。</li></ul><p>下午修改后，很快腾讯云的审核就过了，感觉还没有半个小时？然后就是等待管局审批。</p><p><strong>2022.10.27</strong></p><p>准备公安备案，注册账号，开办主体信息提交审核。</p><p>然后仔细搜了一下，发现公安备案如果是交互式网站，需要面审或实地审核（？疫情封校也不现实啊，而且我最近时间也并不是很闲啊？！）非交互式的省事一点，但是博客的评论多半是不能要了。</p><p><strong>2022.11.1</strong></p><p>ICP 备案申请通过审核，准备将域名接入（ICP 备案号都下来了，开办主体申请都还没消息x）。</p><h3 id="域名更换">域名更换</h3><p>由于之前 Github 上的博客我还不想放弃（毕竟评论啥的是灵魂啊），所以我决定把原来的博客从一级域名 <code>zerolacqua.top</code> 放在二级域名 <code>blog.zerolacqua.top</code> 下，这就意味着有很多需要修改的。比如 <code>CNAME</code> 文件需要修改， <code>_config.yml</code> 和 <code>_config.butterfly.yml</code> 中相关的 <code>url</code> 也需要进行替换。好在大多数都是相对地址，要改动的不是很多。朋友圈的友链页面 <code>url</code> 、<code>Waline</code> 关于本网站网址的环境变量需要修改。此外，用于网站提交的相关信息，也需要注意及时更新。</p><p>同时，别忘记修改站外的相关信息啊。比如提供新友链给友站，还有个人社交账号中的主页信息等等。</p><h3 id="域名管理">域名管理</h3><p>备案号下来兴高采烈设置完解析，结果怎么也没不上，公网 IP 能进入博客，A 类型记录解析到服务器 IP 却访问不了，很是郁闷啊。</p><p>实际上，阿里云域名要想在腾讯云服务器上使用，需要在阿里云域名控制台中修改域名 DNS 服务器地址，<strong>把域名管理权交给腾讯云</strong>。然后，之前在阿里云配置的域名记得要在腾讯云重新配置一遍~可以参见：<a href="https://www.vpsss.net/17001.html">阿里云域名如何在腾讯云服务器解析使用的具体流程-魏艾斯笔记 (vpsss.net)</a></p><p>然后你还记得之前在宝塔中配置时网站域名填的是什么吗？如果填的不是域名，域名应该是访问不了的，记得换成你已经准备好的域名。</p><p>SSL 证书免费申请一下吧（亚洲诚信），不然 <code>https</code> 用不了哦~申请证书还蛮快的，在腾讯云的“我的证书”中选择“手动部署”可以下载证书的 <code>.key</code> 和 <code>.pem</code> 然后贴到宝塔里就好。</p><h3 id="腾讯云-CDN-加速">腾讯云 CDN 加速</h3><p>想使用白嫖的腾讯云 CDN 流量加速，结果配了一天都没能配好，也不知道到底是哪儿出问题了……作罢作罢。</p><p><strong>2022.11.29</strong></p><p>事实证明，不用 CDN 真的慢出天际了，还不如我在 github 搭建的网站，等哪天我有空了再试试吧（</p><p><strong>2023.1.8</strong></p><p>由于这几天免费 CDN 频繁出问题，想起来自己配的腾讯云 CDN。结果居然异常地顺利。可能上次配 CDN 的时候，没有理解源站域名和加速域名的区别，导致了失败。</p><p>在配置完成后，还可以申请 SSL 证书证书（参考前述内容）。在使用中可能会出现跨域问题，需要在<code>腾讯云内容分发网络-&gt;域名管理-&gt;高级配置</code>中设置 <code>HTTP 响应头配置</code>（记得配置状态一定要开启，别像我一样改完配置笨笨地找半天）</p><p>可参考：</p><ul><li><a href="https://cloud.tencent.com/document/product/228/60739">内容分发网络 CDN &gt; 故障处理 &gt; 页面展示异常-访问跨域报错</a></li><li><a href="https://cloud.tencent.com/developer/article/1556468">HTTP跨域详解和解决方式 - 腾讯云开发者社区-腾讯云 (tencent.com)</a></li><li><a href="https://www.cheshirex.com/4824.html">网站调用CDN静态资源遇到跨域问题，报错CORS error | 柴郡猫 (cheshirex.com)</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> 博客相关 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 博客搭建 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>选择</title>
      <link href="/posts/7b2c5414.html"/>
      <url>/posts/7b2c5414.html</url>
      
        <content type="html"><![CDATA[<div class="tabs" id="请选择"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#请选择-1">A</button></li><li class="tab"><button type="button" data-href="#请选择-2">B</button></li><li class="tab"><button type="button" data-href="#请选择-3">&nbsp</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="请选择-1"><center><font size=5px>请 选 择</font></center><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="请选择-2"><p>我在想，该怎样写一篇随笔，才能让它读起来不像以前的日记一样，字里行间全是怨天尤人的味道。以前的日记，总有一种诉说不甘，不该“流落至此”的感觉，总是在遗憾自己为什么不能做得更好一点。但是，当时自认为虎落平阳的我，现在在武大也只是前十几名。最后虽然侥幸拿到了保研资格，却也只是保研本校。我开始思考，我是怎么慢慢走到这个地步的？</p><p>我潜意识里对考入武大并不满意。从高中开始（甚至初中开始），我就一直被老师们寄予厚望，他们认为我是能考清北的种子选手。然而现实证明我只是个很普通的人，只是个陪跑的人。但是，这种期望与现实的强烈落差让我很沮丧，甚至开始后悔高中时做出的参加竞赛的选择。如果没有当时学习竞赛花费的大半年时间……</p><p>到了大学，我自信地认为只要搞好学习就可以了。大学期间我的学习成绩还是比较不错的。大二的时候，老师就告诉我需要参加一些社会实践与比赛。后来，我也确实参加了一些，比如说八段锦比赛、软件开发比赛，结果就是那段时间无比紧张，最后也没有什么特别好的成绩，就作罢了。我想，我这个绩点应该也可以碾压他们了吧。结果，到了评奖学金、评保研排名的时候，我怎么也不知道其他人是怎么靠比赛、论文和专利拿到那么多分的。我终于意识到我努力错了方向，与其在分数上卷，不如在比赛、论文和专利上多出力气，至少这些以后比绩点更有说服力。我后悔了，后悔当时为什么没有去主动参赛比赛，只是在有人邀请时，才去打一打比赛。</p><p>最后，有着不错成绩的我最终选择了留在了武大。看着自己认识的不认识的，都去了更好的大学，而我还是留在了武汉大学，心里总是有些不太好受。尤其是那些感觉平时“不如”（真的吗？）我的人，最后却还去了中科大、清北啥的，更是让我觉得 emo 。当时也不知道为什么，我从一开始就没有去准备参加其他院校的夏令营。虽然当时我室友说了我很有希望上其他的学校的，但是我又有太多的顾虑，比如担心准备其它学校的夏令营结果连本校的夏令营优营都拿不到什么的；比如我已经先找了一个本校的导师，再去参加外校的之后会不会做毕设的时候被卡；再如摄影测量这种冷门专业，外校的实力可能也没有本校强，等等。在保研的比赛已经结束之后，我才知道我与他人的信息差有多么的大，之前那些顾虑只是不愿走出舒适区的借口罢了。我又在后悔为什么没有早做准备早点了解其他高校的情况。</p><p>同方向的一个室友也选择了保研本校。但是他选择的是做深度学习的老师，而我选择的是做摄影测量的老师（也有一点计算机视觉？）当我看到他这三四个月的学习已经有了成果的时候，我焦虑了！即使是和我路线最相似的同学，后面选择的道路也似乎比我顺利。</p><p>说白了，还是因为对未来感到焦虑了吧。永远都看着别人的好，永远都在拿自己和别人比，永远都在看别人的成果，这也是我上大学以来焦虑的根源吧。</p><p>不管怎样，最终还是要接受现实。每个阶段都有每个阶段的选择，选择过后，就只能继续前进了。就像高尔顿板的一个个分叉口，落向了一边，就意味着放弃了另一半的可能。虽然还存在逆转的机会，但那终究是少部分人的幸运。</p><p>正因为无法知晓“如果”的可能性，我才会幻想另一种选择会是更好的，自己选的是更差的。正是害怕这个结果，才会在每一次关键的选择中犹豫不决。也正如高尔顿板预言的结果一样，大部分人都是平庸的人，既不是最坏也不是最好。经历了许多事、许多选择后，我也不得不承认自己只是正态分布的普通一员。</p><p>如果永远都在为错失了更好的选择而沉湎于后悔之中，那就没有时间让自己的选择变为更好的选择了。后悔无用，正视自己的选择，对自己的选择负责，这才是更好的选择。希望自己今后不再陷入后悔与自责的泥潭，而是吸取教训，更自信地前进。</p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="请选择-3"><center><font size=5px>未选择的路</font></center><center><font size=2px>罗伯特·弗罗斯特</font></center><center>黄色的树林里分出两条路，</center><center>可惜我不能同时去涉足，</center><center>我在那路口久久伫立，</center><center>我向着一条路极目望去，</center><center>直到它消失在丛林深处。</center><center>但我却选了另外一条路，</center><center>它荒草萋萋，十分幽寂，</center><center>显得更诱人、更美丽，</center><center>虽然在这条小路上，</center><center>都很少留下旅人的足迹，</center><center>虽然那天清晨落叶满地，</center><center>两条路都未经脚印污染。</center><center>啊，留下一条路等改日再见！</center><center>但我知道路径延绵无尽头，</center><center>恐怕我难以再回返。</center><center>也许多少年后在某个地方，</center><center>我将轻声叹息把往事回顾，</center><center>一片树林里分出两条路，</center><center>而我选了人迹更少的一条，</center><center>因此走出了这迥异的旅途。</center><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div>]]></content>
      
      
      <categories>
          
          <category> 随笔 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 吐槽 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Zotero 教程</title>
      <link href="/posts/aedb3e8c.html"/>
      <url>/posts/aedb3e8c.html</url>
      
        <content type="html"><![CDATA[<div class="tip warning faa-horizontal animated-hover"><p>本文章还在施工中</p></div><h2 id="前言-6">前言</h2><p>文献管理不得不学了。从几个软件中选了 <a href="https://www.zotero.org/"><i>Zotero</i></a> ，这里记录学习的一些技巧。</p><h2 id="功能">功能</h2><h3 id="Zotero-Connector">Zotero Connector</h3><p><code>Zotero Connector</code> 作为 Zotero 官方自带的浏览器插件，能快速把你正在浏览的网页、文献保存到 <code>Zotero</code> 中（只要 <code>Zotero</code> 处于打开状态）。如果是普通网站，它可以保存网页的快照。而如果是某些文献数据库网页，且文献可以下载，则它可以直接把文献保存到 <code>Zotero</code> 中，很方便啊有没有。</p><h3 id="云同步功能">云同步功能</h3><p><code>Zotero</code> 附带有云同步功能，每个账号拥有免费的 300MB 云空间，可用于同步附件（注意，文献的标题、作者等信息<strong>不属于附件</strong>，目前来看应该是免费同步的，而下载的文献 PDF 是附件形式，需要同步），不过 300MB 对于文献库的使用来说，有点不够塞牙缝，一旦存储空间用尽，文献附件就无法同步。</p><p>利用云盘存储文献附件，能更好地发挥云同步的优势。目前，利用云盘的同步有两种方式：</p><ul><li><code>WebDAV</code> 直接同步。<ul><li>配置方便</li><li>文件名是无意义的字符组合，无法直接以 <code>pdf</code> 格式打开</li><li><code>Zotero</code> 删除文件后，云端会同步删除</li></ul></li><li>利用 <code>ZotFile</code> 间接同步，即利用云盘的同步文件夹进行本地与云端的同步，然后利用 <code>ZotFile</code> 将文件在同步文件夹与 <code>Zotero</code> 文件夹之间迁移。<ul><li>文件名是有意义的，可以知道是什么文献</li><li><code>Zotero</code> 删除文件后，云端无法同步删除</li></ul></li></ul><p>丘卡选择的是方式一，国内支持 <code>WebDAV</code> 的云盘不多，坚果云是为数不多的几个，它的免费版每个月有 1GB 的免费上传流量和 5GB 的下载流量，已经够用啦~</p><p>注册坚果云后在安全选项中添加应用，获取应用密码。</p><p><img src="https://s1.ax1x.com/2022/10/01/xuqwQI.png" alt=""></p><p>然后在 <code>Zotero</code> 中将坚果云的服务器地址复制到 URL 中，就配置完毕，可以愉快地多电脑同步啦~</p><p><img src="https://s1.ax1x.com/2022/10/01/xuq0yt.png" alt=""></p><h3 id="RSS-订阅">RSS 订阅</h3><p>没错，<i>Zotero</i> 是可以添加 RSS 订阅的，作为一个文献管理软件，订阅期刊什么的还是挺重要的（当然你也可以去订阅博客）。</p><p>点击菜单栏的按钮，选择新建订阅。然后按照相应的方式就可以添加订阅啦！</p><p><img src="https://s1.ax1x.com/2022/10/20/x6PMV0.png" alt=""></p><h3 id="生成参考文献">生成参考文献</h3><p>一方面，你可以通过生成 BibTeX 在 LaTeX 中方便地生成引文。另一方面，若是想在 word 里使用，<i>Zotero</i> 也可以直接生成文本，只需要将文献库中的文献拖拽到 word 中即可完成。当然，若是想导出国标的引文格式，只需要在<code>编辑</code> -&gt; <code>首选项</code> -&gt; <code>导出</code>中将项目改为你想要的引文格式即可。</p><h2 id="其他">其他</h2><h3 id="插件">插件</h3><p>为什么先从插件写起呢，因为好写啊，而且我先开始也是从插件学起的。</p><h4 id="Better-BibTeX-for-Zotero">Better BibTeX for Zotero</h4><p><i>Zotero</i> 可以导出分类或导出条目，对应的是一组文献和单个文献。右击菜单中选择<code>导出XX</code>，就可以导出相应的 <code>.bib</code> 文件。但是，它默认导出的 <code>.bib</code> 文件有很多不必要的信息。这时，我们可以使用 <a href="https://retorque.re/zotero-better-bibtex/"><code>Better BibTeX for Zotero</code></a> 插件优化 <code>.bib</code> 文件的导出内容。</p><p>我在<code>首选项</code>的 <code>Better BibTeX</code> 中设置了如下选项：</p><ul><li><code>Citation Keys</code> -&gt; <code>Citation key formula</code><br><code>auth.fold.capitalize + year</code></li><li><code>Export</code>-&gt;<code>Fields</code>-&gt;<code>Fields to omit from export</code><br><code>note,keywords,url,doi,shorttitle,abstract,urldate,langid,file</code>。</li></ul><p>需要注意的是对于 <code>Zotero 5.0</code> 之后的版本，修改 <code>Citation Keys</code>，<code>Zotero</code> 并不能自动刷新。需要手动刷新。进主目录<code>我的文库</code>，全选右侧的全部文献，右键选择 <code>Better Bibtex</code>-&gt;<code>Refresh Bibtex Key</code>。</p><p>参考：<a href="https://zhuanlan.zhihu.com/p/458340252">知乎：Zotero Better BibTex 选项配置推荐(个人)</a></p><h4 id="Zotero-PDF-Translate">Zotero PDF Translate</h4><p><a href="https://github.com/windingwind/zotero-pdf-translate#readme">Zotero PDF Translate</a> 支持内置 PDF 阅读器的划词翻译，并能将翻译直接添加到笔记中。对于注释，该插件也能自动进行翻译。翻译效果中规中矩，对词汇积累不够的人很有帮助。</p><h4 id="Jasminum">Jasminum</h4><p><a href="https://github.com/l0o0/jasminum">Jasminum</a> 一个简单的 Zotero 中文插件（这个插件并不是 Zotero translator），能拆分或合并 Zotero 中条目作者姓和名，并根据知网上下载的文献文件来抓取引用信息（根据文件名）。</p><h4 id="Night-for-Zotero">Night for Zotero</h4><p>Zotero 黑色主题插件 <a href="https://github.com/tefkah/zotero-night">Night for Zotero</a>，让你在看 pdf 的时候眼睛不必饱受白色的折磨。</p>]]></content>
      
      
      <categories>
          
          <category> 软件 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 文献管理 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Lua 学习记录</title>
      <link href="/posts/3944b39.html"/>
      <url>/posts/3944b39.html</url>
      
        <content type="html"><![CDATA[<h2 id="前言-5">前言</h2><p>啊，我真的懒得写了。明明应该好好学 <code>Python</code> 的，怎么学起 <code>Lua</code> 了……</p><p>其实，我是看到别人用 <code>Lua</code> 和 <code>LÖVE</code> 框架做了俄罗斯方块，自己也想做一个，才研究了一下 <code>Lua</code> （明明 <code>Python</code> 也可以做啊）。</p><h2 id="配置-2">配置</h2><h3 id="Lua">Lua</h3><p><code>Lua</code> 在<a href="https://www.lua.org/">官网</a>上下载即可，然后配置环境变量，将包含 <code>Lua</code> 的文件夹路径加入环境变量中。之后就可以在命令行执行：</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">lua54</span><br></pre></td></tr></table></figure><p>显示相关信息，则说明 <code>Lua</code> 配置成功。要注意的是，下载的版本不同，执行的命令可能也不同，我的版本是 <code>lua-5.4.2</code> 。这一问题在后面配置 <i>VSCode</i> 时还会遇到。</p><h3 id="LOVE">LÖVE</h3><p><code>LÖVE</code> 在<a href="https://love2d.org/">这里</a>下载，配置环境变量。将包含 <code>LÖVE</code>  的文件夹路径加入环境变量中。之后在命令行执行：</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">love</span><br></pre></td></tr></table></figure><p>会启动默认的 <code>LÖVE</code> 程序。</p><h3 id="VSCode">VSCode</h3><p>没错，我还是想用 <i>VSCode</i> ，所以就需要配置一下了。</p><p><i>VSCode</i> 需要使用相应的拓展。我使用的是 <code>Code Runner</code> 和 <code>Love2D Support</code> ，在配置拓展时，需要对 <code>Code Runner</code> 的默认配置进行修改，并设置 <code>love.exe</code> 的路径（我也不知道为什么还要再设一次路径，明明有环境变量了）。</p><figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="attr">&quot;code-runner.executorMap&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line"><span class="attr">&quot;lua&quot;</span><span class="punctuation">:</span> <span class="string">&quot;lua54&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;pixelbyte.love2d.path&quot;</span><span class="punctuation">:</span> <span class="string">&quot;xxx\\love-11.4-win64\\love.exe&quot;</span><span class="punctuation">,</span></span><br></pre></td></tr></table></figure><p><code>Code Runner</code> 是用来跑 <code>Lua</code> 的， <code>Love2D Support</code> 是跑 <code>LÖVE</code> 的。在 <code>Love2D Support</code> 拓展的设置中，可以设置开启 <code>LÖVE</code> 的控制台，这样就能看见 <code>print()</code>的输出了（<del>草</del>）。</p><h3 id="测试">测试</h3><p>测试 <code>Lua</code> 的情况。</p><figure class="highlight lua"><table><tr><td class="code"><pre><span class="line"><span class="built_in">print</span>(<span class="string">&quot;hello world!&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;你好，世界！&quot;</span>)</span><br></pre></td></tr></table></figure><p>如果中文输出出现乱码，很有可能因为使用的终端是 <code>cmd</code> ，有两种方法解决该问题。第一种方法是将使用的终端改为 <code>powershell</code>；第二种方法则是将 <code>cmd</code> 的编码改为 <code>UTF-8</code> 。</p><figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="attr">&quot;terminal.integrated.defaultProfile.windows&quot;</span><span class="punctuation">:</span> <span class="string">&quot;PowerShell&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;terminal.integrated.shellArgs.windows&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;/K chcp 65001 &gt;nul&quot;</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br></pre></td></tr></table></figure><p>测试 <code>LÖVE</code> 的情况。</p><figure class="highlight lua"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 初始化矩形的一些默认值</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">love.load</span><span class="params">()</span></span></span><br><span class="line">    x, y, w, h = <span class="number">20</span>, <span class="number">20</span>, <span class="number">60</span>, <span class="number">20</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 每一帧增加矩形的尺寸</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">love.update</span><span class="params">(dt)</span></span></span><br><span class="line">    w = w + <span class="number">1</span></span><br><span class="line">    h = h + <span class="number">1</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 绘制有颜色的矩形</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">love.draw</span><span class="params">()</span></span></span><br><span class="line">    love.graphics.setColor(<span class="number">0</span>, <span class="number">100</span>, <span class="number">100</span>)</span><br><span class="line">    love.graphics.rectangle(<span class="string">&quot;fill&quot;</span>, x, y, w, h)</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure><p>按住 <kbd>Alt</kbd> + <kbd>L</kbd>，应当会有 <code>LÖVE</code> 程序启动，绘制一个不断变大的青色矩形。当然，拓展的这个快捷键可以在设置中进行修改。</p><h2 id="编写游戏">编写游戏</h2><h3 id="基础">基础</h3><h4 id="配置文件">配置文件</h4><p>在游戏目录中的 <code>conf.lua</code> 文件夹，会在 <code>LÖVE</code> 模块加载前运行，可以使用该文件重写 <code>love.conf</code> 函数。</p><p><code>love.conf</code> 函数有一个参数，该参数是一个包含所有默认值的 <code>table</code> 类型参数。通过 <code>love.conf</code> 函数，可以修改默认值，关闭不需要的模块：</p><figure class="highlight lua"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">love.conf</span><span class="params">(t)</span></span></span><br><span class="line"><span class="comment">-- 修改默认值</span></span><br><span class="line">    t.window.width = <span class="number">1024</span></span><br><span class="line">    t.window.height = <span class="number">768</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">-- 关闭不需要的模块</span></span><br><span class="line">    t.modules.joystick = <span class="literal">false</span></span><br><span class="line">    t.modules.physics = <span class="literal">false</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure><p>以下是 <code>11.3</code> 和 <code>11.4</code> 的全部默认值：</p><figure class="highlight lua"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">love.conf</span><span class="params">(t)</span></span></span><br><span class="line">    t.identity = <span class="literal">nil</span>                    <span class="comment">-- The name of the save directory (string)</span></span><br><span class="line">    t.appendidentity = <span class="literal">false</span>            <span class="comment">-- Search files in source directory before save directory (boolean)</span></span><br><span class="line">    t.version = <span class="string">&quot;11.3&quot;</span>                  <span class="comment">-- The LÖVE version this game was made for (string)</span></span><br><span class="line">    t.console = <span class="literal">false</span>                   <span class="comment">-- Attach a console (boolean, Windows only)</span></span><br><span class="line">    t.accelerometerjoystick = <span class="literal">true</span>      <span class="comment">-- Enable the accelerometer on iOS and Android by exposing it as a Joystick (boolean)</span></span><br><span class="line">    t.externalstorage = <span class="literal">false</span>           <span class="comment">-- True to save files (and read from the save directory) in external storage on Android (boolean) </span></span><br><span class="line">    t.gammacorrect = <span class="literal">false</span>              <span class="comment">-- Enable gamma-correct rendering, when supported by the system (boolean)</span></span><br><span class="line"></span><br><span class="line">    t.audio.mic = <span class="literal">false</span>                 <span class="comment">-- Request and use microphone capabilities in Android (boolean)</span></span><br><span class="line">    t.audio.mixwithsystem = <span class="literal">true</span>        <span class="comment">-- Keep background music playing when opening LOVE (boolean, iOS and Android only)</span></span><br><span class="line"></span><br><span class="line">    t.window.title = <span class="string">&quot;Untitled&quot;</span>         <span class="comment">-- The window title (string)</span></span><br><span class="line">    t.window.icon = <span class="literal">nil</span>                 <span class="comment">-- Filepath to an image to use as the window&#x27;s icon (string)</span></span><br><span class="line">    t.window.width = <span class="number">800</span>                <span class="comment">-- The window width (number)</span></span><br><span class="line">    t.window.height = <span class="number">600</span>               <span class="comment">-- The window height (number)</span></span><br><span class="line">    t.window.borderless = <span class="literal">false</span>         <span class="comment">-- Remove all border visuals from the window (boolean)</span></span><br><span class="line">    t.window.resizable = <span class="literal">false</span>          <span class="comment">-- Let the window be user-resizable (boolean)</span></span><br><span class="line">    t.window.minwidth = <span class="number">1</span>               <span class="comment">-- Minimum window width if the window is resizable (number)</span></span><br><span class="line">    t.window.minheight = <span class="number">1</span>              <span class="comment">-- Minimum window height if the window is resizable (number)</span></span><br><span class="line">    t.window.fullscreen = <span class="literal">false</span>         <span class="comment">-- Enable fullscreen (boolean)</span></span><br><span class="line">    t.window.fullscreentype = <span class="string">&quot;desktop&quot;</span> <span class="comment">-- Choose between &quot;desktop&quot; fullscreen or &quot;exclusive&quot; fullscreen mode (string)</span></span><br><span class="line">    t.window.vsync = <span class="number">1</span>                  <span class="comment">-- Vertical sync mode (number)</span></span><br><span class="line">    t.window.msaa = <span class="number">0</span>                   <span class="comment">-- The number of samples to use with multi-sampled antialiasing (number)</span></span><br><span class="line">    t.window.depth = <span class="literal">nil</span>                <span class="comment">-- The number of bits per sample in the depth buffer</span></span><br><span class="line">    t.window.stencil = <span class="literal">nil</span>              <span class="comment">-- The number of bits per sample in the stencil buffer</span></span><br><span class="line">    t.window.display = <span class="number">1</span>                <span class="comment">-- Index of the monitor to show the window in (number)</span></span><br><span class="line">    t.window.highdpi = <span class="literal">false</span>            <span class="comment">-- Enable high-dpi mode for the window on a Retina display (boolean)</span></span><br><span class="line">    t.window.usedpiscale = <span class="literal">true</span>         <span class="comment">-- Enable automatic DPI scaling when highdpi is set to true as well (boolean)</span></span><br><span class="line">    t.window.x = <span class="literal">nil</span>                    <span class="comment">-- The x-coordinate of the window&#x27;s position in the specified display (number)</span></span><br><span class="line">    t.window.y = <span class="literal">nil</span>                    <span class="comment">-- The y-coordinate of the window&#x27;s position in the specified display (number)</span></span><br><span class="line"></span><br><span class="line">    t.modules.audio = <span class="literal">true</span>              <span class="comment">-- Enable the audio module (boolean)</span></span><br><span class="line">    t.modules.data = <span class="literal">true</span>               <span class="comment">-- Enable the data module (boolean)</span></span><br><span class="line">    t.modules.event = <span class="literal">true</span>              <span class="comment">-- Enable the event module (boolean)</span></span><br><span class="line">    t.modules.font = <span class="literal">true</span>               <span class="comment">-- Enable the font module (boolean)</span></span><br><span class="line">    t.modules.graphics = <span class="literal">true</span>           <span class="comment">-- Enable the graphics module (boolean)</span></span><br><span class="line">    t.modules.image = <span class="literal">true</span>              <span class="comment">-- Enable the image module (boolean)</span></span><br><span class="line">    t.modules.joystick = <span class="literal">true</span>           <span class="comment">-- Enable the joystick module (boolean)</span></span><br><span class="line">    t.modules.keyboard = <span class="literal">true</span>           <span class="comment">-- Enable the keyboard module (boolean)</span></span><br><span class="line">    t.modules.<span class="built_in">math</span> = <span class="literal">true</span>               <span class="comment">-- Enable the math module (boolean)</span></span><br><span class="line">    t.modules.mouse = <span class="literal">true</span>              <span class="comment">-- Enable the mouse module (boolean)</span></span><br><span class="line">    t.modules.physics = <span class="literal">true</span>            <span class="comment">-- Enable the physics module (boolean)</span></span><br><span class="line">    t.modules.sound = <span class="literal">true</span>              <span class="comment">-- Enable the sound module (boolean)</span></span><br><span class="line">    t.modules.system = <span class="literal">true</span>             <span class="comment">-- Enable the system module (boolean)</span></span><br><span class="line">    t.modules.thread = <span class="literal">true</span>             <span class="comment">-- Enable the thread module (boolean)</span></span><br><span class="line">    t.modules.timer = <span class="literal">true</span>              <span class="comment">-- Enable the timer module (boolean), Disabling it will result 0 delta time in love.update</span></span><br><span class="line">    t.modules.touch = <span class="literal">true</span>              <span class="comment">-- Enable the touch module (boolean)</span></span><br><span class="line">    t.modules.video = <span class="literal">true</span>              <span class="comment">-- Enable the video module (boolean)</span></span><br><span class="line">    t.modules.window = <span class="literal">true</span>             <span class="comment">-- Enable the window module (boolean)</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure><p>各配置详细的作用请参考：<a href="https://love2d.org/wiki/Config_Files">Config Files - LOVE (love2d.org)</a></p><h4 id="运行">运行</h4><p><code>love.run()</code>是运行的主函数，它包含了运行时的主循环，不同版本的默认值不同。</p><figure class="highlight lua"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- The default function for 11.0, used if you don&#x27;t supply your own.</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">love.run</span><span class="params">()</span></span></span><br><span class="line"><span class="keyword">if</span> love.<span class="built_in">load</span> <span class="keyword">then</span> love.<span class="built_in">load</span>(love.<span class="built_in">arg</span>.parseGameArguments(<span class="built_in">arg</span>), <span class="built_in">arg</span>) <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- We don&#x27;t want the first frame&#x27;s dt to include time taken by love.load.</span></span><br><span class="line"><span class="keyword">if</span> love.timer <span class="keyword">then</span> love.timer.step() <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">local</span> dt = <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- Main loop time.</span></span><br><span class="line"><span class="keyword">return</span> <span class="function"><span class="keyword">function</span><span class="params">()</span></span></span><br><span class="line"><span class="comment">-- Process events.</span></span><br><span class="line"><span class="keyword">if</span> love.event <span class="keyword">then</span></span><br><span class="line">love.event.pump()</span><br><span class="line"><span class="keyword">for</span> name, a,b,c,d,e,f <span class="keyword">in</span> love.event.poll() <span class="keyword">do</span></span><br><span class="line"><span class="keyword">if</span> name == <span class="string">&quot;quit&quot;</span> <span class="keyword">then</span></span><br><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> love.quit <span class="keyword">or</span> <span class="keyword">not</span> love.quit() <span class="keyword">then</span></span><br><span class="line"><span class="keyword">return</span> a <span class="keyword">or</span> <span class="number">0</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line">love.handlers[name](a,b,c,d,e,f)</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- Update dt, as we&#x27;ll be passing it to update</span></span><br><span class="line"><span class="keyword">if</span> love.timer <span class="keyword">then</span> dt = love.timer.step() <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- Call update and draw</span></span><br><span class="line"><span class="keyword">if</span> love.update <span class="keyword">then</span> love.update(dt) <span class="keyword">end</span> <span class="comment">-- will pass 0 if love.timer is disabled</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> love.graphics <span class="keyword">and</span> love.graphics.isActive() <span class="keyword">then</span></span><br><span class="line">love.graphics.origin()</span><br><span class="line">love.graphics.clear(love.graphics.getBackgroundColor())</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> love.draw <span class="keyword">then</span> love.draw() <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">love.graphics.present()</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> love.timer <span class="keyword">then</span> love.timer.sleep(<span class="number">0.001</span>) <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure><p>可以参见<a href="https://love2d.org/wiki/love.run">love.run - LOVE (love2d.org)</a></p><h3 id="任务目标">任务目标</h3><p>做一款现代俄罗斯方块，具有以下特点：</p><ul><li>配色：每个方块的颜色有要求</li><li>延迟锁定：方块接触到地面后，不会立刻锁定</li><li>旋转系统：根据踢墙表，存在踢墙情况</li><li>出块系统：使用 <code>7-Bag</code> 而不是纯随机的出块方式</li></ul><p>可以参见<a href="/posts/531cccb5.html" title="俄罗斯方块心得记录">俄罗斯方块心得记录</a>。在写代码时，学习参考了 MrZ 大佬的代码：</p><center>  <a class="ghcard" rel="external nofollow noopener noreferrer" href="https://github.com/MrZ626/tetris-in-100-lines"><img src="https://github-readme-stats.zerolacqua.top/api/pin/?username=MrZ626&repo=tetris-in-100-lines&show_owner=true"/></a> </center><h3 id="实现">实现</h3><p>以下是我的代码，还没写完（小声）</p><center>  <a class="ghcard" rel="external nofollow noopener noreferrer" href="https://github.com/ZerolAcqua/Tetris"><img src="https://github-readme-stats.zerolacqua.top/api/pin/?username=ZerolAcqua&repo=Tetris&show_owner=true"/></a> </center><h4 id="场地参考">场地参考</h4><p>场地的话，计划使用 10×40 的场地，其中正常游戏只使用 10×20，剩下 10×20 用于存储顶出显示场地的方块。通过建立一个以场地为参考的坐标描述，我们可以描述方块的位置信息，并将游戏逻辑与绘图的逻辑分开。</p><p>实现起来，主要是通过一个二维数组记录 10*40 场地的情况。其中，每格不同的数值代表不同的方块。目前，<code>0</code> 代表无方块，<code>1~7</code> 代表七种方块。这样，以后既可以拓展格子的类型，又可以绘制彩色的场地。</p><p>从数据结构的角度，先消除在线性表靠后数据，再消除在线性表靠前的数据，操作要更方便一些。因此，消行的顺序就很关键。</p><h4 id="方块表达">方块表达</h4><p>方块，以及方块与其他要素的交互是最麻烦的一部分。</p><p>方块表达时，采用以下的方式。</p><p><img src="https://tetris.wiki/images/3/3d/SRS-pieces.png" alt="各方块的边界框"></p><p>方块的边界框是包含四个方向形状的外接矩形。除了 <code>I</code> 和 <code>O</code> 的边界框是 4×4 和 2×2 以外，其他方块的边界框是 3×3 ，若要确定每个 <code>mino</code> 的位置，需要知道此刻边界框的位置和方块的朝向。在我们这次的编写中，我们通过边界框左上角的场地坐标，确定方块的位置。此外，在方块新生成的时候， <code>I</code> 和 <code>O</code> 是居中的，而其他方块是偏左的，它们的边界框左上角坐标也不相同。这些生成时的初始坐标，记录在一个表中。</p><figure class="highlight lua"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 方块活动框左上角坐标 (x,y)</span></span><br><span class="line"><span class="keyword">local</span> initPos=&#123;</span><br><span class="line">&#123;<span class="number">4</span>,<span class="number">22</span>&#125;,<span class="comment">-- I</span></span><br><span class="line">&#123;<span class="number">4</span>,<span class="number">22</span>&#125;,<span class="comment">-- J</span></span><br><span class="line">&#123;<span class="number">4</span>,<span class="number">22</span>&#125;,<span class="comment">-- L</span></span><br><span class="line">&#123;<span class="number">5</span>,<span class="number">22</span>&#125;,<span class="comment">-- O</span></span><br><span class="line">&#123;<span class="number">4</span>,<span class="number">22</span>&#125;,<span class="comment">-- S</span></span><br><span class="line">&#123;<span class="number">4</span>,<span class="number">22</span>&#125;,<span class="comment">-- Z</span></span><br><span class="line">&#123;<span class="number">4</span>,<span class="number">22</span>&#125;<span class="comment">-- T</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>为了表示各个方向下的方块形状，也采用了表结构存储，在已知方块类型和方块朝向后，就能立刻获取其形状。</p><figure class="highlight lua"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 记录的各方向的方块形状(从下往上)：1-原位(0) 2-顺时针位(R) 3-180度位(2) 4-逆时针位(L)</span></span><br><span class="line"><span class="keyword">local</span> blocks=&#123;</span><br><span class="line"><span class="comment">-- I</span></span><br><span class="line">&#123;</span><br><span class="line">&#123;&#123;<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>&#125;,&#123;<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>&#125;,&#123;<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>&#125;,&#123;<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>&#125;&#125;,<span class="comment">--I1</span></span><br><span class="line">&#123;&#123;<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>&#125;,&#123;<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>&#125;,&#123;<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>&#125;,&#123;<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>&#125;&#125;,<span class="comment">--I2</span></span><br><span class="line">&#123;&#123;<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>&#125;,&#123;<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>&#125;,&#123;<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>&#125;,&#123;<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>&#125;&#125;,<span class="comment">--I3</span></span><br><span class="line">&#123;&#123;<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>&#125;,&#123;<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>&#125;,&#123;<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>&#125;,&#123;<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>&#125;&#125;<span class="comment">--I4</span></span><br><span class="line">&#125;,</span><br><span class="line"><span class="comment">-- J</span></span><br><span class="line">&#123;</span><br><span class="line">&#123;&#123;<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>&#125;,&#123;<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>&#125;,&#123;<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>&#125;&#125;,<span class="comment">--J1</span></span><br><span class="line">&#123;&#123;<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>&#125;,&#123;<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>&#125;,&#123;<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>&#125;&#125;,<span class="comment">--J2</span></span><br><span class="line">&#123;&#123;<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>&#125;,&#123;<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>&#125;,&#123;<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>&#125;&#125;,<span class="comment">--J3</span></span><br><span class="line">&#123;&#123;<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>&#125;,&#123;<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>&#125;,&#123;<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>&#125;&#125;<span class="comment">--J4</span></span><br><span class="line">&#125;,</span><br><span class="line"><span class="comment">-- L</span></span><br><span class="line">&#123;</span><br><span class="line">&#123;&#123;<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>&#125;,&#123;<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>&#125;,&#123;<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>&#125;&#125;,<span class="comment">--L1</span></span><br><span class="line">&#123;&#123;<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>&#125;,&#123;<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>&#125;,&#123;<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>&#125;&#125;,<span class="comment">--L2</span></span><br><span class="line">&#123;&#123;<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>&#125;,&#123;<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>&#125;,&#123;<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>&#125;&#125;,<span class="comment">--L3</span></span><br><span class="line">&#123;&#123;<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>&#125;,&#123;<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>&#125;,&#123;<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>&#125;&#125;<span class="comment">--L4</span></span><br><span class="line">&#125;,</span><br><span class="line"><span class="comment">-- O</span></span><br><span class="line">&#123;</span><br><span class="line">&#123;&#123;<span class="number">1</span>,<span class="number">1</span>&#125;,&#123;<span class="number">1</span>,<span class="number">1</span>&#125;&#125;,<span class="comment">--O1</span></span><br><span class="line">&#123;&#123;<span class="number">1</span>,<span class="number">1</span>&#125;,&#123;<span class="number">1</span>,<span class="number">1</span>&#125;&#125;,<span class="comment">--O2</span></span><br><span class="line">&#123;&#123;<span class="number">1</span>,<span class="number">1</span>&#125;,&#123;<span class="number">1</span>,<span class="number">1</span>&#125;&#125;,<span class="comment">--O3</span></span><br><span class="line">&#123;&#123;<span class="number">1</span>,<span class="number">1</span>&#125;,&#123;<span class="number">1</span>,<span class="number">1</span>&#125;&#125;<span class="comment">--O4</span></span><br><span class="line">&#125;,</span><br><span class="line"><span class="comment">-- S</span></span><br><span class="line">&#123;</span><br><span class="line">&#123;&#123;<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>&#125;,&#123;<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>&#125;,&#123;<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>&#125;&#125;,<span class="comment">--S1</span></span><br><span class="line">&#123;&#123;<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>&#125;,&#123;<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>&#125;,&#123;<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>&#125;&#125;,<span class="comment">--S2</span></span><br><span class="line">&#123;&#123;<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>&#125;,&#123;<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>&#125;,&#123;<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>&#125;&#125;,<span class="comment">--S3</span></span><br><span class="line">&#123;&#123;<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>&#125;,&#123;<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>&#125;,&#123;<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>&#125;&#125;<span class="comment">--S4</span></span><br><span class="line">&#125;,</span><br><span class="line"><span class="comment">-- Z</span></span><br><span class="line">&#123;</span><br><span class="line">&#123;&#123;<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>&#125;,&#123;<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>&#125;,&#123;<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>&#125;&#125;,<span class="comment">--Z1</span></span><br><span class="line">&#123;&#123;<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>&#125;,&#123;<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>&#125;,&#123;<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>&#125;&#125;,<span class="comment">--Z2</span></span><br><span class="line">&#123;&#123;<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>&#125;,&#123;<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>&#125;,&#123;<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>&#125;&#125;,<span class="comment">--Z3</span></span><br><span class="line">&#123;&#123;<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>&#125;,&#123;<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>&#125;,&#123;<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>&#125;&#125;<span class="comment">--Z4</span></span><br><span class="line">&#125;,</span><br><span class="line"><span class="comment">-- T</span></span><br><span class="line">&#123;</span><br><span class="line">&#123;&#123;<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>&#125;,&#123;<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>&#125;,&#123;<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>&#125;&#125;,<span class="comment">--T1</span></span><br><span class="line">&#123;&#123;<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>&#125;,&#123;<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>&#125;,&#123;<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>&#125;&#125;,<span class="comment">--T2</span></span><br><span class="line">&#123;&#123;<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>&#125;,&#123;<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>&#125;,&#123;<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>&#125;&#125;,<span class="comment">--T3</span></span><br><span class="line">&#123;&#123;<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>&#125;,&#123;<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>&#125;,&#123;<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>&#125;&#125;<span class="comment">--T4</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>在后面的实现中，还使用了不少的表，比如行状态表、列状态表、颜色表、踢墙表等等。</p><h4 id="方块碰撞">方块碰撞</h4><p>这点是最复杂的地方，而且牵扯到踢墙的概念。</p><p>由于每个方块的边界框<emp>并不与某一方向时方块的最小外接矩形重合</emp>，方块与场地边界的碰撞检测就稍显麻烦。不对边界框中完全没有 <code>mino</code> 的行或列进行特殊处理的话，就可能造成（场地下边界或场地左右边界）数组越界或是方块悬空的状况。因此，根据方块的形状表，我计算了对应的行状态与列状态表（遇事不决就打表）。在此基础上，可以实现一个判断方块是否超出场地，与场地内方块重叠的函数。通过该函数，我们可以做到判断方块是否落地（落地了就要计时，准备延迟锁定了）。通过该函数，我们可以判断踢墙的结果是否可行。</p><p>踢墙的概念这里不再多说。有踢墙表之后，只需要按顺序进行平移的尝试，成功则采用，不成功则方块不能旋转。</p><h4 id="延迟锁定">延迟锁定</h4><p>目前我只做了延迟锁定，其表现为：</p><ul><li>非落地状态下，不进行延迟锁定计时。</li><li>落地状态下，移动或旋转后变为非落地状态后，不进行延迟锁定计时。</li><li>落地状态下不会立即锁定，而是保留一段继续操作的时间。</li><li>不进行移动或旋转，在设定的时间（锁定延迟）过后，方块锁定。</li><li>落地状态下无法移动（左右卡住），或无法旋转（踢墙表检测全部失败）时，视作未进行操作。注意 <code>O</code> 的旋转虽然看起来没有变化，但它是确确实实成功旋转了的，所以会刷新锁定延迟。</li></ul><p>同时，需要注意，为了避免无限刷新锁定延迟的情况，应该增加一个操作次数限制：</p><ul><li>非落地状态下，不计入操作次数限制。</li><li>落地状态下，一次移动或旋转后，计一次操作次数。</li><li>落地状态下无法移动（左右卡住），或无法旋转（踢墙表检测全部失败）时，视作未进行操作，不计入操作次数限制。注意 <code>O</code> 的旋转虽然看起来没有变化，但它是确确实实成功旋转了的，所以会计一次操作次数。</li><li>当操作次数用尽后，移动和旋转将不再刷新锁定延迟。</li></ul><p>今天（2022.8.23）我实现操作次数的时候，发现还有一个问题：</p><ul><li><p>如果操作次数用尽后，踢墙产生的偏移不能向上。</p><p>这个规定的意义在于，避免玩家通过踢墙将方块“抬高”，然后方块下落，刷新延迟锁定，导致无限操作而不锁定的问题。</p></li></ul><h4 id="出块序列">出块序列</h4><p>实际上就是一个队列，当队列短于设定的数量时。按选定的随机生成器，生成一段新序列加到队尾。</p><p>如果是 <code>bag</code> 出块，则保证要添加的新序列中每种方块各出现一次</p><h4 id="暂存">暂存</h4><p>暂存的实现思路很简单，就是记录下暂存的方块 id 和暂存的操作次数限制而已。但是在这个过程中，我意识到关于暂存计数、锁延计数的重置时机问题。</p><p>根据游戏逻辑，在暂存之后，更换的方块会重新从场地顶部开始下落，并且方块的锁延计数会重置。暂存计数就是为了避免玩家通过无限的暂存，重置锁延计数的情况。所以暂存之后，锁延计数会重置，暂存计数 <code>-1</code>。而暂存计数重置的时机，应当是一个方块成功锁定后，这是毫无疑问的。</p><p>可是，锁延计数是什么时候重置呢？在没有暂存功能的情况下，锁延计数在方块成功锁定后，或者新生成方块时重置都是没有问题的。但是引入了暂存功能后，暂存方块会导致方块的锁延计数重置。因此，如果将锁延计数在方块成功锁定后重置，会导致暂存后新方块的锁延计数未重置。所以锁延计数应当在生成方块时更新。</p><p>换个角度想想，暂存后的方块，本质就是新生成了一个方块，这和方块锁定后新生成方块的原理应当一致。而锁延计数会在方块锁定后和暂存后重置，因此在生成方块时重置锁延计数能很好地解决这两种情况。</p><p>此外，在暂存中无方块和暂存中有方块时，对序列的处理有一定的区别。前者是将当前块暂存，从序列中新取一块作为当前块；后者是将当前块与暂存块交换。</p><h3 id="发布">发布</h3><h4 id="创建-love-文件">创建 .love 文件</h4><p>将游戏文件变为 <code>.exe</code> 文件的步骤比较简单：</p><ul><li>将游戏文件加入 <code>.zip</code> 压缩文件中</li><li>将后缀更改为<code>.love</code></li></ul><p>此文件就可以通过以下方式运行：</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">love xxx.love</span><br></pre></td></tr></table></figure><h4 id="针对-windows-平台构建">针对 windows 平台构建</h4><ul><li>将 <code>love.exe</code> 与 <code>.zip</code> 文件合并为一个 <code>.exe</code> 文件</li><li>将 <code>.dll</code> 文件、许可 <code>license.txt</code> 和 合并得到的 <code>.exe</code> 文件放在同一个目录下，即可运行游戏</li></ul><h4 id="网页发布">网页发布</h4><p>推荐使用 <a href="https://github.com/Davidobot/love.js">Davidobot/love.js</a>，该作者目前还保持着更新，适用于 <code>11.4</code> 版本</p><p>通过以下方式安装：</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">npm i love.js</span><br></pre></td></tr></table></figure><p>或</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">npm -g i love.js</span><br></pre></td></tr></table></figure><p>然后构建兼容版本：</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">love.js game.love game -c</span><br></pre></td></tr></table></figure><p>如果命令无法正常执行（比如说，打开了 <code>love.js</code> 文件），则可以使用以下命令：</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">love.js.cmd game.love game -c</span><br></pre></td></tr></table></figure><p>即可完成构建。该命令会在当前目录生成一个文件夹：</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">Tetris</span><br><span class="line">│  game.data</span><br><span class="line">│  game.js</span><br><span class="line">│  index.html</span><br><span class="line">│  love.js</span><br><span class="line">│  love.wasm</span><br><span class="line">│</span><br><span class="line">└─theme</span><br><span class="line">        bg.png</span><br><span class="line">        love.css</span><br></pre></td></tr></table></figure><p>其中，<code>game.data</code> 和 <code>game.js</code> 是游戏的生成文件， <code>index.html</code> 就是生成的网页，而 <code>theme</code> 目录下的文件是页面的美化相关的文件。<code>love.js</code> 和 <code>love.wasm</code> 是 <code>love</code> 框架对应的文件。</p><div class="tip info faa-horizontal animated-hover"><p>游戏基本上完成了，剩下的东西主要是美化辅助和提升操作手感的方面（阴影和 DAS ），大概率不会更新了……</p></div><a class="btn-beautify blue outline" href="/html/Lua%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/index.html"   title="戳这里体验一下"><i class="far fa-hand-point-right"></i><span>戳这里体验一下</span></a><p>各种发布方式（包括网页发布）具体可以请参考：<a href="https://love2d.org/wiki/Game_Distribution">Game Distribution - LOVE (love2d.org)</a></p>]]></content>
      
      
      <categories>
          
          <category> 编程学习 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Lua </tag>
            
            <tag> 俄罗斯方块 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>LaTeX 初体验</title>
      <link href="/posts/1f2f2064.html"/>
      <url>/posts/1f2f2064.html</url>
      
        <content type="html"><![CDATA[<div class="tip warning faa-horizontal animated-hover"><p>本文章还在施工中</p></div><h2 id="前言-4">前言</h2><p>之前一直有用 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>LaTeX</mtext></mrow><annotation encoding="application/x-tex">\LaTeX</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8988em;vertical-align:-0.2155em;"></span><span class="mord text"><span class="mord textrm">L</span><span class="mspace" style="margin-right:-0.36em;"></span><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6833em;"><span style="top:-2.905em;"><span class="pstrut" style="height:2.7em;"></span><span class="mord"><span class="mord textrm mtight sizing reset-size6 size3">A</span></span></span></span></span></span><span class="mspace" style="margin-right:-0.15em;"></span><span class="mord text"><span class="mord textrm">T</span><span class="mspace" style="margin-right:-0.1667em;"></span><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.4678em;"><span style="top:-2.7845em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord textrm">E</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2155em;"><span></span></span></span></span><span class="mspace" style="margin-right:-0.125em;"></span><span class="mord textrm">X</span></span></span></span></span></span> 去生成 <i>Word</i> 的数学公式（谁让 <i>Word</i> 太僵硬了呢），用 <span class="bubble-content"><i>manim</i> </span><span class="bubble-notation"><span class="bubble-item" style="background-color:#71a4e3;">Animation engine for explanatory math videos</span></span> 的时候也经常接触 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>LaTeX</mtext></mrow><annotation encoding="application/x-tex">\LaTeX</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8988em;vertical-align:-0.2155em;"></span><span class="mord text"><span class="mord textrm">L</span><span class="mspace" style="margin-right:-0.36em;"></span><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6833em;"><span style="top:-2.905em;"><span class="pstrut" style="height:2.7em;"></span><span class="mord"><span class="mord textrm mtight sizing reset-size6 size3">A</span></span></span></span></span></span><span class="mspace" style="margin-right:-0.15em;"></span><span class="mord text"><span class="mord textrm">T</span><span class="mspace" style="margin-right:-0.1667em;"></span><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.4678em;"><span style="top:-2.7845em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord textrm">E</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2155em;"><span></span></span></span></span><span class="mspace" style="margin-right:-0.125em;"></span><span class="mord textrm">X</span></span></span></span></span></span> 的数学公式，再加上某个<span class='p cyan'>小可爱</span>的不懈安利，我也索性就试试配置吧。</p><h2 id="配置">配置</h2><p><i>MikTex</i> 以前装过，而最近写博客用 <i>VSCode</i> 觉得也是非常好看实用，所以这次配置我选择了 <i>VSCode</i> + <i>MikTex</i> 方案。</p><ul><li><p><i>MikTex</i></p><p>对于 <i>MikTex</i> ，在下载完成后，可以通过图形界面 <i>MikTeX Console</i> 进行更新。安装完成后，一定要添加环境变量。使用 <i>TeX Live</i> 应该是差不多的，同样要注意环境变量的问题。</p></li><li><p><i>VSCode</i></p><p><i>VSCode</i> 的下载就没什么好说的了。下载完成后，安装 <code>LaTeX Workshop</code> 拓展，默认情况下，该拓展会预定义几种编译方案，但是对于一些复杂的文件，往往需要几次，其编译链不一定符合要求，因此需要在 <i>VSCode</i> 的 <code>settings.json</code> 文件中进行配置。以下是我的一点简单的配置：</p><figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;[latex]&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;editor.wordWrap&quot;</span><span class="punctuation">:</span> <span class="string">&quot;on&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;latex-workshop.latex.autoBuild.run&quot;</span><span class="punctuation">:</span> <span class="string">&quot;never&quot;</span><span class="punctuation">,</span>  <span class="comment">//禁止保存文件时自动build</span></span><br><span class="line">  <span class="attr">&quot;latex-workshop.intellisense.package.enabled&quot;</span><span class="punctuation">:</span> <span class="keyword">true</span><span class="punctuation">,</span>  <span class="comment">//自动补全</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">//定义编译命令</span></span><br><span class="line">  <span class="attr">&quot;latex-workshop.latex.tools&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;XeLaTeXmk&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;command&quot;</span><span class="punctuation">:</span> <span class="string">&quot;latexmk&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;args&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="string">&quot;-xelatex&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;-synctex=1&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;-shell-escape&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;-interaction=nonstopmode&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;-file-line-error&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;%DOCFILE%.tex&quot;</span></span><br><span class="line">      <span class="punctuation">]</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;LuaLaTeXmk&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;command&quot;</span><span class="punctuation">:</span> <span class="string">&quot;latexmk&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;args&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="string">&quot;-lualatex&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;-synctex=1&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;-shell-escape&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;-interaction=nonstopmode&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;-file-line-error&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;%DOCFILE%.tex&quot;</span></span><br><span class="line">      <span class="punctuation">]</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;xelatex&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;command&quot;</span><span class="punctuation">:</span> <span class="string">&quot;xelatex&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;args&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="string">&quot;-synctex=1&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;-interaction=nonstopmode&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;-file-line-error&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;-shell-escape&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;%DOC%&quot;</span></span><br><span class="line">      <span class="punctuation">]</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;lualatex&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;command&quot;</span><span class="punctuation">:</span> <span class="string">&quot;lualatex&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;args&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="string">&quot;-synctex=1&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;-interaction=nonstopmode&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;-file-line-error&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;-shell-escape&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;%DOC%&quot;</span></span><br><span class="line">      <span class="punctuation">]</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;bibtex&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;command&quot;</span><span class="punctuation">:</span> <span class="string">&quot;bibtex&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;args&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="string">&quot;%DOCFILE%&quot;</span></span><br><span class="line">      <span class="punctuation">]</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  <span class="comment">//定义编译链</span></span><br><span class="line">  <span class="attr">&quot;latex-workshop.latex.recipes&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;xelatexmk&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;tools&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="string">&quot;XeLaTeXmk&quot;</span></span><br><span class="line">      <span class="punctuation">]</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;lualatexmk&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;tools&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="string">&quot;LuaLaTeXmk&quot;</span></span><br><span class="line">      <span class="punctuation">]</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;xelatex ➞ bibtex ➞ xelatex × 2&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;tools&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="string">&quot;xelatex&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;bibtex&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;xelatex&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;xelatex&quot;</span></span><br><span class="line">      <span class="punctuation">]</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;lualatex ➞ bibtex ➞ lualatex × 2&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;tools&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="string">&quot;lualatex&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;bibtex&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;lualatex&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;lualatex&quot;</span></span><br><span class="line">      <span class="punctuation">]</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  <span class="comment">//设定清理文件的类型(ctrl+alt+c：清除辅助文件) </span></span><br><span class="line">  <span class="attr">&quot;latex-workshop.latex.clean.fileTypes&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">      <span class="string">&quot;*.aux&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="string">&quot;*.bbl&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="string">&quot;*.blg&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="string">&quot;*.idx&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="string">&quot;*.ind&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="string">&quot;*.lof&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="string">&quot;*.lot&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="string">&quot;*.out&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="string">&quot;*.toc&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="string">&quot;*.acn&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="string">&quot;*.acr&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="string">&quot;*.alg&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="string">&quot;*.glg&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="string">&quot;*.glo&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="string">&quot;*.gls&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="string">&quot;*.ist&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="string">&quot;*.fls&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="string">&quot;*.log&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="string">&quot;*.fdb_latexmk&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="string">&quot;*.nav&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="string">&quot;*.snm&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="string">&quot;*.synctex.gz&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="string">&quot;*.bcf&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="string">&quot;*.run.xml&quot;</span></span><br><span class="line">    <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;latex-workshop.view.pdf.viewer&quot;</span><span class="punctuation">:</span> <span class="string">&quot;tab&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;latex-workshop.intellisense.citation.label&quot;</span><span class="punctuation">:</span> <span class="string">&quot;title&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>可以参考以下网站，它有关于各配置项含义的讲解：</p><div class="tag link"><a class="link-card" title="VSCode 配置 LaTeX" href="https://zhuanlan.zhihu.com/p/166523064"><div class="left"><img src="https://pic1.zhimg.com/v2-8067a0af5345bb361030879f7b5abd24_1440w.jpg?source=172ae18b"/></div><div class="right"><p class="text">VSCode 配置 LaTeX</p><p class="url">https://zhuanlan.zhihu.com/p/166523064</p></div></a></div></li></ul><h2 id="简单使用">简单使用</h2><p>前几天在网上高强度冲浪的时候，发现了武汉大学的论文模板。</p><center><a class="ghcard" rel="external nofollow noopener noreferrer" href="https://github.com/whutug/whu-thesis"><img src="https://github-readme-stats.zerolacqua.top/api/pin/?username=whutug&repo=whu-thesis&show_owner=true"/></a></center><p>你别说，还挺不错。不过要用起来还要花点时间琢磨。</p><div class="tip warning"><p>该部分主要围绕该论文模板展开，可能并不适用于其他情况。</p></div><h3 id="文献管理">文献管理</h3><h4 id="BibTeX">BibTeX</h4><p><i>BibTeX</i> 是最为流行的参考文献数据组织格式之一。它的出现让我们摆脱手写参考文献条目的麻烦。我们还可以通过参考文献样式的支持，让同一份 <i>BibTeX</i> 数据库生成不同样式的参考文献列表。</p><h4 id="Zotero-导出-bib-文件">Zotero 导出 .bib 文件</h4><p><i>Zotero</i> 是一款优秀的文献管理软件，真的超好用啊！尤其是它的浏览器插件，“抓取”文献很方便！并且 <i>Zotero</i> 可以通过账号在不同电脑上同步，能支持很多的拓展插件。</p><p><i>Zotero</i> 可以导出分类或导出条目，对应的是一组文献和单个文献。右击菜单中选择<code>导出XX</code>，就可以导出相应的 <code>.bib</code> 文件。</p><p>但是，它默认导出的 <code>.bib</code> 文件有很多不必要的信息。这时，我们可以使用 <a href="https://retorque.re/zotero-better-bibtex/"><code>Better BibTeX for Zotero</code></a> 插件优化 <code>.bib</code> 文件的导出内容。安装插件的步骤很简单，安装完成后，在<code>首选项</code>-&gt; <code>Export</code> -&gt; <code>Fields</code> 中，可以设置要过滤的项目，这样导出的 <code>.bib</code> 文件就可以直接拿去使用了。</p><h4 id="知网导出-bib-文件">知网导出 .bib 文件</h4><p>想要从知网的文献引用中获取 <code>.bib</code> 文件，需要利用脚本进行提取。这里推荐使用 <i>Google Chrome</i> 的 <i>Tampermonkey</i> 拓展，使用<a href="https://greasyfork.org/zh-CN/scripts/393305-%E7%9F%A5%E7%BD%91-%E5%8F%82%E8%80%83%E6%96%87%E7%8C%AE-bibtex">油猴脚本</a>实现提取。</p><h4 id="在模板中使用-bib-文件">在模板中使用 .bib 文件</h4><p><code>\whusetup&#123;⟨键值列表⟩&#125;</code> 的键值 <code>element/bibliography</code>，设置 <code>.bib</code> 文件。可以是单个文件，也可以是用英文逗号隔开的一组文件。如果选定了 <code>bib-backend = biblatex</code>，数据源必须明确给出 <code>.bib</code> 后缀名。设置好 <code>.bib</code> 文件的路径后，模板就会生成 <code>参考文献</code>章节，引用文献会按要求的格式显示并自动编号。</p><figure class="highlight latex"><table><tr><td class="code"><pre><span class="line"><span class="keyword">\documentclass</span>[type=bachelor]&#123;whu-thesis&#125;</span><br><span class="line"><span class="keyword">\whusetup</span></span><br><span class="line">  &#123;</span><br><span class="line">    info               =</span><br><span class="line">      &#123;</span><br><span class="line">        title          = &#123;武汉大学学位论文 <span class="keyword">\LaTeX</span>&#123;&#125; 模板<span class="keyword">\\</span>使用示例文档&#125;,</span><br><span class="line">        title*         = &#123;An Introduction to LaTeX Thesis Template<span class="keyword">\\</span>of Wuhan University&#125;,</span><br><span class="line">        student-number = &#123;xxxxxxxxxxxxx&#125;,</span><br><span class="line">        school         = &#123;院系名称&#125;,</span><br><span class="line">        author         = &#123;作者姓名&#125;,</span><br><span class="line">        author*        = &#123;Your Name&#125;,</span><br><span class="line">        subject        = &#123;学科&#125;,</span><br><span class="line">        major          = &#123;专业名称&#125;,</span><br><span class="line">        advisor        = &#123;教师姓名 , 职称&#125;,</span><br><span class="line">        direction      = &#123;研究方向&#125;,</span><br><span class="line">        <span class="comment">% date           = &#123;2021/5&#125;,</span></span><br><span class="line">        keywords       = &#123;关键词 1 , 关键词 2 , 关键词 3 , 关键词 4 , 一个非常非常，非常非常长——的关键词 5&#125;,</span><br><span class="line">        keywords*      = &#123;key word 1 , key word 2 , key word 3 , key word 4 , &#123;and a very very, very very long key word---the key word 5&#125;&#125;,</span><br><span class="line">      &#125;,</span><br><span class="line">    style              =</span><br><span class="line">      &#123;</span><br><span class="line">        graphics-path  = &#123;&#123;figures/&#125;&#123;data/&#125;&#125;,</span><br><span class="line">        list-of-figures,</span><br><span class="line">        list-of-tables,</span><br><span class="line">      &#125;,</span><br><span class="line">    element            =</span><br><span class="line">      &#123;</span><br><span class="line">        innovation     = &#123;pages/innovation&#125;,</span><br><span class="line">        abstract       = &#123;pages/abstract&#125;,</span><br><span class="line">        abstract*      = &#123;pages/enabstract&#125;,</span><br><span class="line">        bibliography   = &#123;ref/refs , ref/thu&#125;,</span><br><span class="line">        achievements   = &#123;pages/achievements&#125;,</span><br><span class="line">        thanks         = &#123;pages/thanks&#125;,</span><br><span class="line">        appendix       = &#123;pages/appendix&#125;</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">\begin</span>&#123;document&#125;</span><br><span class="line"><span class="comment">%%----------- 主体部分 ----------- %%</span></span><br><span class="line"><span class="keyword">\include</span>&#123;pages/chapter1&#125;</span><br><span class="line"><span class="keyword">\include</span>&#123;pages/chapter2&#125;</span><br><span class="line"><span class="keyword">\include</span>&#123;pages/chapter3&#125;</span><br><span class="line"><span class="keyword">\include</span>&#123;pages/chapter4&#125;</span><br><span class="line"><span class="keyword">\end</span>&#123;document&#125;</span><br></pre></td></tr></table></figure><p>在正文中使用 <code>\cite&#123;⟨citation⟩&#125;</code> 进行引用，可以自动匹配编号。具体请参见文档 <code>whu-thesis-doc.pdf</code> 的相关说明。</p><h3 id="公式插图表格">公式插图表格</h3><p>这一部分其实参考 <code>whu-thesis-demo.tex</code> 的源码和 <code>whu-thesis-demo.pdf</code> 就可以理解大部分使用方法了。</p><h4 id="公式的使用">公式的使用</h4><p>这部分包括行内公式、行间公式与公式引用等。</p><ul><li><p>行内公式：</p>  <figure class="highlight latex"><table><tr><td class="code"><pre><span class="line"><span class="built_in">$</span>a<span class="built_in">^</span>2+b<span class="built_in">^</span>2=c<span class="built_in">^</span>2<span class="built_in">$</span></span><br><span class="line"><span class="keyword">\(</span>a<span class="built_in">^</span>2+b<span class="built_in">^</span>2=c<span class="built_in">^</span>2<span class="keyword">\)</span></span><br><span class="line"><span class="keyword">\[</span>a<span class="built_in">^</span>2+b<span class="built_in">^</span>2=c<span class="built_in">^</span>2<span class="keyword">\]</span></span><br></pre></td></tr></table></figure></li><li><p>行间公式，让公式单独一段：</p>  <figure class="highlight latex"><table><tr><td class="code"><pre><span class="line">还可以让公式单独一段：</span><br><span class="line"><span class="keyword">\begin</span>&#123;equation&#125;</span><br><span class="line">  <span class="keyword">\sin</span><span class="built_in">^</span>2&#123;<span class="keyword">\theta</span>&#125; + <span class="keyword">\cos</span><span class="built_in">^</span>2&#123;<span class="keyword">\theta</span>&#125; = 1</span><br><span class="line"><span class="keyword">\end</span>&#123;equation&#125;</span><br><span class="line">注意，公式前请不要空行。</span><br></pre></td></tr></table></figure><blockquote><p>为了格式的正确，公式前后的空行问题一定要注意。语意是连续的情况下，公式后面的文字是顶格开始的，不应当空行。</p></blockquote><p>行间公式还可以多行对齐：</p>  <figure class="highlight latex"><table><tr><td class="code"><pre><span class="line"><span class="keyword">\begin</span>&#123;equation&#125;</span><br><span class="line">  <span class="keyword">\begin</span>&#123;aligned&#125;</span><br><span class="line">    f<span class="built_in">_</span>1(x) <span class="built_in">&amp;</span> = (x + y)<span class="built_in">^</span>2         <span class="keyword">\\</span></span><br><span class="line">           <span class="built_in">&amp;</span> = x<span class="built_in">^</span>2 + 2 x y + y<span class="built_in">^</span>2</span><br><span class="line">  <span class="keyword">\end</span>&#123;aligned&#125;</span><br><span class="line"><span class="keyword">\end</span>&#123;equation&#125;</span><br></pre></td></tr></table></figure></li><li><p>公式引用</p><p>使用 <code>\label&#123;⟨标签名⟩&#125;</code> 为公式添加标签。使用 <code>\eqref&#123;⟨标签名⟩&#125;</code> 进行引用。</p>  <figure class="highlight latex"><table><tr><td class="code"><pre><span class="line">可以给公式加上编号</span><br><span class="line"><span class="keyword">\begin</span>&#123;equation&#125;</span><br><span class="line">  <span class="keyword">\sin</span><span class="built_in">^</span>2&#123;<span class="keyword">\theta</span>&#125; + <span class="keyword">\cos</span><span class="built_in">^</span>2&#123;<span class="keyword">\theta</span>&#125; = 1 <span class="keyword">\label</span>&#123;eq:pingfanghe&#125;</span><br><span class="line"><span class="keyword">\end</span>&#123;equation&#125;</span><br><span class="line">并通过添加的标签在正文中引用公式，如式<span class="keyword">\eqref</span>&#123;eq:pingfanghe&#125;。</span><br></pre></td></tr></table></figure></li></ul><h4 id="插图的使用">插图的使用</h4><p>这部分是插图的使用，包括设置图片的大小、位置及分图等：</p><figure class="highlight latex"><table><tr><td class="code"><pre><span class="line"><span class="keyword">\begin</span>&#123;figure&#125;</span><br><span class="line">  <span class="keyword">\centering</span></span><br><span class="line">  <span class="keyword">\includegraphics</span>[width=0.3<span class="keyword">\textwidth</span>]&#123;whulogo.pdf&#125;</span><br><span class="line">  <span class="keyword">\caption</span>&#123;插图示例&#125;</span><br><span class="line">  <span class="keyword">\label</span>&#123;fig:whu&#125;</span><br><span class="line"><span class="keyword">\end</span>&#123;figure&#125;</span><br></pre></td></tr></table></figure><ul><li><p>设置大小</p><p>图像可以使用 <code>width</code> 设置宽度。<code>[width=\textwidth]</code> 则为一整行。</p></li><li><p>设置排版位置</p><p>作为浮动体， <code>figure</code> 可以设置排版位置，即使用 <code>[htbp]</code> 设置排版位置：</p>  <figure class="highlight latex"><table><tr><td class="code"><pre><span class="line"><span class="keyword">\begin</span>&#123;figure&#125;[⟨placement⟩]</span><br><span class="line">...</span><br><span class="line"><span class="keyword">\end</span>&#123;figure&#125;</span><br></pre></td></tr></table></figure></li><li><p>分图子图</p><p>如果一个图由两个或两个以上分图组成时，各分图分别以(a)、(b)、(c)… 作为图序，并须有分图题。模板使用 subcaption 宏包来处理。可以参考以下代码：</p>  <figure class="highlight latex"><table><tr><td class="code"><pre><span class="line"><span class="keyword">\begin</span>&#123;figure&#125;[h]</span><br><span class="line">  <span class="keyword">\centering</span></span><br><span class="line">  <span class="keyword">\begin</span>&#123;subfigure&#125;&#123;0.2<span class="keyword">\textwidth</span>&#125;</span><br><span class="line">    <span class="keyword">\includegraphics</span>[width=<span class="keyword">\linewidth</span>]&#123;whulogo.pdf&#125;</span><br><span class="line">    <span class="keyword">\caption</span>&#123;武汉大学校徽&#125;</span><br><span class="line">    <span class="keyword">\label</span>&#123;fig:subfig-a&#125;</span><br><span class="line">  <span class="keyword">\end</span>&#123;subfigure&#125;<span class="keyword">\qquad</span></span><br><span class="line">  <span class="keyword">\begin</span>&#123;subfigure&#125;&#123;0.7<span class="keyword">\textwidth</span>&#125;</span><br><span class="line">    <span class="keyword">\includegraphics</span>[width=<span class="keyword">\linewidth</span>]&#123;whu.pdf&#125;</span><br><span class="line">    <span class="keyword">\caption</span>&#123;武汉大学&#125;</span><br><span class="line">    <span class="keyword">\label</span>&#123;fig:subfig-b&#125;</span><br><span class="line">  <span class="keyword">\end</span>&#123;subfigure&#125;</span><br><span class="line">  <span class="keyword">\caption</span>&#123;多个分图的示例&#125;</span><br><span class="line">  <span class="keyword">\label</span>&#123;fig:multi-image&#125;</span><br><span class="line"><span class="keyword">\end</span>&#123;figure&#125;</span><br></pre></td></tr></table></figure></li><li><p>插图引用</p><p>若要进行引用，也是通过 <code>\label&#123;⟨标签名⟩&#125;</code> 添加标签。并使用 <code>\ref&#123;⟨标签名⟩&#125;</code> 进行引用。</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">比如引用上面的两个子图，可以用图~\ref&#123;fig:subfig-a&#125; 和图~\ref&#123;fig:subfig-b&#125;。</span><br></pre></td></tr></table></figure></li></ul><h4 id="表格的使用">表格的使用</h4><p>这部分包括普通表格（三线表）和跨页表格的使用。</p><ul><li><p>普通表格</p><figure class="highlight latex"><table><tr><td class="code"><pre><span class="line"><span class="keyword">\begin</span>&#123;table&#125;[ht]</span><br><span class="line">  <span class="keyword">\centering</span></span><br><span class="line">  <span class="keyword">\caption</span>&#123;简单表格&#125;</span><br><span class="line">  <span class="keyword">\label</span>&#123;tab:1&#125;</span><br><span class="line">  <span class="keyword">\begin</span>&#123;tabular&#125;&#123;|l|c|r|&#125;</span><br><span class="line">    <span class="keyword">\hline</span></span><br><span class="line">    我是 <span class="built_in">&amp;</span> 一只 <span class="built_in">&amp;</span> 普通 <span class="keyword">\\</span></span><br><span class="line">    <span class="keyword">\hline</span></span><br><span class="line">    的   <span class="built_in">&amp;</span> 表格 <span class="built_in">&amp;</span> 呀   <span class="keyword">\\</span></span><br><span class="line">    <span class="keyword">\hline</span></span><br><span class="line">  <span class="keyword">\end</span>&#123;tabular&#125;</span><br><span class="line"><span class="keyword">\end</span>&#123;table&#125;</span><br></pre></td></tr></table></figure><p>由示例可知， <code>&#123;|l|c|r|&#125;</code>参数是用于确定文字的对齐方向的。</p><p>作为浮动体， <code>table</code> 可以设置排版位置，即使用 <code>[htbp]</code> 设置排版位置：</p><figure class="highlight latex"><table><tr><td class="code"><pre><span class="line"><span class="keyword">\begin</span>&#123;table&#125;[⟨placement⟩]</span><br><span class="line">...</span><br><span class="line"><span class="keyword">\end</span>&#123;table&#125;</span><br></pre></td></tr></table></figure><p>如果需要引用表格，方法与之前类似。通过 <code>\label&#123;⟨标签名⟩&#125;</code> 添加标签。并使用 <code>\ref&#123;⟨标签名⟩&#125;</code> 进行引用。</p></li><li><p>三线表</p><figure class="highlight latex"><table><tr><td class="code"><pre><span class="line"><span class="keyword">\begin</span>&#123;table&#125;[ht]</span><br><span class="line">  <span class="keyword">\centering</span></span><br><span class="line">  <span class="keyword">\caption</span>&#123;一般三线表&#125;</span><br><span class="line">  <span class="keyword">\label</span>&#123;tab:2&#125;</span><br><span class="line">  <span class="keyword">\begin</span>&#123;tabular&#125;&#123;ccc&#125;</span><br><span class="line">    <span class="keyword">\toprule</span></span><br><span class="line">    姓名 <span class="built_in">&amp;</span> 学号 <span class="built_in">&amp;</span> 性别 <span class="keyword">\\</span></span><br><span class="line">    <span class="keyword">\midrule</span></span><br><span class="line">    张三 <span class="built_in">&amp;</span> 001  <span class="built_in">&amp;</span> 男   <span class="keyword">\\</span></span><br><span class="line">    李四 <span class="built_in">&amp;</span> 002  <span class="built_in">&amp;</span> 女   <span class="keyword">\\</span></span><br><span class="line">    <span class="keyword">\bottomrule</span></span><br><span class="line">  <span class="keyword">\end</span>&#123;tabular&#125;</span><br><span class="line"><span class="keyword">\end</span>&#123;table&#125;</span><br></pre></td></tr></table></figure><p>三线表中三条横线分别使用 <code>\toprule</code>、<code>\midrule</code> 与 <code>\bottomrule</code>。若要添加 m-n 列的横线，可使用 <code>\cmidrule&#123;m-n&#125;</code> :</p><figure class="highlight latex"><table><tr><td class="code"><pre><span class="line"><span class="keyword">\begin</span>&#123;table&#125;[ht]</span><br><span class="line">  <span class="keyword">\centering</span></span><br><span class="line">  <span class="keyword">\caption</span>&#123;占满文字宽度的三线表&#125;</span><br><span class="line">  <span class="keyword">\label</span>&#123;tab:3&#125;</span><br><span class="line">  <span class="keyword">\begin</span>&#123;tabularx&#125;&#123;<span class="keyword">\textwidth</span>&#125;&#123;CCCC&#125;</span><br><span class="line">    <span class="keyword">\toprule</span></span><br><span class="line">    序号 <span class="built_in">&amp;</span> 年龄 <span class="built_in">&amp;</span> 身高   <span class="built_in">&amp;</span> 体重  <span class="keyword">\\</span></span><br><span class="line">    <span class="keyword">\midrule</span></span><br><span class="line">    1    <span class="built_in">&amp;</span> 14   <span class="built_in">&amp;</span> 156    <span class="built_in">&amp;</span> 42    <span class="keyword">\\</span></span><br><span class="line">    2    <span class="built_in">&amp;</span> 16   <span class="built_in">&amp;</span> 158    <span class="built_in">&amp;</span> 45    <span class="keyword">\\</span></span><br><span class="line">    3    <span class="built_in">&amp;</span> 14   <span class="built_in">&amp;</span> 162    <span class="built_in">&amp;</span> 48    <span class="keyword">\\</span></span><br><span class="line">    4    <span class="built_in">&amp;</span> 15   <span class="built_in">&amp;</span> 163    <span class="built_in">&amp;</span> 50    <span class="keyword">\\</span></span><br><span class="line">    <span class="keyword">\cmidrule</span>&#123;2-4&#125; <span class="comment">%添加2-4列的中线</span></span><br><span class="line">    平均 <span class="built_in">&amp;</span> 15   <span class="built_in">&amp;</span> 159.75 <span class="built_in">&amp;</span> 46.25 <span class="keyword">\\</span></span><br><span class="line">    <span class="keyword">\bottomrule</span></span><br><span class="line">  <span class="keyword">\end</span>&#123;tabularx&#125;</span><br><span class="line"><span class="keyword">\end</span>&#123;table&#125;</span><br></pre></td></tr></table></figure></li><li><p>跨页表格</p><p>跨页表格常用于附录（把正文懒得放下的实验数据统统放在附录的表中）。下面是跨页表格的一个示例：</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">\begin&#123;xltabular&#125;&#123;\textwidth&#125;&#123;CCCCCCCCC&#125;</span><br><span class="line">  \caption&#123;文字宽度的跨页表格示例&#125;  \\</span><br><span class="line">  \toprule</span><br><span class="line">  1 &amp; 0 &amp; 5 &amp; 1 &amp; 2 &amp; 3 &amp; 4 &amp; 5 &amp; 6 \\</span><br><span class="line">  \midrule</span><br><span class="line">  \endfirsthead</span><br><span class="line"></span><br><span class="line">  \multicolumn&#123;9&#125;&#123;l&#125;&#123;接上一页&#125;      \\</span><br><span class="line">  \toprule</span><br><span class="line">  1 &amp; 0 &amp; 5 &amp; 1 &amp; 2 &amp; 3 &amp; 4 &amp; 5 &amp; 6 \\</span><br><span class="line">  \midrule</span><br><span class="line">  \endhead</span><br><span class="line"></span><br><span class="line">  \toprule</span><br><span class="line">  \multicolumn&#123;9&#125;&#123;r&#125;&#123;转下一页&#125;</span><br><span class="line">  \endfoot</span><br><span class="line"></span><br><span class="line">  \bottomrule</span><br><span class="line">  \endlastfoot</span><br><span class="line"></span><br><span class="line">  1 &amp; 0 &amp; 5 &amp; 1 &amp; 2 &amp; 3 &amp; 4 &amp; 5 &amp; 6 \\</span><br><span class="line">  1 &amp; 0 &amp; 5 &amp; 1 &amp; 2 &amp; 3 &amp; 4 &amp; 5 &amp; 6 \\</span><br><span class="line">  1 &amp; 0 &amp; 5 &amp; 1 &amp; 2 &amp; 3 &amp; 4 &amp; 5 &amp; 6 \\</span><br><span class="line">  1 &amp; 0 &amp; 5 &amp; 1 &amp; 2 &amp; 3 &amp; 4 &amp; 5 &amp; 6 \\</span><br><span class="line">  1 &amp; 0 &amp; 5 &amp; 1 &amp; 2 &amp; 3 &amp; 4 &amp; 5 &amp; 6 \\</span><br><span class="line">  1 &amp; 0 &amp; 5 &amp; 1 &amp; 2 &amp; 3 &amp; 4 &amp; 5 &amp; 6 \\</span><br><span class="line">  1 &amp; 0 &amp; 5 &amp; 1 &amp; 2 &amp; 3 &amp; 4 &amp; 5 &amp; 6 \\</span><br><span class="line">  1 &amp; 0 &amp; 5 &amp; 1 &amp; 2 &amp; 3 &amp; 4 &amp; 5 &amp; 6 \\</span><br><span class="line">  1 &amp; 0 &amp; 5 &amp; 1 &amp; 2 &amp; 3 &amp; 4 &amp; 5 &amp; 6 \\</span><br><span class="line">  1 &amp; 0 &amp; 5 &amp; 1 &amp; 2 &amp; 3 &amp; 4 &amp; 5 &amp; 6 \\</span><br><span class="line">  1 &amp; 0 &amp; 5 &amp; 1 &amp; 2 &amp; 3 &amp; 4 &amp; 5 &amp; 6 \\</span><br><span class="line">  1 &amp; 0 &amp; 5 &amp; 1 &amp; 2 &amp; 3 &amp; 4 &amp; 5 &amp; 6 \\</span><br><span class="line">  1 &amp; 0 &amp; 5 &amp; 1 &amp; 2 &amp; 3 &amp; 4 &amp; 5 &amp; 6 \\</span><br><span class="line">  1 &amp; 0 &amp; 5 &amp; 1 &amp; 2 &amp; 3 &amp; 4 &amp; 5 &amp; 6 \\</span><br><span class="line">  1 &amp; 0 &amp; 5 &amp; 1 &amp; 2 &amp; 3 &amp; 4 &amp; 5 &amp; 6 \\</span><br><span class="line">  1 &amp; 0 &amp; 5 &amp; 1 &amp; 2 &amp; 3 &amp; 4 &amp; 5 &amp; 6 \\</span><br><span class="line">  1 &amp; 0 &amp; 5 &amp; 1 &amp; 2 &amp; 3 &amp; 4 &amp; 5 &amp; 6 \\</span><br><span class="line">  1 &amp; 0 &amp; 5 &amp; 1 &amp; 2 &amp; 3 &amp; 4 &amp; 5 &amp; 6 \\</span><br><span class="line">  1 &amp; 0 &amp; 5 &amp; 1 &amp; 2 &amp; 3 &amp; 4 &amp; 5 &amp; 6 \\</span><br><span class="line">  1 &amp; 0 &amp; 5 &amp; 1 &amp; 2 &amp; 3 &amp; 4 &amp; 5 &amp; 6 \\</span><br><span class="line">\end&#123;xltabular&#125;</span><br></pre></td></tr></table></figure><p>跨页表格的表头表尾：</p><figure class="highlight latex"><table><tr><td class="code"><pre><span class="line"><span class="comment">% 这里写第一页表头的内容</span></span><br><span class="line"><span class="keyword">\endfirsthead</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">% 这里写之后每一页的表头的内容，可选</span></span><br><span class="line"><span class="keyword">\endhead</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">% 这里写第一页表尾的内容，可选</span></span><br><span class="line"><span class="keyword">\endfoot</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">% 这里写最后一页表尾的内容，可选</span></span><br><span class="line"><span class="keyword">\endlastfoot</span></span><br></pre></td></tr></table></figure></li></ul>]]></content>
      
      
      <categories>
          
          <category> 编程学习 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> LaTeX </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>博客样式测试</title>
      <link href="/posts/7cd08a64.html"/>
      <url>/posts/7cd08a64.html</url>
      
        <content type="html"><![CDATA[<h2 id="前言-8">前言</h2><p>样式测试</p><h2 id="Butterfly-主题使用的插件">Butterfly 主题使用的插件</h2><h3 id="Tabs">Tabs</h3><div class="tabs" id="成就记录"><ul class="nav-tabs"><li class="tab"><button type="button" data-href="#成就记录-1">40L</button></li><li class="tab active"><button type="button" data-href="#成就记录-2">20TSD</button></li><li class="tab"><button type="button" data-href="#成就记录-3">拼花</button></li></ul><div class="tab-contents"><div class="tab-item-content" id="成就记录-1"><p><strong>在尽可能短的时间内消除40行</strong></p><ul><li><a href="https://www.bilibili.com/video/BV1KP4y1N73j">sub60</a></li></ul><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content active" id="成就记录-2"><p><strong>连续完成20次T-spin doule</strong></p><ul><li><p><a href="https://www.bilibili.com/video/BV1Av411K7ER">机械TSD</a></p></li><li><p><a href="https://www.bilibili.com/video/BV1BU4y1o7sH">LST</a></p></li></ul><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="成就记录-3"><p><strong>大于号拼花</strong></p><ul><li><a href="https://www.bilibili.com/video/BV1j5411g7m5">secret grade</a></li></ul><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><h3 id="timeline">timeline</h3><div class="timeline color"><div class='timeline-item headline'><div class='timeline-item-title'><div class='item-circle'><p>title</p></div></div></div><div class='timeline-item'><div class='timeline-item-title'><div class='item-circle'><p>title</p></div></div><div class='timeline-item-content'><p>xxxxx</p></div></div><div class='timeline-item'><div class='timeline-item-title'><div class='item-circle'><p>title</p></div></div><div class='timeline-item-content'><p>xxxxx</p></div></div></div><h3 id="折叠框-hideToggle">折叠框 hideToggle</h3><details class="toggle" ><summary class="toggle-button" style="">Butterfly安裝方法</summary><div class="toggle-content"><p>在你的博客根目錄裏</p><p>git clone -b master <a href="https://github.com/jerryc127/hexo-theme-butterfly.git">https://github.com/jerryc127/hexo-theme-butterfly.git</a> themes/Butterfly</p><p>如果想要安裝比較新的dev分支，可以</p><p>git clone -b dev <a href="https://github.com/jerryc127/hexo-theme-butterfly.git">https://github.com/jerryc127/hexo-theme-butterfly.git</a> themes/Butterfly</p></div></details><h2 id="Tag-Plugins-Plus">Tag Plugins Plus</h2><blockquote><p>插件：hexo-butterfly-tag-plugins-plus<br>测试例来自或参考于 <a href="https://akilar.top/posts/615e2dec/">Tag Plugins Plus | Akilarの糖果屋</a></p></blockquote><h3 id="行内文本样式-text">行内文本样式 text</h3><ol><li>带 <u>下划线</u> 的文本</li><li>带 <emp>着重号</emp> 的文本</li><li>带 <wavy>波浪线</wavy> 的文本</li><li>带 <del>删除线</del> 的文本</li><li>键盘样式的文本 <kbd>command</kbd> + <kbd>D</kbd></li><li>密码样式的文本：<psw>这里没有验证码</psw></li></ol><h3 id="行内文本-span">行内文本 span</h3><ul><li>彩色文字<br>在一段话中方便插入各种颜色的标签，包括：<span class='p red'>红色</span>、<span class='p yellow'>黄色</span>、<span class='p green'>绿色</span>、<span class='p cyan'>青色</span>、<span class='p blue'>蓝色</span>、<span class='p gray'>灰色</span>。</li><li>超大号文字<br>文档「开始」页面中的标题部分就是超大号文字。<span class='p center logo large'>Volantis</span><span class='p center small'>A Wonderful Theme for Hexo</span></li></ul><h3 id="上标标签-tip">上标标签 tip</h3><div class="tip "><p>default</p></div><div class="tip info"><p>info</p></div><div class="tip success"><p>success</p></div><div class="tip error"><p>error</p></div><div class="tip warning"><p>warning</p></div><div class="tip bolt"><p>bolt</p></div><div class="tip ban"><p>ban</p></div><div class="tip home"><p>home</p></div><div class="tip sync"><p>sync</p></div><div class="tip cogs"><p>cogs</p></div><div class="tip key"><p>key</p></div><div class="tip bell"><p>bell</p></div><div class="tip fa-atom"><p>自定义font awesome图标</p></div><h3 id="动态标签-anima">动态标签 anima</h3><div class="tip warning faa-horizontal animated-hover"><p>warning</p></div><div class="tip ban faa-flash animated-hover"><p>ban</p></div><h3 id="复选列表-checkbox">复选列表 checkbox</h3><div class='checkbox'><input type="checkbox" />            <p>纯文本测试</p>            </div><div class='checkbox checked'><input type="checkbox" checked="checked"/>            <p>支持简单的 <a href="https://guides.github.com/features/mastering-markdown/">markdown</a> 语法</p>            </div><div class='checkbox red'><input type="checkbox" />            <p>支持自定义颜色</p>            </div><div class='checkbox green checked'><input type="checkbox" checked="checked"/>            <p>绿色 + 默认选中</p>            </div><div class='checkbox yellow checked'><input type="checkbox" checked="checked"/>            <p>黄色 + 默认选中</p>            </div><div class='checkbox cyan checked'><input type="checkbox" checked="checked"/>            <p>青色 + 默认选中</p>            </div><div class='checkbox blue checked'><input type="checkbox" checked="checked"/>            <p>蓝色 + 默认选中</p>            </div><div class='checkbox plus green checked'><input type="checkbox" checked="checked"/>            <p>增加</p>            </div><div class='checkbox minus yellow checked'><input type="checkbox" checked="checked"/>            <p>减少</p>            </div><div class='checkbox times red checked'><input type="checkbox" checked="checked"/>            <p>叉</p>            </div><h3 id="单选列表-radio">单选列表 radio</h3><div class='checkbox'><input type="radio" />            <p>纯文本测试</p>            </div><div class='checkbox checked'><input type="radio" checked="checked"/>            <p>支持简单的 <a href="https://guides.github.com/features/mastering-markdown/">markdown</a> 语法</p>            </div><div class='checkbox red'><input type="radio" />            <p>支持自定义颜色</p>            </div><div class='checkbox green'><input type="radio" />            <p>绿色</p>            </div><div class='checkbox yellow'><input type="radio" />            <p>黄色</p>            </div><div class='checkbox cyan'><input type="radio" />            <p>青色</p>            </div><div class='checkbox blue'><input type="radio" />            <p>蓝色</p>            </div><h3 id="链接卡片-link">链接卡片 link</h3><p>标签插件没法嵌套，大悲。</p><div class="tag link"><a class="link-card" title="博客搭建备忘录" href="/posts/6b405ec0.html"><div class="left"><img src="/images/linkcard.png"/></div><div class="right"><p class="text">博客搭建备忘录</p><p class="url">/posts/6b405ec0.html</p></div></a></div><h3 id="注释-notation">注释 notation</h3><span class='nota' data-nota='可以看到注解内容出现在顶栏'>把鼠标移动到我上面试试</span><h3 id="气泡注释-bubble">气泡注释 bubble</h3><p>西藏地区湖泊众多，受人类活动影响较小，处于较为原始自然的状态，如<span class="bubble-content">扎日南木错</span><span class="bubble-notation"><span class="bubble-item" style="background-color:#868fd7;">位于西藏阿里地区错勤县境内，该湖水主要靠冰雪融水补给，入湖河流主要有错勤藏布、达龙藏布，错勤藏布发源于冈底斯山。它是西藏境内第三大湖泊。 </span></span>。这些湖泊的水补给多为冰川融水，其水位能一定程度反映冰川的消融情况，与我国淡水资源的利用研究有十分密切的联系，具有有很大的现实意义。</p><h3 id="引用文献-reference">引用文献 reference</h3><p>同时，由于青藏高原环境恶劣，很少有现场测量仪器可用于湖水位监测。而基于卫星测高技术具有快速的全球覆盖能力，能够大尺度、周期性地探测陆表水的各种自然现象及其变化，故在这类研究中具有其他观测技术无可比拟的优越性<span class="hidden-anchor" id="referto_[1]"></span><sup class="reference"><a href="#referfrom_[1]">[1]</a></sup><span class="reference-bubble"><span class="reference-item"><span class="reference-literature">基于卫星测高技术的青藏高原湖泊水位和冰川高程变化监测研究</span><span class="reference-title">参考资料</span></span></span>。</p><div class="reference-source"><span class="hidden-anchor" id="referfrom_[1] "></span><a class="reference-anchor" href="#referto_[1] ">[1] <div class="reference-anchor-up fa-solid fa-angles-up"></div></a><a class="reference-link" href=" https://d.wanfangdata.com.cn/thesis/ChJUaGVzaXNOZXdTMjAyMjA1MjYSCFkyNjc0NjA4Ggg2ODhsaWhrag%3D%3D"> 高乐. 基于卫星测高技术的青藏高原湖泊水位和冰川高程变化监测研究[D]. 中国科学院大学&sbquo;2014. </a></div><h3 id="github卡片-ghcard">github卡片 ghcard</h3><table><thead><tr><th></th><th></th></tr></thead><tbody><tr><td><a class="ghcard" rel="external nofollow noopener noreferrer" href="https://github.com/ZerolAcqua/old-programs"><img src="https://github-readme-stats.zerolacqua.top/api/pin/?username=ZerolAcqua&repo=old-programs&show_owner=true"/></a></td><td><a class="ghcard" rel="external nofollow noopener noreferrer" href="https://github.com/ZerolAcqua/old-programs"><img src="https://github-readme-stats.zerolacqua.top/api/pin/?username=ZerolAcqua&repo=old-programs&theme=vue&show_owner=true"/></a></td></tr><tr><td><a class="ghcard" rel="external nofollow noopener noreferrer" href="https://github.com/ZerolAcqua/old-programs"><img src="https://github-readme-stats.zerolacqua.top/api/pin/?username=ZerolAcqua&repo=old-programs&theme=buefy&show_owner=true"/></a></td><td><a class="ghcard" rel="external nofollow noopener noreferrer" href="https://github.com/ZerolAcqua/old-programs"><img src="https://github-readme-stats.zerolacqua.top/api/pin/?username=ZerolAcqua&repo=old-programs&theme=solarized-light&show_owner=true"/></a></td></tr><tr><td><a class="ghcard" rel="external nofollow noopener noreferrer" href="https://github.com/ZerolAcqua/old-programs"><img src="https://github-readme-stats.zerolacqua.top/api/pin/?username=ZerolAcqua&repo=old-programs&theme=onedark&show_owner=true"/></a></td><td><a class="ghcard" rel="external nofollow noopener noreferrer" href="https://github.com/ZerolAcqua/old-programs"><img src="https://github-readme-stats.zerolacqua.top/api/pin/?username=ZerolAcqua&repo=old-programs&theme=solarized-dark&show_owner=true"/></a></td></tr><tr><td><a class="ghcard" rel="external nofollow noopener noreferrer" href="https://github.com/ZerolAcqua/old-programs"><img src="https://github-readme-stats.zerolacqua.top/api/pin/?username=ZerolAcqua&repo=old-programs&theme=algolia&show_owner=true"/></a></td><td><a class="ghcard" rel="external nofollow noopener noreferrer" href="https://github.com/ZerolAcqua/old-programs"><img src="https://github-readme-stats.zerolacqua.top/api/pin/?username=ZerolAcqua&repo=old-programs&theme=calm&show_owner=true"/></a></td></tr></tbody></table><h3 id="折叠框-folding">折叠框 folding</h3><p><code>Butterfly</code> 虽然也有内置折叠框 <code>hideToggle</code> 标签，但是 <code>Volantis</code> 的 <code>folding</code> 折叠框更好看一些。</p><details class="folding-tag" green><summary> 查看代码测试 </summary>              <div class='content'>              <figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">//假装这里有代码块</span></span><br></pre></td></tr></table></figure>              </div>            </details><h3 id="网站卡片-sites">网站卡片 sites</h3><div class="site-card-group"><a class="site-card" href="http://zerolacqua.top"><div class="img"><img src=" https://cdn.zerolacqua.top/images/blogs/博客样式测试/丘卡饮品店.png"/></div><div class="info"><img src=" https://cdn.zerolacqua.top/images/avatar.png"/><span class="title">丘卡饮品店</span><span class="desc">欢迎来玩~</span></div></a></div><h3 id="诗词标签-poem">诗词标签 poem</h3><div class='poem'><div class='poem-title'>水调歌头</div><div class='poem-author'>苏轼</div><p>丙辰中秋，欢饮达旦，大醉，作此篇，兼怀子由。<br>明月几时有？把酒问青天。<br>不知天上宫阙，今夕是何年？<br>我欲乘风归去，又恐琼楼玉宇，高处不胜寒。<br>起舞弄清影，何似在人间？</p><p>转朱阁，低绮户，照无眠。<br>不应有恨，何事长向别时圆？<br>人有悲欢离合，月有阴晴圆缺，此事古难全。<br>但愿人长久，千里共婵娟。</p></div><h2 id="其他插件">其他插件</h2><h3 id="spoiler">spoiler</h3><blockquote><p>插件：hexo-spoiler</p></blockquote><!-- spoiler-1ffd9:black -->  <span class="spoiler" onclick="this.classList.toggle('spoiler')">    <span class="spoiler-blur spoiler-1ffd9">你看不见我</span>  </span><h3 id="ruby">ruby</h3><blockquote><p>插件：markdown-it-ruby<br><code>spoiler</code> 和 <code>ruby</code> 可以一起用哦</p></blockquote><p>我是看板娘<ruby>零醇丘卡<rt><!-- spoiler-1ffd9:black -->  <span class="spoiler" onclick="this.classList.toggle('spoiler')">    <span class="spoiler-blur spoiler-1ffd9">低糖啾啾~</span>  </span></rt></ruby></p><h3 id="ECharts">ECharts</h3><blockquote><p>插件：hexo-tag-echarts</p></blockquote><div id="echarts2233" style="width: 85%;height: 400px;margin: 0 auto"></div><script src="https://cdn.bootcss.com/echarts/3.8.0/echarts.common.min.js"></script><script type="text/javascript">        // 基于准备好的dom，初始化echarts实例        var myChart = echarts.init(document.getElementById('echarts2233'));        // 指定图表的配置项和数据        var option = {    tooltip : {        trigger: 'axis',        axisPointer : {            // 坐标轴指示器，坐标轴触发有效            type : 'shadow'        // 默认为直线，可选为：'line' | 'shadow'        }    },    legend: {        data:['利润', '支出', '收入']    },    grid: {        left: '3%',        right: '4%',        bottom: '3%',        containLabel: true    },    xAxis : [        {            type : 'value'        }    ],    yAxis : [        {            type : 'category',            axisTick : {show: false},            data : ['周一','周二','周三','周四','周五','周六','周日']        }    ],    series : [        {            name:'利润',            type:'bar',            itemStyle : {                normal: {                    label: {show: true, position: 'inside'}                }            },            data:[200, 170, 240, 244, 200, 220, 210]        },        {            name:'收入',            type:'bar',            stack: '总量',            itemStyle: {                normal: {                    label : {show: true}                }            },            data:[320, 302, 341, 374, 390, 450, 420]        },        {            name:'支出',            type:'bar',            stack: '总量',            itemStyle: {normal: {                label : {show: true, position: 'left'}            }},            data:[-120, -132, -101, -134, -190, -230, -210]        }    ]};        // 使用刚指定的配置项和数据显示图表。        myChart.setOption(option);</script>]]></content>
      
      
      <categories>
          
          <category> 博客相关 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 博客搭建 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>colmap 三维重建极简教程</title>
      <link href="/posts/abd9a5f1.html"/>
      <url>/posts/abd9a5f1.html</url>
      
        <content type="html"><![CDATA[<h2 id="前言-7">前言</h2><p>利用 <code>colmap</code> 由手机拍摄影像生成三维模型。</p><h2 id="软件下载">软件下载</h2><ul><li><p><a href="https://github.com/colmap/colmap/releases"><code>colmap</code></a> 是一种通用运动结构（<code>SfM</code>）和多视立体（<code>MVS</code>）管道，具有图形界面，开源。</p><blockquote><p>建议使用 <code>-cuda</code> 版本，而不是 <code>-no-cuda</code>。后者无法生成稠密点云和 <code>mesh</code> 。</p></blockquote></li><li><p><a href="https://www.meshlab.net/#download"><code>MeshLab</code></a> 是一种三维三角格网处理编辑系统，开源。</p></li></ul><h2 id="使用">使用</h2><ul><li><p>运行 <code>COLMAP.bat</code> ，会开启命令行和 <code>colmap</code> 的图形界面。</p><blockquote><p>注意不要关闭命令行！</p></blockquote></li><li><p>选择 <code>Reconstruction -&gt; Automatic reconstruction </code></p><ul><li>设置 <code>Workspace folder</code>：这里存放中间结果与最终的重建结果；</li><li>设置 <code>Image folder</code>：这里是初始影像的存放目录；</li><li><code>Data type</code> 选择 <code>Individual images</code> ；</li><li><code>Quality</code> 根据需要进行选择 ；</li><li>勾选 <code>Sparse model</code> 和 <code>Dense model</code> 生成稀疏和稠密模型，取消勾选 <code>Shared intrinsics</code>，其他不变。</li></ul></li><li><p>点击 <code>run</code> 开始运行</p></li><li><p>生成的稠密点云和 <code>mesh</code> 结果在  <code>workspace\dense\0\fused.ply</code> 和 <code>workspace\dense\0\meshed-poisson.ply</code> 中，需要用 <code>MeshLab</code> 等外部软件进行可视化。</p></li></ul><h2 id="结果">结果</h2><p>结果如图</p><p><img src="https://cdn.zerolacqua.top/images/blogs/colmap%E4%B8%89%E7%BB%B4%E9%87%8D%E5%BB%BA%E6%9E%81%E7%AE%80%E6%95%99%E7%A8%8B/1.png" alt="图1"></p>]]></content>
      
      
      <categories>
          
          <category> 课程学习 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 摄影测量 </tag>
            
            <tag> 计算机视觉 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>C 与 C++ 的文件读写</title>
      <link href="/posts/e85bfb6a.html"/>
      <url>/posts/e85bfb6a.html</url>
      
        <content type="html"><![CDATA[<h2 id="前言-2">前言</h2><p>虽然我已经大三了，但是面对夏令营随时可能犯病的编程要求，我还是要准备一下文件读取的。毕竟文件读写还是挺重要的，而编程题目里的文件格式乱七八糟的，不清楚是否允许使用 C++ 的读写方式，所以做一做总结吧。</p><h2 id="打开关闭文件">打开关闭文件</h2><div class="tabs" id="打开关闭文件"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#打开关闭文件-1">C 语言风格</button></li><li class="tab"><button type="button" data-href="#打开关闭文件-2">C++ 风格</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="打开关闭文件-1"><p>使用 C 标准库 <code>stdio.h</code></p><figure class="highlight c"><table><tr><td class="code"><pre><span class="line">FILE *<span class="title function_">fopen</span><span class="params">(<span class="type">const</span> <span class="type">char</span> *filename, <span class="type">const</span> <span class="type">char</span> *mode)</span>;</span><br></pre></td></tr></table></figure><table><thead><tr><th>模式</th><th>描述</th></tr></thead><tbody><tr><td>r</td><td>打开一个已有的文本文件，允许读取文件。</td></tr><tr><td>w</td><td>打开一个文本文件，允许写入文件。如果文件不存在，则会创建一个新文件。在这里，您的程序会从文件的开头写入内容。如果文件存在，则该会被截断为零长度，重新写入。</td></tr><tr><td>a</td><td>打开一个文本文件，以追加模式写入文件。如果文件不存在，则会创建一个新文件。在这里，您的程序会在已有的文件内容中追加内容。</td></tr><tr><td>r+</td><td>打开一个文本文件，允许读写文件。</td></tr><tr><td>w+</td><td>打开一个文本文件，允许读写文件。如果文件已存在，则文件会被截断为零长度，如果文件不存在，则会创建一个新文件。</td></tr><tr><td>a+</td><td>打开一个文本文件，允许读写文件。如果文件不存在，则会创建一个新文件。读取会从文件的开头开始，写入则只能是追加模式。</td></tr></tbody></table><p>如果处理的是二进制文件，则需使用下面的访问模式来取代上面的访问模式：</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&quot;rb&quot;, &quot;wb&quot;, &quot;ab&quot;, &quot;rb+&quot;, &quot;r+b&quot;, &quot;wb+&quot;, &quot;w+b&quot;, &quot;ab+&quot;, &quot;a+b&quot;</span><br></pre></td></tr></table></figure><p>如果需要关闭文件，使用 <code>fclose()</code> 函数：</p><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">fclose</span><span class="params">(FILE *fp)</span>;</span><br></pre></td></tr></table></figure><p>如果成功关闭文件，<code>fclose()</code> 函数返回零，如果关闭文件时发生错误，函数返回 <code>EOF</code>。这个函数实际上，会清空缓冲区中的数据，关闭文件，并释放用于该文件的所有内存。<code>EOF</code> 是一个定义在头文件 <code>stdio.h</code> 中的常量。</p><p>C 标准库提供了各种函数来按字符或者以固定长度字符串的形式读写文件。</p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="打开关闭文件-2"><p>使用 C++ 标准库 <code>fstream</code>，它定义了三个新的数据类型：</p><table><thead><tr><th>数据类型</th><th>描述</th></tr></thead><tbody><tr><td>ofstream</td><td>该数据类型表示输出文件流，用于创建文件并向文件写入信息。</td></tr><tr><td>ifstream</td><td>该数据类型表示输入文件流，用于从文件读取信息。</td></tr><tr><td>fstream</td><td>该数据类型通常表示文件流，且同时具有 <code>ofstream</code> 和 <code>ifstream</code> 两种功能，这意味着它可以创建文件，向文件写入信息，从文件读取信息。</td></tr></tbody></table><p>要在 C++ 中进行文件处理，必须在 C++ 源代码文件中包含头文件 <code>&lt;iostream&gt;</code> 和 <code>&lt;fstream&gt;</code>。</p><p>同样的，利用 <code>open()</code> 函数打开文件。</p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">open</span><span class="params">(<span class="type">const</span> <span class="type">char</span> *filename, ios::openmode mode)</span></span>;</span><br></pre></td></tr></table></figure><p>在这里，<code>open()</code> 成员函数的第一参数指定要打开的文件的名称和位置，第二个参数定义文件被打开的模式。</p><table><thead><tr><th style="text-align:left">模式标志</th><th style="text-align:left">描述</th></tr></thead><tbody><tr><td style="text-align:left">ios::app</td><td style="text-align:left">追加模式。所有写入都追加到文件末尾。</td></tr><tr><td style="text-align:left">ios::ate</td><td style="text-align:left">文件打开后定位到文件末尾。</td></tr><tr><td style="text-align:left">ios::in</td><td style="text-align:left">打开文件用于读取。</td></tr><tr><td style="text-align:left">ios::out</td><td style="text-align:left">打开文件用于写入。</td></tr><tr><td style="text-align:left">ios::trunc</td><td style="text-align:left">如果该文件已经存在，其内容将在打开文件之前被截断，即把文件长度设为 0。</td></tr></tbody></table><p>对于 <code>ifstream</code>，可以直接在构造函数中提供以上参数，则不需要 <code>open()</code>。</p><p>当 C++ 程序终止时，它会自动关闭刷新所有流，释放所有分配的内存，并关闭所有打开的文件。但程序员应该养成一个好习惯，在程序终止前关闭所有打开的文件。</p><p>下面是 <code>close()</code> 函数的标准语法，<code>close()</code> 函数是 <code>fstream</code>、<code>ifstream</code> 和 <code>ofstream</code> 对象的一个成员。</p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">close</span><span class="params">()</span></span>;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><h2 id="读取文件">读取文件</h2><div class="tabs" id="读取文件"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#读取文件-1">C 语言风格</button></li><li class="tab"><button type="button" data-href="#读取文件-2">C++ 风格</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="读取文件-1"><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">fgetc</span><span class="params">(FILE * fp)</span>; <span class="comment">// 读取单个字符</span></span><br><span class="line"><span class="type">char</span> *<span class="title function_">fgets</span><span class="params">(<span class="type">char</span> *buf, <span class="type">int</span> n, FILE *fp)</span>; <span class="comment">// 读取一段字符串</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">fscanf</span><span class="params">(FILE *fp, <span class="type">const</span> <span class="type">char</span> *format, ...)</span> <span class="comment">// 格式化读取</span></span><br></pre></td></tr></table></figure><ul><li><p><code>fgetc()</code> 函数从 <code>fp</code> 所指向的输入文件中读取一个字符。返回值是读取的字符，如果发生错误则返回 <code>EOF</code>。</p></li><li><p><code>fgets()</code> 函数从 <code>fp</code> 所指向的输入流中读取 <code>n - 1</code> 个字符。它会把读取的字符串复制到缓冲区 <code>buf</code>，并在最后追加一个 <code>null</code> 字符来终止字符串。</p><p>如果这个函数在读取最后一个字符之前就遇到一个换行符 <code>'\n'</code> 或文件的末尾 <code>EOF</code>，则只会返回读取到的字符，<u>包括换行符</u>。当 <code>fget()</code>读取失败，如已经达到 <code>EOF</code> 时，返回 <code>NULL</code>，借此可以判断文件是否读取完成。</p></li><li><p><code>fscanf()</code> 函数从文件中读取字符串，但是在<u>遇到第一个空格和换行符时，它会停止读取</u>。如果成功，该函数返回成功匹配和<b>赋值</b>的个数。如果到达文件末尾或发生读错误，则返回 <code>EOF</code>。<code>format</code> 的格式请见 <a href="https://www.runoob.com/cprogramming/c-function-fscanf.html">C 库函数 – fscanf() | 菜鸟教程 (runoob.com)</a></p><blockquote><p>也就是说，如果使用类似 <code>%*d</code> 的方式忽视了匹配的内容，则不会计入返回的成功匹配和<b>赋值</b>计数中。</p></blockquote></li><li><p><code>fread()</code>函数用于读取二进制文件。</p></li><li><p>如果想再从头开始读取，使用以下函数：</p><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">rewind</span><span class="params">(FILE *stream)</span></span><br></pre></td></tr></table></figure></li></ul><p>读取文件时需要注意这两个代码的差异</p><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">/* --- data.txt --- </span></span><br><span class="line"><span class="comment">3</span></span><br><span class="line"><span class="comment">3N,1E,1N,3E,2S,1W</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">FILE* infile = fopen(<span class="string">&quot;data.txt&quot;</span>, <span class="string">&quot;r&quot;</span>);</span><br><span class="line"><span class="type">int</span> i = <span class="number">0</span>;</span><br><span class="line"><span class="type">char</span> c1 = <span class="number">0</span>;</span><br><span class="line"><span class="built_in">fscanf</span>(infile, <span class="string">&quot;%d&quot;</span>, &amp;i); <span class="comment">// 这里没有空格</span></span><br><span class="line"><span class="built_in">fscanf</span>(infile, <span class="string">&quot;%c&quot;</span>, &amp;c1); <span class="comment">// c1=&#x27;\n&#x27;</span></span><br></pre></td></tr></table></figure><figure class="highlight c"><table><tr><td class="code"><pre><span class="line">FILE* infile = fopen(<span class="string">&quot;data.txt&quot;</span>, <span class="string">&quot;r&quot;</span>);</span><br><span class="line"><span class="type">int</span> i = <span class="number">0</span>;</span><br><span class="line"><span class="type">char</span> c1 = <span class="number">0</span>;</span><br><span class="line"><span class="built_in">fscanf</span>(infile, <span class="string">&quot;%d &quot;</span>, &amp;i);<span class="comment">// 这里有空格</span></span><br><span class="line"><span class="built_in">fscanf</span>(infile, <span class="string">&quot;%c&quot;</span>, &amp;c1); <span class="comment">// c1=&#x27;3&#x27;</span></span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="读取文件-2"><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line">infile &gt;&gt; tmp;</span><br><span class="line"><span class="function">std::istream &amp;<span class="title">getline</span><span class="params">(<span class="type">char</span>* _Str, std::streamsize _count)</span></span>;</span><br></pre></td></tr></table></figure><ul><li><p>使用类似 <code>cin</code>的写法，利用 <code>&gt;&gt;</code> 运算符读取。这种方法首先跳过流中连续的空白字符（空格、换行、制表符），然后开始按变量类型读取非空白字符，中间再遇到流中的空格、换行、制表符等空白字符就会停止读取，但是它不会读入这些空白字符，所以可以连续使用进行读取。</p></li><li><p>类方法 <code>getline()</code> 与 C 语言中的 <code>fgets()</code> 类似。如果它读取的字符少于给定的大小 <code>n - 1</code>，或到达 <code>EOF</code> ，它会追加空字符后读入内存中。<b>但是</b>，它会把每行结尾的 <code>'\n'</code> 丢弃。</p><blockquote><ul><li><p>如果是读取了 <code>n - 1</code> 个字符，还不能达到设定的分隔符，或者换行符，则 <code>getline()</code> 会设置 <code>failbit</code> 如果要继续读取，需要调用 <code>clear()</code> 进行重置。</p></li><li><p>如果使用 <code>infile &gt;&gt; tmp</code> 读取了某一行，则行末的换行还留在文件流中，那么再使用 <code>getline()</code> 就会读入该行末尾的换行，也就是读入一个空字符串。如果要文件位置指针跳过换行，需要用 <code>infile.seekg(2,ios::cur)</code>，因为 <code>windows</code>中换行是 <code>\r\n</code> 占两个字节。</p></li></ul></blockquote></li><li><p><code>read()</code>函数用于读取二进制文件。<b>一定要注意配合相应的打开模式！</b><a href="/posts/e85bfb6a.html#关于二进制读取的重要补充说明">一定要看我！</a></p></li><li><p>判断文件是否读取完毕需要用 <code>eof()</code>方法。</p><blockquote><p>注意，以下写法会出现问题。</p></blockquote><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">/* --- data.txt --- </span></span><br><span class="line"><span class="comment">1234</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function">fstream <span class="title">infile</span> <span class="params">(<span class="string">&quot;data.txt&quot;</span>)</span></span>;</span><br><span class="line"><span class="type">char</span> c = <span class="number">0</span>;</span><br><span class="line">cout &lt;&lt; <span class="string">&quot;输出结果：&quot;</span>;</span><br><span class="line"><span class="keyword">while</span> (!infile.<span class="built_in">eof</span>())</span><br><span class="line">&#123;</span><br><span class="line">infile &gt;&gt; c;</span><br><span class="line">    cout &lt;&lt; c;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//输出结果：12344</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>原因是 <code>C++</code> 判定文件读取到 <code>EOF</code> 的时机，是尝试读取最后一个元素后面的数据时，而不是读取完最后一个数据就到了 <code>EOF</code>。所以，当 <code>'4'</code> 被读取后，还未达到 <code>EOF</code>, <code>!infile.eof()</code> 为 <code>true</code> ，还会再进入一次循环，经过一次读取后才达到 <code>EOF</code>, <code>!infile.eof()</code> 才会变为 <code>false</code>。</p></li><li><p><code>istream</code> 和 <code>ostream</code> 都提供了用于重新定位文件位置指针的成员函数。这些成员函数包括关于 <code>istream</code> 的 <code>seekg</code>（“seek get”）和关于 <code>ostream</code> 的 <code>seekp</code>（“seek put”）。</p><p><code>seekg</code> 和 <code>seekp</code> 的参数通常是一个长整型。第二个参数可以用于指定查找方向。查找方向可以是 <code>ios::beg</code>（默认的，从流的开头开始定位），也可以是 <code>ios::cur</code>（从流的当前位置开始定位），也可以是 <code>ios::end</code>（从流的末尾开始定位）。</p><p>文件位置指针是一个整数值，指定了从文件的起始位置到指针所在位置的字节数。</p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 定位到 fileObject 的第 n 个字节（假设是 ios::beg）</span></span><br><span class="line">fileObject.<span class="built_in">seekg</span>(n);</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 把文件的读指针从 fileObject 当前位置向后移 n 个字节</span></span><br><span class="line">fileObject.<span class="built_in">seekg</span>(n,ios::cur);</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 把文件的读指针从 fileObject 末尾往回移 n 个字节</span></span><br><span class="line">fileObject.<span class="built_in">seekg</span>(n,ios::end);</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 定位到 fileObject 的末尾</span></span><br><span class="line">fileObject.<span class="built_in">seekg</span>(<span class="number">0</span>,ios::end);</span><br></pre></td></tr></table></figure></li></ul><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><h2 id="写入文件">写入文件</h2><div class="tabs" id="写入文件"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#写入文件-1">C 语言风格</button></li><li class="tab"><button type="button" data-href="#写入文件-2">C++ 风格</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="写入文件-1"><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">fgetc</span><span class="params">( FILE * fp )</span></span>;</span><br><span class="line"><span class="function"><span class="type">char</span> *<span class="title">fgets</span><span class="params">( <span class="type">char</span> *buf, <span class="type">int</span> n, FILE *fp )</span></span>;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">fprintf</span><span class="params">(FILE *fp,<span class="type">const</span> <span class="type">char</span> *format, ...)</span> </span></span><br></pre></td></tr></table></figure><ul><li>函数 <code>fputc()</code> 把参数 <code>c</code> 的字符值写入到 <code>fp</code> 所指向的输出流中。如果写入成功，它会返回写入的字符，如果发生错误，则会返回 <code>EOF</code>。</li><li>函数 <code>fputs()</code> 把字符串 <code>s</code> 写入到 <code>fp</code> 所指向的输出流中。如果写入成功，它会返回一个非负值，如果发生错误，则会返回 <code>EOF</code>。</li><li>函数 <code>fprintf()</code> 把一个字符串写入到文件中。</li><li>函数 <code>fwrite()</code>用于写入二进制文件</li></ul><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="写入文件-2"><ul><li>使用类似 <code>cout</code>的写法，利用 <code>&lt;&lt;</code> 运算符写入。</li></ul><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line">outfile &lt;&lt; tmp;</span><br></pre></td></tr></table></figure><p>写入的格式与 <code>cout</code> 的写法相同。需要包含 <code>&lt;iomanip&gt;</code>。</p><blockquote><p>注意：“流操纵算子”一栏中的星号<code>*</code>不是算子的一部分，星号表示在没有使用任何算子的情况下，就等效于使用了该算子。例如，在默认情况下，整数是用十进制形式输出的，等效于使用了 dec 算子。</p></blockquote><table><tr><th>流操纵算子</th><th colspan="2">作 &nbsp;用</th></tr><tr><td>*dec</td><td>以十进制形式输出整数</td><td rowspan="13">常用</td></tr><tr><td>hex</td><td>以十六进制形式输出整数</td></tr><tr><td>oct</td><td>以八进制形式输出整数</td></tr><tr><td>fixed</td><td>以普通小数形式输出浮点数</td></tr><tr><td>scientific</td><td>以科学计数法形式输出浮点数</td></tr><tr><td>left</td><td>左对齐，即在宽度不足时将填充字符添加到右边</td></tr><tr><td>*right</td><td>右对齐，即在宽度不足时将填充字符添加到左边</td></tr><tr><td>setbase(b)</td><td>设置输出整数时的进制，b=8、10 或 16</td></tr><tr><td>setw(w)</td><td>指定输出宽度为 w 个字符，或输入字符串时读入 w 个字符</td></tr><tr><td>setfill(c)</td><td>在指定输出宽度的情况下，输出的宽度不足时用字符 c 填充（默认情况是用空格填充）</td></tr><tr><td>setprecision(n)</td><td>设置输出浮点数的精度为 n。<br /><br />在使用非 fixed 且非 scientific&nbsp;方式输出的情况下，n 即为有效数字最多的位数，如果有效数字位数超过 n，则小数部分四舍五人，或自动变为科学计数法输出并保留一共 n 位有效数字。<br /><br />在使用 fixed 方式和 scientific 方式输出的情况下，n 是小数点后面应保留的位数。</td></tr><tr><td>setiosflags(flag)</td><td>将某个输出格式标志置为 1</td></tr><tr><td>resetiosflags(flag)</td><td>将某个输出格式标志置为 0</td></tr><tr><td>boolapha</td><td>把 true 和 false 输出为字符串</td><td rowspan="13">不常用</td></tr><tr><td>*noboolalpha</td><td>把 true 和 false 输出为 0、1</td></tr><tr><td>showbase</td><td>输出表示数值的进制的前缀</td></tr><tr><td>*noshowbase</td><td>不输出表示数值的进制.的前缀</td></tr><tr><td>showpoint</td><td>总是输出小数点</td></tr><tr><td>*noshowpoint</td><td>只有当小数部分存在时才显示小数点</td></tr><tr><td>showpos</td><td>在非负数值中显示 +</td></tr><tr><td>*noshowpos</td><td>在非负数值中不显示 +</td></tr><tr><td>*skipws</td><td>输入时跳过空白字符</td></tr><tr><td>noskipws</td><td>输入时不跳过空白字符</td></tr><tr><td>uppercase</td><td>十六进制数中使用 A~E。若输出前缀，则前缀输出&nbsp;0X，科学计数法中输出 E</td></tr><tr><td>*nouppercase</td><td>十六进制数中使用 a~e。若输出前缀，则前缀输出 0x，科学计数法中输出 e。</td></tr><tr><td>internal</td><td>数值的符号（正负号）在指定宽度内左对齐，数值右对 齐，中间由填充字符填充。</td></tr></table><ul><li>函数 <code>write()</code>用于写入二进制文件</li></ul><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><h2 id="关于二进制读取的重要补充说明">关于二进制读取的重要补充说明</h2><div class="tip warning faa-horizontal animated-hover"><p>看我看我一定要看我！</p></div><p>这部分内容是在夏令营之后添加的。我其实根本想不到题目居然会出二进制文件的读取，二进制文件读取我也没认真准备。<!-- spoiler-1ffd9:black -->  <span class="spoiler" onclick="this.classList.toggle('spoiler')">    <span class="spoiler-blur spoiler-1ffd9">这和前两年的题目风格完全不一样啊！</span>  </span></p><h3 id="起因">起因</h3><p>在夏令营机试的时候，使用 C++ 风格的二进制文件读取 <code>infile.read()</code> 只成功读入了42个<b>正确数据</b>，之后就到了 <code>EOF</code>。其中 <code>fval.dat</code> 是存储了512*512个 <code>float</code> 数据的。</p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function">fstream <span class="title">infile1</span> <span class="params">(<span class="string">&quot;fval.dat&quot;</span>,ios::in)</span></span>;</span><br><span class="line"><span class="type">float</span>* f1 = <span class="keyword">new</span> <span class="type">float</span>[<span class="number">512</span> * <span class="number">512</span>];</span><br><span class="line">infile1.<span class="built_in">read</span>((<span class="type">char</span>*)f1, <span class="number">512</span> * <span class="number">512</span> * <span class="built_in">sizeof</span>(<span class="type">float</span>));</span><br><span class="line">infile1.<span class="built_in">close</span>();</span><br></pre></td></tr></table></figure><p>我 Debug 了半个小时还没有读进去，当时就慌了，心一狠，换了 C 语言风格的二进制文件读取，然后就成功读取了全部的数据。</p><figure class="highlight c"><table><tr><td class="code"><pre><span class="line">FILE* infile2 = fopen(<span class="string">&quot;fval.dat&quot;</span>, <span class="string">&quot;rb&quot;</span>);</span><br><span class="line"><span class="type">float</span>* f2 = new <span class="type">float</span>[<span class="number">512</span> * <span class="number">512</span>];</span><br><span class="line">fread(f2, <span class="keyword">sizeof</span>(<span class="type">float</span>), <span class="number">512</span> * <span class="number">512</span>, infile2);</span><br><span class="line">fclose(infile2);</span><br></pre></td></tr></table></figure><p>你发现什么问题了吗？</p><h3 id="经过">经过</h3><p>夏令营之后，我查找了 c++ 文件读写出错的问题，最后在同学的指点下，意识到一个自己从来没注意但<b>很严重</b>的问题。由于我从来没有用 C++ 进行二进制文件读写过，所以我对 <code>ios::binary</code> 没有太多的印象。而之前提及的表格中，也少了一个用于打开二进制文件的 <code>ios::binary</code></p><table><thead><tr><th style="text-align:left">模式标志</th><th style="text-align:left">描述</th></tr></thead><tbody><tr><td style="text-align:left">ios::app</td><td style="text-align:left">追加模式。所有写入都追加到文件末尾。</td></tr><tr><td style="text-align:left">ios::ate</td><td style="text-align:left">文件打开后定位到文件末尾。</td></tr><tr><td style="text-align:left">ios::in</td><td style="text-align:left">打开文件用于读取。</td></tr><tr><td style="text-align:left">ios::out</td><td style="text-align:left">打开文件用于写入。</td></tr><tr><td style="text-align:left">ios::trunc</td><td style="text-align:left">如果该文件已经存在，其内容将在打开文件之前被截断，即把文件长度设为 0。</td></tr></tbody></table><p>不使用 <code>ios::binary</code> 虽然在原理上也能进行读取。但是，如果不使用二进制模式，对于某些情况，存在<b>转换的情况</b>。在本次的数据（二进制）中</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">C7 91 1C C0    10 67 1b C0    47 3B 1A C0    6E 0E 19 C0</span><br></pre></td></tr></table></figure><p>前8个字节能正常读取数据，<code>float</code> 占4个字节，因此成功读取了两个 <code>float</code> 数值。但是在读取第三个 <code>float</code> 数据时， <code>1A</code> 对应的是 <code>SUB</code>，或者说是 <code>^Z</code>。因此会导致文件读取提前结束。当我们把 <code>1A</code> 换成 <code>3B</code> 等不会被转换的字节时，读取就不会提前结束。</p><h3 id="结论">结论</h3><ul><li>二进制文件就好好用二进制模式读取。</li><li>二进制模式下，不会存在特殊字符的转换问题。</li></ul><h2 id="参考网页">参考网页</h2><ul><li><p><a href="https://www.runoob.com/cprogramming/c-file-io.html">C 文件读写 | 菜鸟教程 (runoob.com)</a></p></li><li><p><a href="https://www.runoob.com/cplusplus/cpp-files-streams.html">C++ 文件和流 | 菜鸟教程 (runoob.com)</a></p></li><li><p><a href="http://c.biancheng.net/view/275.html">C++ cout格式化输出（输出格式）完全攻略 (biancheng.net)</a></p></li></ul>]]></content>
      
      
      <categories>
          
          <category> 编程学习 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> c++ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>C++ 矩阵类实现</title>
      <link href="/posts/ff321836.html"/>
      <url>/posts/ff321836.html</url>
      
        <content type="html"><![CDATA[<h2 id="前言">前言</h2><p>这个矩阵是当时大一下学期暑假的时候为简单的平差而写的，虽然效率不高，但是对面向对象的编程来说，还是大有裨益的。</p><blockquote><p>工程文件请见：<a href="/resources#%E5%B7%A5%E7%A8%8B%E4%BB%A3%E7%A0%81">C++矩阵类实现</a></p></blockquote><h2 id="主要功能">主要功能</h2><details class="toggle" ><summary class="toggle-button" style="">基本的矩阵运算（包括运算符重载）</summary><div class="toggle-content"><ul><li>矩阵加减法</li><li>矩阵数乘</li><li>矩阵乘法</li><li>矩阵“除法”</li><li>矩阵赋值（包括复合赋值）</li><li>矩阵前后置自增自减</li><li>矩阵判等</li><li>矩阵广播（与数字的）</li></ul></div></details><details class="toggle" ><summary class="toggle-button" style="">矩阵处理</summary><div class="toggle-content"><ul><li>矩阵合并</li><li>矩阵分割</li><li>矩阵打印输出</li></ul></div></details><details class="toggle" ><summary class="toggle-button" style="">矩阵构造</summary><div class="toggle-content"><ul><li>零矩阵</li><li>单位矩阵</li><li>元素全为1的矩阵</li><li>构造对角矩阵</li><li>构造元素随机的矩阵</li></ul></div></details><details class="toggle" ><summary class="toggle-button" style="">矩阵操作</summary><div class="toggle-content"><ul><li>矩阵转置</li><li>矩阵求逆</li><li>高斯消元法、求秩</li><li>行列式、伴随矩阵</li><li>矩阵元素下标取值</li><li>矩阵取对角线元素</li><li>化为 hessenberg 矩阵</li><li>QR 分解</li><li>实对称矩阵求特征值</li></ul></div></details><h2 id="矩阵类技术细节">矩阵类技术细节</h2><h3 id="矩阵类成员变量">矩阵类成员变量</h3><p>矩阵类的成员变量很少，主要是记录矩阵行列数的变量，以及一个存储矩阵数据的指向动态内存的指针。</p><p>矩阵类还包括静态成员变量，用于控制矩阵打印输入的格式。</p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Matrix</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">// ---- 成员变量 ----</span></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line"><span class="type">int</span> miRow = <span class="number">0</span>;<span class="comment">//行数</span></span><br><span class="line"><span class="type">int</span> miCol = <span class="number">0</span>;<span class="comment">//列数</span></span><br><span class="line"><span class="type">double</span>* mpBuf = <span class="literal">nullptr</span>;<span class="comment">//存储矩阵</span></span><br><span class="line"><span class="comment">// ---- 静态成员变量 ----</span></span><br><span class="line"><span class="type">static</span> <span class="type">int</span> iPrecise;<span class="comment">// 控制流输出的显示精度</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="矩阵的构造函数">矩阵的构造函数</h3><p>矩阵类的构造函数有多个，下面进行部分介绍</p><ul><li>无参数的构造函数生成未分配内存的0*0矩阵，这个空矩阵的意义，相信大家在数据结构课的学习中能感受到的。</li><li>以 <code>std::initializer_list</code> 为参数的构造函数，是为了实现如同 Matlab 的矩阵构造方法设计的，这里涉及到 <code>std::initializer_list</code> 的使用方法</li></ul><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Matrix</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"><span class="comment">// ---- 构造函数 ----</span></span><br><span class="line">    </span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">*@brief 无参数构造函数</span></span><br><span class="line"><span class="comment">* </span></span><br><span class="line"><span class="comment">*获取一个0*0的未分配内存的空矩阵</span></span><br><span class="line"><span class="comment">*不合法的计算一般返回本矩阵</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="keyword">explicit</span> <span class="title">Matrix</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">*@brief 构造函数</span></span><br><span class="line"><span class="comment">*   将double类型转化为1*1矩阵</span></span><br><span class="line"><span class="comment">*</span></span><br><span class="line"><span class="comment">*@param num 数字</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="built_in">Matrix</span>(<span class="type">double</span> num);</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">*@brief 构造函数</span></span><br><span class="line"><span class="comment">*使用初始化列表构造矩阵</span></span><br><span class="line"><span class="comment">*</span></span><br><span class="line"><span class="comment">*@param lst 初始化列表</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="built_in">Matrix</span>(<span class="type">const</span> MatIniLst&amp; lst);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">*@brief 构造函数</span></span><br><span class="line"><span class="comment">*使用初始化列表构造矩阵，列数为最多的一行的元素个数，可以以0补足其它行的元素</span></span><br><span class="line"><span class="comment">*</span></span><br><span class="line"><span class="comment">*@param lst 初始化列表（两层）</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="built_in">Matrix</span>(<span class="type">const</span> std::initializer_list&lt;MatIniLst&gt;&amp; lst);</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">*@brief 构造函数</span></span><br><span class="line"><span class="comment">*使用初始化列表构造矩阵，根据设定的列数，可以以0补足初始化列表中没有的元素</span></span><br><span class="line"><span class="comment">*</span></span><br><span class="line"><span class="comment">*@param lst 初始化列表（两层）</span></span><br><span class="line"><span class="comment">*@param col 矩阵列数</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="keyword">explicit</span> <span class="title">Matrix</span><span class="params">(<span class="type">const</span> std::initializer_list&lt;MatIniLst&gt;&amp; lst, <span class="type">int</span> col)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">*@brief 构造函数</span></span><br><span class="line"><span class="comment">*使用指针所指的数据构造矩阵,若数组长度小于需要的长度row*col，则会报错</span></span><br><span class="line"><span class="comment">*</span></span><br><span class="line"><span class="comment">*@param p double型指针，是要输入的数据</span></span><br><span class="line"><span class="comment">*@param row 矩阵行数</span></span><br><span class="line"><span class="comment">*@param col 矩阵列数</span></span><br><span class="line"><span class="comment">*   @param count 数组长度</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="keyword">explicit</span> <span class="title">Matrix</span><span class="params">(<span class="type">double</span>* p, <span class="type">int</span> row, <span class="type">int</span> col, <span class="type">int</span> count)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="矩阵的拷贝构造（赋值）函数">矩阵的拷贝构造（赋值）函数</h3><p>拷贝构造（赋值）函数需要注意以下几点：</p><ul><li>由于矩阵类中有指针和动态分配的内存，拷贝时需要用深拷贝。</li><li>拷贝的时候需要注意加上判断条件，拷贝的对象如果是自身，则不进行其他操作</li><li>在重载拷贝赋值符的时候，要保持 <code>=</code> 原始的用法，即 <code>operator=</code> 应当返回赋值的结果</li></ul><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Matrix</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">*@brief 拷贝构造函数</span></span><br><span class="line"><span class="comment">*</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="built_in">Matrix</span>(<span class="type">const</span> Matrix&amp; tmp);</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">*@brief 运算符重载，拷贝赋值函数</span></span><br><span class="line"><span class="comment">*将矩阵赋值</span></span><br><span class="line"><span class="comment">*</span></span><br><span class="line"><span class="comment">*@param tmp 待赋值的矩阵</span></span><br><span class="line"><span class="comment">*@return 返回赋值之后的该矩阵的引用</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">Matrix&amp; <span class="keyword">operator</span>=(<span class="type">const</span> Matrix&amp; tmp);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="矩阵的移动构造（赋值）函数">矩阵的移动构造（赋值）函数</h3><p>关于对象移动，在 C++ primer 中有详细的介绍，下面给出我的觉得重要的几点：</p><ul><li>移动主要是为了从“将亡值”中取出需要的数据（这里主要是动态内存），减少了拷贝的成本。</li><li>移动构造（赋值）函数需要加上 <code>noexcept</code> 以支持与标准库交互</li><li>在为类的移动构造和移动赋值函数指定不抛出异常时，必须在类的头文件声明中和定义中（如果定义在类外的话）都指定 <code>noexcept</code></li><li>移动的时候需要注意加上判断条件，移动的对象如果是自身，则不应当进行其他操作</li><li>在重载移动赋值符的时候，要保持 <code>=</code> 原始的用法，即 <code>operator=</code> 应当返回赋值的结果</li></ul><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Matrix</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">*@brief 移动构造函数</span></span><br><span class="line"><span class="comment">*</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="built_in">Matrix</span>(Matrix&amp;&amp; tmp)<span class="keyword">noexcept</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">*@brief 运算符重载，移动赋值函数</span></span><br><span class="line"><span class="comment">*将矩阵赋值</span></span><br><span class="line"><span class="comment">*</span></span><br><span class="line"><span class="comment">*@param tmp 待赋值的矩阵</span></span><br><span class="line"><span class="comment">*@return 返回赋值之后的该矩阵的引用</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">Matrix&amp; <span class="keyword">operator</span>=(Matrix&amp;&amp; tmp)<span class="keyword">noexcept</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="矩阵的析构函数">矩阵的析构函数</h3><p>析构函数没有什么特别的技术点，注意内存回收就好了</p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Matrix</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">*@brief 析构函数</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">~<span class="built_in">Matrix</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="矩阵的运算符重载">矩阵的运算符重载</h3><p>关于运算符重载，在 C++ primer 中也有详细的介绍。下面是我觉得需要注意的地方。</p><ul><li><p>运算符重载应当与其内置版本意义相似</p></li><li><p>运算符要注意“对称”运算符与“非对称”运算符的处理。“对称”运算符应当为普通非成员函数，尤其是左侧运算对象不一定为类的对象时（这里使用的是友元函数）；而“非对称”的运算符需要是成员函数，尤其是当其会改变类对象的状态时。</p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Matrix</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">*@brief 运算符重载,友元函数</span></span><br><span class="line"><span class="comment">*将本矩阵与所给矩阵相加求和</span></span><br><span class="line"><span class="comment">*</span></span><br><span class="line"><span class="comment">*@param lMat 左加矩阵</span></span><br><span class="line"><span class="comment">*@param rMat 右加矩阵</span></span><br><span class="line"><span class="comment">*@return 返回求和之后的该矩阵的引用</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">    <span class="keyword">friend</span> Matrix <span class="keyword">operator</span>+(<span class="type">const</span> Matrix&amp; lMat, <span class="type">const</span> Matrix&amp; rMat);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">*@brief 运算符重载</span></span><br><span class="line"><span class="comment">*   复合赋值+=</span></span><br><span class="line"><span class="comment">*</span></span><br><span class="line"><span class="comment">*@param tmp 要加上的矩阵</span></span><br><span class="line"><span class="comment">*@return 返回结果矩阵的引用</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">    Matrix&amp; <span class="keyword">operator</span>+=(<span class="type">const</span> Matrix&amp; tmp);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>下标运算符通常定义两个版本：一个返回普通的<b>引用</b>，另一个是<b>类的常量成员并返回常量引用</b>。本类为了实现类的按行列的下标访问，返回类型略有不同。</p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Matrix</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">*@brief 运算符重载</span></span><br><span class="line"><span class="comment">*   取下标</span></span><br><span class="line"><span class="comment">*返回下标对应的矩阵的某一行</span></span><br><span class="line"><span class="comment">*   一般连续使用两个[]以获取某个指针</span></span><br><span class="line"><span class="comment">*   不要在类的方法中使用取下标运算符！！！</span></span><br><span class="line"><span class="comment">*有两个版本，此为非常量版本</span></span><br><span class="line"><span class="comment">*</span></span><br><span class="line"><span class="comment">*@param num 下标</span></span><br><span class="line"><span class="comment">*@return 返回下标对应的矩阵的某一行的第一个元素的指针</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="type">double</span>* <span class="keyword">operator</span>[](<span class="type">int</span> num);</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">*@brief 运算符重载</span></span><br><span class="line"><span class="comment">*   取下标</span></span><br><span class="line"><span class="comment">*返回下标对应的矩阵的某一行</span></span><br><span class="line"><span class="comment">*   一般连续使用两个[]以获取某个指针</span></span><br><span class="line"><span class="comment">*   不要在类的方法中使用取下标运算符！！！</span></span><br><span class="line"><span class="comment">*有两个版本，此为常量版本</span></span><br><span class="line"><span class="comment">*</span></span><br><span class="line"><span class="comment">*@param num 下标</span></span><br><span class="line"><span class="comment">*@return 返回下标对应的矩阵的某一行的第一个元素的指针</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="type">const</span> <span class="type">double</span>* <span class="keyword">operator</span>[](<span class="type">int</span> num)<span class="type">const</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>递增和递减运算符有两种版本，分别是前置和后置版本。</p><ul><li>前置递增递减运算符应当与内置版本意义相近，返回递增递减后对象的<b>引用</b></li><li>前置递增递减运算符应当与内置版本意义相近，返回递增递减前对象的<b>原值</b></li><li>区分前置和后置运算符。后置版本接受一个额外的、并不使用的 <code>int</code> 类型形参</li></ul><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Matrix</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span>:</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">      *@brief 运算符重载</span></span><br><span class="line"><span class="comment">      * 前置递增</span></span><br><span class="line"><span class="comment">      *</span></span><br><span class="line"><span class="comment">      *@return 递增后的矩阵引用</span></span><br><span class="line"><span class="comment">      */</span></span><br><span class="line">    Matrix&amp; <span class="keyword">operator</span>++();</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">      *@brief 运算符重载</span></span><br><span class="line"><span class="comment">      * 后置递增</span></span><br><span class="line"><span class="comment">      *</span></span><br><span class="line"><span class="comment">      *@param 区分前后置的参数</span></span><br><span class="line"><span class="comment">      *@return 递增前的矩阵</span></span><br><span class="line"><span class="comment">      */</span></span><br><span class="line">    Matrix <span class="keyword">operator</span>++(<span class="type">int</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul>]]></content>
      
      
      <categories>
          
          <category> 编程学习 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> c++ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>数学公式测试</title>
      <link href="/posts/67588483.html"/>
      <url>/posts/67588483.html</url>
      
        <content type="html"><![CDATA[<h2 id="前言-16">前言</h2><p>公式渲染很魔幻，我也不懂是为啥。换了<code>Katex</code>好了点，但是<strong>加粗</strong>会出问题。</p><h2 id="行间公式">行间公式</h2><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mtable rowspacing="0.16em" columnspacing="1em"><mtr><mtd class ="mtr-glue"></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow><mo fence="true">[</mo><mtable rowspacing="0.16em" columnalign="center" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>X</mi><mo>−</mo><msub><mi>X</mi><mi>S</mi></msub></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>Y</mi><mo>−</mo><msub><mi>Y</mi><mi>S</mi></msub></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>Z</mi><mo>−</mo><msub><mi>Z</mi><mi>S</mi></msub></mrow></mstyle></mtd></mtr></mtable><mo fence="true">]</mo></mrow><mo>=</mo><mi>λ</mi><mi>R</mi><mrow><mo fence="true">[</mo><mtable rowspacing="0.16em" columnalign="center" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mi>x</mi></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mi>y</mi></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mo>−</mo><mi>f</mi></mrow></mstyle></mtd></mtr></mtable><mo fence="true">]</mo></mrow></mrow></mstyle></mtd><mtd class ="mtr-glue"></mtd><mtd class ="mml-eqn-num"></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{equation}\begin{bmatrix}X-X_S \\  Y-Y_S \\  Z-Z_S\end{bmatrix}=\lambda R \begin{bmatrix}x \\  y \\  -f\end{bmatrix}\end{equation}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:3.6em;vertical-align:-1.55em;"></span><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-4.05em;"><span class="pstrut" style="height:4.05em;"></span><span class="mord"><span class="minner"><span class="mopen"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-4.05em;"><span class="pstrut" style="height:5.6em;"></span><span style="width:0.667em;height:3.600em;"><svg xmlns="http://www.w3.org/2000/svg" width='0.667em' height='3.600em' viewBox='0 0 667 3600'><path d='M403 1759 V84 H666 V0 H319 V1759 v0 v1759 h347 v-84H403z M403 1759 V0 H319 V1759 v0 v1759 h84z'/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em;"><span></span></span></span></span></span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-4.21em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.0785em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05764em;">S</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-3.01em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.22222em;">Y</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.22222em;">Y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.2222em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05764em;">S</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-1.81em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">Z</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">Z</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.0715em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05764em;">S</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em;"><span></span></span></span></span></span></span></span><span class="mclose"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-4.05em;"><span class="pstrut" style="height:5.6em;"></span><span style="width:0.667em;height:3.600em;"><svg xmlns="http://www.w3.org/2000/svg" width='0.667em' height='3.600em' viewBox='0 0 667 3600'><path d='M347 1759 V0 H0 V84 H263 V1759 v0 v1759 H0 v84 H347zM347 1759 V0 H263 V1759 v0 v1759 h84z'/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em;"><span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord mathnormal">λ</span><span class="mord mathnormal" style="margin-right:0.00773em;">R</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="minner"><span class="mopen"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-4.05em;"><span class="pstrut" style="height:5.6em;"></span><span style="width:0.667em;height:3.600em;"><svg xmlns="http://www.w3.org/2000/svg" width='0.667em' height='3.600em' viewBox='0 0 667 3600'><path d='M403 1759 V84 H666 V0 H319 V1759 v0 v1759 h347 v-84H403z M403 1759 V0 H319 V1759 v0 v1759 h84z'/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em;"><span></span></span></span></span></span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-4.21em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">x</span></span></span><span style="top:-3.01em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span></span></span><span style="top:-1.81em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">−</span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em;"><span></span></span></span></span></span></span></span><span class="mclose"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-4.05em;"><span class="pstrut" style="height:5.6em;"></span><span style="width:0.667em;height:3.600em;"><svg xmlns="http://www.w3.org/2000/svg" width='0.667em' height='3.600em' viewBox='0 0 667 3600'><path d='M347 1759 V0 H0 V84 H263 V1759 v0 v1759 H0 v84 H347zM347 1759 V0 H263 V1759 v0 v1759 h84z'/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em;"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em;"><span></span></span></span></span></span></span></span><span class="tag"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-4.05em;"><span class="pstrut" style="height:4.05em;"></span><span class="eqn-num"></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em;"><span></span></span></span></span></span></span></span></span></p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mtable rowspacing="0.16em" columnspacing="1em"><mtr><mtd class ="mtr-glue"></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><msub><mover accent="true"><mi>y</mi><mo>^</mo></mover><mi>t</mi></msub><mo>=</mo><mfrac><mn>1</mn><mrow><mn>2</mn><mi>l</mi><mo>+</mo><mn>1</mn></mrow></mfrac><mo stretchy="false">(</mo><msub><mi>y</mi><mrow><mi>t</mi><mo>−</mo><mi>l</mi></mrow></msub><mo>+</mo><msub><mi>y</mi><mrow><mi>t</mi><mo>−</mo><mo stretchy="false">(</mo><mi>l</mi><mo>−</mo><mn>1</mn><mo stretchy="false">)</mo></mrow></msub><mo>+</mo><mo>⋯</mo><mo>+</mo><msub><mi>y</mi><mrow><mi>t</mi><mo>−</mo><mn>1</mn></mrow></msub><mo>+</mo><msub><mi>y</mi><mi>t</mi></msub><mo>+</mo><msub><mi>y</mi><mrow><mi>t</mi><mo>+</mo><mn>1</mn></mrow></msub><mo>+</mo><mo>⋯</mo><mo>+</mo><msub><mi>y</mi><mrow><mi>t</mi><mo>+</mo><mi>l</mi></mrow></msub><mo stretchy="false">)</mo></mrow></mstyle></mtd><mtd class ="mtr-glue"></mtd><mtd class ="mml-eqn-num"></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{equation}\hat {y}_ {t}=\cfrac{1}{2l+1}(y_{t-l}+y_{t-(l-1)}+\cdots+y_{t-1}+y_{t}+y_{t+1}+\cdots+y_{t+l})\end{equation}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:2.3593em;vertical-align:-0.9297em;"></span><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.4297em;"><span style="top:-3.4297em;"><span class="pstrut" style="height:3.59em;"></span><span class="mord"><span class="mord"><span class="mord accent"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.6944em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.1944em;"><span class="mord">^</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.1944em;"><span></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2806em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.59em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">2</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord">1</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.74em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.7693em;"><span></span></span></span></span></span><span></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mbin mtight">−</span><span class="mord mathnormal mtight" style="margin-right:0.01968em;">l</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2083em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em;"><span style="top:-2.5198em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mbin mtight">−</span><span class="mopen mtight">(</span><span class="mord mathnormal mtight" style="margin-right:0.01968em;">l</span><span class="mbin mtight">−</span><span class="mord mtight">1</span><span class="mclose mtight">)</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.3552em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="minner">⋯</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2083em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2806em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2083em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="minner">⋯</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mbin mtight">+</span><span class="mord mathnormal mtight" style="margin-right:0.01968em;">l</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2083em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.9297em;"><span></span></span></span></span></span></span></span><span class="tag"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.4297em;"><span style="top:-3.4297em;"><span class="pstrut" style="height:3.59em;"></span><span class="eqn-num"></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.9297em;"><span></span></span></span></span></span></span></span></span></p><h2 id="行内公式">行内公式</h2><ul><li>这是行内公式：<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mover accent="true"><mi>y</mi><mo>^</mo></mover><mi>t</mi></msub><mo>=</mo><mstyle displaystyle="true" scriptlevel="0"><mfrac><mn>1</mn><mrow><mn>2</mn><mi>l</mi><mo>+</mo><mn>1</mn></mrow></mfrac></mstyle><mo stretchy="false">(</mo><msub><mi>y</mi><mrow><mi>t</mi><mo>−</mo><mi>l</mi></mrow></msub><mo>+</mo><msub><mi>y</mi><mrow><mi>t</mi><mo>−</mo><mo stretchy="false">(</mo><mi>l</mi><mo>−</mo><mn>1</mn><mo stretchy="false">)</mo></mrow></msub><mo>+</mo><mo>⋯</mo><mo>+</mo><msub><mi>y</mi><mrow><mi>t</mi><mo>−</mo><mn>1</mn></mrow></msub><mo>+</mo><msub><mi>y</mi><mi>t</mi></msub><mo>+</mo><msub><mi>y</mi><mrow><mi>t</mi><mo>+</mo><mn>1</mn></mrow></msub><mo>+</mo><mo>⋯</mo><mo>+</mo><msub><mi>y</mi><mrow><mi>t</mi><mo>+</mo><mi>l</mi></mrow></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\hat {y}_ {t}=\cfrac{1}{2l+1}(y_{t-l}+y_{t-(l-1)}+\cdots+y_{t-1}+y_{t}+y_{t+1}+\cdots+y_{t+l})</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord accent"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.6944em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.1944em;"><span class="mord">^</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.1944em;"><span></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2806em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:2.3593em;vertical-align:-0.7693em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.59em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">2</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord">1</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.74em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.7693em;"><span></span></span></span></span></span><span></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mbin mtight">−</span><span class="mord mathnormal mtight" style="margin-right:0.01968em;">l</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2083em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.9385em;vertical-align:-0.3552em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em;"><span style="top:-2.5198em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mbin mtight">−</span><span class="mopen mtight">(</span><span class="mord mathnormal mtight" style="margin-right:0.01968em;">l</span><span class="mbin mtight">−</span><span class="mord mtight">1</span><span class="mclose mtight">)</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.3552em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6667em;vertical-align:-0.0833em;"></span><span class="minner">⋯</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.7917em;vertical-align:-0.2083em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2083em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.7778em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2806em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.7917em;vertical-align:-0.2083em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2083em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6667em;vertical-align:-0.0833em;"></span><span class="minner">⋯</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mbin mtight">+</span><span class="mord mathnormal mtight" style="margin-right:0.01968em;">l</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2083em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span></li><li>这是行内公式：<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mrow><mo fence="true">[</mo><mtable rowspacing="0.16em" columnalign="center" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>X</mi><mo>−</mo><msub><mi>X</mi><mi>S</mi></msub></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>Y</mi><mo>−</mo><msub><mi>Y</mi><mi>S</mi></msub></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>Z</mi><mo>−</mo><msub><mi>Z</mi><mi>S</mi></msub></mrow></mstyle></mtd></mtr></mtable><mo fence="true">]</mo></mrow><mo>=</mo><mi>λ</mi><mi>R</mi><mrow><mo fence="true">[</mo><mtable rowspacing="0.16em" columnalign="center" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mi>x</mi></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mi>y</mi></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mo>−</mo><mi>f</mi></mrow></mstyle></mtd></mtr></mtable><mo fence="true">]</mo></mrow></mrow><annotation encoding="application/x-tex">\begin{bmatrix}X-X_S \\  Y-Y_S \\  Z-Z_S\end{bmatrix}=\lambda R \begin{bmatrix}x \\  y \\  -f\end{bmatrix}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:3.6em;vertical-align:-1.55em;"></span><span class="minner"><span class="mopen"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-4.05em;"><span class="pstrut" style="height:5.6em;"></span><span style="width:0.667em;height:3.600em;"><svg xmlns="http://www.w3.org/2000/svg" width='0.667em' height='3.600em' viewBox='0 0 667 3600'><path d='M403 1759 V84 H666 V0 H319 V1759 v0 v1759 h347 v-84H403z M403 1759 V0 H319 V1759 v0 v1759 h84z'/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em;"><span></span></span></span></span></span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-4.21em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.0785em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05764em;">S</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-3.01em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.22222em;">Y</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.22222em;">Y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.2222em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05764em;">S</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-1.81em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">Z</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">Z</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.0715em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05764em;">S</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em;"><span></span></span></span></span></span></span></span><span class="mclose"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-4.05em;"><span class="pstrut" style="height:5.6em;"></span><span style="width:0.667em;height:3.600em;"><svg xmlns="http://www.w3.org/2000/svg" width='0.667em' height='3.600em' viewBox='0 0 667 3600'><path d='M347 1759 V0 H0 V84 H263 V1759 v0 v1759 H0 v84 H347zM347 1759 V0 H263 V1759 v0 v1759 h84z'/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em;"><span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:3.6em;vertical-align:-1.55em;"></span><span class="mord mathnormal">λ</span><span class="mord mathnormal" style="margin-right:0.00773em;">R</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="minner"><span class="mopen"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-4.05em;"><span class="pstrut" style="height:5.6em;"></span><span style="width:0.667em;height:3.600em;"><svg xmlns="http://www.w3.org/2000/svg" width='0.667em' height='3.600em' viewBox='0 0 667 3600'><path d='M403 1759 V84 H666 V0 H319 V1759 v0 v1759 h347 v-84H403z M403 1759 V0 H319 V1759 v0 v1759 h84z'/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em;"><span></span></span></span></span></span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-4.21em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">x</span></span></span><span style="top:-3.01em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span></span></span><span style="top:-1.81em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">−</span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em;"><span></span></span></span></span></span></span></span><span class="mclose"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-4.05em;"><span class="pstrut" style="height:5.6em;"></span><span style="width:0.667em;height:3.600em;"><svg xmlns="http://www.w3.org/2000/svg" width='0.667em' height='3.600em' viewBox='0 0 667 3600'><path d='M347 1759 V0 H0 V84 H263 V1759 v0 v1759 H0 v84 H347zM347 1759 V0 H263 V1759 v0 v1759 h84z'/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em;"><span></span></span></span></span></span></span></span></span></span></span>​</li></ul>]]></content>
      
      
      <categories>
          
          <category> 博客相关 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 博客搭建 </tag>
            
            <tag> 测试 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>俄罗斯方块心得记录</title>
      <link href="/posts/531cccb5.html"/>
      <url>/posts/531cccb5.html</url>
      
        <content type="html"><![CDATA[<div class="tip warning faa-horizontal animated-hover"><p>本文章还在施工中</p></div><h2 id="前言-9">前言</h2><p>从2021年3月开始，我正式开始接触现代方块(玩的是 <a href="https://ch.tetr.io">tetr.io</a>)，到现在我写下这篇博客，已经有一年了。段位也从一开始的 <img class="inline-img" src="https://tetr.io/res/league-ranks/c.png" style="height:15px"/>，一点点地爬到了 <img class="inline-img" src="https://tetr.io/res/league-ranks/ss.png" style="height:15px"/>。</p><p>下面是tetr.io的段位，进步也是肉眼可见的。</p><p><img src="https://tetris.wiki/images/thumb/4/47/Tetra_League_TR_and_Rank_Information_-_Tetrio.png/800px-Tetra_League_TR_and_Rank_Information_-_Tetrio.png" alt="tetris.wiki上的段位信息"></p><p>但是要达到我的目标 <img class="inline-img" src="https://tetr.io/res/league-ranks/x.png" style="height:15px"/>，可能还有很远很远的一段距离吧……不过，至少到 <img class="inline-img" src="https://tetr.io/res/league-ranks/u.png" style="height:15px"/> 还是很有希望的，此博客也算是努力的记录吧。</p><hr><h2 id="机制">机制</h2><p>现代俄罗斯方块的机制主要有几个方面：延迟锁定、旋转系统、出块系统等。下面只是简单地点出一下。</p><h3 id="延迟锁定-2">延迟锁定</h3><p>与传统方块不同，现代方块允许方块触底后进行移动和旋转。</p><h3 id="旋转系统">旋转系统</h3><p><a href="https://harddrop.com/wiki/SRS"><code>SRS (Super Rotation System)</code></a> 是一种常用的旋转系统，它的存在，使得方块在旋转时，可以根据特定的 <code>Wall Kick Data</code>（踢墙表）炫酷地进入某些空洞中。</p><h3 id="出块系统">出块系统</h3><p>常见的 <code>7-bag</code> 出块系统，可以使 <code>I</code> 块久等不来的现象（也称“干旱”）大大减少，并且可以据此研发出相应的开局定式。</p><h2 id="技巧心得">技巧心得</h2><p>其实说来说去，也就那几个部分，多练才是最重要的。</p><h3 id="堆叠">堆叠</h3><p>良好的堆叠可以帮助你整理地形，为准备火力打好基础。</p><p>举个例子，<code>c4w/s4w</code> 如果没有良好的堆叠水平，是很难起楼的。因为堆积的宽度有所限制，所以容易出现堆坏的情况（如无块可放、出现 2 格高以上的断崖、出现孤岛）。此外，在进行 <code>LST</code> 堆叠的时候，<code>T</code> 槽本身的堆叠方式是很简单的，但是想要在保留某些需要块的前提下，把 <code>T</code> 槽之外的平台堆好，还是很需要水平的。</p><p>另一方面，堆叠是俄罗斯方块中最常见的操作，也是提升速度的一个重要角度。良好的堆叠（乃至不使用或少使用<ruby>暂存<rt>hold</rt></ruby>）可以大大提升你的落块速度。</p><p>要做到好的堆叠，要善用<ruby>预览<rt>next</rt></ruby>和暂存。在落块前想好怎么保证地形平坦又能放置各种方块，避免落块前无意义的移动和暂存。由于 <code>7-Bag</code> 的存在，减少对相同方块的多个依赖，是堆叠的一个重要方面（同时，在找 <code>PC</code> 中也很重要）。</p><h3 id="挖掘">挖掘</h3><p>堆叠是向上堆叠，挖掘是向下挖掘。在对战中，好的挖掘能提升你的生存能力，同时长挖掘连击和挖掘消四，也是反击对手的重要方式。</p><p>挖掘一方面要避免堵洞，一方面为了延续挖掘连击的长度，类似 <code>I</code>、<code>L</code>、<code>J</code> 的方块，可以选择平放。</p><p>多观看顶尖高手的对战视频，也能学习到一些有用的挖掘技巧。有时可能你从未尝试过某种方块的放置方法，看看高手们的视频就能学习到新东西。</p><h3 id="火力">火力</h3><p>这方面的东西有太多太多，我自己首先想说的是，不要太依赖<b>开局</b>定式，<b>开局</b>定式的伤害数据多是虚高的。当然，中局的常用形状还是很值得练习的。开局 <code>DT 炮</code>的形状我见多了以后，在中局的堆叠中，也会尝试使用。</p><p>我认为火力包括持续火力和<ruby>爆发<rt>spike</rt></ruby>两大种，在对战中，真正致命的是爆发。因此，在段位提升到一个程度后，只做消四的消四人（尤其是 <code>s1w</code> 死磕到底的人），虽然火力持续，但经常打不动对手，反而会被对手一波爆发带走。我们最早学习的短时间高伤害无非是双消四、连击消四、<code>T2</code> 接消四。但是想要进一步提升爆发的火力，就需要利用多个 <code>T2</code> 加上消四等操作了。这就意味着需要学习如何搭建如双刃剑、<code>STSD</code>、千鸟格子等等的能一次打出两个 <code>T2</code> 的形状。同时还对架桥提出了要求，最常见的就是 <code>STMB cave</code>，一种在三格宽的等高洞口架桥打出 T2 的方法。</p><p>此外，<code>B2B</code> 也是火力的一个重要方面。在输出、挖掘的过程中，尽量维持 <code>B2B</code> 不断，很考验技术。最基础的一点就是学会预判，以只依靠消四的 <code>B2B</code> 为例。需要挖掘时，做到刚好只在洞上堆积四行，消四后自然会打开洞口，这就是根据洞口位置预判消四了。道理很简单，但是需要的练习量可不少。同时，加入 <code>T2</code> 的 <code>B2B</code> 维持起来就更加复杂了，还需要积累不少的技巧。</p><p>总之，这些都是需要很多练习的技巧，在平时多思考多积累，你的火力一定能慢慢精进的。</p><h2 id="历程">历程</h2><h3 id="成就记录">成就记录</h3><div class="tabs" id="成就记录"><ul class="nav-tabs"><li class="tab"><button type="button" data-href="#成就记录-1">40L</button></li><li class="tab active"><button type="button" data-href="#成就记录-2">20TSD</button></li><li class="tab"><button type="button" data-href="#成就记录-3">拼花</button></li></ul><div class="tab-contents"><div class="tab-item-content" id="成就记录-1"><p><strong>在尽可能短的时间内消除40行</strong></p><ul><li><a href="https://www.bilibili.com/video/BV1KP4y1N73j">sub60</a></li></ul><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content active" id="成就记录-2"><p><strong>连续完成20次T-spin doule</strong></p><ul><li><p><a href="https://www.bilibili.com/video/BV1Av411K7ER">机械TSD</a></p></li><li><p><a href="https://www.bilibili.com/video/BV1BU4y1o7sH">LST</a></p></li></ul><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="成就记录-3"><p><strong>大于号拼花</strong></p><ul><li><a href="https://www.bilibili.com/video/BV1j5411g7m5">secret grade</a></li></ul><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><h3 id="目标">目标</h3><ul><li><p>DPC</p></li><li><p>free style 20TSD</p></li><li><p>10PC</p></li></ul>]]></content>
      
      
      <categories>
          
          <category> 游戏 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 俄罗斯方块 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>地理建模方法编程</title>
      <link href="/posts/ef2fa561.html"/>
      <url>/posts/ef2fa561.html</url>
      
        <content type="html"><![CDATA[<h2 id="前言-12">前言</h2><p>为了分析社会中人与人之间的合作关系，根据博弈论的基础概念与理论，通过 <a href="http://ccl.northwestern.edu/netlogo/">NetLogo</a> 软件构建合作关系模型，研究不同的社会奖惩倾向、参与者的类型、互动频率，以及互动中信息误传递等因素，对整个社会风气的影响。结果表明，惩恶扬善的社会体制，能约束坏的风气；社会中互动次数的增加，有利于构建良好的合作环境；错误会导致合作的崩解，适当的宽容有利于合作的维系。</p><p><code>NetLogo</code>具体使用方法参见<a href="https://ccl.northwestern.edu/netlogo/docs/NetLogo%20User%20Manual.pdf">官方用户手册</a>。</p><div class="tip ban faa-horizontal animated-hover"><p><a href="http://ccl.northwestern.edu/netlogo/4.0.4/docs/NetLogo_manual_chinese.pdf">中文用户手册</a>已经过时，有很多语法是不支持的了，仅供参考使用</p></div><h2 id="选题">选题</h2><p>选题灵感来自博弈论游戏——《信任的进化》，以及<strong>罗伯特·阿克塞尔罗德</strong>的《合作的进化》</p><div class="tag link"><a class="link-card" title="在线游玩《信任的进化》" href="https://dccxi.com/trust/"><div class="left"><img src="https://cdn.zerolacqua.top/images/blogs/地理建模方法编程/信任的进化.png"/></div><div class="right"><p class="text">在线游玩《信任的进化》</p><p class="url">https://dccxi.com/trust/</p></div></a></div><p>博弈论，作为数学学科的一个重要分支，是研究人们在不同的信息条件下如何进行互动决策的理论。它在经济学、生物学、政治学、军事战略，以及国际关系等学科中都有着广泛的应用。而“囚徒困境”，则是博弈论中研究最为广泛的模型之一，它揭示了在一次博弈过程中追求个人利益与公共利益之间存在的矛盾。</p><p>但是，在社会中合作行为时刻都在发生，而且人与人之间的合作基本不止一次，因此“囚徒困境”将从单次博弈变为重复博弈，对局双方的选择也会更多，不再是简单地选择欺骗策略。</p><p>罗伯特·阿克塞尔罗德所著的《合作的进化》一书，记述了作者组织的两次计算机程序重复博弈比赛。在这两场比赛中，采用“一报还一报”简单策略的程序都获得了第一名<sup>[1]</sup>。这个程序具有的一些特点，放在社会合作关系中也同样适用。</p><h2 id="模型">模型</h2><h3 id="思路与假设">思路与假设</h3><p>在这个模型中，博弈方通过合作或是欺骗行为，获取尽可能高的分数。每种类型的人会采取不同的策略：</p><ul><li>老好人（G）：永远选择合作</li><li>大恶人（B）：永远选择欺骗</li><li>复读机（TFT）：第一次选择合作，之后会重复对方上一次的选择</li></ul><p>根据社会中的合作关系，提出以下假设：</p><ul><li><p>人的社交范围是有限的：考虑瓦片的邻域作为进行比拼的范围；</p></li><li><p>人与人的接触是<strong>频繁</strong>的：考虑每局比拼中两个瓦片之间会进行多轮“比拼”；更重要的是，多次合作的具体次数是不可知的（即不知道最后一次合作是何时）</p></li><li><p>人会被<strong>淘汰</strong>：得分最低的瓦片会被清除；</p></li><li><p>人会<strong>繁衍</strong>：“无生命”的瓦片会变成有“生命”的瓦片；</p></li><li><p>人会受到<strong>周围</strong>人的影响：根据周围的“有生命”的瓦片类型的占比，决定繁殖出的瓦片的类型；</p></li><li><p>人还会受<strong>整体</strong>社会风气的影响：根据所有瓦片的占比，也会影响到繁殖出的的瓦片的类型。</p></li><li><p>人会<strong>犯错</strong>：人在“比拼”中可能会不小心做出相反的选择，在本模型中只讨论<strong>复读机</strong>之间、<strong>老好人与复读机</strong>之间的犯错可能性。</p></li></ul><blockquote><p>注意：这里的淘汰与繁衍不一定指的是生物进化论中的淘汰，也可能是个体由于看到其他人的策略更成功，而转变了自己的策略，因而原来的那个类型的人被“淘汰”了。</p></blockquote><h3 id="说明-2">说明</h3><p>整个社会各种类型的个体可以按比例随机生成或是人工设置，其中粉色代表老好人，紫色代表大恶人，青色代表复读机。博弈的得益矩阵、博弈次数可以进行修改，并可以调节淘汰百分比（末位淘汰）、繁殖概率、繁殖时受邻域的影响权重，以及犯错的概率。运行后，每个个体都与八邻域内的个体按设定的规则和自身的策略进行多轮博弈，总得分最低的一些个体被淘汰，随后整个社会的个体进行繁殖并开始下一轮的博弈，如此循环。可以观察社会中各种类型的分布变化，以及坐标图中各类型的比例变化，界面如图1所示。</p><p><img src="https://s1.ax1x.com/2022/07/29/vPtTzj.png" alt="图1 模型界面"></p><h3 id="代码">代码</h3><blockquote><p>工程文件请见：<a href="/resources#%E5%B7%A5%E7%A8%8B%E4%BB%A3%E7%A0%81">地理建模方法</a></p></blockquote><p>其中最为麻烦的就是选出得分最低的若干瓦片并淘汰的过程。一开始看的是中文文档，里面的语法已经过时，无法支持<code>sort-by</code>的操作。正确的语法如下：</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">let score-list sort-by [ [a b] -&gt; [score] of a &lt; [score] of b ] patches</span><br></pre></td></tr></table></figure><p>上述代码的意思是将<code>patches</code>按<code>score</code>从小到大排序，得到一个列表<code>score-list</code>。然后根据设定的百分比，将排名靠后的瓦片清理。</p><h3 id="结果与分析">结果与分析</h3><blockquote><p><a href="/html/地理建模方法编程/the_trust_game.html" target="_blank">配合模型食用更佳</a></p></blockquote><h4 id="初始参数与结果">初始参数与结果</h4><p>初始参数设置如下：</p><p>G、B、TFT比例为0.85、0.10、0.05，每轮博弈重复次数为20次，得益矩阵如下表所示。淘汰率为0.1，繁殖概率为0.5，繁殖的邻域影响权重为0.8，犯错概率为0</p><table>    <tr>        <td rowspan="2" colspan="2"></td>        <td colspan="2" align="center">乙</td>    </tr>     <tr>        <td align="center">合作</td>        <td align="center">欺骗</td>    </tr>    <tr>        <td rowspan="2" align="center">甲</td>        <td align="center">合作</td>        <td align="center">（1，1）</td>        <td align="center">（-2，2）</td>    </tr>    <tr>        <td align="center">欺骗</td>        <td align="center">（2，-2）</td>        <td align="center">（0，0）</td>    </tr></table><p>在模型的二维网格上，粉色代表合作者G，紫色代表欺骗者B，青色代表一报还一报者 TFT。</p><p>在模型的曲线图上，黑色曲线代表个体占整个社会的比例，粉色曲线代表G在个体中的比例，紫色曲线代表B在个体中的比例，青色曲线代表TFT在个体中的比例。</p><p>当参数为初始参数时，博弈结果如图2所示，个体类型比例的变化曲线如图3所示。</p><p>可以看到，第一阶段，G占多数而B和TFT只占少数。由于G的策略是永远合作，B的策略是永远欺骗，导致开始阶段B可以一直欺骗G保持快速的增长速度，而G相应地被大量淘汰了。</p><p>第二阶段，在B占多数的情况下，可供B压榨的G的数量不足，B之间只能互相欺骗，无利可得，得分最低。而TFT通过其策略，能与TFT和G进行良好的合作，获取分数。TFT而对B也能在第一次被欺骗之后不再与B合作。因此，这一阶段中，处于TFT内部的G被保护得很好；而B则在内斗之中慢慢被TFT渗透。</p><p>第三阶段，当B的内部渗透了足够多的TFT时，由于邻域对繁殖个体类型的影响，导致TFT迅速地将B消灭殆尽。少数存活的G与能与TFT和谐地相处下去。</p><div class="gallery">    <div class="fj-gallery " data-rowHeight="220" data-limit="10">    <span class="gallery-data">[{"url":"https://s1.ax1x.com/2022/07/29/vPtIJg.png","alt":"图 2 ticks=0时的社会情况"},{"url":"https://s1.ax1x.com/2022/07/29/vPt5FS.png","alt":"图 2 ticks=38时的社会情况"},{"url":"https://s1.ax1x.com/2022/07/29/vPtho8.png","alt":"图 2 ticks=82时的社会情况"},{"url":"https://s1.ax1x.com/2022/07/29/vPtfdf.png","alt":"图 2 ticks=111时的社会情况"},{"url":"https://s1.ax1x.com/2022/07/29/vPtoWQ.png","alt":"图 3 个体类型的比例变化曲线"}]</span>    </div>    <button class="gallery-load-more"><span>加载更多</span><i class="fa-solid fa-arrow-down"></i></button>    </div><h4 id="得益矩阵对结果的影响">得益矩阵对结果的影响</h4><p>默认参数下的合作的胜利，这一切都基于一个重要的前提——合作双方要有利可图。如果将得益矩阵修改为如下表所示。那么任何合作都将失去意义，TFT与G也无法通过合作抵抗B的欺骗行为，结果将是毫无悬念的B大获全胜（如图4）。</p><table>    <tr>        <td rowspan="2" colspan="2"></td>        <td colspan="2" align="center">乙</td>    </tr>     <tr>        <td align="center">合作</td>        <td align="center">欺骗</td>    </tr>    <tr>        <td rowspan="2" align="center">甲</td>        <td align="center">合作</td>        <td align="center">（0，0）</td>        <td align="center">（-2，2）</td>    </tr>    <tr>        <td align="center">欺骗</td>        <td align="center">（2，-2）</td>        <td align="center">（0，0）</td>    </tr></table><p>相反，如果削减B欺骗的得益，补偿G和TFT被欺骗的损失（如下表），则破坏合作环境的B将无处容身（如图5）。</p><table>    <tr>        <td rowspan="2" colspan="2"></td>        <td colspan="2" align="center">乙</td>    </tr>     <tr>        <td align="center">合作</td>        <td align="center">欺骗</td>    </tr>    <tr>        <td rowspan="2" align="center">甲</td>        <td align="center">合作</td>        <td align="center">（1，1）</td>        <td align="center">（-1，1）</td>    </tr>    <tr>        <td align="center">欺骗</td>        <td align="center">（1，-1）</td>        <td align="center">（0，0）</td>    </tr></table><div class="gallery">    <div class="fj-gallery " data-rowHeight="220" data-limit="10">    <span class="gallery-data">[{"url":"https://s1.ax1x.com/2022/07/29/vPtHQs.png","alt":"图 4 个体类型的比例变化曲线"},{"url":"https://s1.ax1x.com/2022/07/29/vPtbyn.png","alt":"图 5 个体类型的比例变化曲线"}]</span>    </div>    <button class="gallery-load-more"><span>加载更多</span><i class="fa-solid fa-arrow-down"></i></button>    </div><p>这就说明，社会中对合作的奖罚倾向会很大程度上影响社会中个体的策略。如果社会不能够有效地鼓励合作，反而是欺骗他人能获得更多的回报，那么就没有人愿意合作了。反之，如果能够鼓励合作，惩治破坏合作秩序的人，那么合作的好风气就可以扩散开。</p><h4 id="博弈次数对结果的影响">博弈次数对结果的影响</h4><p>此外，一轮的博弈次数也将对结果产生很大影响。当一局的博弈次数由20次减少到10次时，虽然演化过程依然为相似的三个阶段，但TFT对B的第二阶段侵入速度将大幅度下降（如图6），用时约为2800ticks，远比初始参数下的100ticks要长（如图3）。</p><p>当一轮的博弈次数减少到4-6次时，TFT对B的侵入能力将消失，演化也将停留在第二阶段（如图7，图8）。</p><p>而当一轮的博弈次数减少到3次以下时，B将直接把TFT与G全部淘汰（如图9）。</p><div class="gallery">    <div class="fj-gallery " data-rowHeight="220" data-limit="10">    <span class="gallery-data">[{"url":"https://s1.ax1x.com/2022/07/29/vPtqLq.png","alt":"图 6 个体类型的比例变化曲线"},{"url":"https://s1.ax1x.com/2022/07/29/vPtOe0.png","alt":"图 7 演化停留在第二阶段"},{"url":"https://s1.ax1x.com/2022/07/29/vPtXwV.png","alt":"图 8 个体类型的比例变化曲线"},{"url":"https://s1.ax1x.com/2022/07/29/vPtjoT.png","alt":"图 9 个体类型的比例变化曲线"}]</span>    </div>    <button class="gallery-load-more"><span>加载更多</span><i class="fa-solid fa-arrow-down"></i></button>    </div><p>结果表明，博弈次数对整个社会演化结果有很大的影响。对TFT来说，只要有足够的博弈次数，就能与其他的TFT和G建立良好的合作关系，累积足够的分数来抵消第一次博弈中被B欺骗的损失。因而，在一小群TFT侵入B之后，TFT能稳定地在B中存在，最终淘汰掉B群体。但是，当合作的次数减少时，TFT合作的收益将逐渐无法抵消B的第一次欺骗的损失，因而无法在B的群体中立足，演化将停滞在第二阶段。而当博弈次数继续减少到3以下时，TFT合作总收益进一步减少，甚至比互相欺骗的B的得分还要低，因此无法抵挡B的侵入。</p><p>这也说明了，社会中足够多次的互动，才能够促进信任与合作的传播；若互动次数不足，则未来合作的可能总得益还不及一次欺骗的得益高，也就不会有人愿意再合作了。</p><h4 id="错误率对结果的影响">错误率对结果的影响</h4><p>社会中的互动可能会存在信息误传递，导致错误的出现。这里仅考虑TFT之间，TFT与G之间的第一次博弈的错误可能性。将错误概率设为0.3时，可以发现演化情况的前一部分依然是以前述的三个阶段为主（如图10），但是由于犯错的可能，使TFT的合作收益降低，因此TFT对B的侵入速度也有降低的现象出现。而演化的后一部分则出现了有趣的现象，在TFT消除了大量的B之后，G又迅速地消除了大量的TFT，相应的B的数量也有所恢复（如图11）。整个演化的过程如图12所示。</p><div class="gallery">    <div class="fj-gallery " data-rowHeight="220" data-limit="10">    <span class="gallery-data">[{"url":"https://s1.ax1x.com/2022/07/29/vPtxFU.png","alt":"图 10 ticks=0时的社会情况"},{"url":"https://s1.ax1x.com/2022/07/29/vPtzYF.png","alt":"图 10 ticks=127时的社会情况"},{"url":"https://s1.ax1x.com/2022/07/29/vPNSW4.png","alt":"图 10 ticks=4405时的社会情况"},{"url":"https://s1.ax1x.com/2022/07/29/vPN9SJ.png","alt":"图 10 ticks=5497时的社会情况"},{"url":"https://s1.ax1x.com/2022/07/29/vPNiO1.png","alt":"图 11 ticks=5566时的社会情况"},{"url":"https://s1.ax1x.com/2022/07/29/vPNCl9.png","alt":"图 11 ticks=5968时的社会情况"},{"url":"https://s1.ax1x.com/2022/07/29/vPNPyR.png","alt":"图 12 ticks=5497时的社会情况"}]</span>    </div>    <button class="gallery-load-more"><span>加载更多</span><i class="fa-solid fa-arrow-down"></i></button>    </div><p>后一部分现象的出现，其原因在于TFT具有的可激怒性。当TFT与TFT进行博弈时，由于第一次博弈双方存在犯错的可能性，一旦一方犯错，双方就会陷入彼此欺骗的循环中。而如果双方在第一次博弈中同时犯错，双方则会一直欺骗对方，这就使得益更少。相比TFT，G就非常宽容，无论对方做了什么，G都会选择继续合作。所以G不会因为对方犯了错，就选择报复，因而能和TFT合作得很好，这也是为什么之后G能消除大部分TFT。这也证明了，在社会合作中，犯错可能会破坏合作的建立；适当的宽容，反而能促进合作的进行。</p><h2 id="总结">总结</h2><p>通过前述的结果与分析，可以看出，社会中的合作关系同时受到社会奖惩倾向、社会中合作互动的次数，社会中犯错概率，合作双方宽容度等诸多因素的影响。一个奖善惩恶的社会，是推动合作、减少欺骗的关键。人与人之间足够多的互动，能促进合作与信任的加深。而适当的宽容，能保持合作的稳定进行。</p><p>在本文的实验中，每个个体的博弈对象是固定的，而实际中个体可能会迁移，个体之间的关系也不是简单的邻接关系。因此，后续的研究可以考虑个体根据各自的倾向迁移，或基于小世界网络确定博弈对象，以得到更贴近社会情况的模型。</p><h2 id="参考文献-2">参考文献</h2><p>[1]罗伯特·阿克塞尔罗德.合作的进化[M].上海：上海人民出版社,2022:19-37</p><p>[2] Axelrod, Robert. The Complexity of Cooperation: Agent-Based Models of Competition and Collaboration. Princeton University Press, 1997, <a href="http://www.jstor.org/stable/j.ctt7s951">http://www.jstor.org/stable/j.ctt7s951</a>. Accessed 6 May 2022.</p><p>[3] Wilensky, U. 1999. NetLogo. <a href="http://ccl.northwestern.edu/netlogo/">http://ccl.northwestern.edu/netlogo/</a>. Center for Connected Learning and Computer-Based Modeling, Northwestern University. Evanston, IL.</p><p>[4] 宋明鑫. 计算机技术在“囚徒困境”博弈中的应用研究[D]. 天津:天津大学,2006. DOI:10.7666/d.y1047770.</p>]]></content>
      
      
      <categories>
          
          <category> 课程学习 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 地理建模 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>基于卫星遥感的西藏湖泊监测</title>
      <link href="/posts/1562fb12.html"/>
      <url>/posts/1562fb12.html</url>
      
        <content type="html"><![CDATA[<h2 id="前言-14">前言</h2><p>这次作业是一项小组合作的论文，我负责的是利用 Jason-3 数据获取湖面高程时序变化成果，因此这里只我自己的一小部分。</p><hr><h2 id="研究区域">研究区域</h2><p><ruby><b>扎日南木错</b><rt>Zhari Namco</rt></ruby>位于西藏阿里地区错勤县境内，位置介于85°20′~85°54′E，30°44′~31°05′N，湖面海拔4613米，湖泊补给系数为15.5，地属藏北内陆湖区（沿冈底斯山脉及念青唐古拉山以北的广大藏北高原），湖泊形态不规则，南北两岸较窄，东西两岸地势开阔，该湖水主要靠冰雪融水补给，入湖河流主要有错勤藏布、达龙藏布，错勤藏布发源于冈底斯山。扎日南木错属于咸水湖，是阿地区境内最大的湖泊，也是西藏境内第三大湖泊<sup>[1]</sup>。</p><h2 id="研究意义">研究意义</h2><p>湖泊具有涵养水源，调节生态环境的作用，是局部水循环的重要组成，对生态环境，地球科学等方面的研究有重大意义。水位是湖泊的一个重要的水文特征，能一定程度上反映湖泊蓄水量的多少，而水位的时序变化信息更反映了湖泊在一段时间内的变化情况，可以帮助我们分析预测其可能的发展走向，加深我们对气候变化的理解。</p><p>西藏地区湖泊众多，受人类活动影响较小，处于较为原始自然的状态。同时，这些湖泊的水补给多为冰川融水，其水位能一定程度反映冰川的消融情况，与我国淡水资源的利用研究有十分密切的联系，具有有很大的现实意义。</p><p>同时，由于青藏高原环境恶劣，很少有现场测量仪器可用于湖水位监测。而基于卫星测高技术具有快速的全球覆盖能力，能够大尺度、周期性地探测陆表水的各种自然现象及其变化，故在这类研究中具有其他观测技术无可比拟的优越性<sup>[2]</sup>。</p><h2 id="实验数据">实验数据</h2><h3 id="Jason-3-卫星测高数据">Jason-3 卫星测高数据</h3><h4 id="基本信息">基本信息</h4><p>Jason-3卫星是由法国空间研究中心（CNES），美国宇航局（NASA）、欧洲气象卫星组织（EUMETSAT）以及美国海洋和大气局（NOAA）等多个机构合作研制的一颗海洋测高卫星。轨道周期为10天，轨道高度为1336千米，倾角为66°。其延续了Jason-2的轨道，并对系统进行了许多增强<sup>[3]</sup>。</p><h4 id="数据获取方法">数据获取方法</h4><p>通过将 Jason-3 扫描轨迹导入谷歌地球，我们可以知道具体哪一条扫描线通过了扎日南木错。下载此扫描线的历年数据（2016-2021年）</p><blockquote><p>Jason-3 的轨道周期为10天，因此数据的时间分辨率就是10天</p></blockquote><p><img src="https://cdn.zerolacqua.top/images/blogs/%E5%9F%BA%E4%BA%8E%E5%8D%AB%E6%98%9F%E9%81%A5%E6%84%9F%E7%9A%84%E8%A5%BF%E8%97%8F%E6%B9%96%E6%B3%8A%E7%9B%91%E6%B5%8B/1.png" alt="谷歌地球上的 Jason-3 扫描轨迹"></p><p>本实验使用 jason-3 的90号扫描线在2016年2月20日到2021年12月22日之间的总计214次高程测量数据。</p><h3 id="中国1km分辨率逐月平均气温数据集（1901-2020）">中国1km分辨率逐月平均气温数据集（1901-2020）</h3><p>该数据为中国逐月平均温度数据，空间分辨率为0.0083333°（约1km），时间为1901.1-2020.12。数据格式为 NETCDF，即<code>.nc</code>格式。数据单位为0.1 ℃。该数据集是根据 CRU 发布的全球0.5°气候数据集以及 WorldClim 发布的全球高分辨率气候数据集，通过 Delta 空间降尺度方案在中国地区降尺度生成的。并且，使用496个独立气象观测点数据进行验证，验证结果可信。本数据集包含的地理空间范围是全国主要陆地（包含港澳台地区），不含南海岛礁等区域<sup>[4]</sup>。</p><h3 id="中国1km分辨率逐月降水量数据集（1901-2020）">中国1km分辨率逐月降水量数据集（1901-2020）</h3><p>该数据为中国逐月平均温度数据，空间分辨率为0.0083333°（约1km），时间为1901.1-2020.12。数据格式为 NETCDF，即<code>.nc</code>格式。数据单位为0.1 ℃。该数据集是根据 CRU 发布的全球0.5°气候数据集以及 WorldClim 发布的全球高分辨率气候数据集，通过 Delta 空间降尺度方案在中国地区降尺度生成的。并且，使用496个独立气象观测点数据进行验证，验证结果可信。本数据集包含的地理空间范围是全国主要陆地（包含港澳台地区），不含南海岛礁等区域<sup>[5]</sup>。</p><h2 id="研究方法">研究方法</h2><h3 id="水位测高计算原理">水位测高计算原理</h3><p>Jason-3 测高是通过搭载在卫星上的雷达测高仪完成的，通过让测高仪上的雷达装置垂直向下发射脉冲信号，根据测量脉冲从发射经地球表面反射再到卫星天线接收的时间，来计算出卫星到星下点的距离，结合卫星搭载的GPS定位信息计算得到海（水、冰）平面高度</p><p>根据卫星测高的基本工作原理，湖面测高水位计算公式为<sup>[6]</sup>：</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mtable rowspacing="0.16em" columnspacing="1em"><mtr><mtd class ="mtr-glue"></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mi>h</mi><mo>=</mo><msub><mi>h</mi><mrow><mi>a</mi><mi>l</mi><mi>t</mi></mrow></msub><mo>−</mo><msub><mi>h</mi><mrow><mi>r</mi><mi>a</mi><mi>n</mi></mrow></msub><mo>−</mo><msub><mi>h</mi><mrow><mi>g</mi><mi>e</mi><mi>o</mi><mi>i</mi><mi>d</mi></mrow></msub><mo>−</mo><mi>c</mi></mrow></mstyle></mtd><mtd class ="mtr-glue"></mtd><mtd class ="mml-eqn-num"></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{equation}h=h_{alt}-h_{ran}-h_{geoid}-c\end{equation}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.2em;vertical-align:-0.35em;"></span><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.85em;"><span style="top:-3.01em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">h</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord"><span class="mord mathnormal">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">a</span><span class="mord mathnormal mtight">lt</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em;">r</span><span class="mord mathnormal mtight">an</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">g</span><span class="mord mathnormal mtight">eo</span><span class="mord mathnormal mtight">i</span><span class="mord mathnormal mtight">d</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord mathnormal">c</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.35em;"><span></span></span></span></span></span></span></span><span class="tag"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.85em;"><span style="top:-2.85em;"><span class="pstrut" style="height:2.84em;"></span><span class="eqn-num"></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.35em;"><span></span></span></span></span></span></span></span></span></p><p>其中：<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>h</mi></mrow><annotation encoding="application/x-tex">h</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal">h</span></span></span></span> 为湖泊水位正高；<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>h</mi><mrow><mi>a</mi><mi>l</mi><mi>t</mi></mrow></msub></mrow><annotation encoding="application/x-tex">h_{alt}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8444em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">a</span><span class="mord mathnormal mtight">lt</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> 为测高仪的椭球高；<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>h</mi><mrow><mi>r</mi><mi>a</mi><mi>n</mi></mrow></msub></mrow><annotation encoding="application/x-tex">h_{ran}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8444em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em;">r</span><span class="mord mathnormal mtight">an</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> 为测高仪的观测距离；<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>h</mi><mrow><mi>g</mi><mi>e</mi><mi>o</mi><mi>i</mi><mi>d</mi></mrow></msub></mrow><annotation encoding="application/x-tex">h_{geoid}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9805em;vertical-align:-0.2861em;"></span><span class="mord"><span class="mord mathnormal">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">g</span><span class="mord mathnormal mtight">eo</span><span class="mord mathnormal mtight">i</span><span class="mord mathnormal mtight">d</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span></span></span></span> 为大地水准面相对于参考椭球面高度（即大地水准面差距，大地高与正高差）；<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>c</mi></mrow><annotation encoding="application/x-tex">c</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">c</span></span></span></span>为各项观测误差修正。</p><p>在 Jason-3 的数据文件中，储存有扫描线经过点的经纬度坐标、测量时间、椭球高、测高仪的观测距离和大地水准面差距等数据。利用这些数据可以获取扫描行上测量点的高程，以及对应的时间和经纬度。</p><h3 id="高程选取方法">高程选取方法</h3><p>理论上，对于平静湖面来说，其测高数据应当是相等的，只需要选择其中一点的高程测量值即可作为湖面高程。然而，在水陆交界处，雷达的回波会被污染，雷达高度计收到的返回波形与标准的 Brown 模型差异较大，返回波形的实际波形前缘中点与星载高度计预设跟踪点不一致，会造成高度计测量距离与实际距离的偏差，需要通过波形重跟踪进行修正<sup>[7]</sup>。本实验过程中并没有进行提高精度的波形重跟踪。</p><p>此外，雷达测高数据本身也存在误差，即使是高程相等的湖面，其测量的高程也会有一定的波动，甚至存在异常值。因此，需要对获得的数据进行一定的处理，以选出合理的数值代表整个湖面的高程。对于测高数据中的异常值，可以利用均值、拉依达准则（即三倍中误差准则）、RANSAC 等方法进行剔除。</p><p>本文实验是利用众数剔除异常数据得到湖面高程。由于众数对异常值的敏感度很低，而数据文件中正常的湖面高程值占相当大的比例，因此可以通过如下方法确定湖面高程的近似范围：</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mtable rowspacing="0.16em" columnspacing="1em"><mtr><mtd class ="mtr-glue"></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><msub><mi>h</mi><mn>0</mn></msub><mo>=</mo><mi>m</mi><mi>o</mi><mi>d</mi><mi>e</mi><mo stretchy="false">(</mo><mi>r</mi><mi>o</mi><mi>u</mi><mi>n</mi><mi>d</mi><mo stretchy="false">(</mo><mi>H</mi><mo stretchy="false">)</mo><mo stretchy="false">)</mo></mrow></mstyle></mtd><mtd class ="mtr-glue"></mtd><mtd class ="mml-eqn-num"></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{equation}h_0=mode(round(H))\end{equation}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.2em;vertical-align:-0.35em;"></span><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.85em;"><span style="top:-3.01em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord mathnormal">m</span><span class="mord mathnormal">o</span><span class="mord mathnormal">d</span><span class="mord mathnormal">e</span><span class="mopen">(</span><span class="mord mathnormal">ro</span><span class="mord mathnormal">u</span><span class="mord mathnormal">n</span><span class="mord mathnormal">d</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.08125em;">H</span><span class="mclose">))</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.35em;"><span></span></span></span></span></span></span></span><span class="tag"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.85em;"><span style="top:-2.85em;"><span class="pstrut" style="height:2.84em;"></span><span class="eqn-num"></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.35em;"><span></span></span></span></span></span></span></span></span></p><p>其中：<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>H</mi></mrow><annotation encoding="application/x-tex">H</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.08125em;">H</span></span></span></span> 表示一次扫描的高程数据向量；<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>r</mi><mi>o</mi><mi>u</mi><mi>n</mi><mi>d</mi><mo stretchy="false">(</mo><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">round()</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">ro</span><span class="mord mathnormal">u</span><span class="mord mathnormal">n</span><span class="mord mathnormal">d</span><span class="mopen">(</span><span class="mclose">)</span></span></span></span> 表示对数据进行四舍五入；<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>m</mi><mi>o</mi><mi>d</mi><mi>e</mi><mo stretchy="false">(</mo><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">mode()</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">m</span><span class="mord mathnormal">o</span><span class="mord mathnormal">d</span><span class="mord mathnormal">e</span><span class="mopen">(</span><span class="mclose">)</span></span></span></span> 表示计算数据中的众数。</p><p>然后由近似值，设定一定大小的邻域，以筛选出正常值。计算正常值的均值作为湖面的最终高程 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mover accent="true"><mi>h</mi><mo stretchy="true">‾</mo></mover></mrow><annotation encoding="application/x-tex">\overline{h}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8944em;"></span><span class="mord overline"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8944em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">h</span></span></span><span style="top:-3.8144em;"><span class="pstrut" style="height:3em;"></span><span class="overline-line" style="border-bottom-width:0.04em;"></span></span></span></span></span></span></span></span></span></p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mtable rowspacing="0.16em" columnspacing="1em"><mtr><mtd class ="mtr-glue"></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mover accent="true"><mi>h</mi><mo stretchy="true">‾</mo></mover><mo>=</mo><mi>m</mi><mi>e</mi><mi>a</mi><mi>n</mi><mo stretchy="false">(</mo><msub><mi>H</mi><mi>c</mi></msub><mo stretchy="false">)</mo></mrow></mstyle></mtd><mtd class ="mtr-glue"></mtd><mtd class ="mml-eqn-num"></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{equation}\overline{h}=mean(H_c)\end{equation}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.2544em;vertical-align:-0.3772em;"></span><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8772em;"><span style="top:-2.9828em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord overline"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8944em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">h</span></span></span><span style="top:-3.8144em;"><span class="pstrut" style="height:3em;"></span><span class="overline-line" style="border-bottom-width:0.04em;"></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord mathnormal">m</span><span class="mord mathnormal">e</span><span class="mord mathnormal">an</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.08125em;">H</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0813em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">c</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.3772em;"><span></span></span></span></span></span></span></span><span class="tag"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8772em;"><span style="top:-2.8772em;"><span class="pstrut" style="height:2.8944em;"></span><span class="eqn-num"></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.3772em;"><span></span></span></span></span></span></span></span></span></p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mtable rowspacing="0.16em" columnspacing="1em"><mtr><mtd class ="mtr-glue"></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><msub><mi>H</mi><mi>c</mi></msub><mo>=</mo><mo stretchy="false">{</mo><mi>a</mi><mi>b</mi><mi>s</mi><mo stretchy="false">(</mo><mi>h</mi><mo>−</mo><msub><mi>h</mi><mn>0</mn></msub><mo stretchy="false">)</mo><mo>&lt;</mo><mi>ε</mi><mi mathvariant="normal">∣</mi><mi>h</mi><mo>∈</mo><mi>H</mi><mo stretchy="false">}</mo></mrow></mstyle></mtd><mtd class ="mtr-glue"></mtd><mtd class ="mml-eqn-num"></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{equation}H_c=\{abs(h-h_0)&lt;\varepsilon|h \in H\}\end{equation}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.2em;vertical-align:-0.35em;"></span><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.85em;"><span style="top:-3.01em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:0.08125em;">H</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0813em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">c</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mopen">{</span><span class="mord mathnormal">ab</span><span class="mord mathnormal">s</span><span class="mopen">(</span><span class="mord mathnormal">h</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">&lt;</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord mathnormal">ε</span><span class="mord">∣</span><span class="mord mathnormal">h</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">∈</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord mathnormal" style="margin-right:0.08125em;">H</span><span class="mclose">}</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.35em;"><span></span></span></span></span></span></span></span><span class="tag"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.85em;"><span style="top:-2.85em;"><span class="pstrut" style="height:2.84em;"></span><span class="eqn-num"></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.35em;"><span></span></span></span></span></span></span></span></span></p><p>其中：<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>H</mi><mi>c</mi></msub></mrow><annotation encoding="application/x-tex">H_c</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.08125em;">H</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0813em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">c</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> 表示与 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>h</mi><mn>0</mn></msub></mrow><annotation encoding="application/x-tex">h_0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8444em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> 的距离小于 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>ε</mi></mrow><annotation encoding="application/x-tex">\varepsilon</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">ε</span></span></span></span> 的高程数据集合；<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>m</mi><mi>e</mi><mi>a</mi><mi>n</mi><mo stretchy="false">(</mo><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">mean()</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">m</span><span class="mord mathnormal">e</span><span class="mord mathnormal">an</span><span class="mopen">(</span><span class="mclose">)</span></span></span></span> 表示计算数据的均值。</p><h3 id="时间序列分析">时间序列分析</h3><p>时间序列的组合主要包含长期趋势（T）、季节变动（S）、循环变动（C）和不规则变动（I）四个成分。长期趋势是指时间序列随时间的变化而逐渐增加或减少的长期变化趋势。季节变动是指时间序列在一年中或固定时间内，呈现出的固定规则的变动。循环变动是指沿着趋势线如钟摆般地循环变动。不规则变动是指在时间序列中由于随机因素影响所引起的变动。</p><p>时间序列组合方式一般有加法模型和乘法模型两种。加法模型假定时间序列是基于四种成分相加而成的，长期趋势并不影响季节变动；而乘法模型假定时间序列是基于四种成分相乘而成的，假定季节变动与循环变动为长期趋势的函数。若以 Y 表示时间序列，则</p><p>加法模型：</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mtable rowspacing="0.16em" columnspacing="1em"><mtr><mtd class ="mtr-glue"></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mi>Y</mi><mo>=</mo><mi>T</mi><mo>+</mo><mi>S</mi><mo>+</mo><mi>C</mi><mo>+</mo><mi>I</mi></mrow></mstyle></mtd><mtd class ="mtr-glue"></mtd><mtd class ="mml-eqn-num"></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{equation}Y=T+S+C+I\end{equation}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.2em;vertical-align:-0.35em;"></span><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.85em;"><span style="top:-3.01em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.22222em;">Y</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord mathnormal" style="margin-right:0.07847em;">I</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.35em;"><span></span></span></span></span></span></span></span><span class="tag"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.85em;"><span style="top:-2.85em;"><span class="pstrut" style="height:2.84em;"></span><span class="eqn-num"></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.35em;"><span></span></span></span></span></span></span></span></span></p><p>乘法模型：</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mtable rowspacing="0.16em" columnspacing="1em"><mtr><mtd class ="mtr-glue"></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mi>Y</mi><mo>=</mo><mi>T</mi><mo>×</mo><mi>S</mi><mo>×</mo><mi>C</mi><mo>×</mo><mi>I</mi></mrow></mstyle></mtd><mtd class ="mtr-glue"></mtd><mtd class ="mml-eqn-num"></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{equation}Y=T\times S\times C\times I\end{equation}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.2em;vertical-align:-0.35em;"></span><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.85em;"><span style="top:-3.01em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.22222em;">Y</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord mathnormal" style="margin-right:0.07847em;">I</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.35em;"><span></span></span></span></span></span></span></span><span class="tag"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.85em;"><span style="top:-2.85em;"><span class="pstrut" style="height:2.84em;"></span><span class="eqn-num"></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.35em;"><span></span></span></span></span></span></span></span></span></p><p>为了研究湖面高程的变化趋势，本文采用滑动平均法进行拟合。其计算公式为：</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mtable rowspacing="0.16em" columnspacing="1em"><mtr><mtd class ="mtr-glue"></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><msub><mover accent="true"><mi>y</mi><mo>^</mo></mover><mi>t</mi></msub><mo>=</mo><mfrac><mn>1</mn><mrow><mn>2</mn><mi>l</mi><mo>+</mo><mn>1</mn></mrow></mfrac><mo stretchy="false">(</mo><msub><mi>y</mi><mrow><mi>t</mi><mo>−</mo><mi>l</mi></mrow></msub><mo>+</mo><msub><mi>y</mi><mrow><mi>t</mi><mo>−</mo><mo stretchy="false">(</mo><mi>l</mi><mo>−</mo><mn>1</mn><mo stretchy="false">)</mo></mrow></msub><mo>+</mo><mo>⋯</mo><mo>+</mo><msub><mi>y</mi><mrow><mi>t</mi><mo>−</mo><mn>1</mn></mrow></msub><mo>+</mo><msub><mi>y</mi><mi>t</mi></msub><mo>+</mo><msub><mi>y</mi><mrow><mi>t</mi><mo>+</mo><mn>1</mn></mrow></msub><mo>+</mo><mo>⋯</mo><mo>+</mo><msub><mi>y</mi><mrow><mi>t</mi><mo>+</mo><mi>l</mi></mrow></msub><mo stretchy="false">)</mo></mrow></mstyle></mtd><mtd class ="mtr-glue"></mtd><mtd class ="mml-eqn-num"></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{equation}\hat {y}_ {t}=\cfrac{1}{2l+1}(y_{t-l}+y_{t-(l-1)}+\cdots+y_{t-1}+y_{t}+y_{t+1}+\cdots+y_{t+l})\end{equation}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:2.3593em;vertical-align:-0.9297em;"></span><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.4297em;"><span style="top:-3.4297em;"><span class="pstrut" style="height:3.59em;"></span><span class="mord"><span class="mord"><span class="mord accent"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.6944em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.1944em;"><span class="mord">^</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.1944em;"><span></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2806em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.59em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">2</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord">1</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.74em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.7693em;"><span></span></span></span></span></span><span></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mbin mtight">−</span><span class="mord mathnormal mtight" style="margin-right:0.01968em;">l</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2083em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em;"><span style="top:-2.5198em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mbin mtight">−</span><span class="mopen mtight">(</span><span class="mord mathnormal mtight" style="margin-right:0.01968em;">l</span><span class="mbin mtight">−</span><span class="mord mtight">1</span><span class="mclose mtight">)</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.3552em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="minner">⋯</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2083em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2806em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2083em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="minner">⋯</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mbin mtight">+</span><span class="mord mathnormal mtight" style="margin-right:0.01968em;">l</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2083em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.9297em;"><span></span></span></span></span></span></span></span><span class="tag"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.4297em;"><span style="top:-3.4297em;"><span class="pstrut" style="height:3.59em;"></span><span class="eqn-num"></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.9297em;"><span></span></span></span></span></span></span></span></span></p><p>式中：<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mover accent="true"><mi>y</mi><mo>^</mo></mover><mi>t</mi></msub></mrow><annotation encoding="application/x-tex">\hat{y}_t</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord accent"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.6944em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.1944em;"><span class="mord">^</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.1944em;"><span></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2806em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> 为 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi></mrow><annotation encoding="application/x-tex">t</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6151em;"></span><span class="mord mathnormal">t</span></span></span></span> 点的滑动平均值；<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>l</mi></mrow><annotation encoding="application/x-tex">l</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span></span></span></span> 为单侧平滑时距。</p><h2 id="实验结果与分析">实验结果与分析</h2><h3 id="湖面高程提取">湖面高程提取</h3><p>根据前述的高程提取算法，提取2016年2月20日到2016年8月7日 Jason-3 的测高数据如下图。可以看到，本文采用的方法，对测高数据中的异常值有较强的抗干扰能力，不论是较平稳的数据（如下图第3行第1列曲线图），还是异常较多的数据（如下图第3行第4列曲线图），其提取的高程值均位于正常数据所在的水平线上。而根据拉依达准则（这里设置的是二倍中误差）提取的高程值，在大多情况下提取的高程与本文方法相近，而一旦遇到异常值较多的情况，提取的高程值就会有较大偏差（如下图第2行第1列曲线图）。</p><p>同时，注意到下图中的前三幅图没有绘制曲线。经过核对，第二、第三幅图像由于数据文件中数据缺失，无法进行绘制，而第一幅图则是因为数据整体出现了异常，高程超出绘图范围，故没有显示。根据 Jason-3 卫星的发射时间（2016年1月17日），可以猜测这是由于 Jason-3 卫星入轨后需进行一段时间的调试与检校工作，因而数据不稳定，甚至存在缺失。而 Jason-3 的2016年年度有效性报告验证了这一点，在相应时间段上确实有检校工作进行<sup>[8]</sup>。</p><p><img src="https://cdn.zerolacqua.top/images/blogs/%E5%9F%BA%E4%BA%8E%E5%8D%AB%E6%98%9F%E9%81%A5%E6%84%9F%E7%9A%84%E8%A5%BF%E8%97%8F%E6%B9%96%E6%B3%8A%E7%9B%91%E6%B5%8B/2.jpg" alt="扫描数据（实线）与本文算法选取的湖面高程（虚线）以及拉依达准则选取的湖面高程（点划线）"></p><h3 id="湖面高程时序变化">湖面高程时序变化</h3><p>每次测量数据能获得湖面的一个高程值，按照数据文件中的测量时间，可以绘制湖面高程随时间变化的曲线。由于前述卫星检校调整的原因，某些时段选取的湖面高程可能会存在空值或是异常值。对于空值而言，由于 Jason-3 的时间分辨率在10天左右，所以，空值的存在对分析结果基本上没有影响。而对于异常值，虽然它会给分析带来很大的影响，但由于异常值非常突出，也很容易将其剔除。通过设置阈值，将高程大于阈值的数据点剔除，就可以达到消除异常数据的目的。此时湖面高程时序曲线如下图所示。</p><p><img src="https://cdn.zerolacqua.top/images/blogs/%E5%9F%BA%E4%BA%8E%E5%8D%AB%E6%98%9F%E9%81%A5%E6%84%9F%E7%9A%84%E8%A5%BF%E8%97%8F%E6%B9%96%E6%B3%8A%E7%9B%91%E6%B5%8B/3.jpg" alt="剔除异常之后的湖面高程时序曲线"></p><p>为了更好地描述水位的变化趋势，我们使用滑动平均法，以半年为窗口大小，对得到的湖面高程时序曲线进行平滑，然后再计算近似导数，也进行平滑处理。</p><p><img src="https://cdn.zerolacqua.top/images/blogs/%E5%9F%BA%E4%BA%8E%E5%8D%AB%E6%98%9F%E9%81%A5%E6%84%9F%E7%9A%84%E8%A5%BF%E8%97%8F%E6%B9%96%E6%B3%8A%E7%9B%91%E6%B5%8B/4.jpg" alt="平滑后的湖面高程时序曲线"></p><p>从以上湖面高程时序曲线中可以看出，扎日南木错水位的变化总体上呈逐年上涨趋势。在2016年年初到2020年年初之间湖水水位上涨十分显著，而在2020年年初到2022年年初之间，水位呈现出较为稳定的状态且略有回落。</p><p><img src="https://cdn.zerolacqua.top/images/blogs/%E5%9F%BA%E4%BA%8E%E5%8D%AB%E6%98%9F%E9%81%A5%E6%84%9F%E7%9A%84%E8%A5%BF%E8%97%8F%E6%B9%96%E6%B3%8A%E7%9B%91%E6%B5%8B/5.jpg" alt="平滑后的湖面高程时序曲线导数"></p><p>从以上湖面高程时序曲线导数可以看出，2016-2020年水位上涨集中发生在夏季的7月和8月，水位下降则发生在1-3月；2020年之后，夏季水位基本无上涨倾向，整体呈下降态势。</p><p>将本文得出的湖面高程时序曲线与文献【9】中所得的湖面高程时序曲线对应时段（2016年年初-2019年年底）进行比较，两者的走势基本吻合，证明了本文处理结果的有效性。</p><h2 id="参考文献-3">参考文献</h2><p>[1] 普布次仁, 白玛央宗, 洛桑曲珍,等. 2002-2017年扎日南木错湖面面积变化分析[J]. 高原山地气象研究, 2018, 38(4):4.</p><p>[2] 高乐. 基于卫星测高技术的青藏高原湖泊水位和冰川高程变化监测研究[D]. 中国科学院大学,2014.</p><p>[3] <a href="https://www.aviso.altimetry.fr/en/data/products-guide.html?id=601">https://www.aviso.altimetry.fr/en/data/products-guide.html?id=601</a> [EB/OL].</p><p>[4] Peng, S. (2019). 1-km monthly mean temperature dataset for china (1901-2020). National Tibetan Plateau Data Center, DOI: 10.11888/Meteoro.tpdc.270961. CSTR: 18406.11.Meteoro.tpdc.270961.</p><p>[5] Peng, S. (2020). 1-km monthly precipitation dataset for China (1901-2020). National Tibetan Plateau Data Center, DOI: 10.5281/zenodo.3185722.</p><p>[6] 文京川, 赵红莉, 蒋云钟,等. 卫星测高数据筛选方法研究——以Jason-3数据和洪泽湖为例[J]. 南水北调与水利科技, 2018, 16(3):8.</p><p>[7] 黄征凯. 利用多源卫星数据研究青藏高原湖泊水储量变化及其影响因素[D].武汉大学,2018.</p><p>[8] <a href="https://www.aviso.altimetry.fr/en/data/calval/systematic-calval/annual-reports/jason-3.html">https://www.aviso.altimetry.fr/en/data/calval/systematic-calval/annual-reports/jason-3.html</a> [EB/OL].</p><p>[9] Sun M, Guo J, Yuan J, Liu X, Wang H and Li C (2021) Detecting Lake Level Change From 1992 to 2019 of Zhari Namco in Tibet Using Altimetry Data of TOPEX/Poseidon and Jason-1/2/3 Missions. Front. Earth Sci. 9:640553. doi: 10.3389/feart.2021.640553</p><p>[10] Peng, S.Z., Ding, Y.X., Liu, W.Z., &amp; Li, Z. (2019). 1 km monthly temperature and precipitation dataset for China from 1901 to 2017. Earth System Science Data, 11, 1931–1946. <a href="https://doi.org/10.5194/essd-11-1931-2019">https://doi.org/10.5194/essd-11-1931-2019</a><br>[11] Peng, S.Z., Ding, Y.X., Wen, Z.M., Chen, Y.M., Cao, Y., &amp; Ren, J.Y. (2017). Spatiotemporal change and trend analysis of potential evapotranspiration over the Loess Plateau of China during 2011–2100. Agricultural and Forest Meteorology, 233, 183–194.<br>[12] Peng, S. Z, Gang, C. , Cao, Y. , &amp; Chen, Y. . (2017). Assessment of climate change trends over the loess plateau in china from 1901 to 2100. International Journal of Climatology.<br>[13] Ding, Y.X., &amp; Peng, S.Z. (2020). Spatiotemporal trends and attribution of drought across China from 1901–2100. Sustainability, 12(2), 477.</p>]]></content>
      
      
      <categories>
          
          <category> 课程学习 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 遥感 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>卫星摄影测量编程</title>
      <link href="/posts/9df20c2d.html"/>
      <url>/posts/9df20c2d.html</url>
      
        <content type="html"><![CDATA[<h2 id="前言-11">前言</h2><p>采用地形无关的控制方案建立 RPC 模型。本次作业是小组作业，成果为小组共同完成，上传博客经小组成员同意。</p><h2 id="数据组成">数据组成</h2><p><code>DX_ZY3_NAD_att.txt</code>：记录卫星影像某一时刻的四元数（用于计算本体坐标系与 <em>J2000</em> 坐标系之间的变换矩阵），并没有用到本体到轨道坐标系姿态的三个欧拉角。</p><p><code>DX_ZY3_NAD_gps.txt</code>：记录卫星某一时刻在 <em>WGS84</em> 坐标系中的位置，并没有用到速度数据。</p><blockquote><p>本体到轨道坐标系姿态的三个欧拉角与 GPS 速度数据应该是计算本体坐标系到轨道坐标系、轨道坐标系到 <em>WGS84</em> 坐标系的数。这里我们是用本体坐标系与 <em>J2000</em> 坐标系，然后 <em>J2000</em> 坐标系到 <em>WGS84</em> 坐标系计算的。</p><p>此外将 GPS 相位中心坐标直接视为了投影中心坐标，忽视了两者之间的误差，是因为这一部分误差可以归在<strong>偏置矩阵</strong>中，可以结合光学卫星在轨几何定标相关知识理解。</p></blockquote><p><code>DX_ZY3_NAD_imagingTime.txt</code>：记录卫星的扫描行对应的时刻，以对应 GPS 定位数据和四元数数据。</p><p><code>NAD.cbr</code>：记录一个扫描行上的像元指向角，包括垂轨和沿轨方向的指向角。在本次作业中，沿轨方向 x 指向角均为0。</p><p><code>NAD.txt</code>：记录偏置矩阵数据。本次作业中该数据均为0，不需要使用。</p><p><code>zy3.tif</code>：卫星影像数据，从<code>.tif</code>文件中可以读取影像的范围，并由此获取相应区域的 DEM 。</p><blockquote><p>在美国地质调查局USGS官网下载航天飞机成像雷达地形测绘(SRTM) DEM 数据，按卫星影像范围裁剪，作为后续检查计算的基础。</p></blockquote><p><code>zy3_rpc.txt</code>：用途暂时未知。</p><h2 id="基本思路">基本思路</h2><ul><li><p>控制点获取</p><ul><li><p>文件读取</p></li><li><p>格网划分</p></li><li><p>四元数计算</p></li><li><p>视向量计算</p></li><li><p>视向量与椭球的交点</p><p>计算特定 H 下， 椭球与视向量的交点直角坐标</p></li></ul></li><li><p>检查点获取</p><ul><li>格网划分</li><li>根据 DEM 中仿射参数，计算大地坐标 BL 对应的 DEM 像元坐标，获取高程 H</li><li>窗口二分法确定扫描行</li></ul></li></ul><blockquote><p>这两部分有很多相通的地方：</p><ul><li>包括读取、处理数据可以公用</li><li>直角坐标 XYZ 与大地坐标 BLH 相互转换函数</li></ul></blockquote><ul><li><p>RPC 解算</p><ul><li>这一部分的计算很迷，尤其是线性化的方式，和以往的不同</li></ul></li><li><p>精度检查</p></li></ul><h2 id="要注意的地方">要注意的地方</h2><ul><li><p>坐标的对应关系</p><p>整个计算过程中涉及到很多种坐标，一定要理清它们之间的关系。</p><ol><li><p>像方坐标</p><ul><li><p>(x , y) 与 (line , sample) 是等价的</p></li><li><p>(height , width)</p></li><li><p>(r , c)</p></li></ul><blockquote><p>在本次作业中，sample 对应的是图像的 width, 因而可以看出 x 对应 r，y 对应 c</p></blockquote></li><li><p>地球坐标系</p><p>要注意大地坐标 BLH 与直角坐标 XYZ 之间的转化</p></li></ol></li><li><p>像元指向角</p><p>像元指向角文件中的数据是<u>指向角</u>，而不是正切值。</p></li><li><p>地球椭球的使用</p><p>在获取控制点时，我们是通过影像格网与高度计算的地面点坐标，但其中存在一个问题。使用 xyh 计算坐标的时候得到 XYZ 坐标，</p><p>然后 XYZ 计算 BLH 坐标也会得到一个高程 H 。如果这 xyh 和 BLH 的两个高程不相等，那就会麻烦不少。其解决方法详见 PPT 内容。</p></li><li><p>RPC 的线性化，根据我的理解，它甚至没有用到偏导数，是很不常规的解法。同时，它也不需要提供较为准确的初始值（解出参数的稳定堪忧）</p></li></ul>]]></content>
      
      
      <categories>
          
          <category> 课程学习 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 摄影测量 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>TIN的三种构建方式</title>
      <link href="/posts/3cd52e14.html"/>
      <url>/posts/3cd52e14.html</url>
      
        <content type="html"><![CDATA[<h1>三种TIN的生成方法</h1><h2 id="生长算法">生长算法</h2><p>生长算法有两种：递归生长和凸闭包收缩算法。通俗来讲就是前者是从点集中心向外扩展，后者是由外向内收敛。</p><p>以递归生长算法为例，其基本步骤是：</p><ol><li><p>在数据点中任取一点 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>P</mi><mn>1</mn></msub></mrow><annotation encoding="application/x-tex">P_1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> （一般是位于数据点的几何中心附近），并寻找距离此点最近的点 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>P</mi><mn>2</mn></msub></mrow><annotation encoding="application/x-tex">P_2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> 。两者相连形成初始基线 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>P</mi><mn>1</mn></msub><msub><mi>P</mi><mn>2</mn></msub></mrow><annotation encoding="application/x-tex">P_1P_2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> ，利用 <em>Delaunay</em> 三角网剖分准则，在点集中寻找第三点 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>P</mi><mn>3</mn></msub></mrow><annotation encoding="application/x-tex">P_3</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> ，形成第一个三角形 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="normal">△</mi><msub><mi>P</mi><mn>1</mn></msub><msub><mi>P</mi><mn>2</mn></msub><msub><mi>P</mi><mn>3</mn></msub></mrow><annotation encoding="application/x-tex">\triangle P_1P_2P_3</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord">△</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> 。</p></li><li><p>以初始三角形的三条边为基线，利用 <em>Delaunay</em> 三角网剖分准则，分别寻找能与该三条基线形成 <em>Delaunay</em> 三角形的 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>P</mi><mn>4</mn></msub><mo separator="true">,</mo><msub><mi>P</mi><mn>5</mn></msub><mo separator="true">,</mo><msub><mi>P</mi><mn>6</mn></msub></mrow><annotation encoding="application/x-tex">P_4,P_5,P_6</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8778em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">4</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">5</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">6</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> 点，构造新的三角形。</p></li><li><p>重复步骤2，直到所有数据点处理完毕。</p><blockquote><p><em>Delaunay</em> 三角网剖分准则</p><ul><li>满足空外接圆特性</li><li>满足最大最小角特性</li></ul></blockquote></li></ol><p>三角网生长算法逻辑简单，易于计算机编程实现，其最大的问题就在于生成过程中搜寻数据点时间效率很低，因此这部分的选择的算法主要是对搜寻数据点进行的优化<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mrow></mrow><mrow><mo stretchy="false">[</mo><mn>1</mn><mo stretchy="false">]</mo></mrow></msup></mrow><annotation encoding="application/x-tex">^{[1]}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.888em;"></span><span class="mord"><span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.888em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">[</span><span class="mord mtight">1</span><span class="mclose mtight">]</span></span></span></span></span></span></span></span></span></span></span></span>。由于时间有限，只能列出一篇主要论文。</p><h3 id="利用点角改进-Delaunay-三角网生长算法">利用点角改进 <em>Delaunay</em> 三角网生长算法</h3><ol><li><p><strong>点角定义</strong></p><p><em>Delaunay</em> 三角网中，任一点的点角为该点所构成的三角形中该点的角度之和。如下图所示，在 <em>Delaunay</em> 三角网中，点 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>P</mi><mn>4</mn></msub></mrow><annotation encoding="application/x-tex">P_4</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">4</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> 所在的三角形有 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="normal">△</mi><msub><mi>P</mi><mn>4</mn></msub><msub><mi>P</mi><mn>6</mn></msub><msub><mi>P</mi><mn>5</mn></msub><mo separator="true">,</mo><mtext> </mtext><mi mathvariant="normal">△</mi><msub><mi>P</mi><mn>4</mn></msub><msub><mi>P</mi><mn>3</mn></msub><msub><mi>P</mi><mn>6</mn></msub><mo separator="true">,</mo><mtext> </mtext><mi mathvariant="normal">△</mi><msub><mi>P</mi><mn>4</mn></msub><msub><mi>P</mi><mn>2</mn></msub><msub><mi>P</mi><mn>3</mn></msub><mo separator="true">,</mo><mtext> </mtext><mi mathvariant="normal">△</mi><msub><mi>P</mi><mn>4</mn></msub><msub><mi>P</mi><mn>1</mn></msub><msub><mi>P</mi><mn>2</mn></msub><mo separator="true">,</mo><mtext> </mtext><mi mathvariant="normal">△</mi><msub><mi>P</mi><mn>4</mn></msub><msub><mi>P</mi><mn>5</mn></msub><msub><mi>P</mi><mn>1</mn></msub></mrow><annotation encoding="application/x-tex">\triangle P_4P_6P_5,\ \triangle P_4P_3P_6,\ \triangle P_4P_2P_3,\ \triangle P_4P_1P_2,\ \triangle P_4P_5P_1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord">△</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">4</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">6</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">5</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace"> </span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">△</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">4</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">6</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace"> </span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">△</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">4</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace"> </span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">△</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">4</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace"> </span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">△</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">4</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">5</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> ，易知 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>P</mi><mn>4</mn></msub></mrow><annotation encoding="application/x-tex">P_4</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">4</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> 的点角为:</p></li></ol><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mtable rowspacing="0.16em" columnspacing="1em"><mtr><mtd class ="mtr-glue"></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mi mathvariant="normal">∠</mi><msub><mi>P</mi><mn>4</mn></msub><mo>=</mo><mi mathvariant="normal">∠</mi><mn>1</mn><mo>+</mo><mi mathvariant="normal">∠</mi><mn>2</mn><mo>+</mo><mi mathvariant="normal">∠</mi><mn>3</mn><mo>+</mo><mi mathvariant="normal">∠</mi><mn>4</mn><mo>+</mo><mi mathvariant="normal">∠</mi><mn>5</mn><mo>=</mo><mn>360</mn><mi mathvariant="normal">°</mi></mrow></mstyle></mtd><mtd class ="mtr-glue"></mtd><mtd class ="mml-eqn-num"></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{equation}   \angle P_4=\angle 1+\angle 2+\angle 3+\angle 4+\angle 5=360°   \end{equation}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.2em;vertical-align:-0.35em;"></span><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.85em;"><span style="top:-3.01em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">∠</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">4</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord">∠1</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord">∠2</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord">∠3</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord">∠4</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord">∠5</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord">360°</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.35em;"><span></span></span></span></span></span></span></span><span class="tag"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.85em;"><span style="top:-2.85em;"><span class="pstrut" style="height:2.84em;"></span><span class="eqn-num"></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.35em;"><span></span></span></span></span></span></span></span></span></p><p>显然，除了 <em>Delaunay</em> 三角网中凸包点（最外层多边形构成的点）外，其他任何点的点角都为 360°。为了保证统一且算法更易实现，规定凸包点的点角也为 360°，如下图中三角网点 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>P</mi><mn>2</mn></msub></mrow><annotation encoding="application/x-tex">P_2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> 的点角为 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="normal">∠</mi><msub><mi>P</mi><mn>2</mn></msub><mo>=</mo><mi mathvariant="normal">∠</mi><mn>6</mn><mo>+</mo><mi mathvariant="normal">∠</mi><mn>7</mn><mo>+</mo><mi mathvariant="normal">∠</mi><mn>8</mn><mo>=</mo><mn>360</mn><mi mathvariant="normal">°</mi></mrow><annotation encoding="application/x-tex">\angle P_2= \angle6+\angle7+\angle8=360°</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8422em;vertical-align:-0.15em;"></span><span class="mord">∠</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.7756em;vertical-align:-0.0833em;"></span><span class="mord">∠6</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.7756em;vertical-align:-0.0833em;"></span><span class="mord">∠7</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6922em;"></span><span class="mord">∠8</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord">360°</span></span></span></span>。如此，在构造 <em>Delaunay</em> 三角形之前需先寻找离散点的凸包，计算边界点的点角。</p><p><img src="https://cdn.zerolacqua.top/images/blogs/TIN%E7%9A%84%E4%B8%89%E7%A7%8D%E6%9E%84%E5%BB%BA%E6%96%B9%E5%BC%8F/1.png" alt="图1"></p><ol start="2"><li><p><strong>计算凸壳</strong></p><p>常规的三角网生长算法不需要计算凸壳，这里主要是为查找凸包点并计算每个凸包点的外角，将其赋值为该点的点角，并为确定初始基线边做准备。</p><p>使用格雷厄姆方法来求点集的凸壳。</p><ul><li><p>设点集中纵坐标最小的点为 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>P</mi><mn>1</mn></msub></mrow><annotation encoding="application/x-tex">P_1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>；</p></li><li><p>将 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>P</mi><mn>1</mn></msub></mrow><annotation encoding="application/x-tex">P_1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> 和点集中其他各点用有向线段连接，并计算这些线段与水平线的夹角；</p></li><li><p>线段按夹角大小排序（夹角相同时，按点到 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>P</mi><mn>1</mn></msub></mrow><annotation encoding="application/x-tex">P_1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> 的距离排序），得到一序列 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>P</mi><mn>1</mn></msub><mtext>，</mtext><msub><mi>P</mi><mn>2</mn></msub><mo separator="true">,</mo><mo>⋯</mo><mtext> </mtext><mo separator="true">,</mo><msub><mi>P</mi><mi>n</mi></msub></mrow><annotation encoding="application/x-tex">P_1，P_2,\cdots,P_n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8778em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord cjk_fallback">，</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="minner">⋯</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> ；</p></li><li><p>依次连接所有点，便得到一多边形。显然，<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>P</mi><mn>1</mn></msub><mtext>，</mtext><msub><mi>P</mi><mn>2</mn></msub><mo separator="true">,</mo><mo>⋯</mo><mtext> </mtext><mo separator="true">,</mo><msub><mi>P</mi><mi>n</mi></msub></mrow><annotation encoding="application/x-tex">P_1，P_2,\cdots,P_n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8778em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord cjk_fallback">，</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="minner">⋯</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> 是凸壳边界上的点（见下图）。依据“凸多边形的各顶点必在该多边形的任意一条边同侧”的原则，删去边界序列中的非凸点，从而得到凸壳点集，并以顺时针连接各凸壳点形成有向凸多边形（见下图）。</p><p><img src="https://cdn.zerolacqua.top/images/blogs/TIN%E7%9A%84%E4%B8%89%E7%A7%8D%E6%9E%84%E5%BB%BA%E6%96%B9%E5%BC%8F/2.png" alt="图2"></p></li></ul></li><li><p><strong>CCW 方位测试</strong></p><p>CCW 方位测试（简称 CCW 检测）主要用来查找符合条件的点构成 <em>Delaunay</em> 三角形，可以判断出点与方向线的相互关系，CCW 方位测试如图下所示。</p><p><img src="https://cdn.zerolacqua.top/images/blogs/TIN%E7%9A%84%E4%B8%89%E7%A7%8D%E6%9E%84%E5%BB%BA%E6%96%B9%E5%BC%8F/3.png" alt="图3"></p></li></ol><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mtable rowspacing="0.16em" columnspacing="1em"><mtr><mtd class ="mtr-glue"></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mi>C</mi><mi>C</mi><mi>W</mi><mo stretchy="false">(</mo><mi>c</mi><mo separator="true">,</mo><mi>a</mi><mo separator="true">,</mo><mi>b</mi><mo stretchy="false">)</mo><mo>=</mo><mrow><mo fence="true">∣</mo><mtable rowspacing="0.16em" columnalign="center center center" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>a</mi><mi>x</mi></msub></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>a</mi><mi>y</mi></msub></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>1</mn></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mtext> </mtext><msub><mi>b</mi><mi>x</mi></msub></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>b</mi><mi>y</mi></msub></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>1</mn></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mtext> </mtext><msub><mi>c</mi><mi>x</mi></msub></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>c</mi><mi>y</mi></msub></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>1</mn></mstyle></mtd></mtr></mtable><mo fence="true">∣</mo></mrow><mo>=</mo><mrow><mo fence="true">∣</mo><mtable rowspacing="0.16em" columnalign="center center" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><msub><mi>a</mi><mi>x</mi></msub><mo>−</mo><msub><mi>c</mi><mi>x</mi></msub></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><msub><mi>a</mi><mi>y</mi></msub><mo>−</mo><msub><mi>c</mi><mi>y</mi></msub></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mtext> </mtext><msub><mi>b</mi><mi>x</mi></msub><mo>−</mo><msub><mi>c</mi><mi>x</mi></msub></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><msub><mi>b</mi><mi>y</mi></msub><mo>−</mo><msub><mi>c</mi><mi>y</mi></msub></mrow></mstyle></mtd></mtr></mtable><mo fence="true">∣</mo></mrow></mrow></mstyle></mtd><mtd class ="mtr-glue"></mtd><mtd class ="mml-eqn-num"></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{equation}   CCW(c,a,b)=   \begin{vmatrix}   a_x&amp;a_y&amp;1 \\\    b_x&amp;b_y&amp;1 \\\    c_x&amp;c_y&amp;1   \end{vmatrix}=   \begin{vmatrix}   a_x-c_x&amp;a_y-c_y \\\    b_x-c_x&amp;b_y-c_y   \end{vmatrix}   \end{equation}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:3.6em;vertical-align:-1.55em;"></span><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-4.05em;"><span class="pstrut" style="height:4.05em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">CC</span><span class="mord mathnormal" style="margin-right:0.13889em;">W</span><span class="mopen">(</span><span class="mord mathnormal">c</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">a</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">b</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="minner"><span class="mopen"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-4.05em;"><span class="pstrut" style="height:5.6em;"></span><span style="width:0.333em;height:3.600em;"><svg xmlns="http://www.w3.org/2000/svg" width='0.333em' height='3.600em' viewBox='0 0 333 3600'><path d='M145 15 v585 v2400 v585 c2.667,10,9.667,15,21,15c10,0,16.667,-5,20,-15 v-585 v-2400 v-585 c-2.667,-10,-9.667,-15,-21,-15c-10,0,-16.667,5,-20,15z M188 15 H145 v585 v2400 v585 h43z'/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em;"><span></span></span></span></span></span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-4.21em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">x</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-3.01em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mspace"> </span><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">x</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-1.81em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mspace"> </span><span class="mord"><span class="mord mathnormal">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">x</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-4.21em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">y</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span></span></span><span style="top:-3.01em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">y</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span></span></span><span style="top:-1.81em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">y</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-4.21em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span><span style="top:-3.01em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span><span style="top:-1.81em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em;"><span></span></span></span></span></span></span></span><span class="mclose"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-4.05em;"><span class="pstrut" style="height:5.6em;"></span><span style="width:0.333em;height:3.600em;"><svg xmlns="http://www.w3.org/2000/svg" width='0.333em' height='3.600em' viewBox='0 0 333 3600'><path d='M145 15 v585 v2400 v585 c2.667,10,9.667,15,21,15c10,0,16.667,-5,20,-15 v-585 v-2400 v-585 c-2.667,-10,-9.667,-15,-21,-15c-10,0,-16.667,5,-20,15z M188 15 H145 v585 v2400 v585 h43z'/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em;"><span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="minner"><span class="mopen"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.45em;"><span style="top:-3.45em;"><span class="pstrut" style="height:4.4em;"></span><span style="width:0.333em;height:2.400em;"><svg xmlns="http://www.w3.org/2000/svg" width='0.333em' height='2.400em' viewBox='0 0 333 2400'><path d='M145 15 v585 v1200 v585 c2.667,10,9.667,15,21,15c10,0,16.667,-5,20,-15 v-585 v-1200 v-585 c-2.667,-10,-9.667,-15,-21,-15c-10,0,-16.667,5,-20,15z M188 15 H145 v585 v1200 v585 h43z'/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.95em;"><span></span></span></span></span></span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.45em;"><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">x</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">x</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-2.41em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mspace"> </span><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">x</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">x</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.95em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.45em;"><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">y</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">y</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span></span></span><span style="top:-2.41em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">y</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">y</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.95em;"><span></span></span></span></span></span></span></span><span class="mclose"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.45em;"><span style="top:-3.45em;"><span class="pstrut" style="height:4.4em;"></span><span style="width:0.333em;height:2.400em;"><svg xmlns="http://www.w3.org/2000/svg" width='0.333em' height='2.400em' viewBox='0 0 333 2400'><path d='M145 15 v585 v1200 v585 c2.667,10,9.667,15,21,15c10,0,16.667,-5,20,-15 v-585 v-1200 v-585 c-2.667,-10,-9.667,-15,-21,-15c-10,0,-16.667,5,-20,15z M188 15 H145 v585 v1200 v585 h43z'/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.95em;"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em;"><span></span></span></span></span></span></span></span><span class="tag"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-4.05em;"><span class="pstrut" style="height:4.05em;"></span><span class="eqn-num"></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em;"><span></span></span></span></span></span></span></span></span></p><p>根据公式 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mn>2</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(2)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord">2</span><span class="mclose">)</span></span></span></span> 计算出来的结果的正负性 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mo>&gt;</mo><mn>0</mn><mo separator="true">,</mo><mtext> </mtext><mo>&lt;</mo><mn>0</mn><mo separator="true">,</mo><mtext> </mtext><mo>=</mo><mn>0</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(&gt;0,\ &lt;0,\ =0)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mrel">&gt;</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8389em;vertical-align:-0.1944em;"></span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace"> </span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">&lt;</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8389em;vertical-align:-0.1944em;"></span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace"> </span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">0</span><span class="mclose">)</span></span></span></span>，可判断出点 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>c</mi></mrow><annotation encoding="application/x-tex">c</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">c</span></span></span></span> 在 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mover accent="true"><mrow><mi>a</mi><mi>b</mi></mrow><mo stretchy="true">→</mo></mover></mrow><annotation encoding="application/x-tex">\overrightarrow{ab}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.2164em;"></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:1.2164em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">ab</span></span></span><span class="svg-align" style="top:-3.6944em;"><span class="pstrut" style="height:3em;"></span><span class="hide-tail" style="height:0.522em;min-width:0.888em;"><svg xmlns="http://www.w3.org/2000/svg" width='400em' height='0.522em' viewBox='0 0 400000 522' preserveAspectRatio='xMaxYMin slice'><path d='M0 241v40h399891c-47.3 35.3-84 78-110 128-16.7 32-27.7 63.7-33 95 0 1.3-.2 2.7-.5 4-.3 1.3-.5 2.3-.5 3 0 7.3 6.7 11 20 11 8 0 13.2-.8 15.5-2.5 2.3-1.7 4.2-5.5 5.5-11.5 2-13.3 5.7-27 11-41 14.7-44.7 39-84.5 73-119.5s73.7-60.2 119-75.5c6-2 9-5.7 9-11s-3-9-9-11c-45.3-15.3-85-40.5-119-75.5s-58.3-74.8-73-119.5c-4.7-14-8.3-27.3-11-40-1.3-6.7-3.2-10.8-5.5-12.5-2.3-1.7-7.5-2.5-15.5-2.5-14 0-21 3.7-21 11 0 2 2 10.3 6 25 20.7 83.3 67 151.7 139 205zm0 0v40h399900v-40z'/></svg></span></span></span></span></span></span></span></span></span> 的左侧、右侧或直线上。</p><p>该论文在构造 <em>Delaunay</em> 三角形时，只有 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mover accent="true"><mrow><mi>a</mi><mi>b</mi></mrow><mo stretchy="true">→</mo></mover></mrow><annotation encoding="application/x-tex">\overrightarrow{ab}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.2164em;"></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:1.2164em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">ab</span></span></span><span class="svg-align" style="top:-3.6944em;"><span class="pstrut" style="height:3em;"></span><span class="hide-tail" style="height:0.522em;min-width:0.888em;"><svg xmlns="http://www.w3.org/2000/svg" width='400em' height='0.522em' viewBox='0 0 400000 522' preserveAspectRatio='xMaxYMin slice'><path d='M0 241v40h399891c-47.3 35.3-84 78-110 128-16.7 32-27.7 63.7-33 95 0 1.3-.2 2.7-.5 4-.3 1.3-.5 2.3-.5 3 0 7.3 6.7 11 20 11 8 0 13.2-.8 15.5-2.5 2.3-1.7 4.2-5.5 5.5-11.5 2-13.3 5.7-27 11-41 14.7-44.7 39-84.5 73-119.5s73.7-60.2 119-75.5c6-2 9-5.7 9-11s-3-9-9-11c-45.3-15.3-85-40.5-119-75.5s-58.3-74.8-73-119.5c-4.7-14-8.3-27.3-11-40-1.3-6.7-3.2-10.8-5.5-12.5-2.3-1.7-7.5-2.5-15.5-2.5-14 0-21 3.7-21 11 0 2 2 10.3 6 25 20.7 83.3 67 151.7 139 205zm0 0v40h399900v-40z'/></svg></span></span></span></span></span></span></span></span></span> 右侧的点才能与 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mover accent="true"><mrow><mi>a</mi><mi>b</mi></mrow><mo stretchy="true">→</mo></mover></mrow><annotation encoding="application/x-tex">\overrightarrow{ab}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.2164em;"></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:1.2164em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">ab</span></span></span><span class="svg-align" style="top:-3.6944em;"><span class="pstrut" style="height:3em;"></span><span class="hide-tail" style="height:0.522em;min-width:0.888em;"><svg xmlns="http://www.w3.org/2000/svg" width='400em' height='0.522em' viewBox='0 0 400000 522' preserveAspectRatio='xMaxYMin slice'><path d='M0 241v40h399891c-47.3 35.3-84 78-110 128-16.7 32-27.7 63.7-33 95 0 1.3-.2 2.7-.5 4-.3 1.3-.5 2.3-.5 3 0 7.3 6.7 11 20 11 8 0 13.2-.8 15.5-2.5 2.3-1.7 4.2-5.5 5.5-11.5 2-13.3 5.7-27 11-41 14.7-44.7 39-84.5 73-119.5s73.7-60.2 119-75.5c6-2 9-5.7 9-11s-3-9-9-11c-45.3-15.3-85-40.5-119-75.5s-58.3-74.8-73-119.5c-4.7-14-8.3-27.3-11-40-1.3-6.7-3.2-10.8-5.5-12.5-2.3-1.7-7.5-2.5-15.5-2.5-14 0-21 3.7-21 11 0 2 2 10.3 6 25 20.7 83.3 67 151.7 139 205zm0 0v40h399900v-40z'/></svg></span></span></span></span></span></span></span></span></span> 构成三角形。</p><ol start="4"><li><p><strong>构建三角网</strong></p><ul><li><p>确定初始基线边，如下图 b 所示，子块的凸壳形成后，以纵坐标最小的点为初始基线边的第一点，从图中易知 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mover accent="true"><mrow><msub><mi>P</mi><mn>1</mn></msub><msub><mi>P</mi><mn>11</mn></msub></mrow><mo stretchy="true">→</mo></mover></mrow><annotation encoding="application/x-tex">\overrightarrow {P_1 P_{11}}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.3553em;vertical-align:-0.15em;"></span><span class="mord accent"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.2053em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">11</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span class="svg-align" style="top:-3.6833em;"><span class="pstrut" style="height:3em;"></span><span class="hide-tail" style="height:0.522em;min-width:0.888em;"><svg xmlns="http://www.w3.org/2000/svg" width='400em' height='0.522em' viewBox='0 0 400000 522' preserveAspectRatio='xMaxYMin slice'><path d='M0 241v40h399891c-47.3 35.3-84 78-110 128-16.7 32-27.7 63.7-33 95 0 1.3-.2 2.7-.5 4-.3 1.3-.5 2.3-.5 3 0 7.3 6.7 11 20 11 8 0 13.2-.8 15.5-2.5 2.3-1.7 4.2-5.5 5.5-11.5 2-13.3 5.7-27 11-41 14.7-44.7 39-84.5 73-119.5s73.7-60.2 119-75.5c6-2 9-5.7 9-11s-3-9-9-11c-45.3-15.3-85-40.5-119-75.5s-58.3-74.8-73-119.5c-4.7-14-8.3-27.3-11-40-1.3-6.7-3.2-10.8-5.5-12.5-2.3-1.7-7.5-2.5-15.5-2.5-14 0-21 3.7-21 11 0 2 2 10.3 6 25 20.7 83.3 67 151.7 139 205zm0 0v40h399900v-40z'/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span> 便是初始基线边，且凸多边形每条有向边都是待扩展的基线边。</p></li><li><p>构建首个三角形，从所有离散点中查找能与 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mover accent="true"><mrow><msub><mi>P</mi><mn>1</mn></msub><msub><mi>P</mi><mn>11</mn></msub></mrow><mo stretchy="true">→</mo></mover></mrow><annotation encoding="application/x-tex">\overrightarrow {P_1 P_{11}}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.3553em;vertical-align:-0.15em;"></span><span class="mord accent"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.2053em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">11</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span class="svg-align" style="top:-3.6833em;"><span class="pstrut" style="height:3em;"></span><span class="hide-tail" style="height:0.522em;min-width:0.888em;"><svg xmlns="http://www.w3.org/2000/svg" width='400em' height='0.522em' viewBox='0 0 400000 522' preserveAspectRatio='xMaxYMin slice'><path d='M0 241v40h399891c-47.3 35.3-84 78-110 128-16.7 32-27.7 63.7-33 95 0 1.3-.2 2.7-.5 4-.3 1.3-.5 2.3-.5 3 0 7.3 6.7 11 20 11 8 0 13.2-.8 15.5-2.5 2.3-1.7 4.2-5.5 5.5-11.5 2-13.3 5.7-27 11-41 14.7-44.7 39-84.5 73-119.5s73.7-60.2 119-75.5c6-2 9-5.7 9-11s-3-9-9-11c-45.3-15.3-85-40.5-119-75.5s-58.3-74.8-73-119.5c-4.7-14-8.3-27.3-11-40-1.3-6.7-3.2-10.8-5.5-12.5-2.3-1.7-7.5-2.5-15.5-2.5-14 0-21 3.7-21 11 0 2 2 10.3 6 25 20.7 83.3 67 151.7 139 205zm0 0v40h399900v-40z'/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span> 构三角形最优的点，形成首个三角形存入 <em>Triangle</em> 中。如下图 b，首个三角形为 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="normal">△</mi><msub><mi>P</mi><mn>1</mn></msub><msub><mi>P</mi><mn>10</mn></msub><msub><mi>P</mi><mn>11</mn></msub></mrow><annotation encoding="application/x-tex">\triangle P_1P_{10}P_{11}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord">△</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">10</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">11</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>，同时，计算该三角形每个点的点角，其中 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>P</mi><mn>10</mn></msub></mrow><annotation encoding="application/x-tex">P_{10}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">10</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> 的点角为 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="normal">∠</mi><msub><mi>P</mi><mn>10</mn></msub><mo>=</mo><mi mathvariant="normal">∠</mi><mn>1</mn></mrow><annotation encoding="application/x-tex">\angle P_{10}= \angle 1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8422em;vertical-align:-0.15em;"></span><span class="mord">∠</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">10</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6922em;"></span><span class="mord">∠1</span></span></span></span>，<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>P</mi><mn>1</mn></msub></mrow><annotation encoding="application/x-tex">P_1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>  的点角为 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="normal">∠</mi><mi>P</mi><mn>1</mn><mo>=</mo><mi mathvariant="normal">∠</mi><mn>2</mn><mo>+</mo><mi mathvariant="normal">∠</mi><mn>3</mn></mrow><annotation encoding="application/x-tex">\angle P1= \angle 2+\angle 3</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6922em;"></span><span class="mord">∠</span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mord">1</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.7756em;vertical-align:-0.0833em;"></span><span class="mord">∠2</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6922em;"></span><span class="mord">∠3</span></span></span></span>，<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>P</mi><mn>11</mn></msub></mrow><annotation encoding="application/x-tex">P_{11}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">11</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>  的点角 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="normal">∠</mi><msub><mi>P</mi><mn>11</mn></msub><mo>=</mo><mi mathvariant="normal">∠</mi><mn>4</mn><mo>+</mo><mi mathvariant="normal">∠</mi><mn>5</mn></mrow><annotation encoding="application/x-tex">\angle P_{11}= \angle 4+\angle 5</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8422em;vertical-align:-0.15em;"></span><span class="mord">∠</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">11</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.7756em;vertical-align:-0.0833em;"></span><span class="mord">∠4</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6922em;"></span><span class="mord">∠5</span></span></span></span>。首个三角形同时也形成了三条有向边，将 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mover accent="true"><mrow><msub><mi>P</mi><mn>1</mn></msub><msub><mi>P</mi><mn>10</mn></msub></mrow><mo stretchy="true">→</mo></mover><mo separator="true">,</mo><mtext> </mtext><mover accent="true"><mrow><msub><mi>P</mi><mn>10</mn></msub><msub><mi>P</mi><mn>11</mn></msub></mrow><mo stretchy="true">→</mo></mover></mrow><annotation encoding="application/x-tex">\overrightarrow {P_{1} P_{10}},\ \overrightarrow {P_{10} P_{11}}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.3998em;vertical-align:-0.1944em;"></span><span class="mord accent"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.2053em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">10</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span class="svg-align" style="top:-3.6833em;"><span class="pstrut" style="height:3em;"></span><span class="hide-tail" style="height:0.522em;min-width:0.888em;"><svg xmlns="http://www.w3.org/2000/svg" width='400em' height='0.522em' viewBox='0 0 400000 522' preserveAspectRatio='xMaxYMin slice'><path d='M0 241v40h399891c-47.3 35.3-84 78-110 128-16.7 32-27.7 63.7-33 95 0 1.3-.2 2.7-.5 4-.3 1.3-.5 2.3-.5 3 0 7.3 6.7 11 20 11 8 0 13.2-.8 15.5-2.5 2.3-1.7 4.2-5.5 5.5-11.5 2-13.3 5.7-27 11-41 14.7-44.7 39-84.5 73-119.5s73.7-60.2 119-75.5c6-2 9-5.7 9-11s-3-9-9-11c-45.3-15.3-85-40.5-119-75.5s-58.3-74.8-73-119.5c-4.7-14-8.3-27.3-11-40-1.3-6.7-3.2-10.8-5.5-12.5-2.3-1.7-7.5-2.5-15.5-2.5-14 0-21 3.7-21 11 0 2 2 10.3 6 25 20.7 83.3 67 151.7 139 205zm0 0v40h399900v-40z'/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace"> </span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord accent"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.2053em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">10</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">11</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span class="svg-align" style="top:-3.6833em;"><span class="pstrut" style="height:3em;"></span><span class="hide-tail" style="height:0.522em;min-width:0.888em;"><svg xmlns="http://www.w3.org/2000/svg" width='400em' height='0.522em' viewBox='0 0 400000 522' preserveAspectRatio='xMaxYMin slice'><path d='M0 241v40h399891c-47.3 35.3-84 78-110 128-16.7 32-27.7 63.7-33 95 0 1.3-.2 2.7-.5 4-.3 1.3-.5 2.3-.5 3 0 7.3 6.7 11 20 11 8 0 13.2-.8 15.5-2.5 2.3-1.7 4.2-5.5 5.5-11.5 2-13.3 5.7-27 11-41 14.7-44.7 39-84.5 73-119.5s73.7-60.2 119-75.5c6-2 9-5.7 9-11s-3-9-9-11c-45.3-15.3-85-40.5-119-75.5s-58.3-74.8-73-119.5c-4.7-14-8.3-27.3-11-40-1.3-6.7-3.2-10.8-5.5-12.5-2.3-1.7-7.5-2.5-15.5-2.5-14 0-21 3.7-21 11 0 2 2 10.3 6 25 20.7 83.3 67 151.7 139 205zm0 0v40h399900v-40z'/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span> 存入 <em>Edge</em>（待扩展基线边）中， <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mover accent="true"><mrow><msub><mi>P</mi><mn>11</mn></msub><msub><mi>P</mi><mn>1</mn></msub></mrow><mo stretchy="true">→</mo></mover></mrow><annotation encoding="application/x-tex">\overrightarrow {P_{11} P_{1}}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.3553em;vertical-align:-0.15em;"></span><span class="mord accent"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.2053em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">11</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span class="svg-align" style="top:-3.6833em;"><span class="pstrut" style="height:3em;"></span><span class="hide-tail" style="height:0.522em;min-width:0.888em;"><svg xmlns="http://www.w3.org/2000/svg" width='400em' height='0.522em' viewBox='0 0 400000 522' preserveAspectRatio='xMaxYMin slice'><path d='M0 241v40h399891c-47.3 35.3-84 78-110 128-16.7 32-27.7 63.7-33 95 0 1.3-.2 2.7-.5 4-.3 1.3-.5 2.3-.5 3 0 7.3 6.7 11 20 11 8 0 13.2-.8 15.5-2.5 2.3-1.7 4.2-5.5 5.5-11.5 2-13.3 5.7-27 11-41 14.7-44.7 39-84.5 73-119.5s73.7-60.2 119-75.5c6-2 9-5.7 9-11s-3-9-9-11c-45.3-15.3-85-40.5-119-75.5s-58.3-74.8-73-119.5c-4.7-14-8.3-27.3-11-40-1.3-6.7-3.2-10.8-5.5-12.5-2.3-1.7-7.5-2.5-15.5-2.5-14 0-21 3.7-21 11 0 2 2 10.3 6 25 20.7 83.3 67 151.7 139 205zm0 0v40h399900v-40z'/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span> 与 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mover accent="true"><mrow><msub><mi>P</mi><mn>1</mn></msub><msub><mi>P</mi><mn>11</mn></msub></mrow><mo stretchy="true">→</mo></mover></mrow><annotation encoding="application/x-tex">\overrightarrow {P_1 P_{11}}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.3553em;vertical-align:-0.15em;"></span><span class="mord accent"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.2053em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">11</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span class="svg-align" style="top:-3.6833em;"><span class="pstrut" style="height:3em;"></span><span class="hide-tail" style="height:0.522em;min-width:0.888em;"><svg xmlns="http://www.w3.org/2000/svg" width='400em' height='0.522em' viewBox='0 0 400000 522' preserveAspectRatio='xMaxYMin slice'><path d='M0 241v40h399891c-47.3 35.3-84 78-110 128-16.7 32-27.7 63.7-33 95 0 1.3-.2 2.7-.5 4-.3 1.3-.5 2.3-.5 3 0 7.3 6.7 11 20 11 8 0 13.2-.8 15.5-2.5 2.3-1.7 4.2-5.5 5.5-11.5 2-13.3 5.7-27 11-41 14.7-44.7 39-84.5 73-119.5s73.7-60.2 119-75.5c6-2 9-5.7 9-11s-3-9-9-11c-45.3-15.3-85-40.5-119-75.5s-58.3-74.8-73-119.5c-4.7-14-8.3-27.3-11-40-1.3-6.7-3.2-10.8-5.5-12.5-2.3-1.7-7.5-2.5-15.5-2.5-14 0-21 3.7-21 11 0 2 2 10.3 6 25 20.7 83.3 67 151.7 139 205zm0 0v40h399900v-40z'/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span> 则不再需要扩展，从 Edge 中删除 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mover accent="true"><mrow><msub><mi>P</mi><mn>1</mn></msub><msub><mi>P</mi><mn>11</mn></msub></mrow><mo stretchy="true">→</mo></mover></mrow><annotation encoding="application/x-tex">\overrightarrow {P_1 P_{11}}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.3553em;vertical-align:-0.15em;"></span><span class="mord accent"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.2053em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">11</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span class="svg-align" style="top:-3.6833em;"><span class="pstrut" style="height:3em;"></span><span class="hide-tail" style="height:0.522em;min-width:0.888em;"><svg xmlns="http://www.w3.org/2000/svg" width='400em' height='0.522em' viewBox='0 0 400000 522' preserveAspectRatio='xMaxYMin slice'><path d='M0 241v40h399891c-47.3 35.3-84 78-110 128-16.7 32-27.7 63.7-33 95 0 1.3-.2 2.7-.5 4-.3 1.3-.5 2.3-.5 3 0 7.3 6.7 11 20 11 8 0 13.2-.8 15.5-2.5 2.3-1.7 4.2-5.5 5.5-11.5 2-13.3 5.7-27 11-41 14.7-44.7 39-84.5 73-119.5s73.7-60.2 119-75.5c6-2 9-5.7 9-11s-3-9-9-11c-45.3-15.3-85-40.5-119-75.5s-58.3-74.8-73-119.5c-4.7-14-8.3-27.3-11-40-1.3-6.7-3.2-10.8-5.5-12.5-2.3-1.7-7.5-2.5-15.5-2.5-14 0-21 3.7-21 11 0 2 2 10.3 6 25 20.7 83.3 67 151.7 139 205zm0 0v40h399900v-40z'/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span> 的记录（ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mover accent="true"><mrow><msub><mi>P</mi><mn>11</mn></msub><msub><mi>P</mi><mn>1</mn></msub></mrow><mo stretchy="true">→</mo></mover></mrow><annotation encoding="application/x-tex">\overrightarrow {P_{11} P_{1}}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.3553em;vertical-align:-0.15em;"></span><span class="mord accent"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.2053em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">11</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span class="svg-align" style="top:-3.6833em;"><span class="pstrut" style="height:3em;"></span><span class="hide-tail" style="height:0.522em;min-width:0.888em;"><svg xmlns="http://www.w3.org/2000/svg" width='400em' height='0.522em' viewBox='0 0 400000 522' preserveAspectRatio='xMaxYMin slice'><path d='M0 241v40h399891c-47.3 35.3-84 78-110 128-16.7 32-27.7 63.7-33 95 0 1.3-.2 2.7-.5 4-.3 1.3-.5 2.3-.5 3 0 7.3 6.7 11 20 11 8 0 13.2-.8 15.5-2.5 2.3-1.7 4.2-5.5 5.5-11.5 2-13.3 5.7-27 11-41 14.7-44.7 39-84.5 73-119.5s73.7-60.2 119-75.5c6-2 9-5.7 9-11s-3-9-9-11c-45.3-15.3-85-40.5-119-75.5s-58.3-74.8-73-119.5c-4.7-14-8.3-27.3-11-40-1.3-6.7-3.2-10.8-5.5-12.5-2.3-1.7-7.5-2.5-15.5-2.5-14 0-21 3.7-21 11 0 2 2 10.3 6 25 20.7 83.3 67 151.7 139 205zm0 0v40h399900v-40z'/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span> 直接不需存）。</p></li><li><p>扩展三角网，按顺序从 <em>Edge</em>（待扩展基线边）中取出一条边，从点角不为360°的点集中查找最优点构建 <em>Delaunay</em> 三角形。每扩展一个三角形，需要从 <em>Edge</em> 中删除该有向边，同时计算三个角的点角，生成两条新的有向边。判断 <em>Edge</em> 中有无与新生成的边方向相反且点相同的边，若有，则从 <em>Edge</em> 中删除该边，否则存入新生成的有向边。当 <em>Edge</em> 中无元素时子三角网构建完成，此时点集中所有点的点角为360°。</p><p><img src="https://cdn.zerolacqua.top/images/blogs/TIN%E7%9A%84%E4%B8%89%E7%A7%8D%E6%9E%84%E5%BB%BA%E6%96%B9%E5%BC%8F/4.png" alt="图4"></p></li></ul></li></ol><h3 id="个人看法">个人看法</h3><p>在另一个生长算法的论文<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mrow></mrow><mrow><mo stretchy="false">[</mo><mn>3</mn><mo stretchy="false">]</mo></mrow></msup></mrow><annotation encoding="application/x-tex">^{[3]}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.888em;"></span><span class="mord"><span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.888em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">[</span><span class="mord mtight">3</span><span class="mclose mtight">]</span></span></span></span></span></span></span></span></span></span></span></span>中提到了几个概念，与上述论文有一定相通之处。</p><p><strong>排除封闭点</strong></p><p>在寻找第三点构网的过程中会不断产生封闭点。以 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><mn>1</mn></mrow><annotation encoding="application/x-tex">P1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mord">1</span></span></span></span> 为起始点经过3次遍历后的结果如下图所示，此时点 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><mn>3</mn></mrow><annotation encoding="application/x-tex">P3</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mord">3</span></span></span></span> 已被三角形所包围，称之为封闭点。封闭点将不再参与下一次遍历边集寻找第三点的过程，因此第 4 次遍历前可将点 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><mn>3</mn></mrow><annotation encoding="application/x-tex">P3</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mord">3</span></span></span></span> 从备选点集中移除。通过动态地排除封闭点，可将第三点的备选范围不断缩小，以减少寻点时间。</p><p><img src="https://cdn.zerolacqua.top/images/blogs/TIN%E7%9A%84%E4%B8%89%E7%A7%8D%E6%9E%84%E5%BB%BA%E6%96%B9%E5%BC%8F/5.png" alt="图5"></p><p>这里的<strong>封闭点</strong>，其实和<strong>点角</strong>的概念相近，只不过<strong>点角</strong>是<strong>封闭点</strong>一个具体判断方法。</p><p>由于以前参加编程小组学习建TIN的时候，就是顺着相似的思路写了一个简陋的算法，看到<strong>点角</strong>就有种亲切感，所以生长算法篇幅就比较多。</p><h2 id="逐点插入法">逐点插入法</h2><p>逐点插入法的基本步骤<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mrow></mrow><mrow><mo stretchy="false">[</mo><mn>1</mn><mo stretchy="false">]</mo></mrow></msup></mrow><annotation encoding="application/x-tex">^{[1]}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.888em;"></span><span class="mord"><span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.888em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">[</span><span class="mord mtight">1</span><span class="mclose mtight">]</span></span></span></span></span></span></span></span></span></span></span></span>：</p><ul><li>定义一个包含所有数据点的初始多边形；</li><li>在初始多边形中建立初始三角网，然后迭代以下步骤，直至所有数据点都被处理；</li><li>插入一个数据点 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi></mrow><annotation encoding="application/x-tex">P</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span></span></span></span> ，在三角网中找出包含 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi></mrow><annotation encoding="application/x-tex">P</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span></span></span></span> 的三角形 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi></mrow><annotation encoding="application/x-tex">t</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6151em;"></span><span class="mord mathnormal">t</span></span></span></span> ，把 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi></mrow><annotation encoding="application/x-tex">P</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span></span></span></span> 与 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi></mrow><annotation encoding="application/x-tex">t</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6151em;"></span><span class="mord mathnormal">t</span></span></span></span> 的三个顶点相连，生成三个新的三角形；</li><li>用 <em>LOP</em> 算法优化三角网。</li></ul><p>可以看出，逐点插入算法的思路非常简单，先在包含所有数据点的一个多边形中建立初始三角网，然后将余下的点逐一插入，用 <em>LOP</em> 算法确保其成为 <em>Delaunay</em> 三角网。各种实现方法的差别在于其初始多边形的不同以及建立初始三角网的方法不同。</p><h3 id="一种改进的-Delaunay-三角剖分快速实现算法">一种改进的 <em>Delaunay</em> 三角剖分快速实现算法</h3><p>对以往提出的逐点插入算法的研究发现，影响逐点插入法时间效率的主要因素为点的插入次序。针对这一特点，对逐点插入法进行改进。</p><ol><li><p>基本概念</p><ul><li><p>极大三角形</p><p>在平面内，加入三个点形成一个三角形，使其能够包含点集中的所有点。这个极大三角形就作为三角剖分的辅助初始三角形。</p></li><li><p>影响域</p><p>对每个插入点，外接圆包含该点的所有三角形所构成的多边形区域称为该点的影响域。</p></li></ul></li><li><p>数据结构</p><p>算法的执行效率与数据结构之间有着很密切的关系。该论文中使用的数据结构简要列出如下：</p><ul><li><p>有序顶点类</p><p>保存散乱点集和<strong>排序</strong>后的顶点序列。</p></li><li><p>有向边类</p><p>保存三角形的边以及与该边相邻的三角形信息。</p></li><li><p>三角形类</p></li><li><p>保存生成的各个三角形的顶点及边信息</p></li></ul></li><li><p>算法的主要步骤</p><ul><li><p>将点集中的点在平面内以 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>X</mi></mrow><annotation encoding="application/x-tex">X</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.07847em;">X</span></span></span></span> 轴为主，<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Y</mi></mrow><annotation encoding="application/x-tex">Y</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.22222em;">Y</span></span></span></span> 轴为辅进行升序排序；</p></li><li><p>虚构一个极大三角形成为最初的三角形，使其包含点集中的所有点；</p></li><li><p>插入第一个点，这个点肯定在初始三角形内，连接这个点和极大三角形的各个顶点，形成最初的三角网；</p></li><li><p>依次插入排好序的点到已生成的三角网中，对插入点找到该点的影响域，连接该插入点和它影响域的各个顶点，即重构了 <em>Delaunay</em> 三角网；</p></li><li><p>删除所有以极大三角形顶点为顶点的三角形，即多余三角形，最后得到的三角网就是所求的 <em>Delaunay</em> 三角网。</p></li></ul></li><li><p>新插入一个顶点的过程</p><ul><li>在已存在的 <em>Delaunay</em> 内新插入一个点，首先定位该点所在的三角形，由于<strong>对点集中的所有点进行了有序化</strong>，所有定位三角形时不像传统方法那样需要遍历当前所有三角形；</li><li>其次找出有哪些三角形的<strong>外接圆包含该插入点</strong>，即确定出该点的影响域，删除影响域内的三角形，形成一个空腔，连接新插入点与空腔的各个顶点，形成多个三角形；</li><li>最后把新生成的三角形放回三角网中。</li></ul></li></ol><h3 id="个人看法-2">个人看法</h3><ol><li>在上述论文的描述中，虽然并没有明确地使用 <em>LOP</em> 算法。但是个人认为实际上在<strong>新插入一个顶点的过程</strong>中，“寻找外接圆包含插入点的三角形，并删去这些三角形，再连接新插入点”的操作，就等效于使用了 <em>LOP</em> 算法。</li><li>无论是在生长算法，还是逐点插入法中，排序都是很重要的一种优化思路，如论文 [3,4] 都提到了排序的必要性。并且能连接成三角形的点基本上距离很近。结合无人机摄影中学到的 <em>KD</em>-树的概念，我们是否能采用类似的树结构进行优化呢？在论文 [5] 中也确实有四叉树划分点云数据文件进行并行计算动态调度的思路。</li></ol><h2 id="分割-合并算法">分割-合并算法</h2><p>将分治算法思想应用于生成 <em>Delaunay</em> 三角网，递归地分割点集，直至子集中只包含三个点而形成三角形，然后自下而上地逐级合并生成最终的三角网。其基本步骤如下<sup>[1]</sup>：</p><ul><li>把点集 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>V</mi></mrow><annotation encoding="application/x-tex">V</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.22222em;">V</span></span></span></span> 以横坐标为主，纵坐标为辅按升序排序，然后递归地执行以下步骤；</li><li>把点集 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>V</mi></mrow><annotation encoding="application/x-tex">V</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.22222em;">V</span></span></span></span> 分为近似相等的两个子集 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>V</mi><mi>L</mi></msub></mrow><annotation encoding="application/x-tex">V_L</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.2222em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">L</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> 和 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>V</mi><mi>R</mi></msub></mrow><annotation encoding="application/x-tex">V_R</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.2222em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.00773em;">R</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> ；</li><li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>V</mi><mi>L</mi></msub></mrow><annotation encoding="application/x-tex">V_L</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.2222em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">L</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> 和 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>V</mi><mi>R</mi></msub></mrow><annotation encoding="application/x-tex">V_R</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.2222em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.00773em;">R</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> 中生成三角网；</li><li>用 <em>LOP</em> 算法优化所生成的三角网，使之成为 <em>Delaunay</em> 三角网；</li><li>找出连接 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>V</mi><mi>L</mi></msub></mrow><annotation encoding="application/x-tex">V_L</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.2222em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">L</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> 和 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>V</mi><mi>R</mi></msub></mrow><annotation encoding="application/x-tex">V_R</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.2222em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.00773em;">R</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> 中两个凸壳的底线和顶线；</li><li>由底线至顶线合并  <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>V</mi><mi>L</mi></msub></mrow><annotation encoding="application/x-tex">V_L</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.2222em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">L</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> 和 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>V</mi><mi>R</mi></msub></mrow><annotation encoding="application/x-tex">V_R</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.2222em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.00773em;">R</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> 中两个三角网。</li></ul><p>以上步骤显示，这种算法的基本思路是使问题简化，把点集划分到足够小，使其易于生成三角网，然后把子集中的三角网合并生成最终的三角网，用 <em>LOP</em> 算法保证其成为 <em>Delaunay</em> 三角网。</p><h3 id="Delaunay-三角网的生成算法研究"><em>Delaunay</em> 三角网的生成算法研究</h3><ol><li><p>其基本步骤为：</p><ul><li><p>把点集 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>V</mi></mrow><annotation encoding="application/x-tex">V</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.22222em;">V</span></span></span></span> 以横坐标为主，纵坐标为辅按升序排序，然后递归地执行以下步骤；</p></li><li><p>若 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>V</mi></mrow><annotation encoding="application/x-tex">V</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.22222em;">V</span></span></span></span> 中数据量大于一给定值，把 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>V</mi></mrow><annotation encoding="application/x-tex">V</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.22222em;">V</span></span></span></span> 分为近似相等的两个子集 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>V</mi><mi>L</mi></msub></mrow><annotation encoding="application/x-tex">V_L</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.2222em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">L</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> 和 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>V</mi><mi>R</mi></msub></mrow><annotation encoding="application/x-tex">V_R</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.2222em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.00773em;">R</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> ；</p></li><li><p>在 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>V</mi><mi>L</mi></msub></mrow><annotation encoding="application/x-tex">V_L</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.2222em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">L</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> 和 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>V</mi><mi>R</mi></msub></mrow><annotation encoding="application/x-tex">V_R</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.2222em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.00773em;">R</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> 中用合成算法生成三角网；</p></li><li><p>找出连接 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>V</mi><mi>L</mi></msub></mrow><annotation encoding="application/x-tex">V_L</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.2222em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">L</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> 和 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>V</mi><mi>R</mi></msub></mrow><annotation encoding="application/x-tex">V_R</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.2222em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.00773em;">R</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> 中两个凸壳的底线和顶线；</p></li><li><p>由底线至顶线合并 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>V</mi><mi>L</mi></msub></mrow><annotation encoding="application/x-tex">V_L</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.2222em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">L</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> 和 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>V</mi><mi>R</mi></msub></mrow><annotation encoding="application/x-tex">V_R</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.2222em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.00773em;">R</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> 中两个三角网</p></li><li><p>否则生成基本三角网</p></li></ul></li><li><p>基本三角网生成过程</p><ul><li><p>生成凸壳过程</p><p>使用 <em>Larkin</em> 改进和完善了的凸壳生成算法。</p><p>把具有 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi><mo separator="true">,</mo><mi>y</mi><mo separator="true">,</mo><mi>x</mi><mo>+</mo><mi>y</mi><mo separator="true">,</mo><mi>x</mi><mo>−</mo><mi>y</mi></mrow><annotation encoding="application/x-tex">x,y,x+y,x-y</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7778em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">x</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">x</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.7778em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">x</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span></span></span></span> 的极大值和极小值的点相连作为初始凸壳，然后用一个递归过程 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>c</mi><mi>o</mi><mi>n</mi><mi>v</mi><mi>e</mi><mi>x</mi><mo stretchy="false">(</mo><mi>I</mi><mo separator="true">,</mo><mi>J</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">convex(I,J)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">co</span><span class="mord mathnormal">n</span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="mord mathnormal">e</span><span class="mord mathnormal">x</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.07847em;">I</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.09618em;">J</span><span class="mclose">)</span></span></span></span> 把位于其中相邻两点间凸壳上的其余点找出来。为提高搜索效率，先把数据分块。 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>c</mi><mi>o</mi><mi>n</mi><mi>v</mi><mi>e</mi><mi>x</mi><mo stretchy="false">(</mo><mi>I</mi><mo separator="true">,</mo><mi>J</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">convex(I,J)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">co</span><span class="mord mathnormal">n</span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="mord mathnormal">e</span><span class="mord mathnormal">x</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.07847em;">I</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.09618em;">J</span><span class="mclose">)</span></span></span></span> 搜索包含线段 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mover accent="true"><mrow><mi>I</mi><mi>J</mi></mrow><mo stretchy="true">→</mo></mover></mrow><annotation encoding="application/x-tex">\overrightarrow{IJ}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.2053em;"></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:1.2053em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07847em;">I</span><span class="mord mathnormal" style="margin-right:0.09618em;">J</span></span></span><span class="svg-align" style="top:-3.6833em;"><span class="pstrut" style="height:3em;"></span><span class="hide-tail" style="height:0.522em;min-width:0.888em;"><svg xmlns="http://www.w3.org/2000/svg" width='400em' height='0.522em' viewBox='0 0 400000 522' preserveAspectRatio='xMaxYMin slice'><path d='M0 241v40h399891c-47.3 35.3-84 78-110 128-16.7 32-27.7 63.7-33 95 0 1.3-.2 2.7-.5 4-.3 1.3-.5 2.3-.5 3 0 7.3 6.7 11 20 11 8 0 13.2-.8 15.5-2.5 2.3-1.7 4.2-5.5 5.5-11.5 2-13.3 5.7-27 11-41 14.7-44.7 39-84.5 73-119.5s73.7-60.2 119-75.5c6-2 9-5.7 9-11s-3-9-9-11c-45.3-15.3-85-40.5-119-75.5s-58.3-74.8-73-119.5c-4.7-14-8.3-27.3-11-40-1.3-6.7-3.2-10.8-5.5-12.5-2.3-1.7-7.5-2.5-15.5-2.5-14 0-21 3.7-21 11 0 2 2 10.3 6 25 20.7 83.3 67 151.7 139 205zm0 0v40h399900v-40z'/></svg></span></span></span></span></span></span></span></span></span> （从 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>I</mi></mrow><annotation encoding="application/x-tex">I</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.07847em;">I</span></span></span></span> 到 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>J</mi></mrow><annotation encoding="application/x-tex">J</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.09618em;">J</span></span></span></span> 逆时针方向）的矩形内的数据块。找出位于 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mover accent="true"><mrow><mi>I</mi><mi>J</mi></mrow><mo stretchy="true">→</mo></mover></mrow><annotation encoding="application/x-tex">\overrightarrow{IJ}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.2053em;"></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:1.2053em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07847em;">I</span><span class="mord mathnormal" style="margin-right:0.09618em;">J</span></span></span><span class="svg-align" style="top:-3.6833em;"><span class="pstrut" style="height:3em;"></span><span class="hide-tail" style="height:0.522em;min-width:0.888em;"><svg xmlns="http://www.w3.org/2000/svg" width='400em' height='0.522em' viewBox='0 0 400000 522' preserveAspectRatio='xMaxYMin slice'><path d='M0 241v40h399891c-47.3 35.3-84 78-110 128-16.7 32-27.7 63.7-33 95 0 1.3-.2 2.7-.5 4-.3 1.3-.5 2.3-.5 3 0 7.3 6.7 11 20 11 8 0 13.2-.8 15.5-2.5 2.3-1.7 4.2-5.5 5.5-11.5 2-13.3 5.7-27 11-41 14.7-44.7 39-84.5 73-119.5s73.7-60.2 119-75.5c6-2 9-5.7 9-11s-3-9-9-11c-45.3-15.3-85-40.5-119-75.5s-58.3-74.8-73-119.5c-4.7-14-8.3-27.3-11-40-1.3-6.7-3.2-10.8-5.5-12.5-2.3-1.7-7.5-2.5-15.5-2.5-14 0-21 3.7-21 11 0 2 2 10.3 6 25 20.7 83.3 67 151.7 139 205zm0 0v40h399900v-40z'/></svg></span></span></span></span></span></span></span></span></span> 右侧与 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mover accent="true"><mrow><mi>I</mi><mi>J</mi></mrow><mo stretchy="true">→</mo></mover></mrow><annotation encoding="application/x-tex">\overrightarrow{IJ}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.2053em;"></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:1.2053em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07847em;">I</span><span class="mord mathnormal" style="margin-right:0.09618em;">J</span></span></span><span class="svg-align" style="top:-3.6833em;"><span class="pstrut" style="height:3em;"></span><span class="hide-tail" style="height:0.522em;min-width:0.888em;"><svg xmlns="http://www.w3.org/2000/svg" width='400em' height='0.522em' viewBox='0 0 400000 522' preserveAspectRatio='xMaxYMin slice'><path d='M0 241v40h399891c-47.3 35.3-84 78-110 128-16.7 32-27.7 63.7-33 95 0 1.3-.2 2.7-.5 4-.3 1.3-.5 2.3-.5 3 0 7.3 6.7 11 20 11 8 0 13.2-.8 15.5-2.5 2.3-1.7 4.2-5.5 5.5-11.5 2-13.3 5.7-27 11-41 14.7-44.7 39-84.5 73-119.5s73.7-60.2 119-75.5c6-2 9-5.7 9-11s-3-9-9-11c-45.3-15.3-85-40.5-119-75.5s-58.3-74.8-73-119.5c-4.7-14-8.3-27.3-11-40-1.3-6.7-3.2-10.8-5.5-12.5-2.3-1.7-7.5-2.5-15.5-2.5-14 0-21 3.7-21 11 0 2 2 10.3 6 25 20.7 83.3 67 151.7 139 205zm0 0v40h399900v-40z'/></svg></span></span></span></span></span></span></span></span></span> 距离最大的点。该点就是要找的凸壳上的点。如果最大距离为零，则要判断它是否位于 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>I</mi><mo separator="true">,</mo><mi>J</mi></mrow><annotation encoding="application/x-tex">I,J</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8778em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.07847em;">I</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.09618em;">J</span></span></span></span> 之间。如是，它也是凸壳上的点。</p></li><li><p>初始三角网生成过程</p></li><li><p>点插入过程</p></li><li><p>局部优化过程（<em>LOP</em>）</p><p>局部优化过程（<em>LOP</em>）是所有生成 <em>Delaunay</em> 三角网的算法都要用到的关键过程。理论上说，不论用何种方法生成的三角网，只要用 <em>LOP</em> 过程进行处理，就能使它变为 <em>Delaunay</em> 三角网。这样一个重要的过程其实非常简单，它就是运用 <em>Delaunay</em> 三角网的性质，对由两个有公共边的三角形组成的四边形进行判断。如果其中一个三角形的外接圆包含第四个顶点，则将这个四边形的对角线交换。</p><p><img src="https://cdn.zerolacqua.top/images/blogs/TIN%E7%9A%84%E4%B8%89%E7%A7%8D%E6%9E%84%E5%BB%BA%E6%96%B9%E5%BC%8F/6.png" alt="图6"></p></li></ul></li><li><p>寻找连接两个凸壳的底线过程</p><p>分治算法分两步进行，首先找出连接左右两个凸外界的顶线和底线，然后由底至顶合并两个子三角网。这两个过程都要用到函数 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi><mi>r</mi><mi>e</mi><mi>d</mi><mo stretchy="false">(</mo><msub><mi>v</mi><mi>i</mi></msub><mo separator="true">,</mo><msub><mi>v</mi><mi>j</mi></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">pred(v_i,v_j)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0361em;vertical-align:-0.2861em;"></span><span class="mord mathnormal">p</span><span class="mord mathnormal">re</span><span class="mord mathnormal">d</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span> 和 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi><mi>u</mi><mi>c</mi><mi>c</mi><mo stretchy="false">(</mo><msub><mi>v</mi><mi>i</mi></msub><mo separator="true">,</mo><msub><mi>v</mi><mi>j</mi></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">succ(v_i,v_j)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0361em;vertical-align:-0.2861em;"></span><span class="mord mathnormal">s</span><span class="mord mathnormal">u</span><span class="mord mathnormal">cc</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span> 。函数 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi><mi>r</mi><mi>e</mi><mi>d</mi><mo stretchy="false">(</mo><msub><mi>v</mi><mi>i</mi></msub><mo separator="true">,</mo><msub><mi>v</mi><mi>j</mi></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">pred(v_i,v_j)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0361em;vertical-align:-0.2861em;"></span><span class="mord mathnormal">p</span><span class="mord mathnormal">re</span><span class="mord mathnormal">d</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span> 找出在以 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>v</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">v_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> 为共同端点的一簇线段中，与 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>v</mi><mi>i</mi></msub><msub><mi>v</mi><mi>j</mi></msub></mrow><annotation encoding="application/x-tex">v_iv_j</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7167em;vertical-align:-0.2861em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span></span></span></span> 顺时针方向相邻线段的另一端点，<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi><mi>u</mi><mi>c</mi><mi>c</mi><mo stretchy="false">(</mo><msub><mi>v</mi><mi>i</mi></msub><mo separator="true">,</mo><msub><mi>v</mi><mi>j</mi></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">succ(v_i,v_j)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0361em;vertical-align:-0.2861em;"></span><span class="mord mathnormal">s</span><span class="mord mathnormal">u</span><span class="mord mathnormal">cc</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span> 找出与 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>v</mi><mi>i</mi></msub><msub><mi>v</mi><mi>j</mi></msub></mrow><annotation encoding="application/x-tex">v_iv_j</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7167em;vertical-align:-0.2861em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span></span></span></span> 逆时针方向相邻线段的另一端点。</p><p>通过这两个函数，可以找到连接 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>H</mi><mi>L</mi></msub><mo separator="true">,</mo><msub><mi>H</mi><mi>R</mi></msub></mrow><annotation encoding="application/x-tex">H_L,H_R</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8778em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.08125em;">H</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.0813em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">L</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.08125em;">H</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.0813em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.00773em;">R</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> 两个凸壳的底线和顶线。</p></li><li><p>子三角网归并过程</p><p>子三角网的合并过程也是一个迭代过程，它从连接 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>H</mi><mi>L</mi></msub><mo separator="true">,</mo><msub><mi>H</mi><mi>R</mi></msub></mrow><annotation encoding="application/x-tex">H_L,H_R</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8778em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.08125em;">H</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.0813em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">L</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.08125em;">H</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.0813em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.00773em;">R</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> 的底线开始，在两个子三角网 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>T</mi><mi>L</mi></msub><mo separator="true">,</mo><msub><mi>T</mi><mi>R</mi></msub></mrow><annotation encoding="application/x-tex">T_L,T_R</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8778em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">L</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.00773em;">R</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> 中寻找与底线组成 <em>Delaunay</em> 三角形的第三点 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>L</mi><mn>1</mn></msub><mo separator="true">,</mo><msub><mi>R</mi><mn>1</mn></msub></mrow><annotation encoding="application/x-tex">L_1,R_1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8778em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal">L</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.00773em;">R</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0077em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> ，选其中外接圆半径小的一个插入到最最终的三角网中。新生成的连接左右两个子三角网的边成为新的底线，逐步上推直到顶线结束，如下图所示。</p><p><img src="https://cdn.zerolacqua.top/images/blogs/TIN%E7%9A%84%E4%B8%89%E7%A7%8D%E6%9E%84%E5%BB%BA%E6%96%B9%E5%BC%8F/7.png" alt="图7"></p></li></ol><h3 id="个人看法-3">个人看法</h3><p>逐点插入算法实现比较简单，占用内存较小，但它的时间复杂度高；分治算法时间复杂度方面最好，但由于递归执行，内存占用大。为了均衡各种算法的不足，有不少新算法都是围绕着将多种算法融合的思路提出的，如论文 [6,7]，以及上面提到的论文 [1] 。</p><hr><h2 id="视频推荐">视频推荐</h2><p>一个关于Graham算法的参考视频</p><ul><li><a href="https://www.bilibili.com/video/BV1v741197YM">[计算几何] Graham算法构造凸包（重制）</a></li></ul><p>一个逐点插入法的参考视频（和上面那个视频是同一个作者！）。讲得还不错，可以去看看！里面还提到了 <em>CCW</em> 方位测试</p><ul><li><a href="https://www.bilibili.com/video/BV1Ck4y1z7VT">[计算几何] 随机增量法构造德劳内三角网</a></li></ul><h2 id="参考文献">参考文献</h2><p>[1]武晓波, 王世新, 肖春生. Delaunay三角网的生成算法研究[J]. 测绘学报, 1999, 28(1):28-35.</p><p>[2]李建平,徐猛.利用点角改进Delaunay三角网生长算法[J].地理空间信息,2018,16(02):82-84+12.</p><p>[3]韦云舰,卢中.Delaunay三角网生长法的优化与应用[J].地理空间信息,2021,19(05):101-103+119+6.</p><p>[4]宋晓宇,王守金,王永会. 一种改进的Delaunay三角剖分快速实现算法[C]//.2008’中国信息技术与应用学术论坛论文集（二）.,2008:129-131.</p><p>[5]LI Jian, LI Deren, SHAO Zhenfeng. A Streaming Data Delaunay Triangulation Algorithm Based on Parallel Computing[J]. Geomatics and Information Science of Wuhan University, 2013, 38(7): 794-798.</p><p>[6]芮一康,王结臣.Delaunay三角形构网的分治扫描线算法[J].测绘学报,2007(03):358-362.</p><p>[7]刘云,夏兴东,黄北生.基于分治算法与逐点插入法的Delaunay三角网建立算法的改进[J].现代测绘,2010,33(04):14-16.</p>]]></content>
      
      
      <categories>
          
          <category> 课程学习 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 摄影测量 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>数字摄影测量编程与实习</title>
      <link href="/posts/4ee41539.html"/>
      <url>/posts/4ee41539.html</url>
      
        <content type="html"><![CDATA[<h2 id="前言-15">前言</h2><p>又是编程作业。</p><blockquote><p>工程文件请见：<a href="/resources#%E5%B7%A5%E7%A8%8B%E4%BB%A3%E7%A0%81">数字摄影测量</a></p></blockquote><h2 id="影像匹配">影像匹配</h2><blockquote><p>相关系数+最小二乘匹配</p></blockquote><h3 id="Mat相关知识">Mat相关知识</h3><ul><li>行列与坐标的对应关系，经常容易混</li></ul><p><code>opencv</code>影像矩阵<code>Mat</code>的<code>rows</code>对应<code>y</code>方向，<code>cols</code>对应<code>x</code>方向。</p><p>构造<code>Mat</code>时，<code>rows</code>在前，<code>cols</code>在后：</p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="built_in">Mat</span>(<span class="type">int</span> rows, <span class="type">int</span> cols, <span class="type">int</span> type);</span><br></pre></td></tr></table></figure><p>使用<code>Mat::at&lt;_Tp&gt;</code>时，<code>rows</code>在前，<code>cols</code>在后：</p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line">intereMat.<span class="built_in">at</span>&lt;<span class="type">int</span>&gt;(row, col);<span class="comment">//也就是(y,x)</span></span><br></pre></td></tr></table></figure><p>使用坐标时，顺序是正常的：</p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line">Point2f point=<span class="built_in">Point2f</span>(x,y);</span><br></pre></td></tr></table></figure><ul><li><p>数据类型</p><table><thead><tr><th>变量类型</th><th>大小</th><th>范围</th><th>Mat中对应的数据类型</th></tr></thead><tbody><tr><td>uchar</td><td>8bits</td><td>0~255</td><td>CV_8U</td></tr><tr><td>char</td><td>8bits</td><td>-128~127</td><td>CV_8S</td></tr><tr><td>ushort</td><td>16bits</td><td>0~65535</td><td>CV_16U</td></tr><tr><td>short int</td><td>16bits</td><td>-32768~32767</td><td>CV_16S</td></tr><tr><td>int</td><td>32bits</td><td>-2147483648~2147483647</td><td>CV_32S</td></tr><tr><td>float</td><td>32bits</td><td>1.18e-38~3.40e38</td><td>CV_32F</td></tr><tr><td>double</td><td>64bits</td><td>2.23e-308~1.79e308</td><td>CV_64F</td></tr></tbody></table><p>表格不全，但基本上可以看出类型的规律，数据类型以<code>CV_</code>+<code>位数</code>+<code>有无符号</code>(+<code>波段数</code>)组成。使用<code>Mat::at&lt;_Tp&gt;</code>时变量类型要与Mat的数据类型对应。</p><p>在数据类型后加上<code>C1</code>，<code>C2</code>，<code>C3</code>，可以指明<code>Mat</code>存储数据的波段数，此时变量类型使用对应的向量类型，源码如下。</p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">typedef</span> Vec&lt;uchar, <span class="number">2</span>&gt; Vec2b;</span><br><span class="line"><span class="keyword">typedef</span> Vec&lt;uchar, <span class="number">3</span>&gt; Vec3b;</span><br><span class="line"><span class="keyword">typedef</span> Vec&lt;uchar, <span class="number">4</span>&gt; Vec4b;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> Vec&lt;<span class="type">short</span>, <span class="number">2</span>&gt; Vec2s;</span><br><span class="line"><span class="keyword">typedef</span> Vec&lt;<span class="type">short</span>, <span class="number">3</span>&gt; Vec3s;</span><br><span class="line"><span class="keyword">typedef</span> Vec&lt;<span class="type">short</span>, <span class="number">4</span>&gt; Vec4s;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> Vec&lt;ushort, <span class="number">2</span>&gt; Vec2w;</span><br><span class="line"><span class="keyword">typedef</span> Vec&lt;ushort, <span class="number">3</span>&gt; Vec3w;</span><br><span class="line"><span class="keyword">typedef</span> Vec&lt;ushort, <span class="number">4</span>&gt; Vec4w;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> Vec&lt;<span class="type">int</span>, <span class="number">2</span>&gt; Vec2i;</span><br><span class="line"><span class="keyword">typedef</span> Vec&lt;<span class="type">int</span>, <span class="number">3</span>&gt; Vec3i;</span><br><span class="line"><span class="keyword">typedef</span> Vec&lt;<span class="type">int</span>, <span class="number">4</span>&gt; Vec4i;</span><br><span class="line"><span class="keyword">typedef</span> Vec&lt;<span class="type">int</span>, <span class="number">6</span>&gt; Vec6i;</span><br><span class="line"><span class="keyword">typedef</span> Vec&lt;<span class="type">int</span>, <span class="number">8</span>&gt; Vec8i;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> Vec&lt;<span class="type">float</span>, <span class="number">2</span>&gt; Vec2f;</span><br><span class="line"><span class="keyword">typedef</span> Vec&lt;<span class="type">float</span>, <span class="number">3</span>&gt; Vec3f;</span><br><span class="line"><span class="keyword">typedef</span> Vec&lt;<span class="type">float</span>, <span class="number">4</span>&gt; Vec4f;</span><br><span class="line"><span class="keyword">typedef</span> Vec&lt;<span class="type">float</span>, <span class="number">6</span>&gt; Vec6f;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> Vec&lt;<span class="type">double</span>, <span class="number">2</span>&gt; Vec2d;</span><br><span class="line"><span class="keyword">typedef</span> Vec&lt;<span class="type">double</span>, <span class="number">3</span>&gt; Vec3d;</span><br><span class="line"><span class="keyword">typedef</span> Vec&lt;<span class="type">double</span>, <span class="number">4</span>&gt; Vec4d;</span><br><span class="line"><span class="keyword">typedef</span> Vec&lt;<span class="type">double</span>, <span class="number">6</span>&gt; Vec6d;</span><br></pre></td></tr></table></figure></li></ul><h3 id="特征提取">特征提取</h3><p>采用的是<code>Moravec</code>特征提取算法，为了使经验阈值能不受窗口大小变化的影响，算法中计算兴趣值时进行了归一化（除以了窗口大小）。</p><h3 id="相关系数匹配">相关系数匹配</h3><p>从幻灯片里复制下来的左右影像对，其大小并不完全相同。因而先对影像进行了一次重采样，避免后续处理中的问题。</p><ul><li><p>用目标窗口直接对右影像进行整影像扫描</p><p>对于第一组影像来说，由于左右影像基本上可以视为只有平移变换的影像，因而直接用形状相同的正方形窗口进行相关系数匹配，结果也很好。但是对于第二组影像来说，由于影像存在倾斜，匹配效果明显下降。此外，在第一步特征提取时也可以发现，<code>Moravec</code>算法提取的第二组的特征点兴趣值，也比第一组低，这可能也是匹配效果不佳的一个原因。</p><p>此外，这种遍历整个影像的匹配算法，计算量大且浪费时间，匹配特征点的数量一旦变多，耗费时间就成倍增加，并不是一种可行的方案。</p></li><li><p>优化算法，减少重复计算</p><p>第一次扫描时，每次移动窗口，都把目标窗口（左影像上的窗口）重新计算了一遍，但是其实每次扫描中目标窗口都是不变的，所以进行了大量的无意义计算。同时，窗口移动时，右影像窗口的计算有一部分是重叠的，也可以进行优化。</p><p>计算速度虽然变快了，但能计算的点的数量依然有限，耗费时间依然太长。</p></li><li><p>优化算法，加入对上下视差和左右视差的预测</p><p>注意到第一组影像基本上没有倾斜与旋转的影像，因而考虑可以由前若干次的扫描结果预测一个大概的上下视差和左右视差，然后在此基础上，预测右影像待匹配的窗口。</p><p>匹配速度较上一次改进有很大的提升，并且匹配的效果也很好。</p><p>但是第二对影像的匹配效果依然差得离谱。</p><p>从理论上，对倾斜影像，如果依然采用正方形窗口（矩形窗口）而不根据倾斜的特点调整形状重采样的话，匹配效果是不可能有所改善的。因为相关系数本质上就是灰度分布相似的区域，而倾斜影像产生的像点位移会破坏掉原有的灰度分布（或者说是形状），导致相关系数失效。</p></li><li><p>对于透视变换的重采样</p><p>数字摄影测量课上所讲的核线重采样需要内方位元素，而题目所给数据并没有任何方位元素数据。虽然通过5对以上同名像点可以进行相对定向，但是缺少内方位元素不能直接运用。根据射影几何的知识，左右影像之间应该存在着射影变换关系。<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">n</span></span></span></span>维射影变换可用<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi><mo>+</mo><mn>2</mn></mrow><annotation encoding="application/x-tex">n+2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6667em;vertical-align:-0.0833em;"></span><span class="mord mathnormal">n</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">2</span></span></span></span>对点确定，因此我们可以通过4对同名像点，确定左右影像像点之间的关系。将右影像按射影变换重采样到左影像上，然后相关系数匹配就可以使用相同大小的窗口进行匹配了。</p><blockquote><p>主要用到的函数：</p><p><code>getPerspectiveTransform</code>：由四对点计算透视变换矩阵。</p><p><code>warpPerspective</code>：根据透视变换矩阵，对图像进行透视变换。</p></blockquote><p>经过变换之后我们可以看到，这对影像基本上与第一对影像类似了。因此，我们可以使用对第一幅影像的处理方法进行处理。</p><p>结果虽然有小部分错点，但效果比未变换时要好很多很多。</p><p>参考：<a href="https://blog.csdn.net/weixin_42905141/article/details/100745097">Opencv学习（15）—warpPerspective()_华山令狐冲、的博客-CSDN博客_warpperspective</a></p></li></ul><h3 id="最小二乘匹配">最小二乘匹配</h3><p>最小二乘匹配的前提是要有近似的匹配点作为初值。因此，需要先进行相关系数匹配之后，才能开始最小二乘匹配。</p><ul><li><p>几点需要注意的地方</p><ol><li><p><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle displaystyle="true" scriptlevel="0"><mfrac><mrow><mi mathvariant="normal">∂</mi><msub><mi>g</mi><mn>2</mn></msub></mrow><mrow><mi mathvariant="normal">∂</mi><msub><mi>x</mi><mn>2</mn></msub></mrow></mfrac></mstyle><mo separator="true">,</mo><mstyle displaystyle="true" scriptlevel="0"><mfrac><mrow><mi mathvariant="normal">∂</mi><msub><mi>g</mi><mn>2</mn></msub></mrow><mrow><mi mathvariant="normal">∂</mi><msub><mi>y</mi><mn>2</mn></msub></mrow></mfrac></mstyle></mrow><annotation encoding="application/x-tex">\cfrac{\partial g_2}{\partial x_2},\cfrac{\partial g_2}{\partial y_2}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:2.4704em;vertical-align:-0.8804em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.59em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">∂</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.74em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">∂</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.836em;"><span></span></span></span></span></span><span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.59em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">∂</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.74em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">∂</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.8804em;"><span></span></span></span></span></span><span></span></span></span></span></span> 要怎么求？</p><p>虽然是对<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>x</mi><mn>2</mn></msub><mo separator="true">,</mo><msub><mi>y</mi><mn>2</mn></msub></mrow><annotation encoding="application/x-tex">x_2,y_2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>求偏导，但实际上要理清楚，求导是在<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>g</mi><mn>2</mn></mrow><annotation encoding="application/x-tex">g2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8389em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="mord">2</span></span></span></span>的影像上直接通过<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle displaystyle="true" scriptlevel="0"><mfrac><mrow><msub><mi>g</mi><mn>2</mn></msub><mo stretchy="false">(</mo><mi>x</mi><mo>+</mo><mn>1</mn><mo separator="true">,</mo><mi>y</mi><mo stretchy="false">)</mo><mo>−</mo><msub><mi>g</mi><mn>2</mn></msub><mo stretchy="false">(</mo><mi>x</mi><mo>−</mo><mn>1</mn><mo separator="true">,</mo><mi>y</mi><mo stretchy="false">)</mo></mrow><mn>2</mn></mfrac></mstyle></mrow><annotation encoding="application/x-tex">\cfrac{g_2(x+1,y)-g_2(x-1,y)}{2}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:2.276em;vertical-align:-0.686em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.59em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">2</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.74em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord">1</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord">1</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mclose">)</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span></span></span></span></span></span>计算，与<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>x</mi><mn>2</mn></msub><mo separator="true">,</mo><msub><mi>y</mi><mn>2</mn></msub></mrow><annotation encoding="application/x-tex">x_2,y_2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>是无关的，更不要用<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>g</mi><mn>2</mn></msub></mrow><annotation encoding="application/x-tex">g_2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>几何纠正之后的图计算偏导数。</p></li><li><p>插值公式</p><p>课件上的插值公式图中的<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">x</span></span></span></span>轴和<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>y</mi></mrow><annotation encoding="application/x-tex">y</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span></span></span></span>轴与<strong>opencv</strong>上的是相反的。</p></li><li><p>未知数更新的式子很奇怪</p><p>和正常情况下的线性化然后更新的过程不一样，但是实际上确实收敛了。</p></li></ol></li><li><p>代码太乱，不放上来了</p></li></ul><h2 id="核线重采样">核线重采样</h2><p>使用&quot;水平&quot;影像法制作核线影像，卫星摄影测量中讲得很仔细。</p><h3 id="水平影像纠正关系">水平影像纠正关系</h3><p>在解析摄影测量中，我们学习过倾斜影像与水平影像的关系，这种关系是基于共线条件方程建立的</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mtable rowspacing="0.16em" columnspacing="1em"><mtr><mtd class ="mtr-glue"></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow><mo fence="true">[</mo><mtable rowspacing="0.16em" columnalign="center" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>X</mi><mo>−</mo><msub><mi>X</mi><mi>S</mi></msub></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mtext> </mtext><mi>Y</mi><mo>−</mo><msub><mi>Y</mi><mi>S</mi></msub></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mtext> </mtext><mi>Z</mi><mo>−</mo><msub><mi>Z</mi><mi>S</mi></msub></mrow></mstyle></mtd></mtr></mtable><mo fence="true">]</mo></mrow><mo>=</mo><mi>λ</mi><mi>R</mi><mrow><mo fence="true">[</mo><mtable rowspacing="0.16em" columnalign="center" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mi>x</mi></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mtext> </mtext><mi>y</mi></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mtext> </mtext><mo>−</mo><mi>f</mi></mrow></mstyle></mtd></mtr></mtable><mo fence="true">]</mo></mrow></mrow></mstyle></mtd><mtd class ="mtr-glue"></mtd><mtd class ="mml-eqn-num"></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{equation}\begin{bmatrix}X-X_S \\\  Y-Y_S \\\  Z-Z_S\end{bmatrix}=\lambda R \begin{bmatrix}x \\\  y \\\  -f\end{bmatrix}\end{equation}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:3.6em;vertical-align:-1.55em;"></span><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-4.05em;"><span class="pstrut" style="height:4.05em;"></span><span class="mord"><span class="minner"><span class="mopen"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-4.05em;"><span class="pstrut" style="height:5.6em;"></span><span style="width:0.667em;height:3.600em;"><svg xmlns="http://www.w3.org/2000/svg" width='0.667em' height='3.600em' viewBox='0 0 667 3600'><path d='M403 1759 V84 H666 V0 H319 V1759 v0 v1759 h347 v-84H403z M403 1759 V0 H319 V1759 v0 v1759 h84z'/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em;"><span></span></span></span></span></span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-4.21em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.0785em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05764em;">S</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-3.01em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mspace"> </span><span class="mord mathnormal" style="margin-right:0.22222em;">Y</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.22222em;">Y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.2222em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05764em;">S</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-1.81em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mspace"> </span><span class="mord mathnormal" style="margin-right:0.07153em;">Z</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">Z</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.0715em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05764em;">S</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em;"><span></span></span></span></span></span></span></span><span class="mclose"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-4.05em;"><span class="pstrut" style="height:5.6em;"></span><span style="width:0.667em;height:3.600em;"><svg xmlns="http://www.w3.org/2000/svg" width='0.667em' height='3.600em' viewBox='0 0 667 3600'><path d='M347 1759 V0 H0 V84 H263 V1759 v0 v1759 H0 v84 H347zM347 1759 V0 H263 V1759 v0 v1759 h84z'/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em;"><span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord mathnormal">λ</span><span class="mord mathnormal" style="margin-right:0.00773em;">R</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="minner"><span class="mopen"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-4.05em;"><span class="pstrut" style="height:5.6em;"></span><span style="width:0.667em;height:3.600em;"><svg xmlns="http://www.w3.org/2000/svg" width='0.667em' height='3.600em' viewBox='0 0 667 3600'><path d='M403 1759 V84 H666 V0 H319 V1759 v0 v1759 h347 v-84H403z M403 1759 V0 H319 V1759 v0 v1759 h84z'/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em;"><span></span></span></span></span></span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-4.21em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">x</span></span></span><span style="top:-3.01em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mspace"> </span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span></span></span><span style="top:-1.81em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mspace"> </span><span class="mord">−</span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em;"><span></span></span></span></span></span></span></span><span class="mclose"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-4.05em;"><span class="pstrut" style="height:5.6em;"></span><span style="width:0.667em;height:3.600em;"><svg xmlns="http://www.w3.org/2000/svg" width='0.667em' height='3.600em' viewBox='0 0 667 3600'><path d='M347 1759 V0 H0 V84 H263 V1759 v0 v1759 H0 v84 H347zM347 1759 V0 H263 V1759 v0 v1759 h84z'/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em;"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em;"><span></span></span></span></span></span></span></span><span class="tag"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-4.05em;"><span class="pstrut" style="height:4.05em;"></span><span class="eqn-num"></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em;"><span></span></span></span></span></span></span></span></span></p><p>若要建立与水平影像的关系，就应该找到两者之间的联系——倾斜影像和水平影像对应的像点具有相同的地面坐标。</p><p>需要注意的是水平影像与倾斜影像的外方位线元素是相同的（纠正前后投影中心位置是不变的）</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mtable rowspacing="0.16em" columnspacing="1em"><mtr><mtd class ="mtr-glue"></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow><mo fence="true">[</mo><mtable rowspacing="0.16em" columnalign="center" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>X</mi><mo>−</mo><msub><mi>X</mi><mi>S</mi></msub></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mtext> </mtext><mi>Y</mi><mo>−</mo><msub><mi>Y</mi><mi>S</mi></msub></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mtext> </mtext><mi>Z</mi><mo>−</mo><msub><mi>Z</mi><mi>S</mi></msub></mrow></mstyle></mtd></mtr></mtable><mo fence="true">]</mo></mrow><mo>=</mo><msub><mi>λ</mi><mi>n</mi></msub><msub><mi>R</mi><mi>n</mi></msub><mrow><mo fence="true">[</mo><mtable rowspacing="0.16em" columnalign="center" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>x</mi><mi>n</mi></msub></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mtext> </mtext><msub><mi>y</mi><mi>n</mi></msub></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mtext> </mtext><mo>−</mo><msub><mi>f</mi><mi>n</mi></msub></mrow></mstyle></mtd></mtr></mtable><mo fence="true">]</mo></mrow></mrow></mstyle></mtd><mtd class ="mtr-glue"></mtd><mtd class ="mml-eqn-num"></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{equation}\begin{bmatrix}X-X_S \\\  Y-Y_S \\\  Z-Z_S\end{bmatrix}=\lambda_n  R_n \begin{bmatrix}x_n \\\  y_n \\\  -f_n\end{bmatrix}\end{equation}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:3.6em;vertical-align:-1.55em;"></span><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-4.05em;"><span class="pstrut" style="height:4.05em;"></span><span class="mord"><span class="minner"><span class="mopen"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-4.05em;"><span class="pstrut" style="height:5.6em;"></span><span style="width:0.667em;height:3.600em;"><svg xmlns="http://www.w3.org/2000/svg" width='0.667em' height='3.600em' viewBox='0 0 667 3600'><path d='M403 1759 V84 H666 V0 H319 V1759 v0 v1759 h347 v-84H403z M403 1759 V0 H319 V1759 v0 v1759 h84z'/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em;"><span></span></span></span></span></span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-4.21em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.0785em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05764em;">S</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-3.01em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mspace"> </span><span class="mord mathnormal" style="margin-right:0.22222em;">Y</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.22222em;">Y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.2222em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05764em;">S</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-1.81em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mspace"> </span><span class="mord mathnormal" style="margin-right:0.07153em;">Z</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">Z</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.0715em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05764em;">S</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em;"><span></span></span></span></span></span></span></span><span class="mclose"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-4.05em;"><span class="pstrut" style="height:5.6em;"></span><span style="width:0.667em;height:3.600em;"><svg xmlns="http://www.w3.org/2000/svg" width='0.667em' height='3.600em' viewBox='0 0 667 3600'><path d='M347 1759 V0 H0 V84 H263 V1759 v0 v1759 H0 v84 H347zM347 1759 V0 H263 V1759 v0 v1759 h84z'/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em;"><span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord"><span class="mord mathnormal">λ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.00773em;">R</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0077em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="minner"><span class="mopen"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-4.05em;"><span class="pstrut" style="height:5.6em;"></span><span style="width:0.667em;height:3.600em;"><svg xmlns="http://www.w3.org/2000/svg" width='0.667em' height='3.600em' viewBox='0 0 667 3600'><path d='M403 1759 V84 H666 V0 H319 V1759 v0 v1759 h347 v-84H403z M403 1759 V0 H319 V1759 v0 v1759 h84z'/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em;"><span></span></span></span></span></span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-4.21em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-3.01em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mspace"> </span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-1.81em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mspace"> </span><span class="mord">−</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.1076em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em;"><span></span></span></span></span></span></span></span><span class="mclose"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-4.05em;"><span class="pstrut" style="height:5.6em;"></span><span style="width:0.667em;height:3.600em;"><svg xmlns="http://www.w3.org/2000/svg" width='0.667em' height='3.600em' viewBox='0 0 667 3600'><path d='M347 1759 V0 H0 V84 H263 V1759 v0 v1759 H0 v84 H347zM347 1759 V0 H263 V1759 v0 v1759 h84z'/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em;"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em;"><span></span></span></span></span></span></span></span><span class="tag"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-4.05em;"><span class="pstrut" style="height:4.05em;"></span><span class="eqn-num"></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em;"><span></span></span></span></span></span></span></span></span></p><p>两式联立，求得</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mtable rowspacing="0.16em" columnspacing="1em"><mtr><mtd class ="mtr-glue"></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><msub><mi>λ</mi><mi>n</mi></msub><msub><mi>R</mi><mi>n</mi></msub><mrow><mo fence="true">[</mo><mtable rowspacing="0.16em" columnalign="center" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>x</mi><mi>n</mi></msub></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mtext> </mtext><msub><mi>y</mi><mi>n</mi></msub></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mtext> </mtext><mo>−</mo><msub><mi>f</mi><mi>n</mi></msub></mrow></mstyle></mtd></mtr></mtable><mo fence="true">]</mo></mrow><mo>=</mo><mi>λ</mi><mi>R</mi><mrow><mo fence="true">[</mo><mtable rowspacing="0.16em" columnalign="center" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mi>x</mi></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mtext> </mtext><mi>y</mi></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mtext> </mtext><mo>−</mo><mi>f</mi></mrow></mstyle></mtd></mtr></mtable><mo fence="true">]</mo></mrow></mrow></mstyle></mtd><mtd class ="mtr-glue"></mtd><mtd class ="mml-eqn-num"></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{equation}\lambda_nR_n\begin{bmatrix}x_n \\\  y_n \\\  -f_n\end{bmatrix}=\lambda R\begin{bmatrix}x \\\  y \\\  -f\end{bmatrix}\end{equation}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:3.6em;vertical-align:-1.55em;"></span><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-4.05em;"><span class="pstrut" style="height:4.05em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">λ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.00773em;">R</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0077em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="minner"><span class="mopen"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-4.05em;"><span class="pstrut" style="height:5.6em;"></span><span style="width:0.667em;height:3.600em;"><svg xmlns="http://www.w3.org/2000/svg" width='0.667em' height='3.600em' viewBox='0 0 667 3600'><path d='M403 1759 V84 H666 V0 H319 V1759 v0 v1759 h347 v-84H403z M403 1759 V0 H319 V1759 v0 v1759 h84z'/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em;"><span></span></span></span></span></span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-4.21em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-3.01em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mspace"> </span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-1.81em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mspace"> </span><span class="mord">−</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.1076em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em;"><span></span></span></span></span></span></span></span><span class="mclose"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-4.05em;"><span class="pstrut" style="height:5.6em;"></span><span style="width:0.667em;height:3.600em;"><svg xmlns="http://www.w3.org/2000/svg" width='0.667em' height='3.600em' viewBox='0 0 667 3600'><path d='M347 1759 V0 H0 V84 H263 V1759 v0 v1759 H0 v84 H347zM347 1759 V0 H263 V1759 v0 v1759 h84z'/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em;"><span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord mathnormal">λ</span><span class="mord mathnormal" style="margin-right:0.00773em;">R</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="minner"><span class="mopen"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-4.05em;"><span class="pstrut" style="height:5.6em;"></span><span style="width:0.667em;height:3.600em;"><svg xmlns="http://www.w3.org/2000/svg" width='0.667em' height='3.600em' viewBox='0 0 667 3600'><path d='M403 1759 V84 H666 V0 H319 V1759 v0 v1759 h347 v-84H403z M403 1759 V0 H319 V1759 v0 v1759 h84z'/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em;"><span></span></span></span></span></span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-4.21em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">x</span></span></span><span style="top:-3.01em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mspace"> </span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span></span></span><span style="top:-1.81em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mspace"> </span><span class="mord">−</span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em;"><span></span></span></span></span></span></span></span><span class="mclose"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-4.05em;"><span class="pstrut" style="height:5.6em;"></span><span style="width:0.667em;height:3.600em;"><svg xmlns="http://www.w3.org/2000/svg" width='0.667em' height='3.600em' viewBox='0 0 667 3600'><path d='M347 1759 V0 H0 V84 H263 V1759 v0 v1759 H0 v84 H347zM347 1759 V0 H263 V1759 v0 v1759 h84z'/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em;"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em;"><span></span></span></span></span></span></span></span><span class="tag"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-4.05em;"><span class="pstrut" style="height:4.05em;"></span><span class="eqn-num"></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em;"><span></span></span></span></span></span></span></span></span></p><p>对于水平影像，其<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>R</mi><mi>n</mi></msub></mrow><annotation encoding="application/x-tex">R_n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.00773em;">R</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0077em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>是单位矩阵。</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mtable rowspacing="0.16em" columnspacing="1em"><mtr><mtd class ="mtr-glue"></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mtable rowspacing="0.25em" columnalign="right left" columnspacing="0em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><msub><mi>x</mi><mi>n</mi></msub></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>=</mo><mo>−</mo><msub><mi>f</mi><mi>n</mi></msub><mfrac><mrow><msub><mi>a</mi><mn>1</mn></msub><mi>x</mi><mo>+</mo><msub><mi>a</mi><mn>2</mn></msub><mi>y</mi><mo>−</mo><msub><mi>a</mi><mn>3</mn></msub><mi>f</mi></mrow><mrow><msub><mi>c</mi><mn>1</mn></msub><mi>x</mi><mo>+</mo><msub><mi>c</mi><mn>2</mn></msub><mi>y</mi><mo>−</mo><msub><mi>c</mi><mn>3</mn></msub><mi>f</mi></mrow></mfrac></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mtext> </mtext><msub><mi>y</mi><mi>n</mi></msub></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>=</mo><mo>−</mo><msub><mi>f</mi><mi>n</mi></msub><mfrac><mrow><msub><mi>b</mi><mn>1</mn></msub><mi>x</mi><mo>+</mo><msub><mi>b</mi><mn>2</mn></msub><mi>y</mi><mo>−</mo><msub><mi>b</mi><mn>3</mn></msub><mi>f</mi></mrow><mrow><msub><mi>c</mi><mn>1</mn></msub><mi>x</mi><mo>+</mo><msub><mi>c</mi><mn>2</mn></msub><mi>y</mi><mo>−</mo><msub><mi>c</mi><mn>3</mn></msub><mi>f</mi></mrow></mfrac></mrow></mstyle></mtd></mtr></mtable></mstyle></mtd><mtd class ="mtr-glue"></mtd><mtd class ="mml-eqn-num"></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{equation}\begin{aligned}x_n&amp;=-f_n\cfrac{a_1x+a_2y-a_3f}{c_1x+c_2y-c_3f}\\\  y_n&amp;=-f_n\cfrac{b_1x+b_2y-b_3f}{c_1x+c_2y-c_3f}\end{aligned}\end{equation}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:5.5409em;vertical-align:-2.5204em;"></span><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:3.0204em;"><span style="top:-5.0204em;"><span class="pstrut" style="height:5.0204em;"></span><span class="mord"><span class="mord"><span class="mtable"><span class="col-align-r"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:3.0204em;"><span style="top:-5.0204em;"><span class="pstrut" style="height:3.59em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-2.25em;"><span class="pstrut" style="height:3.59em;"></span><span class="mord"><span class="mspace"> </span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.5204em;"><span></span></span></span></span></span><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:3.0204em;"><span style="top:-5.0204em;"><span class="pstrut" style="height:3.59em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord">−</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.1076em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.59em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord mathnormal">x</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.74em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord mathnormal">x</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.8804em;"><span></span></span></span></span></span><span></span></span></span></span><span style="top:-2.25em;"><span class="pstrut" style="height:3.59em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord">−</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.1076em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.59em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord mathnormal">x</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.74em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord mathnormal">x</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.8804em;"><span></span></span></span></span></span><span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.5204em;"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.5204em;"><span></span></span></span></span></span></span></span><span class="tag"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:3.0204em;"><span style="top:-5.0204em;"><span class="pstrut" style="height:5.0204em;"></span><span class="eqn-num"></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.5204em;"><span></span></span></span></span></span></span></span></span></p><h3 id="平行于基线的影像纠正关系">平行于基线的影像纠正关系</h3><p>课本中所谓的“水平”影像实际上指平行于基线的影像。关系式依然是式（3），但是<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>R</mi><mi>n</mi></msub></mrow><annotation encoding="application/x-tex">R_n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.00773em;">R</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0077em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>不能简单地用单位矩阵表示。而是应该根据基线计算出一个旋转矩阵，使得经这个旋转矩阵旋转后，影像恰好能平行于基线。</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mtable rowspacing="0.16em" columnspacing="1em"><mtr><mtd class ="mtr-glue"></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mtable rowspacing="0.25em" columnalign="right left" columnspacing="0em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><msub><mi>x</mi><mi>n</mi></msub></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>=</mo><mo>−</mo><msub><mi>f</mi><mi>n</mi></msub><mfrac><mrow><msub><mi>m</mi><mn>11</mn></msub><mi>x</mi><mo>+</mo><msub><mi>m</mi><mn>12</mn></msub><mi>y</mi><mo>−</mo><msub><mi>m</mi><mn>13</mn></msub><mi>f</mi></mrow><mrow><msub><mi>m</mi><mn>31</mn></msub><mi>x</mi><mo>+</mo><msub><mi>m</mi><mn>32</mn></msub><mi>y</mi><mo>−</mo><msub><mi>m</mi><mn>33</mn></msub><mi>f</mi></mrow></mfrac></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mtext> </mtext><msub><mi>y</mi><mi>n</mi></msub></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>=</mo><mo>−</mo><msub><mi>f</mi><mi>n</mi></msub><mfrac><mrow><msub><mi>m</mi><mn>21</mn></msub><mi>x</mi><mo>+</mo><msub><mi>m</mi><mn>22</mn></msub><mi>y</mi><mo>−</mo><msub><mi>m</mi><mn>23</mn></msub><mi>f</mi></mrow><mrow><msub><mi>m</mi><mn>31</mn></msub><mi>x</mi><mo>+</mo><msub><mi>m</mi><mn>32</mn></msub><mi>y</mi><mo>−</mo><msub><mi>m</mi><mn>33</mn></msub><mi>f</mi></mrow></mfrac></mrow></mstyle></mtd></mtr></mtable></mstyle></mtd><mtd class ="mtr-glue"></mtd><mtd class ="mml-eqn-num"></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{equation}\begin{aligned}x_n&amp;=-f_n\cfrac{m_{11}x+m_{12}y-m_{13}f}{m_{31}x+m_{32}y-m_{33}f}\\\  y_n&amp;=-f_n\cfrac{m_{21}x+m_{22}y-m_{23}f}{m_{31}x+m_{32}y-m_{33}f}\end{aligned}\end{equation}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:5.5409em;vertical-align:-2.5204em;"></span><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:3.0204em;"><span style="top:-5.0204em;"><span class="pstrut" style="height:5.0204em;"></span><span class="mord"><span class="mord"><span class="mtable"><span class="col-align-r"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:3.0204em;"><span style="top:-5.0204em;"><span class="pstrut" style="height:3.59em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-2.25em;"><span class="pstrut" style="height:3.59em;"></span><span class="mord"><span class="mspace"> </span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.5204em;"><span></span></span></span></span></span><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:3.0204em;"><span style="top:-5.0204em;"><span class="pstrut" style="height:3.59em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord">−</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.1076em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.59em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">m</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">31</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord mathnormal">x</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal">m</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">32</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal">m</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">33</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.74em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">m</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">11</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord mathnormal">x</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal">m</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">12</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal">m</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">13</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.8804em;"><span></span></span></span></span></span><span></span></span></span></span><span style="top:-2.25em;"><span class="pstrut" style="height:3.59em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord">−</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.1076em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.59em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">m</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">31</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord mathnormal">x</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal">m</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">32</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal">m</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">33</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.74em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">m</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">21</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord mathnormal">x</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal">m</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">22</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal">m</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">23</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.8804em;"><span></span></span></span></span></span><span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.5204em;"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.5204em;"><span></span></span></span></span></span></span></span><span class="tag"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:3.0204em;"><span style="top:-5.0204em;"><span class="pstrut" style="height:5.0204em;"></span><span class="eqn-num"></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.5204em;"><span></span></span></span></span></span></span></span></span></p><blockquote><p>卫星摄影测量课程中这种核线重采样方法讲得很详细，但是具体如何计算旋转矩阵，还是要靠自己理解，否则计算的角度可能正负会反。</p></blockquote><p>建立了关系之后，利用间接法，对原始影像进行内插，灰度赋值，完成核线重采样工作。</p>]]></content>
      
      
      <categories>
          
          <category> 课程学习 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 摄影测量 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>近景摄影测量编程与实习</title>
      <link href="/posts/5f0fff90.html"/>
      <url>/posts/5f0fff90.html</url>
      
        <content type="html"><![CDATA[<h2 id="前言-19">前言</h2><p>记录编程中的问题</p><h2 id="影像获取">影像获取</h2><h3 id="摄影方式的选择">摄影方式的选择</h3><p>摄影方式主要包括两种：正直摄影方式和交向摄影方式。正直摄影方式中，像片对两像片的主光轴彼此平行，且垂直于摄影基线；交向摄影方式中，像片对两像片的主光轴大体位于同一平面但彼此不平行，且不垂直于摄影基线。</p><p>受限于检校场的大小，为了能拍摄到更多的标志，获得更大的重叠度，可以选择交向摄影方式。同时，为了保证交向摄影的精度，还应该注意交会角的大小。</p><h3 id="焦距的选择">焦距的选择</h3><p>检校场留有的摄影空间较小，摄影距离受限，为了拍摄的影像尽可能包含较多的标志，应当选择较小的焦距。但是，根据交向摄影的精度估算式，为了拍摄出比例尺较大的影像以提高精度，焦距也不应过小。</p><h3 id="调焦方式的选择">调焦方式的选择</h3><p>为了保持畸变参数和内方位元素不变，以简化后续计算，拍摄过程中，不应进行调焦。因而相机的调焦方式应当选择手动调焦。</p><h3 id="曝光程序的选择">曝光程序的选择</h3><p>曝光程序主要有快门优先和光圈优先两种。快门优先即先确定曝光时间，再测定光圈号数；光圈优先即先确定光圈号数，再测定曝光时间。</p><p>由于控制景深需要设置光圈的大小，因而要选择光圈优先曝光程序。</p><h3 id="景深的控制">景深的控制</h3><p>近景摄影测量中，获取清晰的高质量影像至关重要，特别需要关注的是景深的正确选择。景深<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="normal">Δ</mi><mi>D</mi></mrow><annotation encoding="application/x-tex">\Delta D</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord">Δ</span><span class="mord mathnormal" style="margin-right:0.02778em;">D</span></span></span></span>是在给定光圈和模糊圈大小条件下被摄影空间获得清晰构象的深度范围，也就是后景距<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>D</mi><mn>2</mn></msub></mrow><annotation encoding="application/x-tex">D_2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0278em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>与前景距<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>D</mi><mn>1</mn></msub></mrow><annotation encoding="application/x-tex">D_1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0278em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>的差值。</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mtable rowspacing="0.16em" columnspacing="1em"><mtr><mtd class ="mtr-glue"></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><msub><mi>D</mi><mn>1</mn></msub><mo>=</mo><mfrac><mrow><mi>H</mi><mi>D</mi></mrow><mrow><mi>H</mi><mo>+</mo><mi>D</mi></mrow></mfrac></mrow></mstyle></mtd><mtd class ="mtr-glue"></mtd><mtd class ="mml-eqn-num"></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{equation}D_1=\cfrac{HD}{H+D}\end{equation}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:2.3593em;vertical-align:-0.9297em;"></span><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.4297em;"><span style="top:-3.4297em;"><span class="pstrut" style="height:3.59em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0278em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.59em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.08125em;">H</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">D</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.74em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">HD</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.7693em;"><span></span></span></span></span></span><span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.9297em;"><span></span></span></span></span></span></span></span><span class="tag"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.4297em;"><span style="top:-3.4297em;"><span class="pstrut" style="height:3.59em;"></span><span class="eqn-num"></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.9297em;"><span></span></span></span></span></span></span></span></span></p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mtable rowspacing="0.16em" columnspacing="1em"><mtr><mtd class ="mtr-glue"></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><msub><mi>D</mi><mn>2</mn></msub><mo>=</mo><mfrac><mrow><mi>H</mi><mi>D</mi></mrow><mrow><mi>H</mi><mo>−</mo><mi>D</mi></mrow></mfrac></mrow></mstyle></mtd><mtd class ="mtr-glue"></mtd><mtd class ="mml-eqn-num"></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{equation}D_2=\cfrac{HD}{H-D}\end{equation}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:2.3593em;vertical-align:-0.9297em;"></span><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.4297em;"><span style="top:-3.4297em;"><span class="pstrut" style="height:3.59em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0278em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.59em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.08125em;">H</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">D</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.74em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">HD</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.7693em;"><span></span></span></span></span></span><span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.9297em;"><span></span></span></span></span></span></span></span><span class="tag"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.4297em;"><span style="top:-3.4297em;"><span class="pstrut" style="height:3.59em;"></span><span class="eqn-num"></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.9297em;"><span></span></span></span></span></span></span></span></span></p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mtable rowspacing="0.16em" columnspacing="1em"><mtr><mtd class ="mtr-glue"></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mi mathvariant="normal">Δ</mi><mi>D</mi><mo>=</mo><msub><mi>D</mi><mn>2</mn></msub><mo>−</mo><msub><mi>D</mi><mn>1</mn></msub></mrow></mstyle></mtd><mtd class ="mtr-glue"></mtd><mtd class ="mml-eqn-num"></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{equation}\Delta D=D_2-D_1\end{equation}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.2em;vertical-align:-0.35em;"></span><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.85em;"><span style="top:-3.01em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">Δ</span><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0278em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0278em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.35em;"><span></span></span></span></span></span></span></span><span class="tag"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.85em;"><span style="top:-2.85em;"><span class="pstrut" style="height:2.84em;"></span><span class="eqn-num"></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.35em;"><span></span></span></span></span></span></span></span></span></p><p>其中</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mtable rowspacing="0.16em" columnspacing="1em"><mtr><mtd class ="mtr-glue"></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mi>H</mi><mo>=</mo><mfrac><msup><mi>F</mi><mn>2</mn></msup><mrow><mi>k</mi><mi>E</mi></mrow></mfrac></mrow></mstyle></mtd><mtd class ="mtr-glue"></mtd><mtd class ="mml-eqn-num"></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{equation}H=\cfrac{F^2}{kE}\end{equation}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:2.276em;vertical-align:-0.888em;"></span><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.388em;"><span style="top:-3.388em;"><span class="pstrut" style="height:3.59em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.08125em;">H</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.59em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="mord mathnormal" style="margin-right:0.05764em;">E</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.74em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">F</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.888em;"><span></span></span></span></span></span></span></span><span class="tag"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.388em;"><span style="top:-3.388em;"><span class="pstrut" style="height:3.59em;"></span><span class="eqn-num"></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.888em;"><span></span></span></span></span></span></span></span></span></p><p><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>D</mi></mrow><annotation encoding="application/x-tex">D</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">D</span></span></span></span>代表调焦距，<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>H</mi></mrow><annotation encoding="application/x-tex">H</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.08125em;">H</span></span></span></span>代表超焦点距离，<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>F</mi></mrow><annotation encoding="application/x-tex">F</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">F</span></span></span></span>为摄影机焦距，<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi></mrow><annotation encoding="application/x-tex">k</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span></span></span></span>为光圈号数，<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>E</mi></mrow><annotation encoding="application/x-tex">E</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">E</span></span></span></span>为模糊圆直径。</p><p>要保证拍摄物体清晰，就需要控制景深，或者说，使被摄物体位于前景距和后景距之间。由公式(1)~(4)可知，调焦距<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>D</mi></mrow><annotation encoding="application/x-tex">D</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">D</span></span></span></span>、摄影机焦距<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>F</mi></mrow><annotation encoding="application/x-tex">F</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">F</span></span></span></span>、光圈号数<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi></mrow><annotation encoding="application/x-tex">k</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span></span></span></span>、模糊圆直径<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>E</mi></mrow><annotation encoding="application/x-tex">E</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">E</span></span></span></span>是影响前景距与后景距的因素。而由于检校场的摄影空间较小，<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>D</mi></mrow><annotation encoding="application/x-tex">D</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">D</span></span></span></span>与<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>F</mi></mrow><annotation encoding="application/x-tex">F</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">F</span></span></span></span>调节范围受限，而<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>E</mi></mrow><annotation encoding="application/x-tex">E</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">E</span></span></span></span>又是基本确定的值。因此，为了使标志能够成像清晰，需要调节光圈号数<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi></mrow><annotation encoding="application/x-tex">k</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span></span></span></span>。这也是曝光程序选择光圈优先的原因。</p><p>分析公式(1)~(4)，当<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>H</mi><mo>&gt;</mo><mi>D</mi></mrow><annotation encoding="application/x-tex">H&gt;D</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7224em;vertical-align:-0.0391em;"></span><span class="mord mathnormal" style="margin-right:0.08125em;">H</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">&gt;</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">D</span></span></span></span>时，<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi></mrow><annotation encoding="application/x-tex">k</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span></span></span></span>越大，<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>H</mi></mrow><annotation encoding="application/x-tex">H</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.08125em;">H</span></span></span></span>越小，则前景距<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>D</mi><mn>1</mn></msub></mrow><annotation encoding="application/x-tex">D_1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0278em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>越小且后景距<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>D</mi><mn>2</mn></msub></mrow><annotation encoding="application/x-tex">D_2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0278em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>越大。所以，若检校场的标志不能清晰成像，可以选择加大光圈号数，从而使标志点位于前景距与后景距之间，获得清晰成像。</p><h3 id="曝光时间的控制">曝光时间的控制</h3><p>为了确定曝光时间，可以使用经验法、曝光表测定法，试片法，或推算比较法。在曝光程序为光圈优先的情况下，实验使用的相机可以通过测光功能，自动安置曝光时间。但是，在实际的近景摄影测量工作中，有时需要有人工的略微修正。</p><h3 id="相机方位元素的记录">相机方位元素的记录</h3><p>拍摄影像对的目的之一就是为了通过后方交会，计算相机的内外方位元素和畸变参数。由于后方交会解求的是非线性方程，需要提供方位元素的近似值，所以在摄影过程中，应当记录方位元素的近似值。</p><h2 id="像点坐标量测">像点坐标量测</h2><h3 id="圆形识别">圆形识别</h3><p>采用的是边缘检测，并拟合椭圆的方法。这种方法简单有效，易于操作，但是对参数的设置要求较高。</p><p>主要函数：</p><ul><li><p><code>GaussianBlur</code>：进行高斯模糊，减小噪声。噪声会影响<code>Canny</code>算子提取边缘的效果。</p><blockquote><p>确实影响很大，不做高斯模糊有的很明显的圆都识别不出来，还困扰了我很久。</p></blockquote></li><li><p><code>Canny</code>：提取边缘。</p></li><li><p><code>findContours</code>：边缘追踪，得到轮廓。</p></li><li><p><code>contourArea</code>：计算轮廓包围的面积，可以控制识别圆形的大小。</p><blockquote><p>但是要注意<code>contourArea</code>算的面积是有误差的。</p></blockquote></li><li><p><code>arcLength</code>：计算轮廓的周长，结合面积可以计算圆形度。</p></li><li><p><code>fitEllipse</code>：根据轮廓拟合椭圆。</p></li></ul><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cvtColor</span>(focusImg, grayImg, CV_BGR2GRAY);</span><br><span class="line"></span><br><span class="line"><span class="comment">//边缘提取</span></span><br><span class="line"><span class="built_in">GaussianBlur</span>(grayImg, grayImg, <span class="built_in">Size</span>(<span class="number">5</span>, <span class="number">5</span>), <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">Mat edgeImage;</span><br><span class="line"><span class="built_in">Canny</span>(grayImg, edgeImage, <span class="number">30</span>, <span class="number">70</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//边缘追踪</span></span><br><span class="line">vector&lt;vector&lt;Point&gt;&gt; contours;<span class="comment">// 轮廓</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">findContours</span>(edgeImage, contours, CV_RETR_LIST, CV_CHAIN_APPROX_NONE);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="type">double</span> area = <span class="number">0</span>;</span><br><span class="line"><span class="type">double</span> perimeter = <span class="number">0</span>;</span><br><span class="line">Mat cirImg = Mat::<span class="built_in">zeros</span>(edgeImage.<span class="built_in">size</span>(), CV_8UC3);</span><br><span class="line"><span class="type">size_t</span> count = <span class="number">0</span>;</span><br><span class="line">Point center = <span class="built_in">Point</span>(<span class="number">-999</span>, <span class="number">-999</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//找出并筛选圆形</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">auto</span> it1 = contours.<span class="built_in">begin</span>(); it1 != contours.<span class="built_in">end</span>(); )</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">//拟合点个数筛选</span></span><br><span class="line">    count = it1-&gt;<span class="built_in">size</span>();</span><br><span class="line">    <span class="keyword">if</span> (count &lt; <span class="number">6</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        it1 = contours.<span class="built_in">erase</span>(it1);</span><br><span class="line">        <span class="keyword">continue</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//面积筛选与圆度筛选</span></span><br><span class="line">    <span class="comment">//这里面积的阈值如何确定？（可以用户输入）</span></span><br><span class="line">    area = <span class="built_in">contourArea</span>(*it1);</span><br><span class="line">    perimeter = <span class="built_in">arcLength</span>(*it1, <span class="literal">true</span>);</span><br><span class="line">    <span class="keyword">if</span> (area &lt;minArea || area&gt;maxArea)</span><br><span class="line">    &#123;</span><br><span class="line">        it1 = contours.<span class="built_in">erase</span>(it1);</span><br><span class="line">        <span class="keyword">continue</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (<span class="number">4</span> * <span class="number">3.1415926</span> * area / <span class="built_in">pow</span>(perimeter, <span class="number">2</span>) &lt; roundness)</span><br><span class="line">    &#123;</span><br><span class="line">        it1 = contours.<span class="built_in">erase</span>(it1);</span><br><span class="line">        <span class="keyword">continue</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    Point temp = <span class="built_in">fitEllipse</span>(*it1).center;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">sqrtf</span>(<span class="built_in">powf</span>((center.x - temp.x), <span class="number">2</span>) + <span class="built_in">powf</span>((center.y - temp.y), <span class="number">2</span>)) &lt; distance)</span><br><span class="line">    &#123;</span><br><span class="line">        it1 = contours.<span class="built_in">erase</span>(it1);</span><br><span class="line">        <span class="keyword">continue</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        center = temp;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//迭代器后移</span></span><br><span class="line">    it1++;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="区域框选">区域框选</h3><p>需要的主要函数是鼠标事件函数<code>setMouseCallback</code>。比较麻烦的就是鼠标事件获取坐标之后如何传递的问题，我现在还没有理清。<s>（我用的是全局变量，不得不说全局变量是真的丑）</s>。</p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line">Rect select;<span class="comment">//框选的矩形</span></span><br><span class="line"><span class="type">bool</span> select_flag = <span class="literal">false</span>;<span class="comment">//框选状态</span></span><br><span class="line">Point origin;<span class="comment">//框选的起点</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//鼠标事件的回调函数，控制框选区域的是select(全局变量)</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">onMouse</span><span class="params">(<span class="type">int</span> event, <span class="type">int</span> x, <span class="type">int</span> y, <span class="type">int</span>, <span class="type">void</span>*)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">if</span> (event == EVENT_LBUTTONDOWN)</span><br><span class="line">&#123;</span><br><span class="line">select_flag = <span class="literal">true</span>;<span class="comment">//左键按下赋真值</span></span><br><span class="line">origin = <span class="built_in">Point</span>(x, y);<span class="comment">//保存左键单击的坐标</span></span><br><span class="line">select = <span class="built_in">Rect</span>(x, y, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (event == EVENT_LBUTTONUP)</span><br><span class="line">&#123;</span><br><span class="line">select_flag = <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (select_flag)</span><br><span class="line">&#123;</span><br><span class="line">select.x = <span class="built_in">MIN</span>(origin.x, x);<span class="comment">//鼠标按下开始到弹起这段时间实时计算所选矩形框左上角点坐标</span></span><br><span class="line">select.y = <span class="built_in">MIN</span>(origin.y, y);</span><br><span class="line">select.width = <span class="built_in">abs</span>(x - origin.x);<span class="comment">//算矩形宽度和高度</span></span><br><span class="line">select.height = <span class="built_in">abs</span>(y - origin.y);</span><br><span class="line">select &amp;= <span class="built_in">Rect</span>(<span class="number">0</span>, <span class="number">0</span>, preImg.cols, preImg.rows);<span class="comment">//保证所选矩形框在图片区域之内</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>代码可以参考：<a href="https://www.cnblogs.com/tornadomeet/archive/2012/05/04/2483444.html">基础学习笔记之opencv(5)：实现鼠标选定矩形框 - tornadomeet - 博客园 (cnblogs.com)</a></p><h3 id="键盘操作">键盘操作</h3><p>是很简单的输入流与<code>waitKey()</code>控制。输入输出流用于在控制台进行交互。<code>waitKey()</code>则读取按键信息。</p><p>奇怪的地方在于，<code>waitKey()</code>没办法识别<code>delete</code>、<code>shift</code>等等的按键，不知道是什么原因。</p><p>此外<code>waitKey()</code>有一个重要的功能就是让<code>imshow()</code>能显示出图像，特别是在与控制台交互输入点号信息的时候。如果不用<code>waitKey(30)</code>，窗口就会显示灰色而不是图像。</p><h2 id="单像空间后方交会">单像空间后方交会</h2><p>单像空间后方交会是根据一张像片覆盖的一定数量控制点的物方空间坐标及其像点坐标，以像点坐标作为观测值，按共线条件方程解算该像片的内、外方位元素以及其它附加参数的过程。</p><h3 id="坐标系转换">坐标系转换</h3><p>根据实习提供的控制点物方坐标数据，可以推断出控制点物方坐标系各坐标轴的朝向。如图1左图所示，物方坐标数据的坐标系是一个左手坐标系。一方面，左手坐标系不符合通常情况下共线条件方程式的推导结果。另一方面，不恰当的坐标系，会使外方位角元素的初始值（记录的水平角与竖直角）难以转换到选择的坐标系中。采用如图 1 右图所示的物方坐标系，使 Z 轴与摄影方向一致。既能保证右手坐标系，又能将其视为从空中向地面的竖直摄影，方便地使用推导的公式，还可以简单地将水平角与竖直角转换为外方位角元素。</p><p>此外，由于像点坐标量测使用了 OpenCV，量测坐标的平面坐标系与常用的平面坐标系定义不同，如图 2 左图所示。也需要将其转换为如图 2 右图所示的坐标系并配合转换后的物方空间坐标系使用。同理，在输出结果时，要将坐标变换回原始像平面坐标系中的坐标。</p><div class="gallery">    <div class="fj-gallery " data-rowHeight="220" data-limit="10">    <span class="gallery-data">[{"url":"https://cdn.zerolacqua.top/images/blogs/近景摄影测量编程与实习/1.png","alt":"图1 物方空间坐标系的变换"},{"url":"https://cdn.zerolacqua.top/images/blogs/近景摄影测量编程与实习/2.png","alt":"图2 像平面坐标系的转换"}]</span>    </div>    <button class="gallery-load-more"><span>加载更多</span><i class="fa-solid fa-arrow-down"></i></button>    </div><h3 id="误差方程式">误差方程式</h3><div class="note warning modern"><p>误差方程式参见教材。</p></div><p>需要注意以下几点：</p><ul><li>畸变差系数的导数前的符号，这是由共线条件方程中中畸变差的形式决定的。</li><li>误差方程式解算的是各未知数的改正数</li></ul><h3 id="精度计算">精度计算</h3><p>单像空间后方交会解算中计算的是内精度。</p><p>根据平差原理知识，单位权中误差如下式所示。</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mtable rowspacing="0.16em" columnspacing="1em"><mtr><mtd class ="mtr-glue"></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><msub><mi>σ</mi><mn>0</mn></msub><mo>=</mo><msqrt><mfrac><mrow><msup><mi>V</mi><mi mathvariant="normal">T</mi></msup><mi>V</mi></mrow><mi>r</mi></mfrac></msqrt></mrow></mstyle></mtd><mtd class ="mtr-glue"></mtd><mtd class ="mml-eqn-num"></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{equation}\sigma_0=\sqrt{\cfrac{V^\mathrm{T}V}{r}}\end{equation}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:3.04em;vertical-align:-1.27em;"></span><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.77em;"><span style="top:-3.77em;"><span class="pstrut" style="height:4.0859em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">σ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord sqrt"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.0859em;"><span class="svg-align" style="top:-5em;"><span class="pstrut" style="height:5em;"></span><span class="mord" style="padding-left:1em;"><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.59em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">r</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.74em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8413em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathrm mtight">T</span></span></span></span></span></span></span></span><span class="mord mathnormal" style="margin-right:0.22222em;">V</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span></span></span></span></span><span style="top:-4.0459em;"><span class="pstrut" style="height:5em;"></span><span class="hide-tail" style="min-width:1.02em;height:3.08em;"><svg xmlns="http://www.w3.org/2000/svg" width='400em' height='3.08em' viewBox='0 0 400000 3240' preserveAspectRatio='xMinYMin slice'><path d='M473,2793c339.3,-1799.3,509.3,-2700,510,-2702 l0 -0c3.3,-7.3,9.3,-11,18,-11 H400000v40H1017.7s-90.5,478,-276.2,1466c-185.7,988,-279.5,1483,-281.5,1485c-2,6,-10,9,-24,9c-8,0,-12,-0.7,-12,-2c0,-1.3,-5.3,-32,-16,-92c-50.7,-293.3,-119.7,-693.3,-207,-1200c0,-1.3,-5.3,8.7,-16,30c-10.7,21.3,-21.3,42.7,-32,64s-16,33,-16,33s-26,-26,-26,-26s76,-153,76,-153s77,-151,77,-151c0.7,0.7,35.7,202,105,604c67.3,400.7,102,602.7,104,606zM1001 80h400000v40H1017.7z'/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.9541em;"><span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.27em;"><span></span></span></span></span></span></span></span><span class="tag"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.77em;"><span style="top:-3.77em;"><span class="pstrut" style="height:4.0859em;"></span><span class="eqn-num"></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.27em;"><span></span></span></span></span></span></span></span></span></p><p>其中<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>r</mi></mrow><annotation encoding="application/x-tex">r</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span></span></span></span>为多余观测数。</p><p>则由单位权中误差，可以计算出各未知数的中误差</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mtable rowspacing="0.16em" columnspacing="1em"><mtr><mtd class ="mtr-glue"></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><msub><mi>m</mi><mi>X</mi></msub><mo>=</mo><msub><mi>σ</mi><mn>0</mn></msub><msqrt><mrow><mi>D</mi><mi>i</mi><mi>a</mi><mi>g</mi><mo stretchy="false">(</mo><msub><mi>Q</mi><mrow><mi>X</mi><mi>X</mi></mrow></msub><mo stretchy="false">)</mo></mrow></msqrt></mrow></mstyle></mtd><mtd class ="mtr-glue"></mtd><mtd class ="mml-eqn-num"></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{equation}m_X=\sigma_0\sqrt{Diag(Q_{XX})}\end{equation}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.3439em;vertical-align:-0.4219em;"></span><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9219em;"><span style="top:-2.9381em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">m</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.07847em;">X</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">σ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord sqrt"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9839em;"><span class="svg-align" style="top:-3.2em;"><span class="pstrut" style="height:3.2em;"></span><span class="mord" style="padding-left:1em;"><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class="mord mathnormal">ia</span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">Q</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.07847em;">XX</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span><span style="top:-2.9439em;"><span class="pstrut" style="height:3.2em;"></span><span class="hide-tail" style="min-width:1.02em;height:1.28em;"><svg xmlns="http://www.w3.org/2000/svg" width='400em' height='1.28em' viewBox='0 0 400000 1296' preserveAspectRatio='xMinYMin slice'><path d='M263,681c0.7,0,18,39.7,52,119c34,79.3,68.167,158.7,102.5,238c34.3,79.3,51.8,119.3,52.5,120c340,-704.7,510.7,-1060.3,512,-1067l0 -0c4.7,-7.3,11,-11,19,-11H40000v40H1012.3s-271.3,567,-271.3,567c-38.7,80.7,-84,175,-136,283c-52,108,-89.167,185.3,-111.5,232c-22.3,46.7,-33.8,70.3,-34.5,71c-4.7,4.7,-12.3,7,-23,7s-12,-1,-12,-1s-109,-253,-109,-253c-72.7,-168,-109.3,-252,-110,-252c-10.7,8,-22,16.7,-34,26c-22,17.3,-33.3,26,-34,26s-26,-26,-26,-26s76,-59,76,-59s76,-60,76,-60zM1001 80h400000v40h-400000z'/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2561em;"><span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.4219em;"><span></span></span></span></span></span></span></span><span class="tag"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9219em;"><span style="top:-2.9219em;"><span class="pstrut" style="height:2.9839em;"></span><span class="eqn-num"></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.4219em;"><span></span></span></span></span></span></span></span></span></p><h2 id="直接线性变换">直接线性变换</h2><p>直接线性变换解法是建立像点的“坐标仪坐标”和相应物点的物方空间坐标直接的线性关系的解法。</p><h3 id="坐标系转换-2">坐标系转换</h3><p>与<a href="/posts/5f0fff90.html#单像空间后方交会">单像空间后方交会</a>中所述一致。</p><h3 id="近似值的计算">近似值的计算</h3><div class="note warning modern"><p>近似值的计算参见教材。</p></div><p>计算 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>l</mi></mrow><annotation encoding="application/x-tex">l</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span></span></span></span> 系数的近似值时，还需要计算像主点坐标 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>x</mi><mn>0</mn></msub><mo separator="true">,</mo><msub><mi>y</mi><mn>0</mn></msub></mrow><annotation encoding="application/x-tex">x_0,y_0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>，这是因为在直接线性变换中使用了畸变系数，需要使用像主点坐标 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>x</mi><mn>0</mn></msub><mo separator="true">,</mo><msub><mi>y</mi><mn>0</mn></msub></mrow><annotation encoding="application/x-tex">x_0,y_0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>。</p><h3 id="误差方程式-2">误差方程式</h3><div class="note warning modern"><p>误差方程式参见教材。</p></div><p>需要注意以下几点：</p><ul><li>误差方程式解算的是各未知数本身</li></ul><h3 id="精度计算-2">精度计算</h3><p>直接线性变换解算解算 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>l</mi></mrow><annotation encoding="application/x-tex">l</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span></span></span></span> 系数的过程，计算的是内精度。原理与<a href="/posts/5f0fff90.html#单像空间后方交会">单像空间后方交会</a>中所述一致。</p><p>直接线性变换解算待定点物方坐标的过程计算的是内精度和外精度。内精度计算原理与<a href="/posts/5f0fff90.html#单像空间后方交会">单像空间后方交会</a>中所述一致。外精度则通过下式计算：</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mtable rowspacing="0.16em" columnspacing="1em"><mtr><mtd class ="mtr-glue"></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mtable rowspacing="0.25em" columnalign="right left" columnspacing="0em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><msub><mi>m</mi><mi>X</mi></msub></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>=</mo><msqrt><mrow><mfrac><mn>1</mn><mi>n</mi></mfrac><mo>∑</mo><mo stretchy="false">(</mo><mi>X</mi><mo>−</mo><mover accent="true"><mi>X</mi><mo>^</mo></mover><msup><mo stretchy="false">)</mo><mn>2</mn></msup></mrow></msqrt></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><msub><mi>m</mi><mi>Y</mi></msub></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>=</mo><msqrt><mrow><mfrac><mn>1</mn><mi>n</mi></mfrac><mo>∑</mo><mo stretchy="false">(</mo><mi>Y</mi><mo>−</mo><mover accent="true"><mi>Y</mi><mo>^</mo></mover><msup><mo stretchy="false">)</mo><mn>2</mn></msup></mrow></msqrt></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><msub><mi>m</mi><mi>Z</mi></msub></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>=</mo><msqrt><mrow><mfrac><mn>1</mn><mi>n</mi></mfrac><mo>∑</mo><mo stretchy="false">(</mo><mi>Z</mi><mo>−</mo><mover accent="true"><mi>Z</mi><mo>^</mo></mover><msup><mo stretchy="false">)</mo><mn>2</mn></msup></mrow></msqrt></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><msub><mi>m</mi><mi>p</mi></msub></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>=</mo><msqrt><mrow><msubsup><mi>m</mi><mi>X</mi><mn>2</mn></msubsup><mo>+</mo><msubsup><mi>m</mi><mi>Y</mi><mn>2</mn></msubsup><mo>+</mo><msubsup><mi>m</mi><mi>Z</mi><mn>2</mn></msubsup></mrow></msqrt></mrow></mstyle></mtd></mtr></mtable></mstyle></mtd><mtd class ="mtr-glue"></mtd><mtd class ="mml-eqn-num"></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{equation}\begin{aligned}m_X&amp;=\sqrt{\cfrac{1}{n}\sum(X-\hat{X})^2}\\m_Y&amp;=\sqrt{\cfrac{1}{n}\sum(Y-\hat{Y})^2}\\m_Z&amp;=\sqrt{\cfrac{1}{n}\sum(Z-\hat{Z})^2}\\m_p&amp;=\sqrt{m_X^2+m_Y^2+m_Z^2}\\\end{aligned}\end{equation}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:12.16em;vertical-align:-5.83em;"></span><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:6.33em;"><span style="top:-8.33em;"><span class="pstrut" style="height:8.33em;"></span><span class="mord"><span class="mord"><span class="mtable"><span class="col-align-r"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:6.33em;"><span style="top:-8.33em;"><span class="pstrut" style="height:4.0859em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">m</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.07847em;">X</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-4.99em;"><span class="pstrut" style="height:4.0859em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">m</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.22222em;">Y</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-1.65em;"><span class="pstrut" style="height:4.0859em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">m</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.07153em;">Z</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:0.8892em;"><span class="pstrut" style="height:4.0859em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">m</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">p</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:5.83em;"><span></span></span></span></span></span><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:6.33em;"><span style="top:-8.33em;"><span class="pstrut" style="height:4.0859em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord sqrt"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.0859em;"><span class="svg-align" style="top:-5em;"><span class="pstrut" style="height:5em;"></span><span class="mord" style="padding-left:1em;"><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.59em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">n</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.74em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mop op-symbol large-op" style="position:relative;top:0em;">∑</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.9468em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal" style="margin-right:0.07847em;">X</span></span><span style="top:-3.2523em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.1667em;"><span class="mord">^</span></span></span></span></span></span></span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7401em;"><span style="top:-2.989em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span><span style="top:-4.0459em;"><span class="pstrut" style="height:5em;"></span><span class="hide-tail" style="min-width:1.02em;height:3.08em;"><svg xmlns="http://www.w3.org/2000/svg" width='400em' height='3.08em' viewBox='0 0 400000 3240' preserveAspectRatio='xMinYMin slice'><path d='M473,2793c339.3,-1799.3,509.3,-2700,510,-2702 l0 -0c3.3,-7.3,9.3,-11,18,-11 H400000v40H1017.7s-90.5,478,-276.2,1466c-185.7,988,-279.5,1483,-281.5,1485c-2,6,-10,9,-24,9c-8,0,-12,-0.7,-12,-2c0,-1.3,-5.3,-32,-16,-92c-50.7,-293.3,-119.7,-693.3,-207,-1200c0,-1.3,-5.3,8.7,-16,30c-10.7,21.3,-21.3,42.7,-32,64s-16,33,-16,33s-26,-26,-26,-26s76,-153,76,-153s77,-151,77,-151c0.7,0.7,35.7,202,105,604c67.3,400.7,102,602.7,104,606zM1001 80h400000v40H1017.7z'/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.9541em;"><span></span></span></span></span></span></span></span><span style="top:-4.99em;"><span class="pstrut" style="height:4.0859em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord sqrt"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.0859em;"><span class="svg-align" style="top:-5em;"><span class="pstrut" style="height:5em;"></span><span class="mord" style="padding-left:1em;"><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.59em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">n</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.74em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mop op-symbol large-op" style="position:relative;top:0em;">∑</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.22222em;">Y</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.9468em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal" style="margin-right:0.22222em;">Y</span></span><span style="top:-3.2523em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.25em;"><span class="mord">^</span></span></span></span></span></span></span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7401em;"><span style="top:-2.989em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span><span style="top:-4.0459em;"><span class="pstrut" style="height:5em;"></span><span class="hide-tail" style="min-width:1.02em;height:3.08em;"><svg xmlns="http://www.w3.org/2000/svg" width='400em' height='3.08em' viewBox='0 0 400000 3240' preserveAspectRatio='xMinYMin slice'><path d='M473,2793c339.3,-1799.3,509.3,-2700,510,-2702 l0 -0c3.3,-7.3,9.3,-11,18,-11 H400000v40H1017.7s-90.5,478,-276.2,1466c-185.7,988,-279.5,1483,-281.5,1485c-2,6,-10,9,-24,9c-8,0,-12,-0.7,-12,-2c0,-1.3,-5.3,-32,-16,-92c-50.7,-293.3,-119.7,-693.3,-207,-1200c0,-1.3,-5.3,8.7,-16,30c-10.7,21.3,-21.3,42.7,-32,64s-16,33,-16,33s-26,-26,-26,-26s76,-153,76,-153s77,-151,77,-151c0.7,0.7,35.7,202,105,604c67.3,400.7,102,602.7,104,606zM1001 80h400000v40H1017.7z'/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.9541em;"><span></span></span></span></span></span></span></span><span style="top:-1.65em;"><span class="pstrut" style="height:4.0859em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord sqrt"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.0859em;"><span class="svg-align" style="top:-5em;"><span class="pstrut" style="height:5em;"></span><span class="mord" style="padding-left:1em;"><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.59em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">n</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.74em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mop op-symbol large-op" style="position:relative;top:0em;">∑</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.07153em;">Z</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.9468em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">Z</span></span><span style="top:-3.2523em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.1667em;"><span class="mord">^</span></span></span></span></span></span></span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7401em;"><span style="top:-2.989em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span><span style="top:-4.0459em;"><span class="pstrut" style="height:5em;"></span><span class="hide-tail" style="min-width:1.02em;height:3.08em;"><svg xmlns="http://www.w3.org/2000/svg" width='400em' height='3.08em' viewBox='0 0 400000 3240' preserveAspectRatio='xMinYMin slice'><path d='M473,2793c339.3,-1799.3,509.3,-2700,510,-2702 l0 -0c3.3,-7.3,9.3,-11,18,-11 H400000v40H1017.7s-90.5,478,-276.2,1466c-185.7,988,-279.5,1483,-281.5,1485c-2,6,-10,9,-24,9c-8,0,-12,-0.7,-12,-2c0,-1.3,-5.3,-32,-16,-92c-50.7,-293.3,-119.7,-693.3,-207,-1200c0,-1.3,-5.3,8.7,-16,30c-10.7,21.3,-21.3,42.7,-32,64s-16,33,-16,33s-26,-26,-26,-26s76,-153,76,-153s77,-151,77,-151c0.7,0.7,35.7,202,105,604c67.3,400.7,102,602.7,104,606zM1001 80h400000v40H1017.7z'/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.9541em;"><span></span></span></span></span></span></span></span><span style="top:0.8892em;"><span class="pstrut" style="height:4.0859em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord sqrt"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.2851em;"><span class="svg-align" style="top:-3.8em;"><span class="pstrut" style="height:3.8em;"></span><span class="mord" style="padding-left:1em;"><span class="mord"><span class="mord mathnormal">m</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.7959em;"><span style="top:-2.4065em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.07847em;">X</span></span></span><span style="top:-3.0448em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2935em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal">m</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.7959em;"><span style="top:-2.4065em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.22222em;">Y</span></span></span><span style="top:-3.0448em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2935em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal">m</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.7959em;"><span style="top:-2.4065em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.07153em;">Z</span></span></span><span style="top:-3.0448em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2935em;"><span></span></span></span></span></span></span></span></span><span style="top:-3.2451em;"><span class="pstrut" style="height:3.8em;"></span><span class="hide-tail" style="min-width:1.02em;height:1.88em;"><svg xmlns="http://www.w3.org/2000/svg" width='400em' height='1.88em' viewBox='0 0 400000 1944' preserveAspectRatio='xMinYMin slice'><path d='M983 90l0 -0c4,-6.7,10,-10,18,-10 H400000v40H1013.1s-83.4,268,-264.1,840c-180.7,572,-277,876.3,-289,913c-4.7,4.7,-12.7,7,-24,7s-12,0,-12,0c-1.3,-3.3,-3.7,-11.7,-7,-25c-35.3,-125.3,-106.7,-373.3,-214,-744c-10,12,-21,25,-33,39s-32,39,-32,39c-6,-5.3,-15,-14,-27,-26s25,-30,25,-30c26.7,-32.7,52,-63,76,-91s52,-60,52,-60s208,722,208,722c56,-175.3,126.3,-397.3,211,-666c84.7,-268.7,153.8,-488.2,207.5,-658.5c53.7,-170.3,84.5,-266.8,92.5,-289.5zM1001 80h400000v40h-400000z'/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.5549em;"><span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:5.83em;"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:5.83em;"><span></span></span></span></span></span></span></span><span class="tag"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:6.33em;"><span style="top:-8.33em;"><span class="pstrut" style="height:8.33em;"></span><span class="eqn-num"></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:5.83em;"><span></span></span></span></span></span></span></span></span></p><h3 id="方位元素解算">方位元素解算</h3><div class="note warning modern"><p>方位元素的计算参见教材。</p></div><p>对于 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>b</mi><mn>1</mn></msub><mo separator="true">,</mo><msub><mi>b</mi><mn>2</mn></msub></mrow><annotation encoding="application/x-tex">b_1,b_2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> 的计算方法，教材上似乎没有明确给出，个人认为其计算方法如下：</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mtable rowspacing="0.16em" columnspacing="1em"><mtr><mtd class ="mtr-glue"></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mtable rowspacing="0.25em" columnalign="right left" columnspacing="0em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><msub><mi>b</mi><mn>1</mn></msub></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>=</mo><mfrac><mrow><msub><mi>γ</mi><mn>3</mn></msub><msub><mi>l</mi><mn>2</mn></msub><mo>+</mo><msub><mi>b</mi><mn>3</mn></msub><msub><mi>x</mi><mn>0</mn></msub><mo>+</mo><msub><mi>b</mi><mn>2</mn></msub><msub><mi>f</mi><mi>x</mi></msub><mi>tan</mi><mo>⁡</mo><mrow><mi mathvariant="normal">d</mi><mi>β</mi></mrow></mrow><msub><mi>f</mi><mi>x</mi></msub></mfrac></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><msub><mi>b</mi><mn>2</mn></msub></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>=</mo><mfrac><mrow><msub><mi>γ</mi><mn>3</mn></msub><mo stretchy="false">(</mo><msub><mi>l</mi><mn>6</mn></msub><mo>+</mo><msub><mi>l</mi><mn>10</mn></msub><msub><mi>y</mi><mn>0</mn></msub><mo stretchy="false">)</mo><mo stretchy="false">(</mo><mn>1</mn><mo>+</mo><mi mathvariant="normal">d</mi><mi>s</mi><mo stretchy="false">)</mo><mi>cos</mi><mo>⁡</mo><mrow><mi mathvariant="normal">d</mi><mi>β</mi></mrow></mrow><msub><mi>f</mi><mi>x</mi></msub></mfrac></mrow></mstyle></mtd></mtr></mtable></mstyle></mtd><mtd class ="mtr-glue"></mtd><mtd class ="mml-eqn-num"></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{equation}\begin{aligned}b_1&amp;=\cfrac{\gamma_3l_2+b_3x_0+b_2f_x\tan{\mathrm{d}\beta}}{f_x}\\b_2&amp;=\cfrac{\gamma_3(l_6+l_{10}y_0)(1+\mathrm{d}s)\cos{\mathrm{d}\beta}}{f_x}\end{aligned}\end{equation}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:5.5409em;vertical-align:-2.5204em;"></span><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:3.0204em;"><span style="top:-5.0204em;"><span class="pstrut" style="height:5.0204em;"></span><span class="mord"><span class="mord"><span class="mtable"><span class="col-align-r"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:3.0204em;"><span style="top:-5.0204em;"><span class="pstrut" style="height:3.59em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-2.25em;"><span class="pstrut" style="height:3.59em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.5204em;"><span></span></span></span></span></span><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:3.0204em;"><span style="top:-5.0204em;"><span class="pstrut" style="height:3.59em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.59em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.1076em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">x</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.74em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:0.05556em;">γ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0556em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0197em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.1076em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">x</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mop">tan</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathrm">d</span><span class="mord mathnormal" style="margin-right:0.05278em;">β</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.8804em;"><span></span></span></span></span></span><span></span></span></span></span><span style="top:-2.25em;"><span class="pstrut" style="height:3.59em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.59em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.1076em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">x</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.74em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:0.05556em;">γ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0556em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0197em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">6</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0197em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">10</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mopen">(</span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord mathrm">d</span><span class="mord mathnormal">s</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mop">cos</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathrm">d</span><span class="mord mathnormal" style="margin-right:0.05278em;">β</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.8804em;"><span></span></span></span></span></span><span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.5204em;"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.5204em;"><span></span></span></span></span></span></span></span><span class="tag"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:3.0204em;"><span style="top:-5.0204em;"><span class="pstrut" style="height:5.0204em;"></span><span class="eqn-num"></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.5204em;"><span></span></span></span></span></span></span></span></span></p>]]></content>
      
      
      <categories>
          
          <category> 课程学习 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 摄影测量 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>坦克大战记录</title>
      <link href="/posts/8baa3f41.html"/>
      <url>/posts/8baa3f41.html</url>
      
        <content type="html"><![CDATA[<h2 id="前言-13">前言</h2><p>这是大一时写的代码了，有时间了把它放上来，顺便看看自己现在写代码有没有长进。印象中大一写这个坦克大战时真的是被逼得死去活来的，难是真的难，不知道现在这门课还是不是这个坦克大战的作业了，如果要借鉴的话一定注意不要照搬啊！</p><blockquote><p>工程文件请见：<a href="/resources#%E5%B7%A5%E7%A8%8B%E4%BB%A3%E7%A0%81">面向对象的程序设计</a></p></blockquote><hr><h2 id="主要功能-2">主要功能</h2><p>坦克大战程序实现了游戏中<strong>水池</strong>、<strong>石墙</strong>、<strong>草丛</strong>、<strong>铁墙</strong>的基本功能，还创新地添加了<strong>木箱</strong>。坦克、炮弹、方块之间可以进行<strong>碰撞检测</strong>。并且实现了游戏的<strong>结束判定</strong>。使用<code>WSAD</code>移动，<code>space</code>发射子弹，<code>K</code>自杀，<code>P</code>开启“作弊”（铁墙保护和生命增加等）</p><ul><li><p>生命值：被敌人击中生命会减少，并且回到重生点，生命值为0，游戏结束。</p></li><li><p>水池：子弹能通过，但坦克无法通过。</p></li><li><p>木箱：子弹不能通过，坦克无法通过，并且木箱在接触子弹或其它方块时被摧毁，可以是唯一可以被坦克推动的方块。</p></li><li><p>砖墙： 子弹不能通过，坦克无法通过，并且在接触子弹后被摧毁。</p></li><li><p>草丛：子弹、坦克均可通过，并且会被掩藏。</p></li><li><p>铁墙：任何物体都不可通过，无法摧毁。</p></li><li><p>基地：被子弹打中或被敌人入侵游戏即结束，友方坦克可以通过。</p></li></ul><h2 id="主要类">主要类</h2><h3 id="object类"><code>object</code>类</h3><p><code>object</code>类是所有物体的基类。</p><p><strong>属性</strong></p><ul><li><code>m_rct</code>：位置</li><li><code>m_nDir</code>：方向</li><li><code>m_nSpeed</code>：速度</li><li><code>m_movable</code>：可否移动</li></ul><p><strong>函数</strong></p><ul><li>基本的碰撞的函数</li></ul><h3 id="Tank类"><code>Tank</code>类</h3><p><code>Tank</code>类继承自<code>object</code>类。</p><p><strong>属性</strong></p><ul><li><code>m_life</code>：生命</li></ul><p><strong>函数</strong></p><ul><li><p>虚函数</p><ul><li><code>show()</code></li><li><code>fire()</code></li></ul></li><li><p>普通函数</p><ul><li><code>life_decease()</code>：生命减少</li><li><code>TisOverlap()</code>：坦克碰撞函数</li><li><code>TOisOverlap()</code>：坦克碰撞函数</li></ul></li></ul><h3 id="MyTank类"><code>MyTank</code>类</h3><p><code>MyTank</code>类继承自<code>Tank</code>类。</p><p>属性</p><ul><li><code>m_move</code>：是否处于移动状态，是实现移动开炮同时进行的变量</li><li><code>m_respanpos</code>：重生点</li><li><code>m_img</code>：静态成员变量、存储贴图</li></ul><p>函数</p><ul><li><p>虚函数</p><ul><li><code>Show()</code>：重写虚函数</li></ul></li><li><p>普通函数</p><ul><li><code>respan()</code>：重生</li><li><code>gameover()</code>：游戏结束</li><li><code>show_life()</code>：生命显示</li><li><code>myMove()</code>：移动</li><li><code>setDir()</code>：转向</li></ul></li></ul><h3 id="EneTank类"><code>EneTank</code>类</h3><p><code>EneTank</code>类继承自<code>Tank</code>类。</p><p>属性</p><ul><li><p><code>ene_img</code>：静态成员变量，存储贴图</p></li><li><p><code>level</code>：静态成员变量，存储难度</p></li><li><p><code>total_num</code>：静态成员变量，存储消灭坦克数量</p></li><li><p><code>m_time</code>：记录开炮时间</p></li><li><p><code>m_firetime</code>：记录运动的时间</p></li><li><p><code>m_span</code>：开炮时间间隔</p></li><li><p><code>m_firespan</code>：开火时间间隔</p></li></ul><p>函数</p><ul><li><p>虚函数</p><ul><li><code>Show()</code>：重写虚函数</li></ul></li><li><p>普通函数</p><ul><li><code>AutoMove()</code>：自动移动</li><li><code>ChangeDir()</code>：自动转向</li><li><code>re_time()</code>：立即转向</li><li><code>fireClock()</code>：开炮计与重置时</li><li><code>eme_down()</code>：敌人死亡</li></ul></li></ul><h3 id="Shell类"><code>Shell</code>类</h3><p><code>Shell</code>类继承自<code>object</code>类。</p><p>属性</p><ul><li><code>m_inbox</code>：是否在界面内</li><li><code>m_time</code>：飞行时间</li><li><code>m_iniRct</code>：初始位置</li><li><code>s_img</code>：静态成员变量、存储贴图</li></ul><p>函数</p><ul><li>虚函数<code>Show()</code>：重写</li><li>其他函数<ul><li><code>create()</code>：创建</li><li><code>SSisOverlap()</code>：炮弹碰撞</li><li><code>UpdatePos()</code>：更新位置</li></ul></li></ul><h3 id="Wall类"><code>Wall</code>类</h3><p><code>Wall</code>类继承自<code>object</code>类。</p><p>属性</p><ul><li><code>type</code>：墙的类型<ul><li><code>ShellPass</code></li><li><code>TankPass</code></li></ul></li><li><code>destroyable</code>：是否可破坏</li><li><code>w_img</code>：静态成员变量、存储贴图</li></ul><p>函数</p><ul><li><p>虚函数</p><ul><li><code>Show()</code>：重写</li><li><code>Move()</code>：重写</li><li><code>disappear()</code></li></ul></li><li><p>其他函数</p></li></ul><h2 id="关键功能">关键功能</h2><div class="note warning modern"><p>此部分内容待更新！</p></div><h3 id="多线程">多线程</h3><h3 id="碰撞检测">碰撞检测</h3><h3 id="计时器">计时器</h3><h3 id="屏幕绘制">屏幕绘制</h3><h3 id="按键检测">按键检测</h3><h3 id="随机行为">随机行为</h3><hr><h2 id="代码-2">代码</h2><h3 id="Fighting-h"><code>Fighting.h</code></h3><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">// Fighting.h: PROJECT_NAME 应用程序的主头文件</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">pragma</span> once</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">ifndef</span> __AFXWIN_H__</span></span><br><span class="line"><span class="meta">#<span class="keyword">error</span> <span class="string">&quot;在包含此文件之前包含 &#x27;pch.h&#x27; 以生成 PCH&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;resource.h&quot;</span><span class="comment">// 主符号</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// CFightingApp:</span></span><br><span class="line"><span class="comment">// 有关此类的实现，请参阅 Fighting.cpp</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CFightingApp</span> : <span class="keyword">public</span> CWinApp</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"><span class="built_in">CFightingApp</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 重写</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"><span class="function"><span class="keyword">virtual</span> BOOL <span class="title">InitInstance</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 实现</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">DECLARE_MESSAGE_MAP</span>()</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">extern</span> CFightingApp theApp;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="Fighting-cpp"><code>Fighting.cpp</code></h3><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">// Fighting.cpp: 定义应用程序的类行为。</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;pch.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;framework.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Fighting.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;FightingDlg.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">ifdef</span> _DEBUG</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> new DEBUG_NEW</span></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// CFightingApp</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">BEGIN_MESSAGE_MAP</span>(CFightingApp, CWinApp)</span><br><span class="line"><span class="built_in">ON_COMMAND</span>(ID_HELP, &amp;CWinApp::OnHelp)</span><br><span class="line"><span class="built_in">END_MESSAGE_MAP</span>()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// CFightingApp 构造</span></span><br><span class="line"></span><br><span class="line">CFightingApp::<span class="built_in">CFightingApp</span>()</span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">// 支持重新启动管理器</span></span><br><span class="line">m_dwRestartManagerSupportFlags = AFX_RESTART_MANAGER_SUPPORT_RESTART;</span><br><span class="line"></span><br><span class="line"><span class="comment">// <span class="doctag">TODO:</span> 在此处添加构造代码，</span></span><br><span class="line"><span class="comment">// 将所有重要的初始化放置在 InitInstance 中</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 唯一的 CFightingApp 对象</span></span><br><span class="line"></span><br><span class="line">CFightingApp theApp;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// CFightingApp 初始化</span></span><br><span class="line"></span><br><span class="line"><span class="function">BOOL <span class="title">CFightingApp::InitInstance</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="comment">// 如果一个运行在 Windows XP 上的应用程序清单指定要</span></span><br><span class="line"><span class="comment">// 使用 ComCtl32.dll 版本 6 或更高版本来启用可视化方式，</span></span><br><span class="line"><span class="comment">//则需要 InitCommonControlsEx()。  否则，将无法创建窗口。</span></span><br><span class="line">INITCOMMONCONTROLSEX InitCtrls;</span><br><span class="line">InitCtrls.dwSize = <span class="built_in">sizeof</span>(InitCtrls);</span><br><span class="line"><span class="comment">// 将它设置为包括所有要在应用程序中使用的</span></span><br><span class="line"><span class="comment">// 公共控件类。</span></span><br><span class="line">InitCtrls.dwICC = ICC_WIN95_CLASSES;</span><br><span class="line"><span class="built_in">InitCommonControlsEx</span>(&amp;InitCtrls);</span><br><span class="line"></span><br><span class="line">CWinApp::<span class="built_in">InitInstance</span>();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">AfxEnableControlContainer</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建 shell 管理器，以防对话框包含</span></span><br><span class="line"><span class="comment">// 任何 shell 树视图控件或 shell 列表视图控件。</span></span><br><span class="line">CShellManager *pShellManager = <span class="keyword">new</span> CShellManager;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 激活“Windows Native”视觉管理器，以便在 MFC 控件中启用主题</span></span><br><span class="line">CMFCVisualManager::<span class="built_in">SetDefaultManager</span>(<span class="built_in">RUNTIME_CLASS</span>(CMFCVisualManagerWindows));</span><br><span class="line"></span><br><span class="line"><span class="comment">// 标准初始化</span></span><br><span class="line"><span class="comment">// 如果未使用这些功能并希望减小</span></span><br><span class="line"><span class="comment">// 最终可执行文件的大小，则应移除下列</span></span><br><span class="line"><span class="comment">// 不需要的特定初始化例程</span></span><br><span class="line"><span class="comment">// 更改用于存储设置的注册表项</span></span><br><span class="line"><span class="comment">// <span class="doctag">TODO:</span> 应适当修改该字符串，</span></span><br><span class="line"><span class="comment">// 例如修改为公司或组织名</span></span><br><span class="line"><span class="built_in">SetRegistryKey</span>(_T(<span class="string">&quot;应用程序向导生成的本地应用程序&quot;</span>));</span><br><span class="line"></span><br><span class="line">CFightingDlg dlg;</span><br><span class="line">m_pMainWnd = &amp;dlg;</span><br><span class="line">INT_PTR nResponse = dlg.<span class="built_in">DoModal</span>();</span><br><span class="line"><span class="keyword">if</span> (nResponse == IDOK)</span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">// <span class="doctag">TODO:</span> 在此放置处理何时用</span></span><br><span class="line"><span class="comment">//  “确定”来关闭对话框的代码</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (nResponse == IDCANCEL)</span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">// <span class="doctag">TODO:</span> 在此放置处理何时用</span></span><br><span class="line"><span class="comment">//  “取消”来关闭对话框的代码</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (nResponse == <span class="number">-1</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">TRACE</span>(traceAppMsg, <span class="number">0</span>, <span class="string">&quot;警告: 对话框创建失败，应用程序将意外终止。\n&quot;</span>);</span><br><span class="line"><span class="built_in">TRACE</span>(traceAppMsg, <span class="number">0</span>, <span class="string">&quot;警告: 如果您在对话框上使用 MFC 控件，则无法 #define _AFX_NO_MFC_CONTROLS_IN_DIALOGS。\n&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 删除上面创建的 shell 管理器。</span></span><br><span class="line"><span class="keyword">if</span> (pShellManager != <span class="literal">nullptr</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">delete</span> pShellManager;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">if</span> !defined(_AFXDLL) &amp;&amp; !defined(_AFX_NO_MFC_CONTROLS_IN_DIALOGS)</span></span><br><span class="line"><span class="built_in">ControlBarCleanUp</span>();</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 由于对话框已关闭，所以将返回 FALSE 以便退出应用程序，</span></span><br><span class="line"><span class="comment">//  而不是启动应用程序的消息泵。</span></span><br><span class="line"><span class="keyword">return</span> FALSE;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="FightingDlg-h"><code>FightingDlg.h</code></h3><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">// FightingDlg.h: 头文件</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">pragma</span> once</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Object.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Shell.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;wall.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;EneTank.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;MyTank.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;thread&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;mutex&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;Windows.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// CFightingDlg 对话框</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CFightingDlg</span> : <span class="keyword">public</span> CDialogEx</span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">// 构造</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"><span class="built_in">CFightingDlg</span>(CWnd* pParent = <span class="literal">nullptr</span>);<span class="comment">// 标准构造函数</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 对话框数据</span></span><br><span class="line"><span class="meta">#<span class="keyword">ifdef</span> AFX_DESIGN_TIME</span></span><br><span class="line"><span class="keyword">enum</span> &#123; IDD = IDD_FIGHTING_DIALOG &#125;;</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">protected</span>:</span><br><span class="line"><span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">DoDataExchange</span><span class="params">(CDataExchange* pDX)</span></span>;<span class="comment">// DDX/DDV 支持</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">bool</span> work;</span><br><span class="line"><span class="type">static</span> MyTank myTank;</span><br><span class="line"><span class="type">static</span> vector&lt;EneTank&gt;eneTank;</span><br><span class="line"><span class="type">static</span> vector&lt;Shell&gt;myvecShell;</span><br><span class="line"><span class="type">static</span> vector&lt;Shell&gt;enevecShell;</span><br><span class="line"><span class="type">static</span> vector&lt;wall&gt;vecWall;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> mutex mut;</span><br><span class="line"><span class="function"><span class="type">static</span> <span class="type">void</span> <span class="title">Collide1</span><span class="params">()</span></span>;</span><br><span class="line"><span class="function"><span class="type">static</span> <span class="type">void</span> <span class="title">Collide2</span><span class="params">()</span></span>;</span><br><span class="line"><span class="comment">//static void threadTT();</span></span><br><span class="line"><span class="comment">//static void threadSS();</span></span><br><span class="line"><span class="comment">//static void threadTS();</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 实现</span></span><br><span class="line"><span class="keyword">protected</span>:</span><br><span class="line">HICON m_hIcon;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 生成的消息映射函数</span></span><br><span class="line"><span class="function"><span class="keyword">virtual</span> BOOL <span class="title">OnInitDialog</span><span class="params">()</span></span>;</span><br><span class="line"><span class="function">afx_msg <span class="type">void</span> <span class="title">OnSysCommand</span><span class="params">(UINT nID, LPARAM lParam)</span></span>;</span><br><span class="line"><span class="function">afx_msg <span class="type">void</span> <span class="title">OnPaint</span><span class="params">()</span></span>;</span><br><span class="line"><span class="function">afx_msg HCURSOR <span class="title">OnQueryDragIcon</span><span class="params">()</span></span>;</span><br><span class="line"><span class="built_in">DECLARE_MESSAGE_MAP</span>()</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"><span class="function">afx_msg <span class="type">void</span> <span class="title">OnTimer</span><span class="params">(UINT_PTR nIDEvent)</span></span>;</span><br><span class="line"><span class="function">afx_msg <span class="type">void</span> <span class="title">OnKeyDown</span><span class="params">(UINT nChar, UINT nRepCnt, UINT nFlags)</span></span>;</span><br><span class="line"><span class="comment">//afx_msg void OnKeyUp(UINT nChar, UINT nRepCnt, UINT nFlags);</span></span><br><span class="line"><span class="function">afx_msg BOOL <span class="title">OnEraseBkgnd</span><span class="params">(CDC* pDC)</span></span>;</span><br><span class="line"><span class="function">afx_msg <span class="type">void</span> <span class="title">OnDestroy</span><span class="params">()</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">virtual</span> BOOL <span class="title">PreTranslateMessage</span><span class="params">(MSG* pMsg)</span></span>;</span><br><span class="line"><span class="function">afx_msg <span class="type">void</span> <span class="title">OnKeyUp</span><span class="params">(UINT nChar, UINT nRepCnt, UINT nFlags)</span></span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="FightingDlg-cpp"><code>FightingDlg.cpp</code></h3><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">// FightingDlg.cpp: 实现文件</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;pch.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;framework.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Fighting.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;FightingDlg.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;afxdialogex.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Shell.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">ifdef</span> _DEBUG</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> new DEBUG_NEW</span></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"></span><br><span class="line">CPoint EneTank::birth[<span class="number">3</span>] = &#123; <span class="built_in">CPoint</span>(<span class="number">100</span>,<span class="number">100</span>),<span class="built_in">CPoint</span>(<span class="number">300</span>,<span class="number">100</span>),<span class="built_in">CPoint</span>(<span class="number">500</span>,<span class="number">100</span>) &#125;;</span><br><span class="line"></span><br><span class="line">MyTank CFightingDlg::myTank;</span><br><span class="line">vector&lt;EneTank&gt; CFightingDlg::eneTank;</span><br><span class="line">vector&lt;Shell&gt; CFightingDlg::myvecShell;</span><br><span class="line">vector&lt;Shell&gt; CFightingDlg::enevecShell;</span><br><span class="line">vector&lt;wall&gt; CFightingDlg::vecWall;</span><br><span class="line">CString str;</span><br><span class="line"><span class="type">int</span> shell_num ;</span><br><span class="line"><span class="type">bool</span> CFightingDlg::work = <span class="literal">true</span>;</span><br><span class="line">mutex CFightingDlg::mut;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">CFightingDlg::Collide1</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="type">int</span> i, j;</span><br><span class="line">CRect tank;</span><br><span class="line"><span class="keyword">while</span> (work)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span> (mut.<span class="built_in">try_lock</span>())</span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">//////炮弹碰撞//////</span></span><br><span class="line"><span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; myvecShell.<span class="built_in">size</span>(); i++)</span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">//我方炮弹出界</span></span><br><span class="line"><span class="keyword">if</span> (!myvecShell[i].m_inbox)</span><br><span class="line">&#123;</span><br><span class="line">myvecShell.<span class="built_in">erase</span>(myvecShell.<span class="built_in">begin</span>() + i);</span><br><span class="line">i--;</span><br><span class="line"><span class="keyword">continue</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//敌我炮弹碰撞</span></span><br><span class="line"><span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; enevecShell.<span class="built_in">size</span>(); j++)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span> (myvecShell[i].<span class="built_in">SSisOverlap</span>(enevecShell[j]))</span><br><span class="line">&#123;</span><br><span class="line">myvecShell.<span class="built_in">erase</span>(myvecShell.<span class="built_in">begin</span>() + i);</span><br><span class="line">enevecShell.<span class="built_in">erase</span>(enevecShell.<span class="built_in">begin</span>() + j);</span><br><span class="line">i--;</span><br><span class="line">j--;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//敌方炮弹出界</span></span><br><span class="line"><span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;enevecShell.<span class="built_in">size</span>();i++)</span><br><span class="line"><span class="keyword">if</span> (!enevecShell[i].m_inbox)</span><br><span class="line">&#123;</span><br><span class="line">enevecShell.<span class="built_in">erase</span>(enevecShell.<span class="built_in">begin</span>() + i);</span><br><span class="line">i--;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//////敌方坦克与我方炮弹//////</span></span><br><span class="line"><span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; eneTank.<span class="built_in">size</span>(); i++)</span><br><span class="line">&#123;</span><br><span class="line">tank = eneTank[i].<span class="built_in">GetPos</span>();</span><br><span class="line"><span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; myvecShell.<span class="built_in">size</span>(); j++)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span> (myvecShell[j].<span class="built_in">IsOverLap</span>(tank))</span><br><span class="line">&#123;</span><br><span class="line">myvecShell.<span class="built_in">erase</span>(myvecShell.<span class="built_in">begin</span>() + j);</span><br><span class="line">eneTank.<span class="built_in">erase</span>(eneTank.<span class="built_in">begin</span>() + i);</span><br><span class="line">EneTank::<span class="built_in">eme_down</span>();</span><br><span class="line">i--;</span><br><span class="line"></span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//玩家坦克与敌方炮弹</span></span><br><span class="line"><span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; enevecShell.<span class="built_in">size</span>(); i++)</span><br><span class="line">&#123;</span><br><span class="line">tank = myTank.<span class="built_in">GetPos</span>();</span><br><span class="line"><span class="keyword">if</span> (enevecShell[i].<span class="built_in">IsOverLap</span>(tank))</span><br><span class="line">&#123;</span><br><span class="line">myTank.<span class="built_in">lifedecrease</span>();</span><br><span class="line">myTank.<span class="built_in">respan</span>();</span><br><span class="line">enevecShell.<span class="built_in">erase</span>(enevecShell.<span class="built_in">begin</span>() + i);</span><br><span class="line">i--;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//////坦克碰撞//////</span></span><br><span class="line"><span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; eneTank.<span class="built_in">size</span>(); i++)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span> (myTank.<span class="built_in">TOisOverlap</span>(eneTank[i]))</span><br><span class="line">&#123;</span><br><span class="line">eneTank[i].<span class="built_in">re_time</span>();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">myTank.<span class="built_in">IsOut</span>();</span><br><span class="line"><span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; eneTank.<span class="built_in">size</span>(); i++)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; eneTank.<span class="built_in">size</span>(); j++)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span> (i != j)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span> (eneTank[i].<span class="built_in">TOisOverlap</span>(eneTank[j]))</span><br><span class="line">&#123;</span><br><span class="line">eneTank[i].<span class="built_in">re_time</span>();</span><br><span class="line">eneTank[j].<span class="built_in">re_time</span>();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (eneTank[i].<span class="built_in">TOisOverlap</span>(myTank) || eneTank[i].<span class="built_in">IsOut</span>())</span><br><span class="line">&#123;</span><br><span class="line">eneTank[i].<span class="built_in">re_time</span>();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">mut.<span class="built_in">unlock</span>();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">CFightingDlg::Collide2</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="type">int</span> i=<span class="number">0</span>, j=<span class="number">0</span>;</span><br><span class="line"><span class="type">bool</span> check = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> (work)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span> (mut.<span class="built_in">try_lock</span>())</span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">//炮弹与墙</span></span><br><span class="line"><span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; myvecShell.<span class="built_in">size</span>(); i++)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">for</span> (j = <span class="number">0</span>, check = <span class="literal">false</span>; j &lt; vecWall.<span class="built_in">size</span>(); j++)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span> (vecWall[j].<span class="built_in">IsOverLap</span>(myvecShell[i].<span class="built_in">GetPos</span>()))</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span> (vecWall[j].type == BASE)</span><br><span class="line">&#123;</span><br><span class="line">myTank.<span class="built_in">gameover</span>();</span><br><span class="line">work = <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (vecWall[j].ShellPass)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">continue</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">check = <span class="literal">true</span>;</span><br><span class="line"><span class="keyword">if</span> (vecWall[j].destroyable)</span><br><span class="line">&#123;</span><br><span class="line">vecWall.<span class="built_in">erase</span>(vecWall.<span class="built_in">begin</span>() + j);</span><br><span class="line">j--;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (check)</span><br><span class="line">&#123;</span><br><span class="line">myvecShell.<span class="built_in">erase</span>(myvecShell.<span class="built_in">begin</span>() + i);</span><br><span class="line">i--;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; enevecShell.<span class="built_in">size</span>(); i++)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">for</span> (j = <span class="number">0</span>, check = <span class="literal">false</span>; j &lt; vecWall.<span class="built_in">size</span>(); j++)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span> (vecWall[j].<span class="built_in">IsOverLap</span>(enevecShell[i].<span class="built_in">GetPos</span>()))</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span> (vecWall[j].type == BASE)</span><br><span class="line">&#123;</span><br><span class="line">myTank.<span class="built_in">gameover</span>();</span><br><span class="line">work = <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(vecWall[j].ShellPass)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">continue</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">check = <span class="literal">true</span>;</span><br><span class="line"><span class="keyword">if</span> (vecWall[j].destroyable)</span><br><span class="line">&#123;</span><br><span class="line">vecWall.<span class="built_in">erase</span>(vecWall.<span class="built_in">begin</span>() + j);</span><br><span class="line">j--;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (check)</span><br><span class="line">&#123;</span><br><span class="line">enevecShell.<span class="built_in">erase</span>(enevecShell.<span class="built_in">begin</span>() + i);</span><br><span class="line">i--;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//坦克与墙</span></span><br><span class="line"><span class="comment">//敌方</span></span><br><span class="line"><span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; eneTank.<span class="built_in">size</span>(); i++)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; vecWall.<span class="built_in">size</span>(); j++)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span> (vecWall[j].type == BASE)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span> (vecWall[j].<span class="built_in">IsOverLap</span>(eneTank[i].<span class="built_in">GetPos</span>()))</span><br><span class="line">&#123;</span><br><span class="line">myTank.<span class="built_in">gameover</span>();</span><br><span class="line">work = <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (vecWall[j].type!=GRASS&amp;&amp;eneTank[i].<span class="built_in">TOisOverlap</span>(vecWall[j]))</span><br><span class="line">&#123;</span><br><span class="line">eneTank[i].<span class="built_in">re_time</span>();</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//玩家</span></span><br><span class="line"><span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; vecWall.<span class="built_in">size</span>(); j++)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span> (!vecWall[j].TankPass)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span> (myTank.<span class="built_in">TOisOverlap</span>(vecWall[j]))</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//墙与墙</span></span><br><span class="line"><span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; vecWall.<span class="built_in">size</span>(); j++)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; vecWall.<span class="built_in">size</span>(); i++)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span> (vecWall[j].m_movable &amp;&amp; j != i)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span> (vecWall[j].<span class="built_in">IsOverLap</span>(vecWall[i].<span class="built_in">GetPos</span>())&amp;&amp; vecWall[i].type!=GRASS)</span><br><span class="line">&#123;</span><br><span class="line">vecWall.<span class="built_in">erase</span>(vecWall.<span class="built_in">begin</span>() + j);</span><br><span class="line">j--;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line">vecWall[j].<span class="built_in">IsOut</span>();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">mut.<span class="built_in">unlock</span>();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 用于应用程序“关于”菜单项的 CAboutDlg 对话框</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CAboutDlg</span> : <span class="keyword">public</span> CDialogEx</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"><span class="built_in">CAboutDlg</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 对话框数据</span></span><br><span class="line"><span class="meta">#<span class="keyword">ifdef</span> AFX_DESIGN_TIME</span></span><br><span class="line"><span class="keyword">enum</span> &#123; IDD = IDD_ABOUTBOX &#125;;</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">protected</span>:</span><br><span class="line"><span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">DoDataExchange</span><span class="params">(CDataExchange* pDX)</span></span>;    <span class="comment">// DDX/DDV 支持</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 实现</span></span><br><span class="line"><span class="keyword">protected</span>:</span><br><span class="line"><span class="built_in">DECLARE_MESSAGE_MAP</span>()</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">CAboutDlg::<span class="built_in">CAboutDlg</span>() : <span class="built_in">CDialogEx</span>(IDD_ABOUTBOX)</span><br><span class="line">&#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">CAboutDlg::DoDataExchange</span><span class="params">(CDataExchange* pDX)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">CDialogEx::<span class="built_in">DoDataExchange</span>(pDX);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">BEGIN_MESSAGE_MAP</span>(CAboutDlg, CDialogEx)</span><br><span class="line"><span class="built_in">END_MESSAGE_MAP</span>()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// CFightingDlg 对话框</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">CFightingDlg::<span class="built_in">CFightingDlg</span>(CWnd* pParent <span class="comment">/*=nullptr*/</span>)</span><br><span class="line">: <span class="built_in">CDialogEx</span>(IDD_FIGHTING_DIALOG, pParent)</span><br><span class="line">&#123;</span><br><span class="line">m_hIcon = <span class="built_in">AfxGetApp</span>()-&gt;<span class="built_in">LoadIcon</span>(IDR_MAINFRAME);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">CFightingDlg::DoDataExchange</span><span class="params">(CDataExchange* pDX)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">CDialogEx::<span class="built_in">DoDataExchange</span>(pDX);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">BEGIN_MESSAGE_MAP</span>(CFightingDlg, CDialogEx)</span><br><span class="line"><span class="built_in">ON_WM_SYSCOMMAND</span>()</span><br><span class="line"><span class="built_in">ON_WM_PAINT</span>()</span><br><span class="line"><span class="built_in">ON_WM_QUERYDRAGICON</span>()</span><br><span class="line"><span class="built_in">ON_WM_TIMER</span>()</span><br><span class="line"><span class="built_in">ON_WM_KEYDOWN</span>()</span><br><span class="line"><span class="comment">//ON_WM_KEYUP()</span></span><br><span class="line"><span class="comment">//ON_WM_ERASEBKGND()</span></span><br><span class="line"><span class="built_in">ON_WM_ERASEBKGND</span>()</span><br><span class="line"><span class="built_in">ON_WM_DESTROY</span>()</span><br><span class="line"><span class="built_in">ON_WM_KEYUP</span>()</span><br><span class="line"><span class="built_in">END_MESSAGE_MAP</span>()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// CFightingDlg 消息处理程序</span></span><br><span class="line"></span><br><span class="line"><span class="function">BOOL <span class="title">CFightingDlg::OnInitDialog</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">CDialogEx::<span class="built_in">OnInitDialog</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 将“关于...”菜单项添加到系统菜单中。</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// IDM_ABOUTBOX 必须在系统命令范围内。</span></span><br><span class="line"><span class="built_in">ASSERT</span>((IDM_ABOUTBOX &amp; <span class="number">0xFFF0</span>) == IDM_ABOUTBOX);</span><br><span class="line"><span class="built_in">ASSERT</span>(IDM_ABOUTBOX &lt; <span class="number">0xF000</span>);</span><br><span class="line"></span><br><span class="line">CMenu* pSysMenu = <span class="built_in">GetSystemMenu</span>(FALSE);</span><br><span class="line"><span class="keyword">if</span> (pSysMenu != <span class="literal">nullptr</span>)</span><br><span class="line">&#123;</span><br><span class="line">BOOL bNameValid;</span><br><span class="line">CString strAboutMenu;</span><br><span class="line">bNameValid = strAboutMenu.<span class="built_in">LoadString</span>(IDS_ABOUTBOX);</span><br><span class="line"><span class="built_in">ASSERT</span>(bNameValid);</span><br><span class="line"><span class="keyword">if</span> (!strAboutMenu.<span class="built_in">IsEmpty</span>())</span><br><span class="line">&#123;</span><br><span class="line">pSysMenu-&gt;<span class="built_in">AppendMenu</span>(MF_SEPARATOR);</span><br><span class="line">pSysMenu-&gt;<span class="built_in">AppendMenu</span>(MF_STRING, IDM_ABOUTBOX, strAboutMenu);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 设置此对话框的图标。  当应用程序主窗口不是对话框时，框架将自动</span></span><br><span class="line"><span class="comment">//  执行此操作</span></span><br><span class="line"><span class="built_in">SetIcon</span>(m_hIcon, TRUE);<span class="comment">// 设置大图标</span></span><br><span class="line"><span class="built_in">SetIcon</span>(m_hIcon, FALSE);<span class="comment">// 设置小图标</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// <span class="doctag">TODO:</span> 在此添加额外的初始化代码</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">SetTimer</span>(<span class="number">1</span>, <span class="number">40</span>, <span class="literal">NULL</span>);</span><br><span class="line"><span class="built_in">SetTimer</span>(<span class="number">2</span>, <span class="number">20000</span>, <span class="literal">NULL</span>);</span><br><span class="line"><span class="built_in">SetTimer</span>(<span class="number">3</span>, <span class="number">20</span>, <span class="literal">NULL</span>);</span><br><span class="line"><span class="built_in">srand</span>(<span class="built_in">time</span>(<span class="literal">NULL</span>) * <span class="built_in">time</span>(<span class="literal">NULL</span>));</span><br><span class="line">shell_num = <span class="number">2</span>;<span class="comment">//坦克可发射炮弹数</span></span><br><span class="line"></span><br><span class="line"><span class="comment">////////贴图导入////////</span></span><br><span class="line">CString strFileName;</span><br><span class="line">TCHAR cPath[<span class="number">1024</span>];</span><br><span class="line"><span class="built_in">GetModuleFileName</span>(<span class="literal">NULL</span>, cPath, <span class="number">1024</span>);</span><br><span class="line">strFileName = cPath;</span><br><span class="line">CString str;</span><br><span class="line"><span class="comment">//对炮弹的静态成员变量赋值</span></span><br><span class="line">str = strFileName.<span class="built_in">Left</span>(strFileName.<span class="built_in">ReverseFind</span>(<span class="string">&#x27;\\&#x27;</span>) + <span class="number">1</span>) + <span class="string">L&quot;material\\shell.png&quot;</span>;</span><br><span class="line">Shell::s_img.<span class="built_in">Load</span>(str);</span><br><span class="line"><span class="comment">//对敌方坦克的静态成员变量赋值</span></span><br><span class="line">str = strFileName.<span class="built_in">Left</span>(strFileName.<span class="built_in">ReverseFind</span>(<span class="string">&#x27;\\&#x27;</span>) + <span class="number">1</span>) + <span class="string">L&quot;material\\eneTank0.png&quot;</span>;</span><br><span class="line">EneTank::ene_img[<span class="number">0</span>].<span class="built_in">Load</span>(str);</span><br><span class="line">str = strFileName.<span class="built_in">Left</span>(strFileName.<span class="built_in">ReverseFind</span>(<span class="string">&#x27;\\&#x27;</span>) + <span class="number">1</span>) + <span class="string">L&quot;material\\eneTank1.png&quot;</span>;</span><br><span class="line">EneTank::ene_img[<span class="number">1</span>].<span class="built_in">Load</span>(str);</span><br><span class="line">str = strFileName.<span class="built_in">Left</span>(strFileName.<span class="built_in">ReverseFind</span>(<span class="string">&#x27;\\&#x27;</span>) + <span class="number">1</span>) + <span class="string">L&quot;material\\eneTank2.png&quot;</span>;</span><br><span class="line">EneTank::ene_img[<span class="number">2</span>].<span class="built_in">Load</span>(str);</span><br><span class="line">str = strFileName.<span class="built_in">Left</span>(strFileName.<span class="built_in">ReverseFind</span>(<span class="string">&#x27;\\&#x27;</span>) + <span class="number">1</span>) + <span class="string">L&quot;material\\eneTank3.png&quot;</span>;</span><br><span class="line">EneTank::ene_img[<span class="number">3</span>].<span class="built_in">Load</span>(str);</span><br><span class="line"><span class="comment">//墙</span></span><br><span class="line">str = strFileName.<span class="built_in">Left</span>(strFileName.<span class="built_in">ReverseFind</span>(<span class="string">&#x27;\\&#x27;</span>) + <span class="number">1</span>) + <span class="string">L&quot;material\\0.png&quot;</span>;</span><br><span class="line">wall::w_img[BRICK].<span class="built_in">Load</span>(str);</span><br><span class="line">str = strFileName.<span class="built_in">Left</span>(strFileName.<span class="built_in">ReverseFind</span>(<span class="string">&#x27;\\&#x27;</span>) + <span class="number">1</span>) + <span class="string">L&quot;material\\1.png&quot;</span>;</span><br><span class="line">wall::w_img[METAL].<span class="built_in">Load</span>(str);</span><br><span class="line">str = strFileName.<span class="built_in">Left</span>(strFileName.<span class="built_in">ReverseFind</span>(<span class="string">&#x27;\\&#x27;</span>) + <span class="number">1</span>) + <span class="string">L&quot;material\\2.png&quot;</span>;</span><br><span class="line">wall::w_img[GRASS].<span class="built_in">Load</span>(str);</span><br><span class="line">str = strFileName.<span class="built_in">Left</span>(strFileName.<span class="built_in">ReverseFind</span>(<span class="string">&#x27;\\&#x27;</span>) + <span class="number">1</span>) + <span class="string">L&quot;material\\3.png&quot;</span>;</span><br><span class="line">wall::w_img[WATER].<span class="built_in">Load</span>(str);</span><br><span class="line">str = strFileName.<span class="built_in">Left</span>(strFileName.<span class="built_in">ReverseFind</span>(<span class="string">&#x27;\\&#x27;</span>) + <span class="number">1</span>) + <span class="string">L&quot;material\\4.png&quot;</span>;</span><br><span class="line">wall::w_img[WOOD].<span class="built_in">Load</span>(str);</span><br><span class="line">str = strFileName.<span class="built_in">Left</span>(strFileName.<span class="built_in">ReverseFind</span>(<span class="string">&#x27;\\&#x27;</span>) + <span class="number">1</span>) + <span class="string">L&quot;material\\5.png&quot;</span>;</span><br><span class="line">wall::w_img[BASE].<span class="built_in">Load</span>(str);</span><br><span class="line"><span class="comment">//对坦克的静态成员变量赋值</span></span><br><span class="line">str = strFileName.<span class="built_in">Left</span>(strFileName.<span class="built_in">ReverseFind</span>(<span class="string">&#x27;\\&#x27;</span>) + <span class="number">1</span>) + <span class="string">L&quot;material\\mytank0.png&quot;</span>;</span><br><span class="line">MyTank::m_img[<span class="number">0</span>].<span class="built_in">Load</span>(str);</span><br><span class="line">str = strFileName.<span class="built_in">Left</span>(strFileName.<span class="built_in">ReverseFind</span>(<span class="string">&#x27;\\&#x27;</span>) + <span class="number">1</span>) + <span class="string">L&quot;material\\mytank1.png&quot;</span>;</span><br><span class="line">MyTank::m_img[<span class="number">1</span>].<span class="built_in">Load</span>(str);</span><br><span class="line">str = strFileName.<span class="built_in">Left</span>(strFileName.<span class="built_in">ReverseFind</span>(<span class="string">&#x27;\\&#x27;</span>) + <span class="number">1</span>) + <span class="string">L&quot;material\\mytank2.png&quot;</span>;</span><br><span class="line">MyTank::m_img[<span class="number">2</span>].<span class="built_in">Load</span>(str);</span><br><span class="line">str = strFileName.<span class="built_in">Left</span>(strFileName.<span class="built_in">ReverseFind</span>(<span class="string">&#x27;\\&#x27;</span>) + <span class="number">1</span>) + <span class="string">L&quot;material\\mytank3.png&quot;</span>;</span><br><span class="line">MyTank::m_img[<span class="number">3</span>].<span class="built_in">Load</span>(str);</span><br><span class="line"></span><br><span class="line"><span class="comment">////////////线程/////////////</span></span><br><span class="line"><span class="function">thread <span class="title">T</span><span class="params">(Collide1)</span></span>;</span><br><span class="line">T.<span class="built_in">detach</span>();</span><br><span class="line"><span class="function">thread <span class="title">W</span><span class="params">(Collide2)</span></span>;</span><br><span class="line">W.<span class="built_in">detach</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">//////////地图载入///////////</span></span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> j = <span class="number">0</span>; j &lt; Y_MAX / <span class="number">100</span>; j++)</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; X_MAX / <span class="number">50</span>; i++)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span>((i+j)%<span class="number">4</span>)</span><br><span class="line">vecWall.<span class="built_in">push_back</span>(<span class="built_in">wall</span>(<span class="built_in">CPoint</span>(i * <span class="number">50</span>, j * <span class="number">100</span>), (i + j)% <span class="number">5</span>));</span><br><span class="line">&#125;</span><br><span class="line">vecWall.<span class="built_in">push_back</span>(<span class="built_in">wall</span>(<span class="built_in">CPoint</span>(<span class="number">250</span>, <span class="number">450</span>),BASE));</span><br><span class="line">vecWall.<span class="built_in">push_back</span>(<span class="built_in">wall</span>(<span class="built_in">CPoint</span>(<span class="number">200</span>, <span class="number">400</span>), BRICK));</span><br><span class="line">vecWall.<span class="built_in">push_back</span>(<span class="built_in">wall</span>(<span class="built_in">CPoint</span>(<span class="number">200</span>, <span class="number">450</span>), WOOD));</span><br><span class="line">vecWall.<span class="built_in">push_back</span>(<span class="built_in">wall</span>(<span class="built_in">CPoint</span>(<span class="number">300</span>, <span class="number">450</span>), WOOD));</span><br><span class="line"><span class="comment">///////////敌方坦克初始化///////////</span></span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;<span class="number">3</span>;i++)</span><br><span class="line">&#123;</span><br><span class="line"><span class="function">EneTank <span class="title">eme</span><span class="params">(i)</span></span>;</span><br><span class="line">eneTank.<span class="built_in">push_back</span>(eme);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//其他</span></span><br><span class="line"><span class="built_in">SetWindowPos</span>(<span class="literal">NULL</span>, <span class="number">0</span>, <span class="number">0</span>, X_MAX + <span class="number">200</span>, Y_MAX + <span class="number">40</span>+<span class="number">10</span>, SWP_NOMOVE);</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> TRUE;  <span class="comment">// 除非将焦点设置到控件，否则返回 TRUE</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">CFightingDlg::OnSysCommand</span><span class="params">(UINT nID, LPARAM lParam)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">if</span> ((nID &amp; <span class="number">0xFFF0</span>) == IDM_ABOUTBOX)</span><br><span class="line">&#123;</span><br><span class="line">CAboutDlg dlgAbout;</span><br><span class="line">dlgAbout.<span class="built_in">DoModal</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">CDialogEx::<span class="built_in">OnSysCommand</span>(nID, lParam);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 如果向对话框添加最小化按钮，则需要下面的代码</span></span><br><span class="line"><span class="comment">//  来绘制该图标。  对于使用文档/视图模型的 MFC 应用程序，</span></span><br><span class="line"><span class="comment">//  这将由框架自动完成。</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">CFightingDlg::OnPaint</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">if</span> (<span class="built_in">IsIconic</span>())</span><br><span class="line">&#123;</span><br><span class="line"><span class="function">CPaintDC <span class="title">dc</span><span class="params">(<span class="keyword">this</span>)</span></span>; <span class="comment">// 用于绘制的设备上下文</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">SendMessage</span>(WM_ICONERASEBKGND, <span class="built_in">reinterpret_cast</span>&lt;WPARAM&gt;(dc.<span class="built_in">GetSafeHdc</span>()), <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使图标在工作区矩形中居中</span></span><br><span class="line"><span class="type">int</span> cxIcon = <span class="built_in">GetSystemMetrics</span>(SM_CXICON);</span><br><span class="line"><span class="type">int</span> cyIcon = <span class="built_in">GetSystemMetrics</span>(SM_CYICON);</span><br><span class="line">CRect rect;</span><br><span class="line"><span class="built_in">GetClientRect</span>(&amp;rect);</span><br><span class="line"><span class="type">int</span> x = (rect.<span class="built_in">Width</span>() - cxIcon + <span class="number">1</span>) / <span class="number">2</span>;</span><br><span class="line"><span class="type">int</span> y = (rect.<span class="built_in">Height</span>() - cyIcon + <span class="number">1</span>) / <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 绘制图标</span></span><br><span class="line">dc.<span class="built_in">DrawIcon</span>(x, y, m_hIcon);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">CDialogEx::<span class="built_in">OnPaint</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//CMemDC memDC(*GetDC(), this);</span></span><br><span class="line"><span class="comment">//CDC* pDC = &amp;memDC.GetDC();</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> i = <span class="number">0</span>, j = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">CRect   rc;</span><br><span class="line"><span class="comment">//CWnd* pWnd = GetDlgItem(IDC_IMAGE_BOX);</span></span><br><span class="line"><span class="comment">//pWnd-&gt;GetClientRect();</span></span><br><span class="line"><span class="built_in">GetClientRect</span>(&amp;rc);<span class="comment">// 获取客户区  </span></span><br><span class="line"></span><br><span class="line">CDC* pDC = <span class="built_in">GetDC</span>();<span class="comment">//这里通过在CmemDC中绘制，以解决闪烁问题</span></span><br><span class="line"><span class="function">CMemDC <span class="title">dcMem</span><span class="params">(*pDC, <span class="keyword">this</span>)</span></span>;</span><br><span class="line">CDC&amp; dc = dcMem.<span class="built_in">GetDC</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">//////敌方坦克//////</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (myTank.m_life &gt; <span class="number">0</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span> (eneTank.<span class="built_in">size</span>() &lt; <span class="number">3</span>)</span><br><span class="line">&#123;</span><br><span class="line">EneTank eme;</span><br><span class="line">eneTank.<span class="built_in">push_back</span>(eme);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; eneTank.<span class="built_in">size</span>(); i++)</span><br><span class="line">&#123;</span><br><span class="line">eneTank[i].<span class="built_in">AutoMove</span>();</span><br><span class="line"><span class="keyword">if</span> (eneTank[i].<span class="built_in">fireClock</span>())</span><br><span class="line">enevecShell.<span class="built_in">push_back</span>(eneTank[i].<span class="built_in">fire</span>());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/////////////////////////绘制部分/////////////////////////////</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//////绘制背景//////</span></span><br><span class="line">dc.<span class="built_in">FillSolidRect</span>(&amp;Range, <span class="built_in">RGB</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>));</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; vecWall.<span class="built_in">size</span>(); i++)</span><br><span class="line"><span class="keyword">if</span> (vecWall[i].type == WATER</span><br><span class="line">|| vecWall[i].type == BASE</span><br><span class="line">|| vecWall[i].type == WOOD)</span><br><span class="line">&#123;</span><br><span class="line">vecWall[i].<span class="built_in">Show</span>(&amp;dc);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//////炮弹//////</span></span><br><span class="line"><span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; myvecShell.<span class="built_in">size</span>(); i++)</span><br><span class="line">myvecShell[i].<span class="built_in">Show</span>(&amp;dc);</span><br><span class="line"><span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; enevecShell.<span class="built_in">size</span>(); i++)</span><br><span class="line">enevecShell[i].<span class="built_in">Show</span>(&amp;dc);</span><br><span class="line"></span><br><span class="line"><span class="comment">//////敌方坦克//////</span></span><br><span class="line"><span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; eneTank.<span class="built_in">size</span>(); i++)</span><br><span class="line">eneTank[i].<span class="built_in">Show</span>(&amp;dc);</span><br><span class="line"></span><br><span class="line"><span class="comment">//////玩家坦克//////</span></span><br><span class="line">myTank.<span class="built_in">Show</span>(&amp;dc);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; vecWall.<span class="built_in">size</span>(); i++)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span> (vecWall[i].type != WATER </span><br><span class="line">&amp;&amp; vecWall[i].type != BASE</span><br><span class="line">&amp;&amp; vecWall[i].type!=WOOD)</span><br><span class="line">&#123;</span><br><span class="line">vecWall[i].<span class="built_in">Show</span>(&amp;dc);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//生命显示</span></span><br><span class="line"><span class="function">CRect <span class="title">rct</span><span class="params">(CPoint(<span class="number">620</span>, <span class="number">0</span>), CPoint(<span class="number">620</span> + <span class="number">30</span>, <span class="number">0</span> + <span class="number">30</span>))</span></span>;</span><br><span class="line">myTank.<span class="built_in">show_life</span>(&amp;dc,rct);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">work = <span class="literal">false</span>;</span><br><span class="line">str.<span class="built_in">Format</span>(<span class="string">L&quot;游戏结束!您消灭了%d个敌人&quot;</span>, EneTank::total_num);</span><br><span class="line">dc.<span class="built_in">TextOut</span>(<span class="number">250</span>, <span class="number">270</span>,str);</span><br><span class="line">eneTank.<span class="built_in">clear</span>();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//当用户拖动最小化窗口时系统调用此函数取得光标</span></span><br><span class="line"><span class="comment">//显示。</span></span><br><span class="line"><span class="function">HCURSOR <span class="title">CFightingDlg::OnQueryDragIcon</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="built_in">static_cast</span>&lt;HCURSOR&gt;(m_hIcon);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">CFightingDlg::OnTimer</span><span class="params">(UINT_PTR nIDEvent)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="comment">// <span class="doctag">TODO:</span> 在此添加消息处理程序代码和/或调用默认值</span></span><br><span class="line"><span class="keyword">switch</span> (nIDEvent)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line"><span class="built_in">InvalidateRect</span>(Range, <span class="literal">true</span>); </span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line"><span class="keyword">if</span>(EneTank::level&lt;<span class="number">9</span>)</span><br><span class="line">EneTank::level++;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">case</span> <span class="number">3</span>:</span><br><span class="line">myTank.<span class="built_in">myMove</span>();</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">default</span>:</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">CDialogEx::<span class="built_in">OnTimer</span>(nIDEvent);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">CFightingDlg::OnKeyDown</span><span class="params">(UINT nChar, UINT nRepCnt, UINT nFlags)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="type">static</span> <span class="type">bool</span> used = <span class="literal">false</span>;</span><br><span class="line">CRect rct;</span><br><span class="line">CPoint pt;</span><br><span class="line"><span class="keyword">if</span> (myTank.m_life == <span class="number">0</span>)</span><br><span class="line"><span class="keyword">return</span>;</span><br><span class="line"><span class="keyword">switch</span> (nChar)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">case</span> <span class="string">&#x27;w&#x27;</span>:</span><br><span class="line"><span class="keyword">case</span> <span class="string">&#x27;W&#x27;</span>:</span><br><span class="line">myTank.<span class="built_in">setDir</span>(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">case</span> <span class="string">&#x27;s&#x27;</span>:</span><br><span class="line"><span class="keyword">case</span> <span class="string">&#x27;S&#x27;</span>:</span><br><span class="line">myTank.<span class="built_in">setDir</span>(<span class="number">1</span>);</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">case</span> <span class="string">&#x27;a&#x27;</span>:</span><br><span class="line"><span class="keyword">case</span> <span class="string">&#x27;A&#x27;</span>:</span><br><span class="line">myTank.<span class="built_in">setDir</span>(<span class="number">2</span>);</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">case</span> <span class="string">&#x27;d&#x27;</span>:</span><br><span class="line"><span class="keyword">case</span> <span class="string">&#x27;D&#x27;</span>:</span><br><span class="line">myTank.<span class="built_in">setDir</span>(<span class="number">3</span>);</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">case</span> <span class="string">&#x27;p&#x27;</span>:</span><br><span class="line"><span class="keyword">case</span> <span class="string">&#x27;P&#x27;</span>:</span><br><span class="line"><span class="keyword">if</span> (myTank.m_life &lt; <span class="number">30</span>)</span><br><span class="line">&#123;</span><br><span class="line">myTank.m_life += <span class="number">5</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (!used)</span><br><span class="line">&#123;</span><br><span class="line">vecWall.<span class="built_in">push_back</span>(<span class="built_in">wall</span>(<span class="built_in">CPoint</span>(<span class="number">200</span>, <span class="number">400</span>), METAL));</span><br><span class="line">vecWall.<span class="built_in">push_back</span>(<span class="built_in">wall</span>(<span class="built_in">CPoint</span>(<span class="number">250</span>, <span class="number">400</span>), METAL));</span><br><span class="line">vecWall.<span class="built_in">push_back</span>(<span class="built_in">wall</span>(<span class="built_in">CPoint</span>(<span class="number">300</span>, <span class="number">400</span>), METAL));</span><br><span class="line">vecWall.<span class="built_in">push_back</span>(<span class="built_in">wall</span>(<span class="built_in">CPoint</span>(<span class="number">200</span>, <span class="number">450</span>), METAL));</span><br><span class="line">vecWall.<span class="built_in">push_back</span>(<span class="built_in">wall</span>(<span class="built_in">CPoint</span>(<span class="number">300</span>, <span class="number">450</span>), METAL));</span><br><span class="line">shell_num = <span class="number">1000</span>;</span><br><span class="line">myTank.<span class="built_in">setSpeed</span>(<span class="number">10</span>);</span><br><span class="line">used = <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">case</span> <span class="string">&#x27;k&#x27;</span>:</span><br><span class="line"><span class="keyword">case</span> <span class="string">&#x27;K&#x27;</span>:</span><br><span class="line">myTank.<span class="built_in">gameover</span>();</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">case</span> VK_SPACE:</span><br><span class="line"><span class="keyword">if</span> (myvecShell.<span class="built_in">size</span>() &lt; shell_num)</span><br><span class="line">&#123;</span><br><span class="line">myvecShell.<span class="built_in">push_back</span>(myTank.<span class="built_in">Fire</span>());</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">default</span>:</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">CDialogEx::<span class="built_in">OnKeyDown</span>(nChar, nRepCnt, nFlags);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function">BOOL <span class="title">CFightingDlg::OnEraseBkgnd</span><span class="params">(CDC* pDC)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="comment">// <span class="doctag">TODO:</span> 在此添加消息处理程序代码和/或调用默认值</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">CFightingDlg::OnDestroy</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">CDialogEx::<span class="built_in">OnDestroy</span>();</span><br><span class="line"><span class="comment">// <span class="doctag">TODO:</span> 在此处添加消息处理程序代码</span></span><br><span class="line">work = <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function">BOOL <span class="title">CFightingDlg::PreTranslateMessage</span><span class="params">(MSG* pMsg)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="comment">// <span class="doctag">TODO:</span> 在此添加专用代码和/或调用基类</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> CDialogEx::<span class="built_in">PreTranslateMessage</span>(pMsg);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">CFightingDlg::OnKeyUp</span><span class="params">(UINT nChar, UINT nRepCnt, UINT nFlags)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="comment">// <span class="doctag">TODO:</span> 在此添加消息处理程序代码和/或调用默认值</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (myTank.m_life == <span class="number">0</span>)</span><br><span class="line"><span class="keyword">return</span>;</span><br><span class="line"><span class="keyword">switch</span> (nChar)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">case</span> <span class="string">&#x27;w&#x27;</span>:</span><br><span class="line"><span class="keyword">case</span> <span class="string">&#x27;W&#x27;</span>:</span><br><span class="line"><span class="keyword">case</span> <span class="string">&#x27;s&#x27;</span>:</span><br><span class="line"><span class="keyword">case</span> <span class="string">&#x27;S&#x27;</span>:</span><br><span class="line"><span class="keyword">case</span> <span class="string">&#x27;a&#x27;</span>:</span><br><span class="line"><span class="keyword">case</span> <span class="string">&#x27;A&#x27;</span>:</span><br><span class="line"><span class="keyword">case</span> <span class="string">&#x27;d&#x27;</span>:</span><br><span class="line"><span class="keyword">case</span> <span class="string">&#x27;D&#x27;</span>:</span><br><span class="line">myTank.<span class="built_in">setDir</span>(<span class="number">5</span>);</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line">CDialogEx::<span class="built_in">OnKeyUp</span>(nChar, nRepCnt, nFlags);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="EneTank-h"><code>EneTank.h</code></h3><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">pragma</span> once</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Tank.h&quot;</span></span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">EneTank</span> :<span class="keyword">public</span> Tank</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"><span class="built_in">EneTank</span>();</span><br><span class="line"><span class="built_in">EneTank</span>(<span class="type">int</span> pos);</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Show</span><span class="params">(CDC* pDC)</span></span>;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">AutoMove</span><span class="params">()</span></span>;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">EneTank::ChangeDir</span><span class="params">()</span></span>;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">re_time</span><span class="params">()</span></span>;</span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">fireClock</span><span class="params">()</span></span>;</span><br><span class="line"><span class="function"><span class="type">static</span> <span class="type">void</span> <span class="title">eme_down</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">DWORD m_time;</span><br><span class="line">DWORD m_firetime;</span><br><span class="line"><span class="type">double</span> m_span;</span><br><span class="line"><span class="type">int</span> m_firespan;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//消灭坦克的数量,是静态成员变量</span></span><br><span class="line"><span class="type">static</span> <span class="type">int</span> total_num;</span><br><span class="line"><span class="type">static</span> <span class="type">int</span> level;</span><br><span class="line"><span class="comment">//贴图</span></span><br><span class="line"><span class="type">static</span> CImage ene_img[<span class="number">4</span>];</span><br><span class="line"><span class="keyword">protected</span>:</span><br><span class="line"><span class="comment">//固定的出生点,静态成员变量</span></span><br><span class="line"><span class="type">static</span> CPoint birth[<span class="number">3</span>];</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h3 id="Object-h"><code>Object.h</code></h3><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">pragma</span> once</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> CORRECT 0</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//单位格子的大小</span></span><br><span class="line"><span class="comment">//const CSize unitSize(50, 50);</span></span><br><span class="line"><span class="comment">/*这一块地方很有问题，</span></span><br><span class="line"><span class="comment">不知道为什么mytank接收不到unitsize</span></span><br><span class="line"><span class="comment">可能是因为构造的时候，unitSize还未初始化*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//方向对应的数字</span></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> DIR_UP = <span class="number">0</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> DIR_DOWN = <span class="number">1</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> DIR_LEFT = <span class="number">2</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> DIR_RIGHT = <span class="number">3</span>;</span><br><span class="line"><span class="comment">//单元格子的大小</span></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> size = <span class="number">50</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> Tank_size = <span class="number">45</span>;</span><br><span class="line"><span class="comment">//范围</span></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> X_MAX = <span class="number">600</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> Y_MAX = <span class="number">500</span>;</span><br><span class="line"><span class="comment">//+20是为了防止出界判断的延迟出现图片残留</span></span><br><span class="line"><span class="comment">//具体解决还可以尝试加快判断速度</span></span><br><span class="line"><span class="function"><span class="type">const</span> CRect <span class="title">Range</span><span class="params">(CPoint(<span class="number">0</span>, <span class="number">0</span>), CPoint(X_MAX + <span class="number">200</span>, Y_MAX + <span class="number">40</span>))</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Object</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"><span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">Show</span><span class="params">(CDC* pDC)</span> </span>&#123;&#125;;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Move</span><span class="params">(<span class="type">int</span> Dir)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">SetPos</span><span class="params">(CRect rct)</span> </span>&#123; m_rct = rct; m_rct.<span class="built_in">NormalizeRect</span>(); &#125;;</span><br><span class="line"><span class="function">CRect <span class="title">GetPos</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> m_rct; &#125;;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">setSpeed</span><span class="params">(<span class="type">int</span> n)</span> </span>&#123; <span class="keyword">this</span>-&gt;m_nSpeed = n;&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">bool</span> m_movable = <span class="literal">true</span>;</span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">IsOverLap</span><span class="params">(CRect&amp; rct)</span></span>;<span class="comment">//重叠、碰撞测试基础</span></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">IsOut</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">CRect m_rct;</span><br><span class="line"></span><br><span class="line"><span class="keyword">protected</span>:</span><br><span class="line"><span class="type">int</span> m_nDir;<span class="comment">//0-3:up\down\left\right</span></span><br><span class="line"><span class="type">int</span> m_nSpeed;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="Object-cpp"><code>Object.cpp</code></h3><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;pch.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Object.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Object::Move</span><span class="params">(<span class="type">int</span> Dir)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="comment">//这里移动是将来的移动，能否实现，要通过碰撞测试</span></span><br><span class="line">m_nDir = Dir;</span><br><span class="line"><span class="keyword">if</span> (Dir == DIR_UP)</span><br><span class="line">&#123;</span><br><span class="line">m_rct.<span class="built_in">MoveToY</span>(m_rct.top - m_nSpeed);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (Dir == DIR_DOWN)</span><br><span class="line">&#123;</span><br><span class="line">m_rct.<span class="built_in">MoveToY</span>(m_rct.top + m_nSpeed);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (Dir == DIR_LEFT)</span><br><span class="line">&#123;</span><br><span class="line">m_rct.<span class="built_in">MoveToX</span>(m_rct.left - m_nSpeed);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (Dir == DIR_RIGHT)</span><br><span class="line">&#123;</span><br><span class="line">m_rct.<span class="built_in">MoveToX</span>(m_rct.left + m_nSpeed);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">Object::IsOverLap</span><span class="params">(CRect&amp; rct)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">CRect tmp;</span><br><span class="line">rct.<span class="built_in">NormalizeRect</span>();</span><br><span class="line"><span class="keyword">return</span> <span class="built_in">IntersectRect</span>(tmp, rct, m_rct);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">Object::IsOut</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">if</span> (m_rct.bottom &gt; Y_MAX || m_rct.top&lt;<span class="number">0</span></span><br><span class="line">|| m_rct.right&gt;X_MAX || m_rct.left &lt; <span class="number">0</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span> (m_rct.bottom &gt; Y_MAX)</span><br><span class="line">m_rct.<span class="built_in">OffsetRect</span>(<span class="number">0</span>, -(m_rct.bottom - Y_MAX + CORRECT));</span><br><span class="line"><span class="keyword">if</span> (m_rct.top &lt; <span class="number">0</span>)</span><br><span class="line">m_rct.<span class="built_in">OffsetRect</span>(<span class="number">0</span>, -m_rct.top + CORRECT);</span><br><span class="line"><span class="keyword">if</span> (m_rct.right &gt; X_MAX)</span><br><span class="line">m_rct.<span class="built_in">OffsetRect</span>(-(m_rct.right - X_MAX + CORRECT), <span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span> (m_rct.left &lt; <span class="number">0</span>)</span><br><span class="line">m_rct.<span class="built_in">OffsetRect</span>(-m_rct.left + CORRECT, <span class="number">0</span>);</span><br><span class="line"><span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Tank-h"><code>Tank.h</code></h3><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">pragma</span> once</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Object.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Shell.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Tank</span>:<span class="keyword">public</span> Object</span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">//这里只定义了Show方法，fire方法在子类中定义</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"><span class="built_in">Tank</span>();</span><br><span class="line"><span class="type">int</span> m_life;</span><br><span class="line"><span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">Show</span><span class="params">(CDC* pDC)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">virtual</span> Shell <span class="title">fire</span><span class="params">()</span></span>;</span><br><span class="line"><span class="comment">//生命-1</span></span><br><span class="line"><span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">lifedecrease</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">m_life--;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">TisOverlap</span><span class="params">(CRect rct)</span></span>;</span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">TOisOverlap</span><span class="params">(Object&amp; ob)</span></span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="Tank-cpp"><code>Tank.cpp</code></h3><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;pch.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Tank.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Tank::<span class="built_in">Tank</span>() </span><br><span class="line">&#123;</span><br><span class="line">m_nDir = <span class="number">3</span>;</span><br><span class="line">m_nSpeed = <span class="number">2</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function">Shell <span class="title">Tank::fire</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">Shell sh;</span><br><span class="line">CPoint pt = m_rct.<span class="built_in">CenterPoint</span>();</span><br><span class="line">sh.<span class="built_in">Create</span>(pt, m_nDir, m_nSpeed * <span class="number">50</span>);</span><br><span class="line"><span class="keyword">return</span> sh;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">Tank::TOisOverlap</span><span class="params">(Object&amp; ob)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">CRect&amp; rct = ob.m_rct;</span><br><span class="line"><span class="type">bool</span> check = <span class="literal">false</span>;</span><br><span class="line">CRect tmp;</span><br><span class="line">rct.<span class="built_in">NormalizeRect</span>();</span><br><span class="line">check = <span class="built_in">IntersectRect</span>(tmp, rct, m_rct);</span><br><span class="line"><span class="keyword">if</span> (check)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span> (tmp.<span class="built_in">Height</span>() &lt; tmp.<span class="built_in">Width</span>())</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span> (tmp.bottom &lt; rct.bottom)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">this</span>-&gt;m_rct.<span class="built_in">OffsetRect</span>(<span class="number">0</span>, -(tmp.<span class="built_in">Height</span>() - CORRECT));</span><br><span class="line"><span class="keyword">if</span> (ob.m_movable)</span><br><span class="line">&#123;</span><br><span class="line">rct.<span class="built_in">OffsetRect</span>(<span class="number">0</span>, (tmp.<span class="built_in">Height</span>() - CORRECT));</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">this</span>-&gt;m_rct.<span class="built_in">OffsetRect</span>(<span class="number">0</span>, (tmp.<span class="built_in">Height</span>() - CORRECT));</span><br><span class="line"><span class="keyword">if</span> (ob.m_movable)</span><br><span class="line">&#123;</span><br><span class="line">rct.<span class="built_in">OffsetRect</span>(<span class="number">0</span>, -(tmp.<span class="built_in">Height</span>() - CORRECT));</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span> (tmp.right &lt; rct.right)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">this</span>-&gt;m_rct.<span class="built_in">OffsetRect</span>(-tmp.<span class="built_in">Width</span>() - CORRECT, <span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span> (ob.m_movable)</span><br><span class="line">&#123;</span><br><span class="line">rct.<span class="built_in">OffsetRect</span>(tmp.<span class="built_in">Width</span>() + CORRECT, <span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">this</span>-&gt;m_rct.<span class="built_in">OffsetRect</span>(tmp.<span class="built_in">Width</span>() - CORRECT, <span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span> (ob.m_movable)</span><br><span class="line">&#123;</span><br><span class="line">rct.<span class="built_in">OffsetRect</span>(-(tmp.<span class="built_in">Width</span>() - CORRECT), <span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> check;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">Tank::TisOverlap</span><span class="params">(CRect rct)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="type">bool</span> check = <span class="literal">false</span>;</span><br><span class="line">CRect tmp;</span><br><span class="line">rct.<span class="built_in">NormalizeRect</span>();</span><br><span class="line">check = <span class="built_in">IntersectRect</span>(tmp, rct, m_rct);</span><br><span class="line"><span class="keyword">if</span> (check)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span> (tmp.<span class="built_in">Height</span>() &lt; tmp.<span class="built_in">Width</span>())</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span> (tmp.bottom &lt; rct.bottom)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">this</span>-&gt;m_rct.<span class="built_in">OffsetRect</span>(<span class="number">0</span>, -(tmp.<span class="built_in">Height</span>()-CORRECT));</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">this</span>-&gt;m_rct.<span class="built_in">OffsetRect</span>(<span class="number">0</span>, (tmp.<span class="built_in">Height</span>()-CORRECT));</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span> (tmp.right &lt; rct.right)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">this</span>-&gt;m_rct.<span class="built_in">OffsetRect</span>(-tmp.<span class="built_in">Width</span>()-CORRECT,<span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">this</span>-&gt;m_rct.<span class="built_in">OffsetRect</span>(tmp.<span class="built_in">Width</span>()-CORRECT,<span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> check;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Tank::Show</span><span class="params">(CDC* pDC)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//pDC-&gt;Rectangle(m_rct);</span></span><br><span class="line"><span class="comment">//pDC-&gt;MoveTo(m_rct.CenterPoint());</span></span><br><span class="line"><span class="comment">//if (m_nDir == 0)</span></span><br><span class="line"><span class="comment">//pDC-&gt;LineTo(m_rct.CenterPoint().x, m_rct.CenterPoint().y - 20);</span></span><br><span class="line"><span class="comment">//else if (m_nDir == 1)</span></span><br><span class="line"><span class="comment">//pDC-&gt;LineTo(m_rct.CenterPoint().x, m_rct.CenterPoint().y + 20);</span></span><br><span class="line"><span class="comment">//else if (m_nDir == 2)</span></span><br><span class="line"><span class="comment">//pDC-&gt;LineTo(m_rct.CenterPoint().x - 20, m_rct.CenterPoint().y);</span></span><br><span class="line"><span class="comment">//else if (m_nDir == 3)</span></span><br><span class="line"><span class="comment">//pDC-&gt;LineTo(m_rct.CenterPoint().x + 20, m_rct.CenterPoint().y);</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//////////////////贴图的实现/////////////////////</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*pDC-&gt;Rectangle(m_rct);</span></span><br><span class="line"><span class="comment">pDC-&gt;MoveTo(m_rct.CenterPoint());*/</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="MyTank-h"><code>MyTank.h</code></h3><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">pragma</span> once</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Tank.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyTank</span> : <span class="keyword">public</span> Tank</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"><span class="function">Shell <span class="title">Fire</span><span class="params">()</span></span>;</span><br><span class="line"><span class="built_in">MyTank</span>();</span><br><span class="line"><span class="type">bool</span> m_move = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">respan</span><span class="params">()</span></span>;</span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">gameover</span><span class="params">()</span></span>;</span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">show_life</span><span class="params">(CDC* pDC,CRect rct)</span></span>;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Show</span><span class="params">(CDC* pDC)</span></span>;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">setDir</span><span class="params">(<span class="type">int</span> i)</span></span>;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">myMove</span><span class="params">()</span></span>;</span><br><span class="line"><span class="type">static</span> CImage m_img[<span class="number">4</span>];</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">CPoint m_respanpos;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="MyTank-cpp"><code>MyTank.cpp</code></h3><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;pch.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;MyTank.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;mmsystem.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">pragma</span> comment(lib,<span class="string">&quot;winmm.lib&quot;</span>)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">CImage MyTank::m_img[<span class="number">4</span>];</span><br><span class="line"></span><br><span class="line"><span class="function">Shell <span class="title">MyTank::Fire</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">Shell sh;</span><br><span class="line">CPoint pt = m_rct.<span class="built_in">CenterPoint</span>();</span><br><span class="line">sh.<span class="built_in">Create</span>(pt, m_nDir, m_nSpeed*<span class="number">40</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//播放声音</span></span><br><span class="line">CString strFileName;</span><br><span class="line">TCHAR cPath[<span class="number">1024</span>];</span><br><span class="line"><span class="built_in">GetModuleFileName</span>(<span class="literal">NULL</span>, cPath, <span class="number">1024</span>);</span><br><span class="line">strFileName = cPath;</span><br><span class="line">CString strSound = strFileName.<span class="built_in">Left</span>(strFileName.<span class="built_in">ReverseFind</span>(<span class="string">&#x27;\\&#x27;</span>) + <span class="number">1</span>) + <span class="string">L&quot;fire.wav&quot;</span>;</span><br><span class="line"><span class="built_in">PlaySound</span>(strSound, <span class="number">0</span>, SND_FILENAME | SND_ASYNC);</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> sh;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">MyTank::Show</span><span class="params">(CDC* pDC)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="comment">//显示坦克</span></span><br><span class="line"><span class="keyword">if</span> (m_nDir == DIR_UP)</span><br><span class="line">m_img[DIR_UP].<span class="built_in">Draw</span>(pDC-&gt;<span class="built_in">GetSafeHdc</span>(), m_rct, Gdiplus::InterpolationModeHighQuality);</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (m_nDir == DIR_DOWN)</span><br><span class="line">m_img[DIR_DOWN].<span class="built_in">Draw</span>(pDC-&gt;<span class="built_in">GetSafeHdc</span>(), m_rct, Gdiplus::InterpolationModeHighQuality);</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (m_nDir == DIR_LEFT)</span><br><span class="line">m_img[DIR_LEFT].<span class="built_in">Draw</span>(pDC-&gt;<span class="built_in">GetSafeHdc</span>(), m_rct, Gdiplus::InterpolationModeHighQuality);</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (m_nDir == DIR_RIGHT)</span><br><span class="line">m_img[DIR_RIGHT].<span class="built_in">Draw</span>(pDC-&gt;<span class="built_in">GetSafeHdc</span>(), m_rct, Gdiplus::InterpolationModeHighQuality);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">MyTank::<span class="built_in">MyTank</span>()</span><br><span class="line">&#123;</span><br><span class="line">m_respanpos = <span class="built_in">CPoint</span>(<span class="number">150</span>, <span class="number">450</span>);</span><br><span class="line">m_rct = <span class="built_in">CRect</span>(m_respanpos, <span class="built_in">CSize</span>(Tank_size,Tank_size));</span><br><span class="line">m_life = <span class="number">5</span>;</span><br><span class="line">m_nSpeed = <span class="number">4</span>;</span><br><span class="line">m_nDir = <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">MyTank::show_life</span><span class="params">(CDC* pDC,CRect rct)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= m_life; i++)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span> (i % <span class="number">5</span>)</span><br><span class="line">&#123;</span><br><span class="line">m_img[DIR_UP].<span class="built_in">Draw</span>(pDC-&gt;<span class="built_in">GetSafeHdc</span>(), rct, Gdiplus::InterpolationModeHighQuality);</span><br><span class="line">rct.<span class="built_in">OffsetRect</span>(rct.<span class="built_in">Width</span>() + <span class="number">2</span>, <span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">m_img[DIR_UP].<span class="built_in">Draw</span>(pDC-&gt;<span class="built_in">GetSafeHdc</span>(), rct, Gdiplus::InterpolationModeHighQuality);</span><br><span class="line">rct.<span class="built_in">OffsetRect</span>(-(rct.<span class="built_in">Width</span>() + <span class="number">2</span>)*<span class="number">4</span>, rct.<span class="built_in">Height</span>() + <span class="number">2</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">MyTank::respan</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">m_rct = <span class="built_in">CRect</span>(m_respanpos, <span class="built_in">CSize</span>(Tank_size, Tank_size));</span><br><span class="line">m_nDir = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">MyTank::gameover</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">this</span>-&gt;m_life = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">MyTank::setDir</span><span class="params">(<span class="type">int</span> i)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">if</span> (i &gt; <span class="number">4</span>)</span><br><span class="line">&#123;</span><br><span class="line">m_move = <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">m_nDir = i;</span><br><span class="line">m_move = <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">MyTank::myMove</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">if</span> (m_move)</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">Move</span>(m_nDir);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="EneTank-cpp"><code>EneTank.cpp</code></h3><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;pch.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;EneTank.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//静态成员变量初始化</span></span><br><span class="line">CImage EneTank::ene_img[<span class="number">4</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">//消灭坦克数</span></span><br><span class="line"><span class="type">int</span> EneTank::total_num = <span class="number">0</span>;</span><br><span class="line"><span class="comment">//难度</span></span><br><span class="line"><span class="type">int</span> EneTank::level = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">EneTank::<span class="built_in">EneTank</span>()</span><br><span class="line">&#123;</span><br><span class="line">m_firetime = m_time = <span class="built_in">GetTickCount</span>();</span><br><span class="line">m_nSpeed = <span class="number">1</span>+level;</span><br><span class="line">m_nDir = <span class="number">1</span>;</span><br><span class="line">m_life = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//随机方向和持续时间</span></span><br><span class="line"><span class="type">unsigned</span> <span class="type">int</span> i;</span><br><span class="line"><span class="built_in">rand_s</span>(&amp;i);</span><br><span class="line">m_rct = <span class="built_in">CRect</span>(birth[total_num % <span class="number">3</span>],<span class="built_in">CSize</span>(Tank_size,Tank_size));</span><br><span class="line"><span class="built_in">rand_s</span>(&amp;i);</span><br><span class="line">m_span = <span class="number">1</span> + i % <span class="number">2</span>;</span><br><span class="line">m_firespan = <span class="number">5</span> + i % <span class="number">2</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">EneTank::<span class="built_in">EneTank</span>(<span class="type">int</span> pos)</span><br><span class="line">&#123;</span><br><span class="line">m_firetime = m_time = <span class="built_in">GetTickCount</span>();</span><br><span class="line">m_nSpeed = <span class="number">1</span>+level;</span><br><span class="line">m_nDir = <span class="number">1</span>;</span><br><span class="line">m_life = <span class="number">1</span>;</span><br><span class="line"><span class="comment">//随机运动时间和开火间隔</span></span><br><span class="line"><span class="type">unsigned</span> <span class="type">int</span> i;</span><br><span class="line"><span class="built_in">rand_s</span>(&amp;i);</span><br><span class="line">m_rct = <span class="built_in">CRect</span>(birth[pos%<span class="number">3</span>], <span class="built_in">CSize</span>(Tank_size, Tank_size));</span><br><span class="line"><span class="built_in">rand_s</span>(&amp;i);</span><br><span class="line">m_span = <span class="number">1</span> + i % <span class="number">2</span>;</span><br><span class="line">m_firespan = <span class="number">2</span> + (i % <span class="number">12</span>) / level;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">EneTank::re_time</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">m_span = <span class="number">0.5</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">EneTank::fireClock</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="comment">//原理和AutoMove相似，随机开炮时间间隔</span></span><br><span class="line"><span class="keyword">if</span> ((<span class="built_in">GetTickCount</span>() - m_firetime) / <span class="number">1000</span> &lt; m_firespan)</span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="type">unsigned</span> <span class="type">int</span> i;</span><br><span class="line"><span class="built_in">rand_s</span>(&amp;i);</span><br><span class="line">m_firetime = <span class="built_in">GetTickCount</span>();</span><br><span class="line">m_firespan = <span class="number">1</span>+(i % <span class="number">6</span>) / (<span class="number">0.5</span>*level);</span><br><span class="line"><span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">EneTank::Show</span><span class="params">(CDC* pDC)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">if</span> (m_nDir == DIR_UP)</span><br><span class="line">ene_img[DIR_UP].<span class="built_in">Draw</span>(pDC-&gt;<span class="built_in">GetSafeHdc</span>(), m_rct, Gdiplus::InterpolationModeHighQuality);</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (m_nDir == DIR_DOWN)</span><br><span class="line">ene_img[DIR_DOWN].<span class="built_in">Draw</span>(pDC-&gt;<span class="built_in">GetSafeHdc</span>(), m_rct, Gdiplus::InterpolationModeHighQuality);</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (m_nDir == DIR_LEFT)</span><br><span class="line">ene_img[DIR_LEFT].<span class="built_in">Draw</span>(pDC-&gt;<span class="built_in">GetSafeHdc</span>(), m_rct, Gdiplus::InterpolationModeHighQuality);</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (m_nDir == DIR_RIGHT)</span><br><span class="line">ene_img[DIR_RIGHT].<span class="built_in">Draw</span>(pDC-&gt;<span class="built_in">GetSafeHdc</span>(), m_rct, Gdiplus::InterpolationModeHighQuality);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">EneTank::AutoMove</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="comment">////随机部分（后期实现时可以不用，改为遇墙再随机即可）</span></span><br><span class="line"><span class="keyword">if</span>((<span class="built_in">GetTickCount</span>()-m_time)/<span class="number">1000.0</span>&lt;m_span )</span><br><span class="line"><span class="built_in">Move</span>(m_nDir);</span><br><span class="line"><span class="keyword">else</span><span class="comment">//否则重新随机方向和持续时间</span></span><br><span class="line"><span class="built_in">ChangeDir</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">EneTank::ChangeDir</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="type">unsigned</span> <span class="type">int</span> i;</span><br><span class="line"><span class="built_in">rand_s</span>(&amp;i);</span><br><span class="line">m_nDir = (i % <span class="number">6</span>);<span class="comment">//方向,可调节向下运动的权重</span></span><br><span class="line"><span class="keyword">if</span> (m_nDir &gt; <span class="number">3</span>)</span><br><span class="line">m_nDir = <span class="number">1</span>;</span><br><span class="line"><span class="built_in">rand_s</span>(&amp;i);</span><br><span class="line">m_nSpeed = <span class="number">1</span> + level;</span><br><span class="line">m_span = <span class="number">3</span> + i % <span class="number">5</span>;<span class="comment">//持续时间</span></span><br><span class="line">m_time = <span class="built_in">GetTickCount</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">EneTank::eme_down</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">total_num++;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Shell-h"><code>Shell.h</code></h3><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">pragma</span> once</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Object.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Shell</span> :<span class="keyword">public</span> Object</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"><span class="built_in">Shell</span>();</span><br><span class="line">CImage <span class="type">static</span> s_img;</span><br><span class="line"><span class="type">bool</span> m_inbox;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Show</span><span class="params">(CDC* pDC)</span></span>;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Create</span><span class="params">(CPoint pos, <span class="type">int</span> nDir, <span class="type">int</span> nSpeed)</span></span>;</span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">SSisOverlap</span><span class="params">(Shell&amp; sh)</span></span>;</span><br><span class="line"><span class="keyword">protected</span>:</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">UpdatePos</span><span class="params">()</span></span>;</span><br><span class="line"><span class="keyword">protected</span>:</span><br><span class="line">DWORD m_time;</span><br><span class="line">CRect m_iniRct;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="Shell-cpp"><code>Shell.cpp</code></h3><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;pch.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Shell.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">CImage Shell::s_img;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Shell::<span class="built_in">Shell</span>()</span><br><span class="line">&#123;</span><br><span class="line">m_inbox = <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">Shell::SSisOverlap</span><span class="params">(Shell&amp; sh)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">if</span> (<span class="built_in">IsOverLap</span>(sh.<span class="built_in">GetPos</span>()))</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Shell::Show</span><span class="params">(CDC* pDC)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="built_in">UpdatePos</span>();</span><br><span class="line">s_img.<span class="built_in">Draw</span>(pDC-&gt;<span class="built_in">GetSafeHdc</span>(), m_rct, Gdiplus::InterpolationModeHighQuality);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Shell::UpdatePos</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">DWORD tm = <span class="built_in">GetTickCount</span>();</span><br><span class="line"><span class="type">int</span> nDis = (tm - m_time) * m_nSpeed / <span class="number">1000</span>;</span><br><span class="line"><span class="keyword">switch</span> (m_nDir)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">case</span> DIR_UP:</span><br><span class="line">m_rct.<span class="built_in">MoveToY</span>(m_iniRct.top - nDis);</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">case</span> DIR_DOWN:</span><br><span class="line">m_rct.<span class="built_in">MoveToY</span>(m_iniRct.top + nDis);</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">case</span> DIR_LEFT:</span><br><span class="line">m_rct.<span class="built_in">MoveToX</span>(m_iniRct.left - nDis);</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">case</span> DIR_RIGHT:</span><br><span class="line">m_rct.<span class="built_in">MoveToX</span>(m_iniRct.left + nDis);</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">default</span>:</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (m_rct.top&lt;<span class="number">0</span> || m_rct.bottom&gt;Y_MAX</span><br><span class="line">|| m_rct.left&lt;<span class="number">0</span> || m_rct.right&gt;X_MAX)</span><br><span class="line">m_inbox = <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Shell::Create</span><span class="params">(CPoint pos, <span class="type">int</span> nDir, <span class="type">int</span> nSpeed)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">m_nDir = nDir;</span><br><span class="line">m_nSpeed = nSpeed;</span><br><span class="line"><span class="type">int</span> nShellSize = <span class="number">4</span>;</span><br><span class="line">m_rct = <span class="built_in">CRect</span>(pos.x - nShellSize, pos.y - nShellSize, pos.x + nShellSize, pos.y + nShellSize);</span><br><span class="line">m_iniRct = m_rct;</span><br><span class="line">m_time = <span class="built_in">GetTickCount</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="wall-h"><code>wall.h</code></h3><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">pragma</span> once</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Object.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> BRICK 0</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> METAL 1</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> GRASS 2</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> WATER 3</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> WOOD 4</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> BASE 5</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">wall</span> :<span class="keyword">public</span> Object</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"><span class="built_in">wall</span>(CPoint pt,<span class="type">int</span> type);</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Move</span><span class="params">(<span class="type">int</span> Dir)</span> </span>&#123;&#125;;</span><br><span class="line"><span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">disappear</span><span class="params">()</span> </span>&#123;&#125;;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Show</span><span class="params">(CDC* pDC)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//墙的类型和属性</span></span><br><span class="line"><span class="type">int</span> type = <span class="number">0</span>;</span><br><span class="line"><span class="type">bool</span> ShellPass = <span class="literal">false</span>;</span><br><span class="line"><span class="type">bool</span> TankPass = <span class="literal">false</span>;</span><br><span class="line"><span class="type">bool</span> destroyable = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//贴图</span></span><br><span class="line"><span class="type">static</span> CImage w_img[<span class="number">6</span>];</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//测试用的构造函数</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="wall-cpp"><code>wall.cpp</code></h3><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;pch.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;wall.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">CImage wall::w_img[<span class="number">6</span>];</span><br><span class="line"></span><br><span class="line">wall::<span class="built_in">wall</span>(CPoint pt,<span class="type">int</span> mode)</span><br><span class="line">&#123;</span><br><span class="line"><span class="function">CRect <span class="title">temp</span><span class="params">(pt, CSize(size, size))</span></span>;</span><br><span class="line">type = mode;</span><br><span class="line">m_movable = <span class="literal">false</span>;</span><br><span class="line">m_rct = temp;</span><br><span class="line"><span class="keyword">switch</span> (type)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">case</span> BRICK:</span><br><span class="line">destroyable = <span class="literal">true</span>;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">case</span> GRASS:</span><br><span class="line">ShellPass = <span class="literal">true</span>;</span><br><span class="line">TankPass = <span class="literal">true</span>;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">case</span> WATER:</span><br><span class="line">ShellPass = <span class="literal">true</span>;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">case</span> WOOD:</span><br><span class="line">destroyable = <span class="literal">true</span>;</span><br><span class="line">m_movable = <span class="literal">true</span>;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">case</span> BASE:</span><br><span class="line">destroyable = <span class="literal">true</span>;</span><br><span class="line">TankPass = <span class="literal">true</span>;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">wall::Show</span><span class="params">(CDC* pDC)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">w_img[type].<span class="built_in">Draw</span>(pDC-&gt;<span class="built_in">GetSafeHdc</span>(), m_rct, Gdiplus::InterpolationModeHighQuality);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 课程学习 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> c++ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>可爱的水伊布</title>
      <link href="/posts/a04972d8.html"/>
      <url>/posts/a04972d8.html</url>
      
        <content type="html"><![CDATA[<h2 id="说明">说明</h2><p>原本打算把这些图片放在<a href="https://imgtu.com">路过图床</a>上的，但是服务条款不让上传动漫相关图片，所以只能用别的图片进行测试了。图床使用情况请见<a href="/posts/ef2fa561.html" title="地理建模方法编程">地理建模方法编程</a>和<a href="/gallery">相册</a>。</p><h2 id="水伊布太可爱了">水伊布太可爱了</h2><!-- spoiler-1ffd9:black -->  <span class="spoiler" onclick="this.classList.toggle('spoiler')">    <span class="spoiler-blur spoiler-1ffd9">完全没有抵抗力啊啊啊！！！</span>  </span><hr><div class="gallery">    <div class="fj-gallery " data-rowHeight="220" data-limit="10">    <span class="gallery-data">[{"url":"https://cdn.zerolacqua.top/images/blogs/可爱的水伊布/Vaporeon1.png","alt":""},{"url":"https://cdn.zerolacqua.top/images/blogs/可爱的水伊布/Vaporeon2.png","alt":""},{"url":"https://cdn.zerolacqua.top/images/blogs/可爱的水伊布/Vaporeon3.png","alt":""},{"url":"https://cdn.zerolacqua.top/images/blogs/可爱的水伊布/Vaporeon4.png","alt":""},{"url":"https://cdn.zerolacqua.top/images/blogs/可爱的水伊布/Vaporeon5.png","alt":""},{"url":"https://cdn.zerolacqua.top/images/blogs/可爱的水伊布/Vaporeon6.png","alt":""},{"url":"https://cdn.zerolacqua.top/images/blogs/可爱的水伊布/Vaporeon7.png","alt":""},{"url":"https://cdn.zerolacqua.top/images/blogs/可爱的水伊布/Vaporeon8.png","alt":""},{"url":"https://cdn.zerolacqua.top/images/blogs/可爱的水伊布/Vaporeon9.png","alt":""},{"url":"https://cdn.zerolacqua.top/images/blogs/可爱的水伊布/Vaporeon10.jpg","alt":""},{"url":"https://cdn.zerolacqua.top/images/blogs/可爱的水伊布/Vaporeon11.jpg","alt":""},{"url":"https://cdn.zerolacqua.top/images/blogs/可爱的水伊布/Vaporeon12.png","alt":""},{"url":"https://cdn.zerolacqua.top/images/blogs/可爱的水伊布/Vaporeon13.jpg","alt":""},{"url":"https://cdn.zerolacqua.top/images/blogs/可爱的水伊布/Vaporeon14.jpg","alt":""},{"url":"https://cdn.zerolacqua.top/images/blogs/可爱的水伊布/Vaporeon15.png","alt":""}]</span>    </div>    <button class="gallery-load-more"><span>加载更多</span><i class="fa-solid fa-arrow-down"></i></button>    </div><hr><h2 id="伊布串串">伊布串串</h2><p><img src="https://cdn.zerolacqua.top/images/blogs/%E5%8F%AF%E7%88%B1%E7%9A%84%E6%B0%B4%E4%BC%8A%E5%B8%83/Vaporeon16.jpg" alt=""></p>]]></content>
      
      
      <categories>
          
          <category> 博客相关 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 博客搭建 </tag>
            
            <tag> 测试 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>博客搭建备忘录</title>
      <link href="/posts/6b405ec0.html"/>
      <url>/posts/6b405ec0.html</url>
      
        <content type="html"><![CDATA[<h2 id="前言-10">前言</h2><p>这里是搭建博客时遇到的一些问题，因为怕以后忘记了会多走弯路，就记在这里了。</p><p>看了众多大佬的魔改博客，自觉像我这样没有前端基础的人，只能是小打小闹一般图一乐，不好好学习是永远不可能达到那样的高度的……</p><h2 id="魔改记录存档">魔改记录存档</h2><p>记录魔改过程，便于后续恢复与更新</p><h3 id="为博文添加统计-ECharts-图表">为博文添加统计 ECharts 图表</h3><p>感谢：<a href="https://blog.eurkon.com/post/1213ef82.html">Hexo 博客文章统计图 | Eurkon</a></p><details class="folding-tag" blue><summary> 操作方法 </summary>              <div class='content'>              <p>其他步骤与参考博文基本一致。在添加 <code>charts.js</code> 时需要注意路径位置。</p><p>在 <code>[Blogroot]\themes\butterfly\scripts\helpers\</code> 或者是<code>[Blogroot]\node_modules\hexo-theme-butterfly\scripts\helpers\</code>（具体与安装方式有关）目录下新建 <code>charts.js</code> 文件，然后添加以下内容：</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> cheerio = <span class="built_in">require</span>(<span class="string">&#x27;cheerio&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> moment = <span class="built_in">require</span>(<span class="string">&#x27;moment&#x27;</span>)</span><br><span class="line"></span><br><span class="line">hexo.<span class="property">extend</span>.<span class="property">filter</span>.<span class="title function_">register</span>(<span class="string">&#x27;after_render:html&#x27;</span>, <span class="keyword">function</span> (<span class="params">locals</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> $ = cheerio.<span class="title function_">load</span>(locals)</span><br><span class="line">  <span class="keyword">const</span> post = $(<span class="string">&#x27;#posts-chart&#x27;</span>)</span><br><span class="line">  <span class="keyword">const</span> tag = $(<span class="string">&#x27;#tags-chart&#x27;</span>)</span><br><span class="line">  <span class="keyword">const</span> category = $(<span class="string">&#x27;#categories-chart&#x27;</span>)</span><br><span class="line">  <span class="keyword">const</span> htmlEncode = <span class="literal">false</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (post.<span class="property">length</span> &gt; <span class="number">0</span> || tag.<span class="property">length</span> &gt; <span class="number">0</span> || category.<span class="property">length</span> &gt; <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (post.<span class="property">length</span> &gt; <span class="number">0</span> &amp;&amp; $(<span class="string">&#x27;#postsChart&#x27;</span>).<span class="property">length</span> === <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="keyword">if</span> (post.<span class="title function_">attr</span>(<span class="string">&#x27;data-encode&#x27;</span>) === <span class="string">&#x27;true&#x27;</span>) htmlEncode = <span class="literal">true</span></span><br><span class="line">      post.<span class="title function_">after</span>(<span class="title function_">postsChart</span>(post.<span class="title function_">attr</span>(<span class="string">&#x27;data-start&#x27;</span>)))</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (tag.<span class="property">length</span> &gt; <span class="number">0</span> &amp;&amp; $(<span class="string">&#x27;#tagsChart&#x27;</span>).<span class="property">length</span> === <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="keyword">if</span> (tag.<span class="title function_">attr</span>(<span class="string">&#x27;data-encode&#x27;</span>) === <span class="string">&#x27;true&#x27;</span>) htmlEncode = <span class="literal">true</span></span><br><span class="line">      tag.<span class="title function_">after</span>(<span class="title function_">tagsChart</span>(tag.<span class="title function_">attr</span>(<span class="string">&#x27;data-length&#x27;</span>)))</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (category.<span class="property">length</span> &gt; <span class="number">0</span> &amp;&amp; $(<span class="string">&#x27;#categoriesChart&#x27;</span>).<span class="property">length</span> === <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="keyword">if</span> (category.<span class="title function_">attr</span>(<span class="string">&#x27;data-encode&#x27;</span>) === <span class="string">&#x27;true&#x27;</span>) htmlEncode = <span class="literal">true</span></span><br><span class="line">      category.<span class="title function_">after</span>(<span class="title function_">categoriesChart</span>(category.<span class="title function_">attr</span>(<span class="string">&#x27;data-parent&#x27;</span>)))</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (htmlEncode) &#123;</span><br><span class="line">      <span class="keyword">return</span> $.<span class="title function_">root</span>().<span class="title function_">html</span>().<span class="title function_">replace</span>(<span class="regexp">/&amp;amp;#/g</span>, <span class="string">&#x27;&amp;#&#x27;</span>)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> $.<span class="title function_">root</span>().<span class="title function_">html</span>()</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> locals</span><br><span class="line">  &#125;</span><br><span class="line">&#125;, <span class="number">15</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">postsChart</span> (startMonth) &#123;</span><br><span class="line">  <span class="keyword">const</span> startDate = <span class="title function_">moment</span>(startMonth || <span class="string">&#x27;2020-01&#x27;</span>)</span><br><span class="line">  <span class="keyword">const</span> endDate = <span class="title function_">moment</span>()</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> monthMap = <span class="keyword">new</span> <span class="title class_">Map</span>()</span><br><span class="line">  <span class="keyword">const</span> dayTime = <span class="number">3600</span> * <span class="number">24</span> * <span class="number">1000</span></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> time = startDate; time &lt;= endDate; time += dayTime) &#123;</span><br><span class="line">    <span class="keyword">const</span> month = <span class="title function_">moment</span>(time).<span class="title function_">format</span>(<span class="string">&#x27;YYYY-MM&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> (!monthMap.<span class="title function_">has</span>(month)) &#123;</span><br><span class="line">      monthMap.<span class="title function_">set</span>(month, <span class="number">0</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  hexo.<span class="property">locals</span>.<span class="title function_">get</span>(<span class="string">&#x27;posts&#x27;</span>).<span class="title function_">forEach</span>(<span class="keyword">function</span> (<span class="params">post</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> month = post.<span class="property">date</span>.<span class="title function_">format</span>(<span class="string">&#x27;YYYY-MM&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> (monthMap.<span class="title function_">has</span>(month)) &#123;</span><br><span class="line">      monthMap.<span class="title function_">set</span>(month, monthMap.<span class="title function_">get</span>(month) + <span class="number">1</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="keyword">const</span> monthArr = <span class="title class_">JSON</span>.<span class="title function_">stringify</span>([...monthMap.<span class="title function_">keys</span>()])</span><br><span class="line">  <span class="keyword">const</span> monthValueArr = <span class="title class_">JSON</span>.<span class="title function_">stringify</span>([...monthMap.<span class="title function_">values</span>()])</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="string">`</span></span><br><span class="line"><span class="string">  &lt;script id=&quot;postsChart&quot;&gt;</span></span><br><span class="line"><span class="string">    var color = document.documentElement.getAttribute(&#x27;data-theme&#x27;) === &#x27;light&#x27; ? &#x27;#4c4948&#x27; : &#x27;rgba(255,255,255,0.7)&#x27;</span></span><br><span class="line"><span class="string">    var postsChart = echarts.init(document.getElementById(&#x27;posts-chart&#x27;), &#x27;light&#x27;);</span></span><br><span class="line"><span class="string">    var postsOption = &#123;</span></span><br><span class="line"><span class="string">      title: &#123;</span></span><br><span class="line"><span class="string">        text: &#x27;文章发布统计图&#x27;,</span></span><br><span class="line"><span class="string">        x: &#x27;center&#x27;,</span></span><br><span class="line"><span class="string">        textStyle: &#123;</span></span><br><span class="line"><span class="string">          color: color</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">      &#125;,</span></span><br><span class="line"><span class="string">      tooltip: &#123;</span></span><br><span class="line"><span class="string">        trigger: &#x27;axis&#x27;</span></span><br><span class="line"><span class="string">      &#125;,</span></span><br><span class="line"><span class="string">      xAxis: &#123;</span></span><br><span class="line"><span class="string">        name: &#x27;日期&#x27;,</span></span><br><span class="line"><span class="string">        type: &#x27;category&#x27;,</span></span><br><span class="line"><span class="string">        boundaryGap: false,</span></span><br><span class="line"><span class="string">        nameTextStyle: &#123;</span></span><br><span class="line"><span class="string">          color: color</span></span><br><span class="line"><span class="string">        &#125;,</span></span><br><span class="line"><span class="string">        axisTick: &#123;</span></span><br><span class="line"><span class="string">          show: false</span></span><br><span class="line"><span class="string">        &#125;,</span></span><br><span class="line"><span class="string">        axisLabel: &#123;</span></span><br><span class="line"><span class="string">          show: true,</span></span><br><span class="line"><span class="string">          color: color</span></span><br><span class="line"><span class="string">        &#125;,</span></span><br><span class="line"><span class="string">        axisLine: &#123;</span></span><br><span class="line"><span class="string">          show: true,</span></span><br><span class="line"><span class="string">          lineStyle: &#123;</span></span><br><span class="line"><span class="string">            color: color</span></span><br><span class="line"><span class="string">          &#125;</span></span><br><span class="line"><span class="string">        &#125;,</span></span><br><span class="line"><span class="string">        data: <span class="subst">$&#123;monthArr&#125;</span></span></span><br><span class="line"><span class="string">      &#125;,</span></span><br><span class="line"><span class="string">      yAxis: &#123;</span></span><br><span class="line"><span class="string">        name: &#x27;文章篇数&#x27;,</span></span><br><span class="line"><span class="string">        type: &#x27;value&#x27;,</span></span><br><span class="line"><span class="string">        nameTextStyle: &#123;</span></span><br><span class="line"><span class="string">          color: color</span></span><br><span class="line"><span class="string">        &#125;,</span></span><br><span class="line"><span class="string">        splitLine: &#123;</span></span><br><span class="line"><span class="string">          show: false</span></span><br><span class="line"><span class="string">        &#125;,</span></span><br><span class="line"><span class="string">        axisTick: &#123;</span></span><br><span class="line"><span class="string">          show: false</span></span><br><span class="line"><span class="string">        &#125;,</span></span><br><span class="line"><span class="string">        axisLabel: &#123;</span></span><br><span class="line"><span class="string">          show: true,</span></span><br><span class="line"><span class="string">          color: color</span></span><br><span class="line"><span class="string">        &#125;,</span></span><br><span class="line"><span class="string">        axisLine: &#123;</span></span><br><span class="line"><span class="string">          show: true,</span></span><br><span class="line"><span class="string">          lineStyle: &#123;</span></span><br><span class="line"><span class="string">            color: color</span></span><br><span class="line"><span class="string">          &#125;</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">      &#125;,</span></span><br><span class="line"><span class="string">      series: [&#123;</span></span><br><span class="line"><span class="string">        name: &#x27;文章篇数&#x27;,</span></span><br><span class="line"><span class="string">        type: &#x27;line&#x27;,</span></span><br><span class="line"><span class="string">        smooth: true,</span></span><br><span class="line"><span class="string">        lineStyle: &#123;</span></span><br><span class="line"><span class="string">            width: 0</span></span><br><span class="line"><span class="string">        &#125;,</span></span><br><span class="line"><span class="string">        showSymbol: false,</span></span><br><span class="line"><span class="string">        itemStyle: &#123;</span></span><br><span class="line"><span class="string">          opacity: 1,</span></span><br><span class="line"><span class="string">          color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [&#123;</span></span><br><span class="line"><span class="string">            offset: 0,</span></span><br><span class="line"><span class="string">            color: &#x27;rgba(128, 255, 165)&#x27;</span></span><br><span class="line"><span class="string">          &#125;,</span></span><br><span class="line"><span class="string">          &#123;</span></span><br><span class="line"><span class="string">            offset: 1,</span></span><br><span class="line"><span class="string">            color: &#x27;rgba(1, 191, 236)&#x27;</span></span><br><span class="line"><span class="string">          &#125;])</span></span><br><span class="line"><span class="string">        &#125;,</span></span><br><span class="line"><span class="string">        areaStyle: &#123;</span></span><br><span class="line"><span class="string">          opacity: 1,</span></span><br><span class="line"><span class="string">          color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [&#123;</span></span><br><span class="line"><span class="string">            offset: 0,</span></span><br><span class="line"><span class="string">            color: &#x27;rgba(128, 255, 165)&#x27;</span></span><br><span class="line"><span class="string">          &#125;, &#123;</span></span><br><span class="line"><span class="string">            offset: 1,</span></span><br><span class="line"><span class="string">            color: &#x27;rgba(1, 191, 236)&#x27;</span></span><br><span class="line"><span class="string">          &#125;])</span></span><br><span class="line"><span class="string">        &#125;,</span></span><br><span class="line"><span class="string">        data: <span class="subst">$&#123;monthValueArr&#125;</span>,</span></span><br><span class="line"><span class="string">        markLine: &#123;</span></span><br><span class="line"><span class="string">          data: [&#123;</span></span><br><span class="line"><span class="string">            name: &#x27;平均值&#x27;,</span></span><br><span class="line"><span class="string">            type: &#x27;average&#x27;,</span></span><br><span class="line"><span class="string">            label: &#123;</span></span><br><span class="line"><span class="string">              color: color</span></span><br><span class="line"><span class="string">            &#125;</span></span><br><span class="line"><span class="string">          &#125;]</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">      &#125;]</span></span><br><span class="line"><span class="string">    &#125;;</span></span><br><span class="line"><span class="string">    postsChart.setOption(postsOption);</span></span><br><span class="line"><span class="string">    window.addEventListener(&#x27;resize&#x27;, () =&gt; &#123; </span></span><br><span class="line"><span class="string">      postsChart.resize();</span></span><br><span class="line"><span class="string">    &#125;);</span></span><br><span class="line"><span class="string">    postsChart.on(&#x27;click&#x27;, &#x27;series&#x27;, (event) =&gt; &#123;</span></span><br><span class="line"><span class="string">      if (event.componentType === &#x27;series&#x27;) window.location.href = &#x27;/archives/&#x27; + event.name.replace(&#x27;-&#x27;, &#x27;/&#x27;);</span></span><br><span class="line"><span class="string">    &#125;);</span></span><br><span class="line"><span class="string">  &lt;/script&gt;`</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">tagsChart</span> (len) &#123;</span><br><span class="line">  <span class="keyword">const</span> tagArr = []</span><br><span class="line">  hexo.<span class="property">locals</span>.<span class="title function_">get</span>(<span class="string">&#x27;tags&#x27;</span>).<span class="title function_">map</span>(<span class="keyword">function</span> (<span class="params">tag</span>) &#123;</span><br><span class="line">    tagArr.<span class="title function_">push</span>(&#123; <span class="attr">name</span>: tag.<span class="property">name</span>, <span class="attr">value</span>: tag.<span class="property">length</span>, <span class="attr">path</span>: tag.<span class="property">path</span> &#125;)</span><br><span class="line">  &#125;)</span><br><span class="line">  tagArr.<span class="title function_">sort</span>(<span class="function">(<span class="params">a, b</span>) =&gt;</span> &#123; <span class="keyword">return</span> b.<span class="property">value</span> - a.<span class="property">value</span> &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> dataLength = <span class="title class_">Math</span>.<span class="title function_">min</span>(tagArr.<span class="property">length</span>, len) || tagArr.<span class="property">length</span></span><br><span class="line">  <span class="keyword">const</span> tagNameArr = []</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; dataLength; i++) &#123;</span><br><span class="line">    tagNameArr.<span class="title function_">push</span>(tagArr[i].<span class="property">name</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">const</span> tagNameArrJson = <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(tagNameArr)</span><br><span class="line">  <span class="keyword">const</span> tagArrJson = <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(tagArr)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="string">`</span></span><br><span class="line"><span class="string">  &lt;script id=&quot;tagsChart&quot;&gt;</span></span><br><span class="line"><span class="string">    var color = document.documentElement.getAttribute(&#x27;data-theme&#x27;) === &#x27;light&#x27; ? &#x27;#4c4948&#x27; : &#x27;rgba(255,255,255,0.7)&#x27;</span></span><br><span class="line"><span class="string">    var tagsChart = echarts.init(document.getElementById(&#x27;tags-chart&#x27;), &#x27;light&#x27;);</span></span><br><span class="line"><span class="string">    var tagsOption = &#123;</span></span><br><span class="line"><span class="string">      title: &#123;</span></span><br><span class="line"><span class="string">        text: &#x27;Top <span class="subst">$&#123;dataLength&#125;</span> 标签统计图&#x27;,</span></span><br><span class="line"><span class="string">        x: &#x27;center&#x27;,</span></span><br><span class="line"><span class="string">        textStyle: &#123;</span></span><br><span class="line"><span class="string">          color: color</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">      &#125;,</span></span><br><span class="line"><span class="string">      tooltip: &#123;&#125;,</span></span><br><span class="line"><span class="string">      xAxis: &#123;</span></span><br><span class="line"><span class="string">        name: &#x27;标签&#x27;,</span></span><br><span class="line"><span class="string">        type: &#x27;category&#x27;,</span></span><br><span class="line"><span class="string">        nameTextStyle: &#123;</span></span><br><span class="line"><span class="string">          color: color</span></span><br><span class="line"><span class="string">        &#125;,</span></span><br><span class="line"><span class="string">        axisTick: &#123;</span></span><br><span class="line"><span class="string">          show: false</span></span><br><span class="line"><span class="string">        &#125;,</span></span><br><span class="line"><span class="string">        axisLabel: &#123;</span></span><br><span class="line"><span class="string">          show: true,</span></span><br><span class="line"><span class="string">          color: color,</span></span><br><span class="line"><span class="string">          interval: 0</span></span><br><span class="line"><span class="string">        &#125;,</span></span><br><span class="line"><span class="string">        axisLine: &#123;</span></span><br><span class="line"><span class="string">          show: true,</span></span><br><span class="line"><span class="string">          lineStyle: &#123;</span></span><br><span class="line"><span class="string">            color: color</span></span><br><span class="line"><span class="string">          &#125;</span></span><br><span class="line"><span class="string">        &#125;,</span></span><br><span class="line"><span class="string">        data: <span class="subst">$&#123;tagNameArrJson&#125;</span></span></span><br><span class="line"><span class="string">      &#125;,</span></span><br><span class="line"><span class="string">      yAxis: &#123;</span></span><br><span class="line"><span class="string">        name: &#x27;文章篇数&#x27;,</span></span><br><span class="line"><span class="string">        type: &#x27;value&#x27;,</span></span><br><span class="line"><span class="string">        splitLine: &#123;</span></span><br><span class="line"><span class="string">          show: false</span></span><br><span class="line"><span class="string">        &#125;,</span></span><br><span class="line"><span class="string">        nameTextStyle: &#123;</span></span><br><span class="line"><span class="string">          color: color</span></span><br><span class="line"><span class="string">        &#125;,</span></span><br><span class="line"><span class="string">        axisTick: &#123;</span></span><br><span class="line"><span class="string">          show: false</span></span><br><span class="line"><span class="string">        &#125;,</span></span><br><span class="line"><span class="string">        axisLabel: &#123;</span></span><br><span class="line"><span class="string">          show: true,</span></span><br><span class="line"><span class="string">          color: color</span></span><br><span class="line"><span class="string">        &#125;,</span></span><br><span class="line"><span class="string">        axisLine: &#123;</span></span><br><span class="line"><span class="string">          show: true,</span></span><br><span class="line"><span class="string">          lineStyle: &#123;</span></span><br><span class="line"><span class="string">            color: color</span></span><br><span class="line"><span class="string">          &#125;</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">      &#125;,</span></span><br><span class="line"><span class="string">      series: [&#123;</span></span><br><span class="line"><span class="string">        name: &#x27;文章篇数&#x27;,</span></span><br><span class="line"><span class="string">        type: &#x27;bar&#x27;,</span></span><br><span class="line"><span class="string">        data: <span class="subst">$&#123;tagArrJson&#125;</span>,</span></span><br><span class="line"><span class="string">        itemStyle: &#123;</span></span><br><span class="line"><span class="string">          borderRadius: [5, 5, 0, 0],</span></span><br><span class="line"><span class="string">          color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [&#123;</span></span><br><span class="line"><span class="string">            offset: 0,</span></span><br><span class="line"><span class="string">            color: &#x27;rgba(128, 255, 165)&#x27;</span></span><br><span class="line"><span class="string">          &#125;,</span></span><br><span class="line"><span class="string">          &#123;</span></span><br><span class="line"><span class="string">            offset: 1,</span></span><br><span class="line"><span class="string">            color: &#x27;rgba(1, 191, 236)&#x27;</span></span><br><span class="line"><span class="string">          &#125;])</span></span><br><span class="line"><span class="string">        &#125;,</span></span><br><span class="line"><span class="string">        emphasis: &#123;</span></span><br><span class="line"><span class="string">          itemStyle: &#123;</span></span><br><span class="line"><span class="string">            color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [&#123;</span></span><br><span class="line"><span class="string">              offset: 0,</span></span><br><span class="line"><span class="string">              color: &#x27;rgba(128, 255, 195)&#x27;</span></span><br><span class="line"><span class="string">            &#125;,</span></span><br><span class="line"><span class="string">            &#123;</span></span><br><span class="line"><span class="string">              offset: 1,</span></span><br><span class="line"><span class="string">              color: &#x27;rgba(1, 211, 255)&#x27;</span></span><br><span class="line"><span class="string">            &#125;])</span></span><br><span class="line"><span class="string">          &#125;</span></span><br><span class="line"><span class="string">        &#125;,</span></span><br><span class="line"><span class="string">        markLine: &#123;</span></span><br><span class="line"><span class="string">          data: [&#123;</span></span><br><span class="line"><span class="string">            name: &#x27;平均值&#x27;,</span></span><br><span class="line"><span class="string">            type: &#x27;average&#x27;,</span></span><br><span class="line"><span class="string">            label: &#123;</span></span><br><span class="line"><span class="string">              color: color</span></span><br><span class="line"><span class="string">            &#125;</span></span><br><span class="line"><span class="string">          &#125;]</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">      &#125;]</span></span><br><span class="line"><span class="string">    &#125;;</span></span><br><span class="line"><span class="string">    tagsChart.setOption(tagsOption);</span></span><br><span class="line"><span class="string">    window.addEventListener(&#x27;resize&#x27;, () =&gt; &#123; </span></span><br><span class="line"><span class="string">      tagsChart.resize();</span></span><br><span class="line"><span class="string">    &#125;);</span></span><br><span class="line"><span class="string">    tagsChart.on(&#x27;click&#x27;, &#x27;series&#x27;, (event) =&gt; &#123;</span></span><br><span class="line"><span class="string">      if(event.data.path) window.location.href = &#x27;/&#x27; + event.data.path;</span></span><br><span class="line"><span class="string">    &#125;);</span></span><br><span class="line"><span class="string">  &lt;/script&gt;`</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">categoriesChart</span> (dataParent) &#123;</span><br><span class="line">  <span class="keyword">const</span> categoryArr = []</span><br><span class="line">  <span class="keyword">let</span> categoryParentFlag = <span class="literal">false</span></span><br><span class="line">  hexo.<span class="property">locals</span>.<span class="title function_">get</span>(<span class="string">&#x27;categories&#x27;</span>).<span class="title function_">map</span>(<span class="keyword">function</span> (<span class="params">category</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (category.<span class="property">parent</span>) categoryParentFlag = <span class="literal">true</span></span><br><span class="line">    categoryArr.<span class="title function_">push</span>(&#123;</span><br><span class="line">      <span class="attr">name</span>: category.<span class="property">name</span>,</span><br><span class="line">      <span class="attr">value</span>: category.<span class="property">length</span>,</span><br><span class="line">      <span class="attr">path</span>: category.<span class="property">path</span>,</span><br><span class="line">      <span class="attr">id</span>: category.<span class="property">_id</span>,</span><br><span class="line">      <span class="attr">parentId</span>: category.<span class="property">parent</span> || <span class="string">&#x27;0&#x27;</span></span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;)</span><br><span class="line">  categoryParentFlag = categoryParentFlag &amp;&amp; dataParent === <span class="string">&#x27;true&#x27;</span></span><br><span class="line">  categoryArr.<span class="title function_">sort</span>(<span class="function">(<span class="params">a, b</span>) =&gt;</span> &#123; <span class="keyword">return</span> b.<span class="property">value</span> - a.<span class="property">value</span> &#125;)</span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">translateListToTree</span> (data, parent) &#123;</span><br><span class="line">    <span class="keyword">let</span> tree = []</span><br><span class="line">    <span class="keyword">let</span> temp</span><br><span class="line">    data.<span class="title function_">forEach</span>(<span class="function">(<span class="params">item, index</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (data[index].<span class="property">parentId</span> == parent) &#123;</span><br><span class="line">        <span class="keyword">let</span> obj = data[index];</span><br><span class="line">        temp = <span class="title function_">translateListToTree</span>(data, data[index].<span class="property">id</span>);</span><br><span class="line">        <span class="keyword">if</span> (temp.<span class="property">length</span> &gt; <span class="number">0</span>) &#123;</span><br><span class="line">          obj.<span class="property">children</span> = temp</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (tree.<span class="title function_">indexOf</span>())</span><br><span class="line">          tree.<span class="title function_">push</span>(obj)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">return</span> tree</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">const</span> categoryNameJson = <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(categoryArr.<span class="title function_">map</span>(<span class="keyword">function</span> (<span class="params">category</span>) &#123; <span class="keyword">return</span> category.<span class="property">name</span> &#125;))</span><br><span class="line">  <span class="keyword">const</span> categoryArrJson = <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(categoryArr)</span><br><span class="line">  <span class="keyword">const</span> categoryArrParentJson = <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(<span class="title function_">translateListToTree</span>(categoryArr, <span class="string">&#x27;0&#x27;</span>))</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="string">`</span></span><br><span class="line"><span class="string">  &lt;script id=&quot;categoriesChart&quot;&gt;</span></span><br><span class="line"><span class="string">    var color = document.documentElement.getAttribute(&#x27;data-theme&#x27;) === &#x27;light&#x27; ? &#x27;#4c4948&#x27; : &#x27;rgba(255,255,255,0.7)&#x27;</span></span><br><span class="line"><span class="string">    var categoriesChart = echarts.init(document.getElementById(&#x27;categories-chart&#x27;), &#x27;light&#x27;);</span></span><br><span class="line"><span class="string">    var categoryParentFlag = <span class="subst">$&#123;categoryParentFlag&#125;</span></span></span><br><span class="line"><span class="string">    var categoriesOption = &#123;</span></span><br><span class="line"><span class="string">      title: &#123;</span></span><br><span class="line"><span class="string">        text: &#x27;文章分类统计图&#x27;,</span></span><br><span class="line"><span class="string">        x: &#x27;center&#x27;,</span></span><br><span class="line"><span class="string">        textStyle: &#123;</span></span><br><span class="line"><span class="string">          color: color</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">      &#125;,</span></span><br><span class="line"><span class="string">      legend: &#123;</span></span><br><span class="line"><span class="string">        top: &#x27;bottom&#x27;,</span></span><br><span class="line"><span class="string">        data: <span class="subst">$&#123;categoryNameJson&#125;</span>,</span></span><br><span class="line"><span class="string">        textStyle: &#123;</span></span><br><span class="line"><span class="string">          color: color</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">      &#125;,</span></span><br><span class="line"><span class="string">      tooltip: &#123;</span></span><br><span class="line"><span class="string">        trigger: &#x27;item&#x27;</span></span><br><span class="line"><span class="string">      &#125;,</span></span><br><span class="line"><span class="string">      series: []</span></span><br><span class="line"><span class="string">    &#125;;</span></span><br><span class="line"><span class="string">    categoriesOption.series.push(</span></span><br><span class="line"><span class="string">      categoryParentFlag ? </span></span><br><span class="line"><span class="string">      &#123;</span></span><br><span class="line"><span class="string">        nodeClick :false,</span></span><br><span class="line"><span class="string">        name: &#x27;文章篇数&#x27;,</span></span><br><span class="line"><span class="string">        type: &#x27;sunburst&#x27;,</span></span><br><span class="line"><span class="string">        radius: [&#x27;15%&#x27;, &#x27;90%&#x27;],</span></span><br><span class="line"><span class="string">        center: [&#x27;50%&#x27;, &#x27;55%&#x27;],</span></span><br><span class="line"><span class="string">        sort: &#x27;desc&#x27;,</span></span><br><span class="line"><span class="string">        data: <span class="subst">$&#123;categoryArrParentJson&#125;</span>,</span></span><br><span class="line"><span class="string">        itemStyle: &#123;</span></span><br><span class="line"><span class="string">          borderColor: &#x27;#fff&#x27;,</span></span><br><span class="line"><span class="string">          borderWidth: 2,</span></span><br><span class="line"><span class="string">          emphasis: &#123;</span></span><br><span class="line"><span class="string">            focus: &#x27;ancestor&#x27;,</span></span><br><span class="line"><span class="string">            shadowBlur: 10,</span></span><br><span class="line"><span class="string">            shadowOffsetX: 0,</span></span><br><span class="line"><span class="string">            shadowColor: &#x27;rgba(255, 255, 255, 0.5)&#x27;</span></span><br><span class="line"><span class="string">          &#125;</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">      &#125;</span></span><br><span class="line"><span class="string">      :</span></span><br><span class="line"><span class="string">      &#123;</span></span><br><span class="line"><span class="string">        name: &#x27;文章篇数&#x27;,</span></span><br><span class="line"><span class="string">        type: &#x27;pie&#x27;,</span></span><br><span class="line"><span class="string">        radius: [30, 80],</span></span><br><span class="line"><span class="string">        roseType: &#x27;area&#x27;,</span></span><br><span class="line"><span class="string">        label: &#123;</span></span><br><span class="line"><span class="string">          color: color,</span></span><br><span class="line"><span class="string">          formatter: &#x27;&#123;b&#125; : &#123;c&#125; (&#123;d&#125;%)&#x27;</span></span><br><span class="line"><span class="string">        &#125;,</span></span><br><span class="line"><span class="string">        data: <span class="subst">$&#123;categoryArrJson&#125;</span>,</span></span><br><span class="line"><span class="string">        itemStyle: &#123;</span></span><br><span class="line"><span class="string">          emphasis: &#123;</span></span><br><span class="line"><span class="string">            shadowBlur: 10,</span></span><br><span class="line"><span class="string">            shadowOffsetX: 0,</span></span><br><span class="line"><span class="string">            shadowColor: &#x27;rgba(255, 255, 255, 0.5)&#x27;</span></span><br><span class="line"><span class="string">          &#125;</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">      &#125;</span></span><br><span class="line"><span class="string">    )</span></span><br><span class="line"><span class="string">    categoriesChart.setOption(categoriesOption);</span></span><br><span class="line"><span class="string">    window.addEventListener(&#x27;resize&#x27;, () =&gt; &#123; </span></span><br><span class="line"><span class="string">      categoriesChart.resize();</span></span><br><span class="line"><span class="string">    &#125;);</span></span><br><span class="line"><span class="string">    categoriesChart.on(&#x27;click&#x27;, &#x27;series&#x27;, (event) =&gt; &#123;</span></span><br><span class="line"><span class="string">      if(event.data.path) window.location.href = &#x27;/&#x27; + event.data.path;</span></span><br><span class="line"><span class="string">    &#125;);</span></span><br><span class="line"><span class="string">  &lt;/script&gt;`</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>在添加黑夜模式适配时，需要注入相应的代码到底部</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">switchPostChart</span> () &#123;</span><br><span class="line">  <span class="comment">// 这里为了统一颜色选取的是“明暗模式”下的两种字体颜色，也可以自己定义</span></span><br><span class="line">  <span class="keyword">let</span> color = <span class="variable language_">document</span>.<span class="property">documentElement</span>.<span class="title function_">getAttribute</span>(<span class="string">&#x27;data-theme&#x27;</span>) === <span class="string">&#x27;light&#x27;</span> ? <span class="string">&#x27;#4C4948&#x27;</span> : <span class="string">&#x27;rgba(255,255,255,0.7)&#x27;</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;posts-chart&#x27;</span>) &amp;&amp; postsOption) &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">let</span> postsOptionNew = postsOption</span><br><span class="line">      postsOptionNew.<span class="property">title</span>.<span class="property">textStyle</span>.<span class="property">color</span> = color</span><br><span class="line">      postsOptionNew.<span class="property">xAxis</span>.<span class="property">nameTextStyle</span>.<span class="property">color</span> = color</span><br><span class="line">      postsOptionNew.<span class="property">yAxis</span>.<span class="property">nameTextStyle</span>.<span class="property">color</span> = color</span><br><span class="line">      postsOptionNew.<span class="property">xAxis</span>.<span class="property">axisLabel</span>.<span class="property">color</span> = color</span><br><span class="line">      postsOptionNew.<span class="property">yAxis</span>.<span class="property">axisLabel</span>.<span class="property">color</span> = color</span><br><span class="line">      postsOptionNew.<span class="property">xAxis</span>.<span class="property">axisLine</span>.<span class="property">lineStyle</span>.<span class="property">color</span> = color</span><br><span class="line">      postsOptionNew.<span class="property">yAxis</span>.<span class="property">axisLine</span>.<span class="property">lineStyle</span>.<span class="property">color</span> = color</span><br><span class="line">      postsOptionNew.<span class="property">series</span>[<span class="number">0</span>].<span class="property">markLine</span>.<span class="property">data</span>[<span class="number">0</span>].<span class="property">label</span>.<span class="property">color</span> = color</span><br><span class="line">      postsChart.<span class="title function_">setOption</span>(postsOptionNew)</span><br><span class="line">    &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(error)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (<span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;tags-chart&#x27;</span>) &amp;&amp; tagsOption) &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">let</span> tagsOptionNew = tagsOption</span><br><span class="line">      tagsOptionNew.<span class="property">title</span>.<span class="property">textStyle</span>.<span class="property">color</span> = color</span><br><span class="line">      tagsOptionNew.<span class="property">xAxis</span>.<span class="property">nameTextStyle</span>.<span class="property">color</span> = color</span><br><span class="line">      tagsOptionNew.<span class="property">yAxis</span>.<span class="property">nameTextStyle</span>.<span class="property">color</span> = color</span><br><span class="line">      tagsOptionNew.<span class="property">xAxis</span>.<span class="property">axisLabel</span>.<span class="property">color</span> = color</span><br><span class="line">      tagsOptionNew.<span class="property">yAxis</span>.<span class="property">axisLabel</span>.<span class="property">color</span> = color</span><br><span class="line">      tagsOptionNew.<span class="property">xAxis</span>.<span class="property">axisLine</span>.<span class="property">lineStyle</span>.<span class="property">color</span> = color</span><br><span class="line">      tagsOptionNew.<span class="property">yAxis</span>.<span class="property">axisLine</span>.<span class="property">lineStyle</span>.<span class="property">color</span> = color</span><br><span class="line">      tagsOptionNew.<span class="property">series</span>[<span class="number">0</span>].<span class="property">markLine</span>.<span class="property">data</span>[<span class="number">0</span>].<span class="property">label</span>.<span class="property">color</span> = color</span><br><span class="line">      tagsChart.<span class="title function_">setOption</span>(tagsOptionNew)</span><br><span class="line">    &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(error)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (<span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;categories-chart&#x27;</span>) &amp;&amp; categoriesOption) &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">let</span> categoriesOptionNew = categoriesOption</span><br><span class="line">      categoriesOptionNew.<span class="property">title</span>.<span class="property">textStyle</span>.<span class="property">color</span> = color</span><br><span class="line">      categoriesOptionNew.<span class="property">legend</span>.<span class="property">textStyle</span>.<span class="property">color</span> = color</span><br><span class="line">      <span class="keyword">if</span> (!categoryParentFlag) &#123; categoriesOptionNew.<span class="property">series</span>[<span class="number">0</span>].<span class="property">label</span>.<span class="property">color</span> = color &#125;</span><br><span class="line">      categoriesChart.<span class="title function_">setOption</span>(categoriesOptionNew)</span><br><span class="line">    &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(error)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;darkmode&quot;</span>).<span class="title function_">addEventListener</span>(<span class="string">&quot;click&quot;</span>, <span class="keyword">function</span> (<span class="params"></span>) &#123; <span class="built_in">setTimeout</span>(switchPostChart, <span class="number">100</span>) &#125;)</span><br></pre></td></tr></table></figure>              </div>            </details><h3 id="添加右键菜单">添加右键菜单</h3><p>感谢：</p><p><a href="https://blog.dorakika.cn/p/20220118.html">自定义右键菜单 | DoraKika</a></p><p><a href="https://blog.zhheo.com/p/5e931b65.html">Butterfly魔改：自定义右键菜单 | 张洪Heo (zhheo.com)</a></p><details class="folding-tag" blue><summary> 右键菜单 </summary>              <div class='content'>              <p>添加<code>...butterfly/layout/includes/dorakika/rightmenu.pug</code></p><p>代码如下</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">#rightMenu</span><br><span class="line">    .rightMenu-group.rightMenu-small</span><br><span class="line">        a.rightMenu-item(href=&quot;javascript:window.history.back();&quot;)</span><br><span class="line">            i.fa-solid.fa-arrow-left</span><br><span class="line">        a.rightMenu-item(href=&quot;javascript:window.history.forward();&quot;)</span><br><span class="line">            i.fa-solid.fa-arrow-right</span><br><span class="line">        a.rightMenu-item(href=&quot;javascript:window.location.reload();&quot;)</span><br><span class="line">            i.fa-solid.fa-arrow-rotate-right</span><br><span class="line">        a.rightMenu-item(href=&quot;javascript:rmf.scrollToTop();&quot;)</span><br><span class="line">            i.fa-solid.fa-arrow-up</span><br><span class="line">    .rightMenu-group.rightMenu-line.hide#menu-text</span><br><span class="line">        a.rightMenu-item(href=&quot;javascript:rmf.copySelect();&quot;)</span><br><span class="line">            i.fa-solid.fa-copy</span><br><span class="line">            span=&#x27;复制&#x27;</span><br><span class="line">    .rightMenu-group.rightMenu-line</span><br><span class="line">        a.rightMenu-item(href=&quot;javascript:rmf.switchDarkMode();&quot;)</span><br><span class="line">            i.fa-solid.fa-moon</span><br><span class="line">            span=&#x27;昼夜切换&#x27;</span><br><span class="line">        a.rightMenu-item(href=&quot;javascript:rmf.switchReadMode();&quot;)</span><br><span class="line">            i.fa-solid.fa-book-open</span><br><span class="line">            span=&#x27;阅读模式&#x27;</span><br></pre></td></tr></table></figure><p>然后在 <code>...butterfly/layout/includes/layout.pug</code> 中引入</p><figure class="highlight diff"><table><tr><td class="code"><pre><span class="line">doctype html</span><br><span class="line">html(lang=config.language data-theme=theme.display_mode class=htmlClassHideAside)</span><br><span class="line">  head</span><br><span class="line">    include ./head.pug</span><br><span class="line">  body</span><br><span class="line">    ...</span><br><span class="line"></span><br><span class="line">    else</span><br><span class="line">      include ./404.pug</span><br><span class="line"></span><br><span class="line">    include ./rightside.pug</span><br><span class="line">    !=partial(&#x27;includes/third-party/search/index&#x27;, &#123;&#125;, &#123;cache: true&#125;)</span><br><span class="line"><span class="addition">+    !=partial(&#x27;includes/dorakika/rightmenu&#x27;,&#123;&#125;, &#123;cache:true&#125;)</span></span><br><span class="line">    include ./additional-js.pug</span><br></pre></td></tr></table></figure><p>然后将样式表 <code>inject</code> 到头部，脚本 <code>inject</code> 到底部</p><figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="comment">/* rightMenu */</span></span><br><span class="line"><span class="selector-id">#rightMenu</span>&#123;</span><br><span class="line"><span class="attribute">display</span>: none;</span><br><span class="line"><span class="attribute">position</span>: fixed;</span><br><span class="line"><span class="attribute">width</span>: <span class="number">160px</span>;</span><br><span class="line"><span class="attribute">height</span>: fit-content;</span><br><span class="line"><span class="attribute">top</span>: <span class="number">10%</span>;</span><br><span class="line"><span class="attribute">left</span>: <span class="number">10%</span>;</span><br><span class="line"><span class="attribute">background-color</span>: <span class="built_in">var</span>(--card-bg);</span><br><span class="line"><span class="attribute">border</span>: <span class="number">1px</span> solid <span class="built_in">var</span>(--font-color);</span><br><span class="line"><span class="attribute">border-radius</span>: <span class="number">8px</span>;</span><br><span class="line"><span class="attribute">z-index</span>: <span class="number">100</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-id">#rightMenu</span> <span class="selector-class">.rightMenu-group</span>&#123;</span><br><span class="line"><span class="attribute">padding</span>: <span class="number">7px</span> <span class="number">6px</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-id">#rightMenu</span> <span class="selector-class">.rightMenu-group</span><span class="selector-pseudo">:not</span>(<span class="selector-pseudo">:nth-last-child</span>(<span class="number">1</span>))&#123;</span><br><span class="line"><span class="attribute">border-bottom</span>: <span class="number">1px</span> solid <span class="built_in">var</span>(--font-color);</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-id">#rightMenu</span> <span class="selector-class">.rightMenu-group</span><span class="selector-class">.rightMenu-small</span>&#123;</span><br><span class="line"><span class="attribute">display</span>: flex;</span><br><span class="line"><span class="attribute">justify-content</span>: space-between;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-id">#rightMenu</span> <span class="selector-class">.rightMenu-group</span> <span class="selector-class">.rightMenu-item</span>&#123;</span><br><span class="line"><span class="attribute">height</span>: <span class="number">30px</span>;</span><br><span class="line"><span class="attribute">line-height</span>: <span class="number">30px</span>;</span><br><span class="line"><span class="attribute">border-radius</span>: <span class="number">8px</span>;</span><br><span class="line"><span class="attribute">transition</span>: <span class="number">0.3s</span>;</span><br><span class="line"><span class="attribute">color</span>: <span class="built_in">var</span>(--font-color);</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-id">#rightMenu</span> <span class="selector-class">.rightMenu-group</span><span class="selector-class">.rightMenu-line</span> <span class="selector-class">.rightMenu-item</span>&#123;</span><br><span class="line"><span class="attribute">display</span>: flex;</span><br><span class="line"><span class="attribute">height</span>: <span class="number">40px</span>;</span><br><span class="line"><span class="attribute">line-height</span>: <span class="number">40px</span>;</span><br><span class="line"><span class="attribute">padding</span>: <span class="number">0</span> <span class="number">4px</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-id">#rightMenu</span> <span class="selector-class">.rightMenu-group</span> <span class="selector-class">.rightMenu-item</span><span class="selector-pseudo">:hover</span>&#123;</span><br><span class="line"><span class="attribute">background-color</span>: <span class="built_in">var</span>(--text-bg-hover);</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-id">#rightMenu</span> <span class="selector-class">.rightMenu-group</span> <span class="selector-class">.rightMenu-item</span> <span class="selector-tag">i</span>&#123;</span><br><span class="line"><span class="attribute">display</span>: inline-block;</span><br><span class="line"><span class="attribute">text-align</span>: center;</span><br><span class="line"><span class="attribute">line-height</span>: <span class="number">30px</span>;</span><br><span class="line"><span class="attribute">width</span>: <span class="number">30px</span>;</span><br><span class="line"><span class="attribute">height</span>: <span class="number">30px</span>;</span><br><span class="line"><span class="attribute">padding</span>: <span class="number">0</span> <span class="number">5px</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-id">#rightMenu</span> <span class="selector-class">.rightMenu-group</span> <span class="selector-class">.rightMenu-item</span> <span class="selector-tag">span</span>&#123;</span><br><span class="line"><span class="attribute">line-height</span>: <span class="number">30px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-id">#rightMenu</span> <span class="selector-class">.rightMenu-group</span><span class="selector-class">.rightMenu-line</span> <span class="selector-class">.rightMenu-item</span> *&#123;</span><br><span class="line"><span class="attribute">height</span>: <span class="number">40px</span>;</span><br><span class="line"><span class="attribute">line-height</span>: <span class="number">40px</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.rightMenu-group</span><span class="selector-class">.hide</span>&#123;</span><br><span class="line"><span class="attribute">display</span>: none;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> rmf = &#123;&#125;;</span><br><span class="line">rmf.<span class="property">showRightMenu</span> = <span class="keyword">function</span>(<span class="params">isTrue, x=<span class="number">0</span>, y=<span class="number">0</span></span>)&#123;</span><br><span class="line">    <span class="keyword">let</span> $rightMenu = $(<span class="string">&#x27;#rightMenu&#x27;</span>);</span><br><span class="line">    $rightMenu.<span class="title function_">css</span>(<span class="string">&#x27;top&#x27;</span>,x+<span class="string">&#x27;px&#x27;</span>).<span class="title function_">css</span>(<span class="string">&#x27;left&#x27;</span>,y+<span class="string">&#x27;px&#x27;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(isTrue)&#123;</span><br><span class="line">        $rightMenu.<span class="title function_">show</span>();</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        $rightMenu.<span class="title function_">hide</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">rmf.<span class="property">switchDarkMode</span> = <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="keyword">const</span> nowMode = <span class="variable language_">document</span>.<span class="property">documentElement</span>.<span class="title function_">getAttribute</span>(<span class="string">&#x27;data-theme&#x27;</span>) === <span class="string">&#x27;dark&#x27;</span> ? <span class="string">&#x27;dark&#x27;</span> : <span class="string">&#x27;light&#x27;</span></span><br><span class="line">    <span class="keyword">if</span> (nowMode === <span class="string">&#x27;light&#x27;</span>) &#123;</span><br><span class="line">        <span class="title function_">activateDarkMode</span>()</span><br><span class="line">        saveToLocal.<span class="title function_">set</span>(<span class="string">&#x27;theme&#x27;</span>, <span class="string">&#x27;dark&#x27;</span>, <span class="number">2</span>)</span><br><span class="line">        <span class="variable constant_">GLOBAL_CONFIG</span>.<span class="property">Snackbar</span> !== <span class="literal">undefined</span> &amp;&amp; btf.<span class="title function_">snackbarShow</span>(<span class="variable constant_">GLOBAL_CONFIG</span>.<span class="property">Snackbar</span>.<span class="property">day_to_night</span>)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="title function_">activateLightMode</span>()</span><br><span class="line">        saveToLocal.<span class="title function_">set</span>(<span class="string">&#x27;theme&#x27;</span>, <span class="string">&#x27;light&#x27;</span>, <span class="number">2</span>)</span><br><span class="line">        <span class="variable constant_">GLOBAL_CONFIG</span>.<span class="property">Snackbar</span> !== <span class="literal">undefined</span> &amp;&amp; btf.<span class="title function_">snackbarShow</span>(<span class="variable constant_">GLOBAL_CONFIG</span>.<span class="property">Snackbar</span>.<span class="property">night_to_day</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// handle some cases</span></span><br><span class="line">    <span class="keyword">typeof</span> utterancesTheme === <span class="string">&#x27;function&#x27;</span> &amp;&amp; <span class="title function_">utterancesTheme</span>()</span><br><span class="line">    <span class="keyword">typeof</span> <span class="variable constant_">FB</span> === <span class="string">&#x27;object&#x27;</span> &amp;&amp; <span class="variable language_">window</span>.<span class="title function_">loadFBComment</span>()</span><br><span class="line">    <span class="variable language_">window</span>.<span class="property">DISQUS</span> &amp;&amp; <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;disqus_thread&#x27;</span>).<span class="property">children</span>.<span class="property">length</span> &amp;&amp; <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> <span class="variable language_">window</span>.<span class="title function_">disqusReset</span>(), <span class="number">200</span>)</span><br><span class="line">&#125;;</span><br><span class="line">rmf.<span class="property">switchReadMode</span> = <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="keyword">const</span> $body = <span class="variable language_">document</span>.<span class="property">body</span></span><br><span class="line">    $body.<span class="property">classList</span>.<span class="title function_">add</span>(<span class="string">&#x27;read-mode&#x27;</span>)</span><br><span class="line">    <span class="keyword">const</span> newEle = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;button&#x27;</span>)</span><br><span class="line">    newEle.<span class="property">type</span> = <span class="string">&#x27;button&#x27;</span></span><br><span class="line">    newEle.<span class="property">className</span> = <span class="string">&#x27;fas fa-sign-out-alt exit-readmode&#x27;</span></span><br><span class="line">    $body.<span class="title function_">appendChild</span>(newEle)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">clickFn</span> () &#123;</span><br><span class="line">        $body.<span class="property">classList</span>.<span class="title function_">remove</span>(<span class="string">&#x27;read-mode&#x27;</span>)</span><br><span class="line">        newEle.<span class="title function_">remove</span>()</span><br><span class="line">        newEle.<span class="title function_">removeEventListener</span>(<span class="string">&#x27;click&#x27;</span>, clickFn)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    newEle.<span class="title function_">addEventListener</span>(<span class="string">&#x27;click&#x27;</span>, clickFn)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//复制选中文字</span></span><br><span class="line">rmf.<span class="property">copySelect</span> = <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="variable language_">document</span>.<span class="title function_">execCommand</span>(<span class="string">&#x27;Copy&#x27;</span>,<span class="literal">false</span>,<span class="literal">null</span>);</span><br><span class="line">    <span class="comment">//这里可以写点东西提示一下 已复制</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//回到顶部</span></span><br><span class="line">rmf.<span class="property">scrollToTop</span> = <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">    btf.<span class="title function_">scrollToDest</span>(<span class="number">0</span>, <span class="number">500</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 右键菜单事件</span></span><br><span class="line"><span class="keyword">if</span>(! (navigator.<span class="property">userAgent</span>.<span class="title function_">match</span>(<span class="regexp">/(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone)/i</span>)))&#123;</span><br><span class="line">    <span class="variable language_">window</span>.<span class="property">oncontextmenu</span> = <span class="keyword">function</span>(<span class="params">event</span>)&#123;</span><br><span class="line">        $(<span class="string">&#x27;.rightMenu-group.hide&#x27;</span>).<span class="title function_">hide</span>();</span><br><span class="line">        <span class="comment">//如果有文字选中，则显示 文字选中相关的菜单项</span></span><br><span class="line">        <span class="keyword">if</span>(<span class="variable language_">document</span>.<span class="title function_">getSelection</span>().<span class="title function_">toString</span>())&#123;</span><br><span class="line">            $(<span class="string">&#x27;#menu-text&#x27;</span>).<span class="title function_">show</span>();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> pageX = event.<span class="property">clientX</span> + <span class="number">10</span>;</span><br><span class="line">        <span class="keyword">let</span> pageY = event.<span class="property">clientY</span>;</span><br><span class="line">        <span class="keyword">let</span> rmWidth = $(<span class="string">&#x27;#rightMenu&#x27;</span>).<span class="title function_">width</span>();</span><br><span class="line">        <span class="keyword">let</span> rmHeight = $(<span class="string">&#x27;#rightMenu&#x27;</span>).<span class="title function_">height</span>();</span><br><span class="line">        <span class="keyword">if</span>(pageX + rmWidth &gt; <span class="variable language_">window</span>.<span class="property">innerWidth</span>)&#123;</span><br><span class="line">            pageX -= rmWidth+<span class="number">10</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(pageY + rmHeight &gt; <span class="variable language_">window</span>.<span class="property">innerHeight</span>)&#123;</span><br><span class="line">            pageY -= pageY + rmHeight - <span class="variable language_">window</span>.<span class="property">innerHeight</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        rmf.<span class="title function_">showRightMenu</span>(<span class="literal">true</span>, pageY, pageX);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="variable language_">window</span>.<span class="title function_">addEventListener</span>(<span class="string">&#x27;click&#x27;</span>,<span class="keyword">function</span>(<span class="params"></span>)&#123;rmf.<span class="title function_">showRightMenu</span>(<span class="literal">false</span>);&#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>由于右键菜单的切换夜间模式无法与统计图交互，因而需要对前述的 JS 文件进行如下修改：</p><figure class="highlight diff"><table><tr><td class="code"><pre><span class="line">rmf.switchDarkMode = function()&#123;</span><br><span class="line">    const nowMode = document.documentElement.getAttribute(&#x27;data-theme&#x27;) <span class="comment">=== &#x27;dark&#x27; ? &#x27;dark&#x27; : &#x27;light&#x27;</span></span><br><span class="line">    if (nowMode <span class="comment">=== &#x27;light&#x27;) &#123;</span></span><br><span class="line">        activateDarkMode()</span><br><span class="line">        saveToLocal.set(&#x27;theme&#x27;, &#x27;dark&#x27;, 2)</span><br><span class="line">        GLOBAL_CONFIG.Snackbar !== undefined &amp;&amp; btf.snackbarShow(GLOBAL_CONFIG.Snackbar.day_to_night)</span><br><span class="line"><span class="addition">+ setTimeout(switchPostChart, 100)</span></span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        activateLightMode()</span><br><span class="line">        saveToLocal.set(&#x27;theme&#x27;, &#x27;light&#x27;, 2)</span><br><span class="line">        GLOBAL_CONFIG.Snackbar !== undefined &amp;&amp; btf.snackbarShow(GLOBAL_CONFIG.Snackbar.night_to_day)</span><br><span class="line"><span class="addition">+       setTimeout(switchPostChart, 100)</span></span><br><span class="line">    &#125;</span><br><span class="line">    // handle some cases</span><br><span class="line">    typeof utterancesTheme <span class="comment">=== &#x27;function&#x27; &amp;&amp; utterancesTheme()</span></span><br><span class="line">    typeof FB <span class="comment">=== &#x27;object&#x27; &amp;&amp; window.loadFBComment()</span></span><br><span class="line">    window.DISQUS &amp;&amp; document.getElementById(&#x27;disqus_thread&#x27;).children.length &amp;&amp; setTimeout(() =&gt; window.disqusReset(), 200)</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>              </div>            </details><details class="folding-tag" blue><summary> 右键菜单 2023.1.12 更新 </summary>              <div class='content'>              <p>把右下角按钮移植入右键菜单，基本上是把 <code>JS</code> 函数拷贝到了 <code>.pug</code> 文件中，对阅读模式做了修改，阅读模式中将不开启右键菜单（否则再开启阅读模式，将会导致出现多个退出按钮）。</p><p>单多栏切换则由于窗口大小改变布局会发生改变，因而通过以下方式做到菜单项与布局匹配（ copy 的右边栏的样式，改了下就可以匹配了）。</p><figure class="highlight css"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">@media</span> screen <span class="keyword">and</span> (<span class="attribute">max-width</span>: <span class="number">900px</span>) &#123;</span><br><span class="line"><span class="selector-id">#rightMenu</span> <span class="selector-id">#menu-hide-aside</span>&#123;</span><br><span class="line">  <span class="attribute">display</span>: none;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>为适配石蒜模拟器（因为有时候想关掉它，不希望切换页面或者刷新的时候又跑出来），就在右键菜单写了开关，并修改了 <code>hexo-sakana</code> 插件。主要是插件过滤器的 <code>JS</code> 部分加了是否开启的判断，以及淡入淡出的动画。可以说这个右键菜单是我改得最深入的一次了，对于我这个没啥基础的人来说，真的见识大涨哈哈哈。</p>              </div>            </details><h2 id="主题优化">主题优化</h2><h3 id="样式表修改">样式表修改</h3><details class="folding-tag" blue><summary> 字体修改 </summary>              <div class='content'>              <p>引入字体后，结合样式表选择器可以设置某一部分的字体。</p><p>详见：<a href="https://www.matemaster.cn/posts/52745.html#toc-heading-2">基于Hexo的博客网站 | MateMaster</a></p>              </div>            </details><details class="folding-tag" blue><summary> 透明度修改及黑夜模式适配 </summary>              <div class='content'>              <p>依旧是样式表选择器。之前我把主页的头图和背景图设成了同一幅图，但是刷新之后会有一段时间的错位，看起来很不舒服。用大佬的方法完美地解决了问题。并且，利用样式表选择器可以设置黑夜模式下的透明度和色调。</p><p>详见：<a href="https://akilar.top/posts/ebf20e02">Custom Beautify | Akilarの糖果屋</a></p>              </div>            </details><details class="folding-tag" blue><summary> 鼠标指针修改 </summary>              <div class='content'>              <p>通过样式表选择器进行修改。</p><p>详见：<a href="https://akilar.top/posts/ebf20e02">Custom Beautify | Akilarの糖果屋</a></p>              </div>            </details><h3 id="github-日历">github 日历</h3><p>详见：<a href="https://zfe.space/post/hexo-githubcalendar.html">教程：hexo-githubcalendar 插件 1.0 | 小冰博客 (zfe.space)</a></p><details class="folding-tag" blue open><summary> 解决 2023.7.20 的 This Serverless Function has crashed 问题 </summary>              <div class='content'>              <p><strong>2023.7.20 api 出现问题</strong></p><blockquote><p><span class='p red'>This Serverless Function has crashed.</span><br><span class='p green'>Your connection is working correctly.</span><br><span class='p green'>Vercel is working correctly.</span><br>500: INTERNAL_SERVER_ERROR</p></blockquote><p>zkeq 已继续跟进: <a href="https://github.com/Zfour/python_github_calendar_api/pull/5">Github 页面改版，更新 regex 规则</a>，可以参考进行修改，测试有效。</p>              </div>            </details><details class="folding-tag" blue><summary> 解决 2023.1.7 的 This Serverless Function has crashed 问题 </summary>              <div class='content'>              <p><strong>2023.1.7 api 出现问题</strong>，改用自建的 API 也同样报错：</p><blockquote><p><span class='p red'>This Serverless Function has crashed.</span><br><span class='p green'>Your connection is working correctly.</span><br><span class='p green'>Vercel is working correctly.</span><br>500: INTERNAL_SERVER_ERROR</p></blockquote><p>目前其他博主也遇到了这个情况 <a href="https://github.com/Zfour/python_github_calendar_api/issues/6">500: INTERNAL_SERVER_ERROR</a>，可以看到 zkeq 已经针对该问题提了 PR: <a href="https://github.com/Zfour/python_github_calendar_api/pull/5">Github 页面改版，更新 regex 规则</a>，可以参考进行修改，测试有效。</p>              </div>            </details><details class="folding-tag" blue><summary> 解决 2022.9.4 Vercel 的公共域名被墙的问题 </summary>              <div class='content'>              <p><strong>2022.9.4 Vercel 的公共域名被墙了</strong>，解决方案有以下两种：</p><ul><li>可以先使用 <a href="https://gitcalendar.zfe.space/api">https://gitcalendar.zfe.space/api</a></li><li>使用 Vercel 的自定义域名绑定</li></ul><p>具体参见 <a href="https://github.com/Zfour/python_github_calendar_api">Zfour/python_github_calendar_api</a>，关于自建 API 的步骤中，他的配图用错了，创建项目的时候，别再用 <code>friends_link_list_api</code> 啦！</p>              </div>            </details><h3 id="github-卡片-ghcard">github 卡片 ghcard</h3><p>本插件是 <code>hexo-butterfly-tag-plugins-plus</code> 中的内容。 可以参见：<a href="https://akilar.top/posts/615e2dec/">Tag Plugins Plus | Akilarの糖果屋</a></p><p>如果自己部署了 <code>ghcard API</code> 但是卡片显示 <code>Maximum retries exceeded. Please add an env variable called PAT_1 with your github token in vercel</code> ，那可能是你的 <code>token</code> 没设好，或者过期了，重新生成一个就好。</p><details class="folding-tag" blue open><summary> 解决 2022.9.4 Vercel 的公共域名被墙的问题 </summary>              <div class='content'>              <p>但因为 <strong>2022.9.4 Vercel 的公共域名被墙了</strong>，所以需要使用 Vercel 的自定义域名绑定。自己部署在 Vercel 上的方法如下 <a href="https://github.com/anuraghazra/github-readme-stats">anuraghazra/github-readme-stats</a> ，然后再绑定自定义域名</p><p>注意，在部署时，可能会报错：<u>The value for maxDuration must be between 1 second and 10 seconds, in order to increase this limit upgrade your plan</u> 。解决方法见 <a href="https://github.com/anuraghazra/github-readme-stats/commit/8af4544dad025dfd770b99bf48278728217a8f0d">fix: decrease vercel ‘maxDuration’ to fix free plan deployment</a></p><p>绑定完成后，需要修改 <code>hexo-butterfly-tag-plugins-plus</code> 中相关文件：</p><figure class="highlight diff"><table><tr><td class="code"><pre><span class="line">// [path]\hexo-butterfly-tag-plugins-plus\lib\scripts 其他的 api 类似，使用全部替换即可</span><br><span class="line"><span class="deletion">- url += &#x27;https://github-readme-stats.vercel.app/api/?username=&#x27; + path </span></span><br><span class="line"><span class="addition">+ url += &#x27;https://yourdomain/api/?username=&#x27; + path;</span></span><br></pre></td></tr></table></figure><p>也可以使用我部署已经好的（不会真的有人会用我的吧？？）</p><figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">https://github-readme-stats.zerolacqua.top/api</span><br></pre></td></tr></table></figure>              </div>            </details><h3 id="Magnet">Magnet</h3><p>详见：<a href="https://zfe.space/post/hexo-magnet.html">教程：hexo-magnet 插件 1.0 | 小冰博客 (zfe.space)</a></p><h3 id="底部栏添加跳动的鱼背景">底部栏添加跳动的鱼背景</h3><p>详见：<a href="https://weilining.github.io/206.html">jQuery 插件 养鱼 | Ln’s Blog (weilining.github.io)</a></p><h3 id="Akilar-的标签插件-Tag-Plugins-Plus">Akilar 的标签插件 Tag Plugins Plus</h3><p>本博客的样式使用情况请见：<a href="/posts/7cd08a64.html" title="博客样式测试">博客样式测试</a>。详细测试例请见：<a href="https://akilar.top/posts/615e2dec/">Tag Plugins Plus | Akilarの糖果屋</a></p><h3 id="Waline-评论">Waline 评论</h3><p>这个评论系统有后端的诶真的好棒，看的第一眼就爱上了。不过同样由于 <strong>2022.9.4 Vercel 的公共域名被墙了</strong> 需要绑定自定义域名。要测试评论可以到<a href="/posts/a04972d8.html" title="可爱的水伊布">这里</a>试试</p><h3 id="友链朋友圈">友链朋友圈</h3><p>配置效果见<a href="/link/fcircle">朋友圈</a>，需要注意的是，由于 <strong>Vercel</strong> 受到影响，所以需要使用 <strong>Vercel</strong> 时，依然要绑定自定义域名。当然也可以使用其他部署方式。文档参见：<a href="https://fcircle-doc.yyyzyyyz.cn/">https://fcircle-doc.yyyzyyyz.cn/</a></p><h2 id="相关功能">相关功能</h2><h3 id="关于标签插件">关于标签插件</h3><p>想要将 <code>,</code> 作为参数输入，需要进行转义，使用 <code>&amp;sbquo;</code> 代替 <code>,</code></p><h3 id="隐藏博客">隐藏博客</h3><p>使用插件 <code>hexo-hide-posts</code></p><details class="folding-tag" blue><summary> 使用方法 </summary>              <div class='content'>              <p>安装插件</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">npm install hexo-hide-posts --save</span><br></pre></td></tr></table></figure><p>在博客的<code>Front-matter</code>中加入如下参数</p><figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line">hidden: false </span><br></pre></td></tr></table></figure><p>可实现对文章的隐藏（虽然还是可以用网址访问就是了）</p><p>参考网站：<a href="https://loafing.cn/posts/hexo-tags.html">「推荐」本站用到的 hexo 插件 | 若风 (loafing.cn)</a></p>              </div>            </details><h3 id="文字遮盖效果">文字遮盖效果</h3><p>使用插件 <code>hexo-hide-posts</code></p><details class="folding-tag" blue><summary> 使用方法 </summary>              <div class='content'>              <p>安装插件</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">npm install hexo-spoiler --save</span><br></pre></td></tr></table></figure><p>站点根目录配置</p><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">spoiler:</span></span><br><span class="line">  <span class="attr">style:</span> <span class="string">blur</span> <span class="comment"># 或者box</span></span><br><span class="line">  <span class="attr">color:</span> <span class="string">black</span> <span class="comment"># 仅当 style 为 box 时起效</span></span><br><span class="line">  <span class="attr">p:</span> <span class="literal">false</span> <span class="comment"># 没懂啥意思，不管它</span></span><br></pre></td></tr></table></figure><p>使用：</p><figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line">&#123;% spoiler 默认配置效果 %&#125;</span><br></pre></td></tr></table></figure><p>效果：<!-- spoiler-1ffd9:black --><br><span class="spoiler" onclick="this.classList.toggle('spoiler')"><br><span class="spoiler-blur spoiler-1ffd9">默认配置效果</span><br></span></p><p>参考网站：<a href="https://loafing.cn/posts/hexo-tags.html">「推荐」本站用到的 hexo 插件 | 若风 (loafing.cn)</a></p>              </div>            </details><h3 id="跳转站内文章">跳转站内文章</h3><p>通过标签插件 <code>&#123;% post_link %&#125;</code></p><details class="folding-tag" blue><summary> 使用方法 </summary>              <div class='content'>              <ul><li><p>可以使用以下方式</p>  <figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line">&#123;% post<span class="emphasis">_link 欢迎光临小店 %&#125;</span></span><br></pre></td></tr></table></figure><p>其效果是这样的</p><p><a href="/posts/c0297c2d.html" title="欢迎光临小店">欢迎光临小店</a></p></li><li><p>可以通过第二个参数修改文字内容</p>  <figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line">&#123;% post<span class="emphasis">_link 欢迎光临小店 偷看可是不礼貌的哦 %&#125;</span></span><br></pre></td></tr></table></figure><p>其效果是这样的</p><p><a href="/posts/c0297c2d.html" title="欢迎光临小店">偷看可是不礼貌的哦</a></p></li></ul>              </div>            </details><h3 id="跳转文章锚点">跳转文章锚点</h3><p>通过<code>&lt;a&gt;&lt;/a&gt;</code></p><details class="folding-tag" blue><summary> 使用方法 </summary>              <div class='content'>              <ul><li><p>方法一</p>  <figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;&#123;% post_path &#x27;近景摄影测量编程与实习&#x27; %&#125;#影像获取&quot;</span>&gt;</span>这是一个跳转<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure><p>此方法效果如下</p><p><a href="/posts/5f0fff90.html#影像获取">这是一个跳转</a></p></li><li><p><del>方法二</del></p>  <figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line">[<span class="string">这是一个跳转</span>](<span class="link">&#123;% post_path &#x27;近景摄影测量编程与实习&#x27; %&#125;#课间实习 </span>)</span><br></pre></td></tr></table></figure><p>此方法目前还无法实现，还没找到问题所在。</p><p><b>注意：</b></p><ol><li>如果文章中有图片，可能会出现锚点位置不准确问题，原因是图片加载成功之后会把内容高度撑开。</li><li>如果如果有空格，需要把空格换成连字符 <code>-</code>。</li></ol><p>可以参考以下文章</p><p><a href="https://blog.jijian.link/2020-01-08/hexo-anchor-link/#hexo-%E6%A0%87%E9%A2%98%E4%B8%8E-id-%E5%85%B3%E7%B3%BB">hexo 链接到站内文章指定锚点 | 极简前端 (jijian.link)</a></p></li></ul>              </div>            </details><h3 id="插入视频">插入视频</h3><p>使用 html 插入视频</p><details class="folding-tag" blue><summary> 使用方法 </summary>              <div class='content'>              <div class="tabs" id="使用"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#使用-1">格式一</button></li><li class="tab"><button type="button" data-href="#使用-2">格式二</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="使用-1"><p>嵌入视频</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&#123;% raw %&#125;</span><br><span class="line">&lt;div style=&quot;position: relative; width: 100%; height: 0; padding-bottom: 75%;&quot;&gt;&lt;iframe src=&quot;//player.bilibili.com/player.html?aid=460816113&amp;bvid=BV1j5411g7m5&amp;cid=345672460&amp;page=1&quot; scrolling=&quot;no&quot; border=&quot;0&quot; frameborder=&quot;no&quot; framespacing=&quot;0&quot; allowfullscreen=&quot;true&quot; style=&quot;position: absolute; width: 100%; height: 100%; Left: 0; top: 0;&quot; &gt;&lt;/iframe&gt;&lt;/div&gt;</span><br><span class="line">&#123;% endraw %&#125;</span><br></pre></td></tr></table></figure><div style="position: relative; width: 100%; height: 0; padding-bottom: 75%;"><iframe src="//player.bilibili.com/player.html?aid=460816113&bvid=BV1j5411g7m5&cid=345672460&page=1" scrolling="no" border="0" frameborder="no" framespacing="0" allowfullscreen="true" style="position: absolute; width: 100%; height: 100%; Left: 0; top: 0;" ></iframe></div><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="使用-2"><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;div style=&quot;position: relative; padding: 30% 45%;&quot;&gt;</span><br><span class="line">&lt;iframe style=&quot;position: absolute; width: 100%; height: 100%; left: 0; top: 0;&quot; src=&quot;https://player.bilibili.com/player.html?aid=460816113&amp;bvid=BV1j5411g7m5&amp;cid=345672460&amp;page=1&quot; frameborder=&quot;no&quot; scrolling=&quot;no&quot;&gt;&lt;/iframe&gt;</span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure><div style="position: relative; padding: 30% 45%;"><iframe style="position: absolute; width: 100%; height: 100%; left: 0; top: 0;" src="https://player.bilibili.com/player.html?aid=460816113&bvid=BV1j5411g7m5&cid=345672460&page=1" frameborder="no" scrolling="no"></iframe></div><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><p>可以参考：</p><ul><li><p><a href="https://www.jianshu.com/p/9b4d5903dfc8">Hexo博客如何加入B站视频/How to add bilibili shared video in Hexo - 简书 (jianshu.com)</a></p></li><li><p><a href="https://www.cnblogs.com/wkfvawl/p/12268980.html">关于博客园内嵌入bilibili视频 - 王陸 - 博客园 (cnblogs.com)</a></p></li></ul>              </div>            </details><h3 id="图库">图库</h3><p>通过标签插件 <code>&#123;% gallery %&#125;</code></p><details class="folding-tag" blue><summary> 使用方法 </summary>              <div class='content'>              <figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line">&#123;% gallery %&#125;</span><br><span class="line">![](<span class="link">https://cdn.zerolacqua.top/images/blogs/可爱的水伊布/Vaporeon1.png</span>)</span><br><span class="line">&#123;% endgallery %&#125;</span><br></pre></td></tr></table></figure><p>效果见<a href="/posts/a04972d8.html" title="可爱的水伊布">可爱的水伊布</a></p>              </div>            </details><h3 id="ECharts-2">ECharts</h3><p>使用插件 <code>hexo-tag-echarts</code></p><div id="echarts5514" style="width: 85%;height: 400px;margin: 0 auto"></div><script src="https://cdn.bootcss.com/echarts/3.8.0/echarts.common.min.js"></script><script type="text/javascript">        // 基于准备好的dom，初始化echarts实例        var myChart = echarts.init(document.getElementById('echarts5514'));        // 指定图表的配置项和数据        var option = {    tooltip : {        trigger: 'axis',        axisPointer : {            // 坐标轴指示器，坐标轴触发有效            type : 'shadow'        // 默认为直线，可选为：'line' | 'shadow'        }    },    legend: {        data:['利润', '支出', '收入']    },    grid: {        left: '3%',        right: '4%',        bottom: '3%',        containLabel: true    },    xAxis : [        {            type : 'value'        }    ],    yAxis : [        {            type : 'category',            axisTick : {show: false},            data : ['周一','周二','周三','周四','周五','周六','周日']        }    ],    series : [        {            name:'利润',            type:'bar',            itemStyle : {                normal: {                    label: {show: true, position: 'inside'}                }            },            data:[200, 170, 240, 244, 200, 220, 210]        },        {            name:'收入',            type:'bar',            stack: '总量',            itemStyle: {                normal: {                    label : {show: true}                }            },            data:[320, 302, 341, 374, 390, 450, 420]        },        {            name:'支出',            type:'bar',            stack: '总量',            itemStyle: {normal: {                label : {show: true, position: 'left'}            }},            data:[-120, -132, -101, -134, -190, -230, -210]        }    ]};        // 使用刚指定的配置项和数据显示图表。        myChart.setOption(option);</script><details class="folding-tag" blue><summary> 使用方法 </summary>              <div class='content'>              <div class="tabs" id="使用"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#使用-1">安装插件</button></li><li class="tab"><button type="button" data-href="#使用-2">示例代码</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="使用-1"><p>安装插件</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">npm install hexo-tag-echarts --save</span><br></pre></td></tr></table></figure><p>更新 <code>node_modules\hexo-tag-echarts3\template.html</code>中第二行的</p><figure class="highlight diff"><table><tr><td class="code"><pre><span class="line"><span class="deletion">- &lt;script src=&quot;https://cdn.bootcss.com/echarts/3.8.0/echarts.common.min.js&quot;&gt;&lt;/script&gt;</span></span><br><span class="line"><span class="addition">+ &lt;script src=&quot;https://cdn.jsdelivr.net/npm/echarts@5.3.0/dist/echarts.min.js&quot;&gt;&lt;/script&gt;</span></span><br><span class="line">//或者改为 &lt;script src=&quot;https://unpkg.com/echarts@5.3.0/dist/echarts.min.js&quot;&gt;&lt;/script&gt; </span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="使用-2"><figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line">&#123;% echarts 400 &#x27;85%&#x27; %&#125;</span><br><span class="line">&#123;</span><br><span class="line"><span class="code">    tooltip : &#123;</span></span><br><span class="line"><span class="code">        trigger: &#x27;axis&#x27;,</span></span><br><span class="line"><span class="code">        axisPointer : &#123;            // 坐标轴指示器，坐标轴触发有效</span></span><br><span class="line"><span class="code">            type : &#x27;shadow&#x27;        // 默认为直线，可选为：&#x27;line&#x27; | &#x27;shadow&#x27;</span></span><br><span class="line"><span class="code">        &#125;</span></span><br><span class="line"><span class="code">    &#125;,</span></span><br><span class="line"><span class="code">    legend: &#123;</span></span><br><span class="line"><span class="code">        data:[&#x27;利润&#x27;, &#x27;支出&#x27;, &#x27;收入&#x27;]</span></span><br><span class="line"><span class="code">    &#125;,</span></span><br><span class="line"><span class="code">    grid: &#123;</span></span><br><span class="line"><span class="code">        left: &#x27;3%&#x27;,</span></span><br><span class="line"><span class="code">        right: &#x27;4%&#x27;,</span></span><br><span class="line"><span class="code">        bottom: &#x27;3%&#x27;,</span></span><br><span class="line"><span class="code">        containLabel: true</span></span><br><span class="line"><span class="code">    &#125;,</span></span><br><span class="line"><span class="code">    xAxis : [</span></span><br><span class="line"><span class="code">        &#123;</span></span><br><span class="line"><span class="code">            type : &#x27;value&#x27;</span></span><br><span class="line"><span class="code">        &#125;</span></span><br><span class="line"><span class="code">    ],</span></span><br><span class="line"><span class="code">    yAxis : [</span></span><br><span class="line"><span class="code">        &#123;</span></span><br><span class="line"><span class="code">            type : &#x27;category&#x27;,</span></span><br><span class="line"><span class="code">            axisTick : &#123;show: false&#125;,</span></span><br><span class="line"><span class="code">            data : [&#x27;周一&#x27;,&#x27;周二&#x27;,&#x27;周三&#x27;,&#x27;周四&#x27;,&#x27;周五&#x27;,&#x27;周六&#x27;,&#x27;周日&#x27;]</span></span><br><span class="line"><span class="code">        &#125;</span></span><br><span class="line"><span class="code">    ],</span></span><br><span class="line"><span class="code">    series : [</span></span><br><span class="line"><span class="code">        &#123;</span></span><br><span class="line"><span class="code">            name:&#x27;利润&#x27;,</span></span><br><span class="line"><span class="code">            type:&#x27;bar&#x27;,</span></span><br><span class="line"><span class="code">            itemStyle : &#123;</span></span><br><span class="line"><span class="code">                normal: &#123;</span></span><br><span class="line"><span class="code">                    label: &#123;show: true, position: &#x27;inside&#x27;&#125;</span></span><br><span class="line"><span class="code">                &#125;</span></span><br><span class="line"><span class="code">            &#125;,</span></span><br><span class="line"><span class="code">            data:[200, 170, 240, 244, 200, 220, 210]</span></span><br><span class="line"><span class="code">        &#125;,</span></span><br><span class="line"><span class="code">        &#123;</span></span><br><span class="line"><span class="code">            name:&#x27;收入&#x27;,</span></span><br><span class="line"><span class="code">            type:&#x27;bar&#x27;,</span></span><br><span class="line"><span class="code">            stack: &#x27;总量&#x27;,</span></span><br><span class="line"><span class="code">            itemStyle: &#123;</span></span><br><span class="line"><span class="code">                normal: &#123;</span></span><br><span class="line"><span class="code">                    label : &#123;show: true&#125;</span></span><br><span class="line"><span class="code">                &#125;</span></span><br><span class="line"><span class="code">            &#125;,</span></span><br><span class="line"><span class="code">            data:[320, 302, 341, 374, 390, 450, 420]</span></span><br><span class="line"><span class="code">        &#125;,</span></span><br><span class="line"><span class="code">        &#123;</span></span><br><span class="line"><span class="code">            name:&#x27;支出&#x27;,</span></span><br><span class="line"><span class="code">            type:&#x27;bar&#x27;,</span></span><br><span class="line"><span class="code">            stack: &#x27;总量&#x27;,</span></span><br><span class="line"><span class="code">            itemStyle: &#123;normal: &#123;</span></span><br><span class="line"><span class="code">                label : &#123;show: true, position: &#x27;left&#x27;&#125;</span></span><br><span class="line"><span class="code">            &#125;&#125;,</span></span><br><span class="line"><span class="code">            data:[-120, -132, -101, -134, -190, -230, -210]</span></span><br><span class="line"><span class="code">        &#125;</span></span><br><span class="line"><span class="code">    ]</span></span><br><span class="line"><span class="code">&#125;;</span></span><br><span class="line"><span class="code">&#123;% endecharts %&#125;</span></span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><p>参考：</p><ul><li><a href="https://kchen.cc/2016/11/05/echarts-in-hexo/">在 Hexo 中插入 ECharts 动态图表 - KChen’s Blog</a></li><li><a href="https://226yzy.com/2022/012347381.html">Hexo中使用ECharts动态图表尝试</a></li></ul>              </div>            </details><h3 id="mini-sandbox-前端代码可视化">mini-sandbox 前端代码可视化</h3><p><a href="https://buuing.github.io/mini-sandbox/#/">mini-sandbox 官方文档</a></p><p>内容很大部分参考了<a href="https://www.chuckle.top/article/b827db53.html">使用MiniSandbox前端代码可视化 | 轻笑Chuckle</a></p><div id="sandbox"></div><details class="folding-tag" blue><summary> 使用方法 </summary>              <div class='content'>              <p>通过 CDN 单页引入 MiniSandbox</p><figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://unpkg.com/mini-sandbox@0.3.11&quot;</span>&gt;</span></span><span class="language-xml"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br></pre></td></tr></table></figure><p>创建一个 <code>sandbox.js</code> 文件用于文章中的引入</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">new</span> <span class="title class_">MiniSandbox</span>(&#123;</span><br><span class="line">    <span class="attr">el</span>: <span class="string">&#x27;#sandbox&#x27;</span>,<span class="comment">//要和 markdown 文件中 div 元素的 id 一致</span></span><br><span class="line">    <span class="attr">files</span>: &#123;<span class="comment">//各 tab 页面</span></span><br><span class="line">        <span class="comment">//index.html=&gt;html</span></span><br><span class="line">        <span class="comment">//index.css=&gt;css</span></span><br><span class="line">        <span class="comment">//index.js=&gt;js</span></span><br><span class="line">        <span class="string">&#x27;index.html&#x27;</span>: &#123;</span><br><span class="line">            <span class="attr">title</span>: <span class="string">&#x27;HTML&#x27;</span>,<span class="comment">//tab 上显示的名字</span></span><br><span class="line">            <span class="attr">defaultValue</span>: <span class="string">`&lt;h1&gt;JavaScript&lt;/h1&gt;</span></span><br><span class="line"><span class="string">&lt;p id=&quot;demo&quot;&gt;</span></span><br><span class="line"><span class="string">    JavaScript 能改变 HTML 元素的样式。</span></span><br><span class="line"><span class="string">&lt;/p&gt;</span></span><br><span class="line"><span class="string">&lt;button&gt;点击这里&lt;/button&gt;</span></span><br><span class="line"><span class="string">            `</span>,<span class="comment">//HTML的内容/代码</span></span><br><span class="line">            <span class="attr">cssLibs</span>: [<span class="string">&#x27;index.css&#x27;</span>],<span class="comment">//html引入的css</span></span><br><span class="line">            <span class="attr">jsLibs</span>: [<span class="string">&#x27;index.js&#x27;</span>],<span class="comment">//html引入的js</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">&#x27;index.css&#x27;</span>: &#123;</span><br><span class="line">            <span class="attr">title</span>: <span class="string">&#x27;CSS&#x27;</span>,</span><br><span class="line">            <span class="attr">defaultValue</span>: <span class="string">`h1&#123;</span></span><br><span class="line"><span class="string">    background: red;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">`</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">&#x27;index.js&#x27;</span>: &#123;</span><br><span class="line">            <span class="attr">title</span>: <span class="string">&#x27;JS&#x27;</span>,</span><br><span class="line">            <span class="comment">//JS的内容/代码</span></span><br><span class="line">            <span class="attr">defaultValue</span>: <span class="string">`const btn = document.querySelector(&#x27;button&#x27;)</span></span><br><span class="line"><span class="string">btn.addEventListener(&#x27;click&#x27;, () =&gt; &#123;</span></span><br><span class="line"><span class="string">    document.getElementById(&quot;demo&quot;).style.color</span></span><br><span class="line"><span class="string">    =&quot;#ff0000&quot;;</span></span><br><span class="line"><span class="string">&#125;)</span></span><br><span class="line"><span class="string">`</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">//用来设置一些 Sandbox 的默认配置</span></span><br><span class="line">    <span class="attr">defaultConfig</span>: &#123;</span><br><span class="line">        <span class="attr">height</span>: <span class="string">&#x27;300px&#x27;</span>,<span class="comment">//Sandbox 的高度, 默认为 &#x27;300px&#x27;</span></span><br><span class="line">        <span class="attr">autoRun</span>: <span class="literal">true</span>,<span class="comment">//每次修改后是否自动运行, 默认等于 true</span></span><br><span class="line">        <span class="attr">autoRunInterval</span>: <span class="number">1000</span>,<span class="comment">//每次自动运行的时间间隔, 单位为毫秒, 默认等于 300</span></span><br><span class="line">        <span class="attr">editorRange</span>: <span class="string">&#x27;50%&#x27;</span>,<span class="comment">//编辑区域默认占比, 默认情况下编辑区域占 50%</span></span><br><span class="line">        <span class="attr">draggable</span>: <span class="literal">true</span>,<span class="comment">//是否可以左右拖动布局, 默认为 true</span></span><br><span class="line">        <span class="attr">direction</span>: <span class="string">&#x27;row&#x27;</span>,<span class="comment">//控制上下/左右布局, 默认为 &#x27;row&#x27;。&#x27;row&#x27; | &#x27;row-reverse&#x27; | &#x27;column&#x27; | &#x27;column-reverse&#x27;</span></span><br><span class="line">      &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>并在文章末尾引入</p><figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;[your_directory]/sandbox.js&quot;</span>&gt;</span></span><span class="language-xml"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br></pre></td></tr></table></figure><p>针对 MiniSandbox 的夜间模式，可以参考轻笑Chuckle的 <code>CSS</code> 配置</p><figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-class">.mini-sandbox</span>&#123;</span><br><span class="line">  <span class="attribute">box-shadow</span>: none<span class="meta">!important</span>;</span><br><span class="line">  <span class="attribute">border-radius</span>: <span class="number">7px</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-attr">[data-theme=dark]</span></span><br><span class="line"><span class="selector-class">.mini-sandbox</span>&#123;</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="number">#151515</span><span class="meta">!important</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-attr">[data-theme=dark]</span></span><br><span class="line"><span class="selector-class">.cm-activeLine</span>&#123;</span><br><span class="line">   <span class="attribute">background-color</span>: <span class="number">#252525</span><span class="meta">!important</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-attr">[data-theme=dark]</span></span><br><span class="line"><span class="selector-class">.mini-sandbox</span> <span class="selector-class">.sandbox-head</span>&#123;</span><br><span class="line">  <span class="attribute">background</span>: <span class="number">#202020</span><span class="meta">!important</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-attr">[data-theme=dark]</span></span><br><span class="line"><span class="selector-class">.mini-sandbox</span> <span class="selector-class">.cm-gutters</span>&#123;</span><br><span class="line">  <span class="attribute">background</span>: <span class="number">#202020</span><span class="meta">!important</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.mini-sandbox</span> <span class="selector-class">.sandbox-head</span> <span class="selector-class">.sandbox-tab</span> <span class="selector-class">.sandbox-tab-active</span>&#123;</span><br><span class="line">  <span class="attribute">box-shadow</span>: none<span class="meta">!important</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-attr">[data-theme=dark]</span></span><br><span class="line"><span class="selector-class">.mini-sandbox</span> <span class="selector-class">.sandbox-head</span> <span class="selector-class">.sandbox-tab</span> <span class="selector-class">.sandbox-tab-active</span>&#123;</span><br><span class="line">  <span class="attribute">background</span>: <span class="number">#363636</span><span class="meta">!important</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-attr">[data-theme=dark]</span></span><br><span class="line"><span class="selector-class">.cm-activeLineGutter</span>&#123;</span><br><span class="line">  <span class="attribute">background</span>: <span class="number">#363636</span><span class="meta">!important</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-attr">[data-theme=dark]</span></span><br><span class="line"><span class="selector-class">.sandbox-body</span> <span class="selector-class">.sandbox-gutter</span>&#123;</span><br><span class="line">  <span class="attribute">background</span>: <span class="number">#363636</span><span class="meta">!important</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-attr">[data-theme=dark]</span></span><br><span class="line"><span class="selector-class">.mini-sandbox</span> <span class="selector-class">.sandbox-gutter</span>&#123;</span><br><span class="line">  <span class="attribute">border-left</span>: <span class="number">1px</span> solid <span class="number">#404040</span><span class="meta">!important</span>;</span><br><span class="line">  <span class="attribute">border-right</span>: <span class="number">1px</span> solid <span class="number">#404040</span><span class="meta">!important</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-attr">[data-theme=dark]</span></span><br><span class="line"><span class="selector-class">.mini-sandbox</span> <span class="selector-class">.sandbox-head</span> <span class="selector-class">.sandbox-tab</span> <span class="selector-class">.sandbox-tab-active</span><span class="selector-pseudo">::after</span>&#123;</span><br><span class="line">  <span class="attribute">background</span>: none<span class="meta">!important</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-attr">[data-theme=dark]</span></span><br><span class="line"><span class="selector-class">.mini-sandbox</span> <span class="selector-class">.sandbox-head</span> <span class="selector-class">.sandbox-tab</span> <span class="selector-class">.sandbox-tab-active</span><span class="selector-pseudo">::before</span>&#123;</span><br><span class="line">  <span class="attribute">background</span>: none<span class="meta">!important</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-attr">[data-theme=dark]</span></span><br><span class="line"><span class="selector-class">.mini-sandbox</span> <span class="selector-class">.sandbox-render</span>&#123;</span><br><span class="line">  <span class="attribute">background</span>: <span class="number">#E1E1E1</span><span class="meta">!important</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-attr">[data-theme=dark]</span></span><br><span class="line"><span class="selector-class">.mini-sandbox</span> .ͼd&#123;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#c3e88d</span><span class="meta">!important</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-attr">[data-theme=dark]</span></span><br><span class="line"><span class="selector-class">.mini-sandbox</span> .ͼc&#123;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#c3e88d</span><span class="meta">!important</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-attr">[data-theme=dark]</span></span><br><span class="line"><span class="selector-class">.mini-sandbox</span> .ͼ<span class="selector-tag">b</span>&#123;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#1E90FF</span><span class="meta">!important</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-attr">[data-theme=dark]</span></span><br><span class="line"><span class="selector-class">.mini-sandbox</span> .ͼf&#123;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#1E90FF</span><span class="meta">!important</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-attr">[data-theme=dark]</span></span><br><span class="line"><span class="selector-class">.mini-sandbox</span> .ͼh&#123;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#ff5370</span><span class="meta">!important</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-attr">[data-theme=dark]</span></span><br><span class="line"><span class="selector-class">.mini-sandbox</span> .ͼ<span class="selector-tag">a</span>&#123;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#FF00FF</span><span class="meta">!important</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-attr">[data-theme=dark]</span></span><br><span class="line"><span class="selector-class">.mini-sandbox</span> .ͼ<span class="selector-tag">i</span>&#123;</span><br><span class="line">  <span class="attribute">color</span>:<span class="number">#5F9EA0</span><span class="meta">!important</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-attr">[data-theme=dark]</span></span><br><span class="line"><span class="selector-class">.mini-sandbox</span> .ͼl&#123;</span><br><span class="line">  <span class="attribute">color</span>:<span class="number">#969896</span><span class="meta">!important</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.mini-sandbox</span>&#123;</span><br><span class="line">  <span class="attribute">margin-bottom</span>: <span class="number">10px</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>              </div>            </details><h2 id="Markdown-与数学公式">Markdown 与数学公式</h2><h3 id="数学公式渲染错误">数学公式渲染错误</h3><div class="tip warning faa-horizontal animated-hover"><p>由于 <em><strong>Mathjax</strong></em> 数学公式渲染效果很迷，经常无法复现问题，有时重新部署一下全部都变了，所以 <em><strong>Mathjax</strong></em> 的内容参考价值不大！</p><p>果然还是 <em><strong>Katex</strong></em> 用起来更舒服啊，换了 <em><strong>Katex</strong></em> 之后这些问题就不存在了。解决不了问题，就把产生问题的解决掉。</p></div><details class="folding-tag" blue><summary> 一些解决方法 </summary>              <div class='content'>              <div class="tabs" id="使用"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#使用-1">Katex（推荐）</button></li><li class="tab"><button type="button" data-href="#使用-2">Mathjax（不推荐）</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="使用-1"><p>当然，换了 <em><strong>Katex</strong></em> 还是会有它的问题，就比如<strong>加粗</strong>。</p><figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line">一二<span class="strong">**加粗**</span>三四</span><br><span class="line">一二<span class="strong">**.加粗**</span>三四</span><br><span class="line">一二<span class="strong">**加.粗**</span>三四</span><br><span class="line">一二<span class="strong">**加粗.**</span>三四</span><br></pre></td></tr></table></figure><p>看看效果吧</p><p>一二<strong>加粗</strong>三四<br>一二**.加粗<strong>三四<br>一二</strong>加.粗<strong>三四<br>一二</strong>加粗.**三四</p><ul><li>所以最好还是不要在内部有字符的时候用<strong>加粗</strong>、<em>斜体</em></li><li>更合适的方法是使用<code>&lt;b&gt;</code>和<code>&lt;/b&gt;</code>；<code>&lt;i&gt;</code>和<code>&lt;/i&gt;</code></li></ul><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="使用-2"><p>可以参见这几篇文章进行修改：</p><ul><li><a href="https://www.jianshu.com/p/7ab21c7f0674">在Hexo中渲染MathJax数学公式 - 简书 (jianshu.com)</a></li><li><a href="https://corecabin.cn/2021/08/14/solve-some-problems-of-hexo-renderer-kramed-rendering-conflicts/">解决hexo-renderer-kramed渲染冲突的部分问题 | 卡洛的核心舱 (corecabin.cn)</a></li></ul><p>但是修改后公式中还是会出现<code>\\</code>被转义成<code>\</code>的问题：</p><figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line">CCW(c,a,b)=</span><br><span class="line">\begin&#123;vmatrix&#125;</span><br><span class="line">a<span class="emphasis">_x&amp;a_</span>y&amp;1\\</span><br><span class="line">b<span class="emphasis">_x&amp;b_</span>y&amp;1\\</span><br><span class="line">c<span class="emphasis">_x&amp;c_</span>y&amp;1\\</span><br><span class="line">\end&#123;vmatrix&#125;=</span><br><span class="line">\begin&#123;vmatrix&#125;</span><br><span class="line">a<span class="emphasis">_x-c_</span>x&amp;a<span class="emphasis">_y-c_</span>y\\</span><br><span class="line">b<span class="emphasis">_x-c_</span>x&amp;b<span class="emphasis">_y-c_</span>y\\</span><br><span class="line">\end&#123;vmatrix&#125;</span><br></pre></td></tr></table></figure><p>其效果为：<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>C</mi><mi>C</mi><mi>W</mi><mo stretchy="false">(</mo><mi>c</mi><mo separator="true">,</mo><mi>a</mi><mo separator="true">,</mo><mi>b</mi><mo stretchy="false">)</mo><mo>=</mo><mrow><mo fence="true">∣</mo><mtable rowspacing="0.16em" columnalign="center center center" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>a</mi><mi>x</mi></msub></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>a</mi><mi>y</mi></msub></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>1</mn></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>b</mi><mi>x</mi></msub></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>b</mi><mi>y</mi></msub></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>1</mn></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>c</mi><mi>x</mi></msub></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>c</mi><mi>y</mi></msub></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>1</mn></mstyle></mtd></mtr></mtable><mo fence="true">∣</mo></mrow><mo>=</mo><mrow><mo fence="true">∣</mo><mtable rowspacing="0.16em" columnalign="center center" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><msub><mi>a</mi><mi>x</mi></msub><mo>−</mo><msub><mi>c</mi><mi>x</mi></msub></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><msub><mi>a</mi><mi>y</mi></msub><mo>−</mo><msub><mi>c</mi><mi>y</mi></msub></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><msub><mi>b</mi><mi>x</mi></msub><mo>−</mo><msub><mi>c</mi><mi>x</mi></msub></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><msub><mi>b</mi><mi>y</mi></msub><mo>−</mo><msub><mi>c</mi><mi>y</mi></msub></mrow></mstyle></mtd></mtr></mtable><mo fence="true">∣</mo></mrow></mrow><annotation encoding="application/x-tex">CCW(c,a,b)=\begin{vmatrix}a_x&amp;a_y&amp;1\\b_x&amp;b_y&amp;1\\c_x&amp;c_y&amp;1\\\end{vmatrix}=\begin{vmatrix}a_x-c_x&amp;a_y-c_y\\b_x-c_x&amp;b_y-c_y\\\end{vmatrix}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">CC</span><span class="mord mathnormal" style="margin-right:0.13889em;">W</span><span class="mopen">(</span><span class="mord mathnormal">c</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">a</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">b</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:3.6em;vertical-align:-1.55em;"></span><span class="minner"><span class="mopen"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-4.05em;"><span class="pstrut" style="height:5.6em;"></span><span style="width:0.333em;height:3.600em;"><svg xmlns="http://www.w3.org/2000/svg" width='0.333em' height='3.600em' viewBox='0 0 333 3600'><path d='M145 15 v585 v2400 v585 c2.667,10,9.667,15,21,15c10,0,16.667,-5,20,-15 v-585 v-2400 v-585 c-2.667,-10,-9.667,-15,-21,-15c-10,0,-16.667,5,-20,15z M188 15 H145 v585 v2400 v585 h43z'/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em;"><span></span></span></span></span></span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-4.21em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">x</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-3.01em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">x</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-1.81em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">x</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-4.21em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">y</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span></span></span><span style="top:-3.01em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">y</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span></span></span><span style="top:-1.81em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">y</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-4.21em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span><span style="top:-3.01em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span><span style="top:-1.81em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em;"><span></span></span></span></span></span></span></span><span class="mclose"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-4.05em;"><span class="pstrut" style="height:5.6em;"></span><span style="width:0.333em;height:3.600em;"><svg xmlns="http://www.w3.org/2000/svg" width='0.333em' height='3.600em' viewBox='0 0 333 3600'><path d='M145 15 v585 v2400 v585 c2.667,10,9.667,15,21,15c10,0,16.667,-5,20,-15 v-585 v-2400 v-585 c-2.667,-10,-9.667,-15,-21,-15c-10,0,-16.667,5,-20,15z M188 15 H145 v585 v2400 v585 h43z'/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em;"><span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:2.4em;vertical-align:-0.95em;"></span><span class="minner"><span class="mopen"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.45em;"><span style="top:-3.45em;"><span class="pstrut" style="height:4.4em;"></span><span style="width:0.333em;height:2.400em;"><svg xmlns="http://www.w3.org/2000/svg" width='0.333em' height='2.400em' viewBox='0 0 333 2400'><path d='M145 15 v585 v1200 v585 c2.667,10,9.667,15,21,15c10,0,16.667,-5,20,-15 v-585 v-1200 v-585 c-2.667,-10,-9.667,-15,-21,-15c-10,0,-16.667,5,-20,15z M188 15 H145 v585 v1200 v585 h43z'/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.95em;"><span></span></span></span></span></span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.45em;"><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">x</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">x</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-2.41em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">x</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">x</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.95em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.45em;"><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">y</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">y</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span></span></span><span style="top:-2.41em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">y</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">y</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.95em;"><span></span></span></span></span></span></span></span><span class="mclose"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.45em;"><span style="top:-3.45em;"><span class="pstrut" style="height:4.4em;"></span><span style="width:0.333em;height:2.400em;"><svg xmlns="http://www.w3.org/2000/svg" width='0.333em' height='2.400em' viewBox='0 0 333 2400'><path d='M145 15 v585 v1200 v585 c2.667,10,9.667,15,21,15c10,0,16.667,-5,20,-15 v-585 v-1200 v-585 c-2.667,-10,-9.667,-15,-21,-15c-10,0,-16.667,5,-20,15z M188 15 H145 v585 v1200 v585 h43z'/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.95em;"><span></span></span></span></span></span></span></span></span></span></span></p><p>妥协办法也有，但是太蠢，将就用吧</p><figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line">CCW(c,a,b)=</span><br><span class="line">\begin&#123;vmatrix&#125;</span><br><span class="line">a<span class="emphasis">_x&amp;a_</span>y&amp;1\\\\</span><br><span class="line">b<span class="emphasis">_x&amp;b_</span>y&amp;1\\\\</span><br><span class="line">c<span class="emphasis">_x&amp;c_</span>y&amp;1\\\\</span><br><span class="line">\end&#123;vmatrix&#125;=</span><br><span class="line">\begin&#123;vmatrix&#125;</span><br><span class="line">a<span class="emphasis">_x-c_</span>x&amp;a<span class="emphasis">_y-c_</span>y\\\\</span><br><span class="line">b<span class="emphasis">_x-c_</span>x&amp;b<span class="emphasis">_y-c_</span>y\\\\</span><br><span class="line">\end&#123;vmatrix&#125;</span><br></pre></td></tr></table></figure><p>其效果为：<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>C</mi><mi>C</mi><mi>W</mi><mo stretchy="false">(</mo><mi>c</mi><mo separator="true">,</mo><mi>a</mi><mo separator="true">,</mo><mi>b</mi><mo stretchy="false">)</mo><mo>=</mo><mrow><mo fence="true">∣</mo><mtable rowspacing="0.16em" columnalign="center center center" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>a</mi><mi>x</mi></msub></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>a</mi><mi>y</mi></msub></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>1</mn></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>b</mi><mi>x</mi></msub></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>b</mi><mi>y</mi></msub></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>1</mn></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>c</mi><mi>x</mi></msub></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>c</mi><mi>y</mi></msub></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>1</mn></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow></mrow></mstyle></mtd></mtr></mtable><mo fence="true">∣</mo></mrow><mo>=</mo><mrow><mo fence="true">∣</mo><mtable rowspacing="0.16em" columnalign="center center" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><msub><mi>a</mi><mi>x</mi></msub><mo>−</mo><msub><mi>c</mi><mi>x</mi></msub></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><msub><mi>a</mi><mi>y</mi></msub><mo>−</mo><msub><mi>c</mi><mi>y</mi></msub></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><msub><mi>b</mi><mi>x</mi></msub><mo>−</mo><msub><mi>c</mi><mi>x</mi></msub></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><msub><mi>b</mi><mi>y</mi></msub><mo>−</mo><msub><mi>c</mi><mi>y</mi></msub></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow></mrow></mstyle></mtd></mtr></mtable><mo fence="true">∣</mo></mrow></mrow><annotation encoding="application/x-tex">CCW(c,a,b)=\begin{vmatrix}a_x&amp;a_y&amp;1\\\\b_x&amp;b_y&amp;1\\\\c_x&amp;c_y&amp;1\\\\\end{vmatrix}=\begin{vmatrix}a_x-c_x&amp;a_y-c_y\\\\b_x-c_x&amp;b_y-c_y\\\\\end{vmatrix}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">CC</span><span class="mord mathnormal" style="margin-right:0.13889em;">W</span><span class="mopen">(</span><span class="mord mathnormal">c</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">a</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">b</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:7.2001em;vertical-align:-3.3501em;"></span><span class="minner"><span class="mopen"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:3.8499em;"><span style="top:-5.8499em;"><span class="pstrut" style="height:9.2em;"></span><span style="width:0.333em;height:7.200em;"><svg xmlns="http://www.w3.org/2000/svg" width='0.333em' height='7.200em' viewBox='0 0 333 7200'><path d='M145 15 v585 v6000 v585 c2.667,10,9.667,15,21,15c10,0,16.667,-5,20,-15 v-585 v-6000 v-585 c-2.667,-10,-9.667,-15,-21,-15c-10,0,-16.667,5,-20,15z M188 15 H145 v585 v6000 v585 h43z'/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:3.3501em;"><span></span></span></span></span></span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:3.85em;"><span style="top:-6.01em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">x</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-4.81em;"><span class="pstrut" style="height:3em;"></span><span class="mord"></span></span><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">x</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-2.41em;"><span class="pstrut" style="height:3em;"></span><span class="mord"></span></span><span style="top:-1.21em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">x</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-0.01em;"><span class="pstrut" style="height:3em;"></span><span class="mord"></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:3.35em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:3.85em;"><span style="top:-6.01em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">y</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span></span></span><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">y</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span></span></span><span style="top:-1.21em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">y</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.15em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:3.85em;"><span style="top:-6.01em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span><span style="top:-1.21em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.15em;"><span></span></span></span></span></span></span></span><span class="mclose"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:3.8499em;"><span style="top:-5.8499em;"><span class="pstrut" style="height:9.2em;"></span><span style="width:0.333em;height:7.200em;"><svg xmlns="http://www.w3.org/2000/svg" width='0.333em' height='7.200em' viewBox='0 0 333 7200'><path d='M145 15 v585 v6000 v585 c2.667,10,9.667,15,21,15c10,0,16.667,-5,20,-15 v-585 v-6000 v-585 c-2.667,-10,-9.667,-15,-21,-15c-10,0,-16.667,5,-20,15z M188 15 H145 v585 v6000 v585 h43z'/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:3.3501em;"><span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:4.8em;vertical-align:-2.15em;"></span><span class="minner"><span class="mopen"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.65em;"><span style="top:-4.65em;"><span class="pstrut" style="height:6.8em;"></span><span style="width:0.333em;height:4.800em;"><svg xmlns="http://www.w3.org/2000/svg" width='0.333em' height='4.800em' viewBox='0 0 333 4800'><path d='M145 15 v585 v3600 v585 c2.667,10,9.667,15,21,15c10,0,16.667,-5,20,-15 v-585 v-3600 v-585 c-2.667,-10,-9.667,-15,-21,-15c-10,0,-16.667,5,-20,15z M188 15 H145 v585 v3600 v585 h43z'/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.65em;"><span style="top:-4.81em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">x</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">x</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"></span></span><span style="top:-2.41em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">x</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">x</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-1.21em;"><span class="pstrut" style="height:3em;"></span><span class="mord"></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.15em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.65em;"><span style="top:-4.81em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">y</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">y</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span></span></span><span style="top:-2.41em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">y</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">y</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.95em;"><span></span></span></span></span></span></span></span><span class="mclose"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.65em;"><span style="top:-4.65em;"><span class="pstrut" style="height:6.8em;"></span><span style="width:0.333em;height:4.800em;"><svg xmlns="http://www.w3.org/2000/svg" width='0.333em' height='4.800em' viewBox='0 0 333 4800'><path d='M145 15 v585 v3600 v585 c2.667,10,9.667,15,21,15c10,0,16.667,-5,20,-15 v-585 v-3600 v-585 c-2.667,-10,-9.667,-15,-21,-15c-10,0,-16.667,5,-20,15z M188 15 H145 v585 v3600 v585 h43z'/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.15em;"><span></span></span></span></span></span></span></span></span></span></span></p><p>此外，公式块中 <code>{y}_{t}</code>的<code>_</code>会被渲染成斜体</p><figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line">$$</span><br><span class="line"></span><br><span class="line">\hat &#123;y&#125;<span class="emphasis">_&#123;t&#125;=\cfrac&#123;1&#125;&#123;2l+1&#125;(y_</span>&#123;t-l&#125;+y<span class="emphasis">_&#123;t-(l-1)&#125;+\cdots+y_</span>&#123;t-1&#125;+y<span class="emphasis">_&#123;t&#125;+y_</span>&#123;t+1&#125;+\cdots+y<span class="emphasis">_&#123;t+l&#125;)</span></span><br><span class="line"><span class="emphasis"></span></span><br><span class="line"><span class="emphasis">$$</span></span><br></pre></td></tr></table></figure><p>其效果为：</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mtable rowspacing="0.16em" columnspacing="1em"><mtr><mtd class ="mtr-glue"></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><msub><mover accent="true"><mi>y</mi><mo>^</mo></mover><mi>t</mi></msub><mo>=</mo><mfrac><mn>1</mn><mrow><mn>2</mn><mi>l</mi><mo>+</mo><mn>1</mn></mrow></mfrac><mo stretchy="false">(</mo><msub><mi>y</mi><mrow><mi>t</mi><mo>−</mo><mi>l</mi></mrow></msub><mo>+</mo><msub><mi>y</mi><mrow><mi>t</mi><mo>−</mo><mo stretchy="false">(</mo><mi>l</mi><mo>−</mo><mn>1</mn><mo stretchy="false">)</mo></mrow></msub><mo>+</mo><mo>⋯</mo><mo>+</mo><msub><mi>y</mi><mrow><mi>t</mi><mo>−</mo><mn>1</mn></mrow></msub><mo>+</mo><msub><mi>y</mi><mi>t</mi></msub><mo>+</mo><msub><mi>y</mi><mrow><mi>t</mi><mo>+</mo><mn>1</mn></mrow></msub><mo>+</mo><mo>⋯</mo><mo>+</mo><msub><mi>y</mi><mrow><mi>t</mi><mo>+</mo><mi>l</mi></mrow></msub><mo stretchy="false">)</mo></mrow></mstyle></mtd><mtd class ="mtr-glue"></mtd><mtd class ="mml-eqn-num"></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{equation}\hat {y}_{t}=\cfrac{1}{2l+1}(y_{t-l}+y_{t-(l-1)}+\cdots+y_{t-1}+y_{t}+y_{t+1}+\cdots+y_{t+l})\end{equation}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:2.3593em;vertical-align:-0.9297em;"></span><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.4297em;"><span style="top:-3.4297em;"><span class="pstrut" style="height:3.59em;"></span><span class="mord"><span class="mord"><span class="mord accent"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.6944em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.1944em;"><span class="mord">^</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.1944em;"><span></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2806em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.59em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">2</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord">1</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.74em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.7693em;"><span></span></span></span></span></span><span></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mbin mtight">−</span><span class="mord mathnormal mtight" style="margin-right:0.01968em;">l</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2083em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em;"><span style="top:-2.5198em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mbin mtight">−</span><span class="mopen mtight">(</span><span class="mord mathnormal mtight" style="margin-right:0.01968em;">l</span><span class="mbin mtight">−</span><span class="mord mtight">1</span><span class="mclose mtight">)</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.3552em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="minner">⋯</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2083em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2806em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2083em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="minner">⋯</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mbin mtight">+</span><span class="mord mathnormal mtight" style="margin-right:0.01968em;">l</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2083em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.9297em;"><span></span></span></span></span></span></span></span><span class="tag"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.4297em;"><span style="top:-3.4297em;"><span class="pstrut" style="height:3.59em;"></span><span class="eqn-num"></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.9297em;"><span></span></span></span></span></span></span></span></span></p><p>需要改成<code>{y}_ {t}</code></p><figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line">$$</span><br><span class="line"></span><br><span class="line">\hat &#123;y&#125;<span class="emphasis">_ &#123;t&#125;=\cfrac&#123;1&#125;&#123;2l+1&#125;(y_</span>&#123;t-l&#125;+y<span class="emphasis">_&#123;t-(l-1)&#125;+\cdots+y_</span>&#123;t-1&#125;+y<span class="emphasis">_&#123;t&#125;+y_</span>&#123;t+1&#125;+\cdots+y<span class="emphasis">_&#123;t+l&#125;)</span></span><br><span class="line"><span class="emphasis"></span></span><br><span class="line"><span class="emphasis">$$</span></span><br></pre></td></tr></table></figure><p>其效果为</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mover accent="true"><mi>y</mi><mo>^</mo></mover><mi>t</mi></msub><mo>=</mo><mfrac><mn>1</mn><mrow><mn>2</mn><mi>l</mi><mo>+</mo><mn>1</mn></mrow></mfrac><mo stretchy="false">(</mo><msub><mi>y</mi><mrow><mi>t</mi><mo>−</mo><mi>l</mi></mrow></msub><mo>+</mo><msub><mi>y</mi><mrow><mi>t</mi><mo>−</mo><mo stretchy="false">(</mo><mi>l</mi><mo>−</mo><mn>1</mn><mo stretchy="false">)</mo></mrow></msub><mo>+</mo><mo>⋯</mo><mo>+</mo><msub><mi>y</mi><mrow><mi>t</mi><mo>−</mo><mn>1</mn></mrow></msub><mo>+</mo><msub><mi>y</mi><mi>t</mi></msub><mo>+</mo><msub><mi>y</mi><mrow><mi>t</mi><mo>+</mo><mn>1</mn></mrow></msub><mo>+</mo><mo>⋯</mo><mo>+</mo><msub><mi>y</mi><mrow><mi>t</mi><mo>+</mo><mi>l</mi></mrow></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\hat {y}_ {t}=\cfrac{1}{2l+1}(y_{t-l}+y_{t-(l-1)}+\cdots+y_{t-1}+y_{t}+y_{t+1}+\cdots+y_{t+l})</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord accent"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.6944em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.1944em;"><span class="mord">^</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.1944em;"><span></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2806em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:2.3593em;vertical-align:-0.7693em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.59em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">2</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord">1</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.74em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.7693em;"><span></span></span></span></span></span><span></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mbin mtight">−</span><span class="mord mathnormal mtight" style="margin-right:0.01968em;">l</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2083em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.9385em;vertical-align:-0.3552em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em;"><span style="top:-2.5198em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mbin mtight">−</span><span class="mopen mtight">(</span><span class="mord mathnormal mtight" style="margin-right:0.01968em;">l</span><span class="mbin mtight">−</span><span class="mord mtight">1</span><span class="mclose mtight">)</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.3552em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6667em;vertical-align:-0.0833em;"></span><span class="minner">⋯</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.7917em;vertical-align:-0.2083em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2083em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.7778em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2806em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.7917em;vertical-align:-0.2083em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2083em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6667em;vertical-align:-0.0833em;"></span><span class="minner">⋯</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mbin mtight">+</span><span class="mord mathnormal mtight" style="margin-right:0.01968em;">l</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2083em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span></span></p><p>目前测试发现和<code>{y}_</code>的<code>{}</code>有相关，若是<code>\hat y_{t}</code>则不会出现问题。且只会在本地测试时出问题</p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div>              </div>            </details><h3 id="公式块自动编号">公式块自动编号</h3><p>利用 <code>\begin&#123;equation&#125;</code> 进行公式编号</p><details class="folding-tag" blue><summary> 使用方法 </summary>              <div class='content'>              <p>可以用以下方式对公式进行自动编号</p><figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line">$$</span><br><span class="line">\begin&#123;equation&#125;</span><br><span class="line">1+1=2</span><br><span class="line">\end&#123;equation&#125;</span><br><span class="line">$$</span><br></pre></td></tr></table></figure><p>这是没用的：</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mn>1</mn><mo>+</mo><mn>1</mn><mo>=</mo><mn>2</mn></mrow><annotation encoding="application/x-tex">1+1=2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7278em;vertical-align:-0.0833em;"></span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">2</span></span></span></span></span></p><p>这是用了的：</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mtable rowspacing="0.16em" columnspacing="1em"><mtr><mtd class ="mtr-glue"></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mn>1</mn><mo>+</mo><mn>1</mn><mo>=</mo><mn>2</mn></mrow></mstyle></mtd><mtd class ="mtr-glue"></mtd><mtd class ="mml-eqn-num"></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{equation}1+1=2\end{equation}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.2em;vertical-align:-0.35em;"></span><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.85em;"><span style="top:-3.01em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord">1</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.35em;"><span></span></span></span></span></span></span></span><span class="tag"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.85em;"><span style="top:-2.85em;"><span class="pstrut" style="height:2.84em;"></span><span class="eqn-num"></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.35em;"><span></span></span></span></span></span></span></span></span></p>              </div>            </details><h2 id="网站管理">网站管理</h2><h3 id="网站验证与提交">网站验证与提交</h3><p>使用 <a href="https://github.com/hexojs/hexo-generator-sitemap"><code>hexo-generator-sitemap</code></a> 插件</p><details class="folding-tag" blue><summary> 使用方法 </summary>              <div class='content'>              <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">npm install hexo-generator-sitemap --save</span><br></pre></td></tr></table></figure><p>并在 <code>_config.yml</code> 文件中添加：</p><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="comment"># hexo-generator-sitemap</span></span><br><span class="line"><span class="attr">sitemap:</span></span><br><span class="line">  <span class="attr">path:</span> </span><br><span class="line">    <span class="bullet">-</span> <span class="string">sitemap.xml</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">sitemap.txt</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">  <span class="attr">template_txt:</span></span><br><span class="line">  <span class="attr">rel:</span> <span class="literal">false</span></span><br><span class="line">  <span class="attr">tags:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">categories:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure><p>各参数可参考该插件的说明。</p><p>在各搜索引擎上验证网站，按照各搜索引擎的流程进行验证即可。之后便可以提交网站地图了，需要注意的是，在 <code>Google Search Console</code> 上提交网站地图是，可能会出现<u>无法获取</u>的情况，排除网站地图的问题后，说明可能遇到了 <code>Bug</code> ，状态显示是有误的。参见：<a href="https://support.google.com/webmasters/thread/3105916?hl=en">Sitemap could not be read in new GSC - Google Search Central Community</a></p>              </div>            </details><h3 id="网站-RSS-生成">网站 RSS 生成</h3><p>使用 <a href="https://github.com/hexojs/hexo-generator-feed"><code>hexo-generator-feed</code></a>插件</p><details class="folding-tag" blue><summary> 使用方法 </summary>              <div class='content'>              <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">npm install hexo-generator-feed --save</span><br></pre></td></tr></table></figure><p>并在 <code>_config.yml</code> 文件中添加：</p><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="comment"># hexo-generator-feed</span></span><br><span class="line"><span class="attr">feed:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">atom</span></span><br><span class="line">  <span class="attr">path:</span> <span class="string">atom.xml</span></span><br><span class="line">  <span class="attr">limit:</span> <span class="number">20</span></span><br><span class="line">  <span class="attr">hub:</span></span><br><span class="line">  <span class="attr">content:</span></span><br><span class="line">  <span class="attr">content_limit:</span> <span class="number">140</span></span><br><span class="line">  <span class="attr">content_limit_delim:</span> <span class="string">&#x27; &#x27;</span></span><br><span class="line">  <span class="attr">order_by:</span> <span class="string">-date</span></span><br><span class="line">  <span class="attr">icon:</span> <span class="string">icon.png</span></span><br><span class="line">  <span class="attr">autodiscovery:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">template:</span></span><br></pre></td></tr></table></figure><p>各参数可参考该插件的说明。</p><p>之后就可以愉快地订阅啦~</p>              </div>            </details><h2 id="其他参考网站">其他参考网站</h2><details class="folding-tag" blue><summary> 参考网站 </summary>              <div class='content'>              <ul><li><p><a href="https://zhuanlan.zhihu.com/p/102592286">从零开始搭建个人博客（超详细） - 知乎 (zhihu.com)</a></p></li><li><p><a href="https://shoka.lostyu.me/computer-science/note/theme-shoka-doc/dependents/">Step.1 依赖插件 - Theme Shoka Documentation - 二进制杂谈 - 计算机科学 | Yume Shoka = 優萌初華 = 有夢書架 (lostyu.me)</a></p></li><li><p><a href="https://www.cnblogs.com/glassysky/p/13394579.html">Hexo博客美化之蝴蝶(butterfly)主题魔改 - 远方有你，伴余生 - 博客园 (cnblogs.com)</a></p></li><li><p><a href="https://www.zhihu.com/question/21193762">使用hexo，如果换了电脑怎么更新博客？ - 知乎 (zhihu.com)</a></p></li><li><p><a href="https://swayye.xyz/2020/01/10/hexo%E5%8D%9A%E5%AE%A2%E8%BF%81%E7%A7%BB/">hexo博客迁移 | 一葉扁舟 (swayye.xyz)</a></p></li><li><p><a href="https://loafing.cn/posts/hexo-tags.html">「推荐」本站用到的 hexo 插件 | 若风 (loafing.cn)</a></p></li><li><p><a href="https://226yzy.com/2022/010948485.html">更换Butterfly主题及其美化记录 | 星空下的YZY (226yzy.com)</a></p></li></ul>              </div>            </details><script src="https://unpkg.com/mini-sandbox@0.3.11"></script><script src="/html/博客搭建备忘录/sandbox.js"></script>]]></content>
      
      
      <categories>
          
          <category> 博客相关 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 博客搭建 </tag>
            
            <tag> 博客魔改 </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
